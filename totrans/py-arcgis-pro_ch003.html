<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="packt"/>
<title>Basics of ArcPy</title>
<link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css"/>
<link rel="stylesheet" type="text/css" href="../styles/stylesheet2.css"/>

</head>
<body>

<section id="basics-of-arcpy" class="level1 pkt" data-number="3">
<h1 data-number="3">Basics of ArcPy</h1>
<p>Now that you have an understanding of python syntax you can start working with the <strong>ArcPy</strong> package. ArcPy is the Python package provided by ArcGIS to perform and automate geoprocessing and map production tools tasks. In addition to the <strong>geoprocessing</strong> tools available in ArcGIS you have access to additional modules, functions, and classes. When combined you can create workflows and standalone tools that simplify and automate complex analysis and map production.</p>
<p>This chapter will cover:</p>
<ul>
<li>Ensuring your Python Environment is set up for ArcPy</li>
<li>ArcPy Tools and how to use them in ArcGIS Pro</li>
<li>Accessing <strong>environment settings</strong> in ArcPy</li>
<li><strong>Functions</strong> in ArcPy</li>
<li>ArcPy <strong>Module</strong>s</li>
</ul>
<section id="checking-your-arcpy-install" class="level2" data-number="3.1">
<h2 data-number="3.1">Checking your ArcPy Install</h2>
<p>The ArcPy package allows you access to the geoprocessing function of ArcGIS Pro. Python packages contain multiple modules, functions, and classes. A package is set up with a hierarchical structure and uses dot notation for the modules and functions.</p>
<p>ArcPy is installed with ArcGIS for Pro and ArcGIS Desktop. ArcPy has been used to write Python scripts in ArcGIS since ArcGIS 10.0. It is the official ArcGIS scripting language and can be used to automate analysis and map production workflows. ArcGIS desktop uses Python 2.7, which is currently up to release 2.7.18. ArcGIS Pro uses a new version of Python, Python 3. The most recent release of Python 3 is Python 3.9.5. You can check what version of Python you have installed by going to the <strong>Project&gt;Python&gt;Installed Packages</strong> and finding <strong>Python.</strong></p>
<figure>
<img src="../media/file18.png" />
</figure>
<figure>
<img src="../media/file19.png" />
</figure>
<figure>
<img src="../media/file20.png" />
</figure>
<p>To use the ArcPy package it must be imported. Most scripts start with import statements to allow access to all the modules that are part of the package. To import ArcPy use the following line of code:</p>
<pre><code>import arcpy</code></pre>
<p>Importing ArcPy gives access to all of the geoprocessing tools and the modules included.</p>
<p>Some of the modules are:</p>
<ul>
<li><strong>Arcpy.sa</strong> (Spatial Anlayst)</li>
<li><strong>Arcpy.geocoding</strong> (Geocoding)</li>
<li><strong>Arcpy.na</strong> (Network Analyst)</li>
<li><strong>Arcpy.da</strong> (Data Access)</li>
<li><strong>Arcoy.mp</strong> (Mapping)</li>
</ul>
<p>Later chapters will take a closer at the data access and mapping modules. Both of those are very powerful and can automate work.</p>
<section id="python-idle-shell-for-arcgis-pro-install" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1">Python IDLE Shell for ArcGIS Pro Install</h3>
<p>Since Python and ArcPy are installed with ArcGIS Pro, if you are using the <strong>IDLE Shell</strong> for the version of Python installed with ArcGIS Pro you will not get an error when importing ArcPy. If you are using a different Python interpreter you will have to set it up to find the ArcPy module. Most of the time you will be writing scripts either directly into ArcGIS Pro’s Python window, an ArcGIS Notebook in ArcGIS Pro, or to turn into script tools, so it is easiest to use the Python IDLE that comes with the ArcGIS Pro install.</p>
<blockquote>
<p>The easiest way to ensure accessing the Python IDLE that comes with the install of ArcGIS Pro is to create a shortcut, as one is not created on install.</p>
</blockquote>
<ul>
<li><p>Find the path to run IDLE, for a typical ArcGIS Pro installation it is here: <code>C:\Program Files\ArcGIS\Pro\bin\Python\envs\arcgispro-py3\Lib\idlelib\idle.bat</code> <em>Double clicking</em> on that will open IDLE:</p>
<figure>
<img src="../media/file21.png" />
</figure></li>
<li><p>To create a shortcut, <em>right click</em> on your <strong>desktop</strong> and <em>click</em> <strong>New&gt;Shortcut</strong> and paste the full path of the idle.bat file:</p>
<figure>
<img src="../media/file22.png" />
</figure></li>
<li><p><em>Click</em> <strong>Next</strong>, and then give your shortcut name:</p>
<figure>
<img src="../media/file23.png" />
</figure>
<blockquote>
<p>I suggest using a name that will allow you to remember this is the Python environment that was installed with ArcGIS Pro.</p>
</blockquote></li>
<li><p>The icon will be the default shortcut icon</p>
<figure>
<img src="../media/file24.png" alt="." /><figcaption aria-hidden="true">.</figcaption>
</figure></li>
<li>To change the icon to the standard Python IDLE Icon:
<ul>
<li><em>Right click</em> on it</li>
<li><em>Click</em> <strong>Properties</strong>.</li>
<li><p>On the <strong>Shortcut</strong> tab <em>click</em> <strong>on Change Icon</strong>.</p>
<blockquote>
<p>You may get an alert that there are no icons and that you need to choose an icon from a different file. If so click okay so you can navigate to the icon location.</p>
</blockquote></li>
<li>Navigate to the Python IDLE location, which should be located here: <code>C:\Program Files\ArcGIS\Pro\bin\Python\envs\arcgispro-py3\Lib\idlelib\Icons</code></li>
</ul></li>
<li>A shortcut to access the IDLE install for ArcGIS Pro is now installed on the desktop. This install is a place to test snippets of code when working on complex scripts tools. Something that will be explored in later chapters.</li>
</ul>
<figure>
<img src="../media/file25.png" />
</figure>
<p><em>When you want to use an IDLE to work with ArcGIS Pro you need to use this one as it is associated with your install of ArcGIS Pro.</em></p>
<blockquote>
<p>A good way to ensure the correct IDLE is being used is to import arcpy. If three carets &gt;&gt;&gt; will be displayed after the install was successful</p>
</blockquote>
<figure>
<img src="../media/file26.png" />
</figure>
<p>If not an error will be displayed:</p>
<figure>
<img src="../media/file27.png" />
</figure>
<section id="the-python-idle-shell" class="level4" data-number="3.1.1.1">
<h4 data-number="3.1.1.1">The Python IDLE Shell</h4>
<p>The Python IDLE Shell is a good place to try out code as it is interactive and will display immediate results to code:</p>
<figure>
<img src="../media/file28.png" />
</figure>
<p>The IDLE Shell also shows how elements of the code will be interpreted using different colors. Strings are shown in green, functions are in purple, loops and condition statements are in orange, and results are in blue.</p>
<p>While it is useful to get immediate results from IDLE Shell it is not meant to be used for saving code. It is possible to copy it out if needed, but it is better practice to write it into a script file for saving.</p>
<blockquote>
<p>To start a script file you <em>click</em> in the menu bar of the IDLE Shell on <strong>File&gt;New File</strong>. This opens a new window that is an empty Python script file called Untitled. Unlike the IDLE Shell it doesn’t have a command prompt and the menu bar is different.</p>
</blockquote>
<figure>
<img src="../media/file29.png" />
</figure>
<p>You can create a script file</p>
<ul>
<li>Copy the previous code you wrote in IDLE into the script file</li>
<li>Remove the carets</li>
<li>Fix the indentation to match below.</li>
<li>Save the file.</li>
</ul>
<figure>
<img src="../media/file30.png" />
</figure>
<figure>
<img src="../media/file31.png" />
</figure>
<p>This new file <code>HelloLoop.py</code> has <code>.py</code> extension signifying that it is a Python file. It can be run by clicking <strong>Run &gt; Run Module</strong>. Sending the results to the Python IDLE Shell.</p>
<figure>
<img src="../media/file32.png" />
</figure>
<p>Now that you have an understanding of</p>
<ul>
<li>How to ensure your Python environment is set up to work with ArcPy</li>
<li>How to use the IDLE Shell</li>
<li>How to start a new script file</li>
</ul>
<p>You are now ready to look at the Python window in ArcGIS Pro and what you can do there.</p>
</section>
</section>
<section id="python-window-in-arcgis-pro" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2">Python Window in ArcGIS Pro</h3>
<p>ArcPy can be accessed not just through IDLE but by using the Python window in ArcGIS Pro.</p>
<figure>
<img src="../media/file33.png" />
</figure>
<p>The Python window allows you to write and run code directly in ArcGIS Pro and see the results of any geoprocessing tool as you run them. This can be an advantage when testing out new code to see what it is doing and how it is working. Code written in the Python window can then be copied or saved into large script tools. You will learn more about script tools in later chapters. For now let’s look at the Python window in ArcGIS Pro and see how powerful it can be.</p>
<p>Once you click on the icon the Python window will pop up, usually the first time it will be docked at the bottom of your screen.</p>
<figure>
<img src="../media/file34.png" />
</figure>
<p>Like all windows in ArcGIS Pro the Python window can be docked anywhere or can be floating. You can move it to where it is best for you to work using the same process of dragging and hiding as you would any ArcGIS Pro window.</p>
<p>The top part of the window is called the <strong>transcript</strong> and is where code you have previously written is. The bottom where it says <strong>Enter Python code here</strong> is called the <strong>prompt</strong> and is where you would type code into. When you first open the Python window the transcript is blank as you haven’t written any code yet.</p>
<p>Try some of the code you wrote in IDLE to see how it works in the Python window. Just like in IDLE when you enter a line of code you need to press <em>Enter</em>.</p>
<ul>
<li><p>Type in <code>x = 10 a</code>nd Press <em>Enter</em></p>
<figure>
<img src="../media/file35.png" />
</figure></li>
<li><p>Type in <code>y = 3</code> and Press <em>Enter</em></p>
<figure>
<img src="../media/file36.png" />
</figure></li>
<li>Type <code>x + y a</code>nd press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file37.png" />
</figure>
<p>You can see that this is working just like IDLE. <em>This means that all standard Python functions and tools will work in the Python window the same as they would in the IDLE Shell</em>.</p>
<blockquote>
<p>The transcript can be cleared at any time by right clicking in the transcript box and selecting Clear Transcript. This does not remove your code or your variables from memory.</p>
</blockquote>
<ul>
<li><p>Click in the transcript and select <strong>Clear Transcript</strong>.</p>
<figure>
<img src="../media/file38.png" />
</figure></li>
<li>Type <code>x + y</code> And press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file39.png" />
</figure>
<p>As you can see the variables for x and y were saved in memory and still usable even after clearing the transcript. These variables are even available if you save and close the project and open it again. <em>They are saved into the memory of the project so they can be used again later on the same project.</em> This can be useful but you will look at better ways to save code for reuse in the same and other projects in a later chapter.</p>
<p>Just like in the IDLE Shell the Python Window understands when you are writing multiple lines of connected code. You can see this by writing in the for the HelloLoop.py script you wrote earlier in this chapter.</p>
<ul>
<li>Type in <code>String = “Hello”</code> and press <em>Enter</em></li>
<li>Type in <code>i = 1</code> and press <em>Enter</em></li>
<li><p><em>Type in</em> <code>while i &lt; 5:</code> and press <em>Enter</em></p>
<blockquote>
<p>Notice that the prompt window gets bigger and your cursor is indented. The Python Window understands that while statement is starting a block of code and is part of a multiline construct. As you continue to type in your code the prompt window will get bigger as additional lines are needed. The if statement is part of a multiline construct so it too will get the additional lines and indent as the while statement does</p>
</blockquote></li>
<li>Type in <code>if i == 1:</code> and press <em>Enter Enter</em></li>
<li>Type in <code>print(string)</code> and press Enter</li>
<li>Type in <code>else:</code> and press <em>Enter</em></li>
<li>Type in <code>print(i)</code> and press <em>Enter</em></li>
<li>Type in <code>i+=1</code> and press <em>Enter</em></li>
<li>Press <em>Enter</em></li>
</ul>
<blockquote>
<p>When you are doing writing your multiple lines of code and hit Enter you will just move down another line</p>
</blockquote>
<figure>
<img src="../media/file40.png" />
</figure>
<figure>
<img src="../media/file41.png" />
</figure>
<blockquote>
<p><strong>What happens if you forget the i += 1 and get an endless loop? How do you stop the loop?</strong></p>
<p>You can either click the X in the bottom of the Python Window to stop the execution.</p>
<p>Or type <em>Ctrl</em>+<em>C</em> in the prompt window to stop the execution.</p>
</blockquote>
<figure>
<img src="../media/file42.png" />
</figure>
<figure>
<img src="../media/file43.png" />
</figure>
</section>
<section id="arcpy-environment-settings" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3">ArcPy Environment Settings</h3>
<ul>
<li>ArcPy environment settings allow you access to general geoprocessing settings as well as the geoprocessing settings of a specific tool.</li>
<li>For tools they act as parameters you can set to change the results of a tool.</li>
<li>There are many that can be used but you will find yourself using a few of them commonly.</li>
</ul>
<p>You are going to look at the most common one and see how to set it: <code>arcpy.env.workspace</code>.</p>
<blockquote>
<p>Using the workspace property of the environment class you can check and change your workspace or scratch workspace</p>
</blockquote>
<pre><code>arcpy.env.workspace
arcpy.env.scratchWorkspace</code></pre>
<p>You can check and set your <strong>workspace</strong></p>
<ul>
<li>Type in <code>arcpy.env.workspace</code> and press <em>Enter</em></li>
</ul>
<p>The return you see is your current workspace.</p>
<figure>
<img src="../media/file44.png" />
</figure>
<p>Now you can set your workspace</p>
<ul>
<li>Type in <code>arcpy.env.workspace =  r"C:\PythonBook\Project_2\Project_2.gdb"</code> and press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file45.png" />
</figure>
<p>You can check your scratch workspace in a similar way</p>
<ul>
<li><code>Type in arcpy.env.workspace </code>and press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file46.png" />
</figure>
<code> </code>
<p>Now you can set your scratch workspace</p>
<ul>
<li><code>Type in arcpy.env.scratchWorkspace = r”C:\PythonBook\Project_2\Project_2.gdb”</code> and press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file47.png" />
</figure>
<code> </code>
<p>Setting your scratch workspace and workspace is a good idea as it allows you to have a default location to send data you are creating. It is also the workspace that will be used when using the List functions you will explore below. In the examples you have set your workspace and scratch workspace to geodatabases. You could set them to folder or a feature dataset or any workspace you wanted.</p>
<blockquote>
<p><strong>What is the r in front of the path for the geodatabase?</strong></p>
<p>Note the way you type in the locations. It has an r followed by the location enclosed in a double quote. The r stands for “raw string” and means that Python will read everything within the quotes exactly as it is written. This is important because the \ character in Python is an escape character and can be used to insert characters otherwise not allowed in a string. You have already seen how to use the escape character in a query to get quotes within the quotes of a string. Here though you don’t want the escape character so there are 3 options.</p>
<p>Use an r in front of the quotes to create a raw string</p>
<p>Change all the single \ to double \</p>
<p>Change the single to \</p>
</blockquote>
<p>There are many other environment settings that could be useful to you depending on the process you are running. Most of the settings that you find for a tool in the properties of a tool can be set in the environment settings. Things like analysis extent can be set with <code>arcpy.env.extent</code>, or a snap raster when doing raster analysis with <code>arcpy.env.snapRaster</code>.</p>
<p>It is important to remember that once you set an environment setting it stays set until you change it. You can change it and in more advanced script tools you will change it or have it set and reset throughout the code.</p>
</section>
<section id="arcpy-tools---geoprocessing-using-arcpy" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4">ArcPy Tools - Geoprocessing using ArcPy</h3>
<p>Now that you have some of the basics of how to use the Python Window it is time to look at how to use geoprocessing tools.</p>
<ul>
<li>You will learn how to use select, buffer, make feature layer, and select by feature layer tool, add field, and calculate field tools in the Python window.</li>
<li>The end result will be a feature class of bus stops within 1,000 feet of parks.</li>
</ul>
<p>To do some geoprocessing you will need some data. Make sure you have a map open in ArcGIS Pro and add in the CPAD_2020b_Units.shp data from where you downloaded it to. This data is California Protected Areas Database data that shows parks and other protected areas throughout the state of California. For more information about the dataset please go to <a href="https://www.calands.org/">https://www.calands.org/</a>.</p>
<p>You are going to use the Python window to select the a parks in Oakland, buffer them by 1,000 feet and select the bus stops within that 1,000 foot buffer, and write them to out to a new feature class.</p>
<p>Right click in the table of contents and select <strong>attribute table</strong> and see what the data shows.</p>
<figure>
<img src="../media/file48.png" />
</figure>
<ol>
<li><p>You are going to use the <strong>AGENCY_NAME</strong> field to run a Select tool to create a new feature class of just the protected areas in the City of Oakland. You are going to do this in the Python Window by typing in the following: <code>arcpy.Se</code> The Python window shows you some autocomplete options to help you find the tool you want. You are using the Select tool from the Analysis Toolset so you want <strong>Select() analysis.</strong></p>
<figure>
<img src="../media/file49.png" />
</figure></li>
<li><p>After selecting the tool you can see what <strong>parameters</strong> the tool expects. Hover on the tool to get a help window popping up showing the tool parameters. The select tool takes the following mandatory parameters</p>
<ol>
<li><code>in_features</code></li>
<li><code>out_features,</code>
<ul>
<li>And the following optional parameter</li>
</ul></li>
<li><code>where_clause</code>. The where clause is in curly braces {} because it is optional.
<ul>
<li>The <code>in_features</code> is bold because it is the parameter the tool is currently looking to be entered. Type in the following in between the parenthesis to create the selection query <code>“CPAD_2020b_Units”,”CPAD_2020b_units_Oakland”,’”AGNCY_NAME = \’Oakland, City of\’</code> And press <em>Enter</em></li>
</ul></li>
</ol>
<figure>
<img src="../media/file50.png" />
</figure>
<figure>
<img src="../media/file51.png" />
</figure>
<figure>
<img src="../media/file52.png" />
</figure>
<p>After running it will look like this and you should have a new feature class that is just the protected areas in Oakland.</p>
<blockquote>
<p><strong>How to write the query in the where clause so it works? Using the escape character “\” properly</strong></p>
<p>The \ marks are escape characters that are necessary when you need to use multiple single or double quotes. In this instance since you are running a selection query on a shapefile the attribute field being selected on needs double quotes and the string value needs single quotes. The entire where clause needs to be inside a single or double quote. So the easiest option is wrap the entire query in a single quote and use the escape clauses around the string being selected. If you wanted to wrap the entire where clause in double quotes it would look like this <code>“/”AGNCY_NAME” = ‘Oakland, City of’” </code>Both will work the same.</p>
</blockquote>
<p>If you are working in an ArcGIS Pro project then a new file will be created in that project’s geodatabase as that is the default workspace. If you have set a workspace through the environment settings it will write to that workspace. If you are not then it will be stored in a temp space and not written to disk.</p>
<blockquote>
<p><strong>How do you specify a different workspace if you don’t want to use the default workspace?</strong></p>
<p>To specify a different location you need to write the full path when saving. To write out a shapefile to the <code>MyProject</code> folder you would write the following <code>arcpy.analysis.Select(“CPAD_2020b_Units”,r”C:\PythonBook\MyProject\CPAD_2020b_Units_Oakland.shp”,’”AGNCY_Name” = \’Oakland, City of\’’)</code></p>
</blockquote></li>
<li><p>Now you can take the selected parks and buffer them by 1,000 feet. The buffer tool is in the <strong>analysis</strong> <strong>toolbox</strong> so the call it you type <code>arcpy.analysis.Buffer()</code> You can see the buffer tool parameters the buffer tool takes by hovering in the parenthesis. It takes the following mandatory parameters in this order</p>
<ol>
<li><code>in_features</code></li>
<li><code>out_features</code></li>
<li><code>buffer_distance_or_field</code></li>
</ol>
<p>And the following optional parameters in this order</p>
<ol>
<li><code>line_side</code></li>
<li><code>line_end_type</code></li>
<li><code>dissolve_option</code></li>
<li><code>dissolve_field</code></li>
<li><code>method</code></li>
</ol>
<p>You want to have a buffer of 1,000 feet for the parks, dissolved to just the <code>UNIT_NAME</code>, <code>AGENCY_NAME</code>, and <code>LABEL_NAME</code>. To get this you will be typing in the <code>in_features</code>, <code>out_featuers</code>, <code>buffer_distance</code>, <code>dissolve_option</code>, and <code>dissolve_field paramaters</code>. The <code>in_features</code>, <code>out_features</code>, and <code>buffer_distance</code> are the first 3 parameters, but the <code>dissolve_option</code> and <code>dissolve_field</code> are the 6<sup>th</sup> and 7<sup>th</sup> parameters. To make sure they are in those positions you will type a pair of single or double quotes in the 4<sup>th</sup> and 5<sup>th</sup> parameters. This signifies to the function that those optional parameters are blank, just as if they weren’t entered; and allows you to enter parameters after them. Type in <code>“CPAD_2020b_Units_Oakland”,”CPAD_2020b_Units_Oakland_1000ft”,”1000 FEET”, “”,””,”LIST”,[“UNIT_NAME”,”AGNCY_NAME”,”LABEL_NAME”] </code>And press <em>Enter</em></p>
<figure>
<img src="../media/file53.png" />
</figure></li>
<li>The buffers should have been added to your map. You can explore them and see what they look like. When you are ready you are going to now make a feature layer of the bus stops feature class with the <strong>Make Feature Layer</strong> Tool type in <code>arcpy.management.MakeFeatureLayer(). </code>You can see that the Make Feature Layer tool takes two mandatory parameters
<ol>
<li><code>in_features</code></li>
<li><code>out_layer</code></li>
</ol>
And the following optional parameters
<ol>
<li><code>where_clause</code></li>
<li><code>workspace</code></li>
<li><code>field_info</code></li>
</ol></li>
<li><p>You are going to enter the following parameters to make a feature layer of all the bus stops by typing in the following inside the parenthesis. <code>“UniqueStops_Summer21”,”AC_TransitStops_Summer21” </code>And press <em>Enter</em></p>
<figure>
<img src="../media/file54.png" />
</figure>
<p><em></em></p>
<p><em></em></p></li>
<li>The feature layer should have been added to your map. You can explore it and see that it is just like the UniqueStops_Summer21 feature class. But because it is a feature layer you can use the <strong>Select Layer By Location</strong> tool to select all of the bus stops within the buffer. Type in <code>arcpy.management.SelectLayerByLocation()</code>. You can see that the Select Layer By Location tool takes one mandatory parameter
<ol>
<li><code>in_layer</code></li>
</ol>
And the following optional parameters
<ol>
<li><code>overlap_type</code></li>
<li><code>select_features</code></li>
<li><code>search_distance</code></li>
<li><code>selection_type</code></li>
<li><code>invert_spatial_relationship</code></li>
</ol></li>
<li><p>You are going to enter the following parameters to select the bus stops within the 1,000 foot buffer by typing in the following inside the parenthesis. <code>“AC_TransitStops_Summer21”,”INTERSECT”,”CPAD_2020b_Units_Oakland_1000ft”</code> And press <em>Enter</em></p>
<figure>
<img src="../media/file55.png" />
</figure>
<p><em></em></p></li>
<li>You should see the bus stops get selected. You can explore the data and see if this is what you were looking for. From here you can export your data to table, csv, or feature class. Or just use it for a map display. Right now you are going to export to a feature class for later use when you explore the data access module and using cursors. To do this you will use the <strong>Copy Features tool</strong>. Type in <code>arcpy.management.CopyFeatures()</code>. The Copy Features tool has two mandatory parameters
<ol>
<li><code>in_features</code></li>
<li><code>out_features</code></li>
</ol>
And one optional parameter
<ol>
<li><code>config_keyword</code></li>
</ol></li>
<li>You are going to enter the following parameters in the parenthesis to copy the selected bus stops out to a new feature class <code>“AC_TransitStops_Summer21”, “AC_TransitStops_Within1000ft_OaklandPark”</code></li>
</ol>
<figure>
<img src="../media/file56.png" />
</figure>
<em></em>
<p>Your resulting feature class is displayed in your map and written to your current workspace. The next steps with this data will be explored in Chapter 4: Data Access and Rows. In there you will learn how to do this process all in memory and add the park names to the bus stops.</p>
</section>
<section id="built-in-arcpy-functions" class="level3" data-number="3.1.5">
<h3 data-number="3.1.5">Built in ArcPy Functions</h3>
<p>ArcPy has many built in functions to help with geoprocessing. ArcPy functions look like geoprocessing tools in the way they are written. When you wrote the code to create a selection feature class you wrote <code>arcpy.analysis.select(in_features,out_features,{where_clause}</code>). By encasing the in features, out features, and where clause in parenthesis you were calling the function by passing to it those parameters. <em>That is all a function is, code that you can call later by passing different parameters to it.</em></p>
<p>ArcPy has functions to assist with things such as the environment settings, describing data, licensing, ArcGIS Online, raster, listing data, along with functions for specific modules like the spatial analyst of mapping modules. In this section you will explore two of the more commonly used built in functions</p>
<ul>
<li>Describe function</li>
<li>List functions</li>
</ul>
<p>These are common because they help you in setting up and completing iterative processes like doing the same analysis on different feature classes in one location.</p>
<section id="describe-function" class="level4" data-number="3.1.5.1">
<h4 data-number="3.1.5.1">Describe Function</h4>
<p>The describe function will return different properties depending on what type of element it is. <em>The describe function can be called on a variety of elements, including but not limited to: shapefiles, geodatabases, feature classes, feature datasets, tables, LAS files, rasters and map documents.</em></p>
<p>The describe function returns an object with all of the properties so you need to create a variable to hold those properties and then call them later. You can try this on CPAD data.</p>
<ul>
<li><p>Type <code>desc = arcpy.Describe(r”C:\PythonBook\cpad_2020b\CPAD_2020b\CPAD_2020b_Units.shp </code>And press <em>Enter</em></p>
<figure>
<img src="../media/file57.png" />
</figure></li>
<li><p>It looks like nothing has happened but now you can use that desc variable to get information about the shapefile. You can see is what data type this is by typing <code>desc.dataType</code> and press <em>Enter</em></p>
<figure>
<img src="../media/file58.png" />
</figure></li>
<li>You can also see what type of geometry a feature class has by typing in <code>desc.shapeType</code> and press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file59.png" />
</figure>
<blockquote>
<p>You can see that if you don’t know anything about a file you can call a describe function on it and use the properties to find out information about the file.<br />
In the sample above you know the data is a shapefile you can see how this information could be useful if you were searching through a folder and only wanted to run an analysis on the shapefiles.</p>
</blockquote>
</section>
<section id="list-functions" class="level4" data-number="3.1.5.2">
<h4 data-number="3.1.5.2">List Functions</h4>
<p>List functions are very powerful as they allow you to create a list of data in a workspace, which you can then iterate over. For these examples you are going to use the data in the <code>MyProject.gdb</code> geodatabase.</p>
<p>List functions take the current workspace you are in and will create a list of all the datasets for that type of list function. There are the following list functions</p>
<ul>
<li><code>ListDatasets</code></li>
<li><code>ListFeatureClasses</code></li>
<li><code>ListFields</code></li>
<li><code>ListFiles</code></li>
<li><code>ListIndexes</code></li>
<li><code>ListRasters</code></li>
<li><code>ListTables</code></li>
<li><code>ListVersions</code></li>
<li><code>ListWorkspace</code></li>
</ul>
<p><code>ListDatasets</code>, <code>ListFeatureClasses</code>, <code>ListFiles</code>, <code>ListRasters</code>, <code>ListTables</code>, and <code>ListWorkspaces</code> need to have the workspace set before being run as they will only run on the current workspace.</p>
<ul>
<li><p>Start by listing the workspaces that your <code>MyProject.gdb</code> is in. You need to first set your workspace to the location of the geodatabase. <code>arcpy.env.workspace = r”C:\\PythonBook\MyProject” </code>and press <em>Enter</em></p>
<figure>
<img src="../media/file60.png" />
</figure></li>
<li><p>Next assign the ListWorkspaces function to a variable called wksp, <code>wksp = arcpy.ListWorkspaces() </code>and press <em>Enter</em></p>
<figure>
<img src="../media/file61.png" />
</figure>
<blockquote>
<p>The <code>ListWorkspaces</code> function has two optional parameters,</p>
<blockquote>
<p>Wildcard - used to limit the values returned to the list to those that match what you put in.</p>
</blockquote>
<blockquote>
<p>Workspace Type - used to limit the types of workspace.</p>
</blockquote>
</blockquote></li>
<li><p>You can see what that looks like by just typing in <code>wksp </code>and press <em>Enter</em></p>
<figure>
<img src="../media/file62.png" />
</figure></li>
<li>You can see it is all of the workspaces that are standard when creating a new project in ArcGIS Pro. They are a bit hard to read in that list. So to make them easier to read iterate through the list printing out each one. Type in <code>for w in wksp: </code>and press <em>Enter</em> <code>print(w) </code>and press <em>Enter</em> and press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file63.png" />
</figure>
<p>Now you can really read what you have</p>
<figure>
<img src="../media/file64.png" />
</figure>
<p>This is great as you can see all the workspace in the folder. But you just want the geodatabases in the folder. This is where you can use the parameters. For this you can use the workspace type parameter. The workspace parameter takes the following values as strings</p>
<ul>
<li>Access - personal geodatabases will be selected</li>
<li>Coverage - coverage workspaces will be selected</li>
<li>FileGDB - file geodatabases will be selected</li>
<li>Folder - shapefile workspaces will be selected</li>
<li>SDE - enterprise databases will be selected</li>
<li>All - all workspaces - this is the default</li>
</ul>
<p>To select just the file geodatabase you need to write this.</p>
<pre><code>wksp = arcpy.ListWorkspaces(&quot;&quot;,&quot;FileGDB&quot;)</code></pre>
<blockquote>
<p><strong>Why is there a “” followed by a ,?</strong></p>
<p>The first parameter is for the wildcard and writing “” will leave it blank. That needs to be there though as functions take the parameter in the order they are written in. If you write it like this <code>wksp = arpcy.ListWorkspaces(“FileGDB”)</code> the function will still run. But when you call it you won’t have any data in the list because there is no workspace called “FileGDB”</p>
</blockquote>
<p>You can see when calling the <code>wksp</code> variable you now have a list of just one value the <code>MyProject.gdb</code></p>
<figure>
<img src="../media/file65.png" />
</figure>
<p>While there is just the one value in the list it is still a list and acts as such in Python. That means that functions in ArcPy that expect a string will fail if given a list. For example you cannot update the workspace to this geodatabase location by using the <code>wksp</code> variable</p>
<figure>
<img src="../media/file66.png" />
</figure>
<blockquote>
<p>The elements of the list can be set as the workspace through by using different methods on the list. If you wanted to set each element of the list as a workspace you could do the following</p>
<blockquote>
<p>Type <code>for w in wksp: </code>press <em>Enter</em></p>
</blockquote>
<blockquote>
<p>Type <code>arcpy.env.workspace = w</code> press <em>Enter</em></p>
</blockquote>
<blockquote>
<p>Type <code>print(arcpy.env.workspace)</code> press <em>Enter</em> press <em>Enter</em></p>
</blockquote>
</blockquote>
<figure>
<img src="../media/file67.png" />
</figure>
<blockquote>
<p><strong>What if you know you only have a single workspace that you are targeting?</strong></p>
<p>In this example you only have one item in the list so it only runs once. In these cases where you do only have one item you could just write this <code>w = wksp[0]</code></p>
</blockquote>
<figure>
<img src="../media/file68.png" />
</figure>
<blockquote>
<p>In fact when you know you only have one item in your list you can just write the following to set you workspace <code>arcpy.env.workspace = ListWorkspaces(“”,”FileGDB”)[0]</code><em>Be careful with using this notation as if you have more than workspace you will only be setting the workspace to the first one on the list</em></p>
</blockquote>
<p>Now that the workspace is set to your geodatabase you can use the ListFeatureClasses function to get a list of all the feature classes in the geodatabase and assign it to a variable.</p>
<p>You are going to write the code to get a list of feature classes and then write a for loop to iterate through the list so you can easily read what feature classes are in your list</p>
<figure>
<img src="../media/file69.png" />
</figure>
<ul>
<li><code>fcs = arcpy.ListFeatureClasses()</code>press <em>Enter</em></li>
<li><code>for fc in fcs:</code> press <em>Enter</em></li>
<li><code>print(fc)</code> press <em>Enter.</em> press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file70.png" />
</figure>
<p>You now have a list that contains all the feature classes in your geodatabase. This list can be iterated through to give you a single feature class which you can run through other ArcPy functions or geoprocessing tools. You could use the Describe function from above to find only the feature classes of a certain geometry to make sure you only run your analysis on that.</p>
<p>You are starting with your list of feature classes stored in the variable fcs and will iterate through it like above when you just printed out the name. You will then determine use the ShapeType Property of feature classes to determine what the shape is of each feature class and print out a statement saying that.</p>
<p>The following code is what you will write into the Python window</p>
<pre><code>for fc in fcs:
    desc = arcpy.Describe(fc)
    fcName = desc.name
    if desc.shapeType == &quot;Polygon&quot;:
        print(&quot;Shape Type for &quot; + fcName + &quot; is &quot; + desc.ShapeType)
    elif desc.shapeType == &quot;Polyline&quot;:
        print(&quot;Shape Type for &quot; + fcName + &quot; is &quot; + desc.ShapeType)
    elif desc.ShapeType == &quot;Point&quot;:
        print(&quot;Shape Type for &quot; + fcName + &quot; is &quot; + desc.ShapeType)
    else:
        print(fcName + &quot; is not a Point, Line, or Polygon&quot;)</code></pre>
<p>These are the steps to write it in</p>
<ul>
<li><code>for fc in fcs: </code>and press <em>Enter</em></li>
<li><code>desc = arcpy.Describe(fc) </code>and press <em>Enter</em></li>
<li><code>fcName = desc.name </code>and press <em>Enter</em></li>
<li><code>if desc.shapeType == “Polygon”: </code>and press <em>Enter</em></li>
<li><code>print(“Shape Type for “ + fcName + “ is “ + desc.ShapeType) </code>and press <em>Enter</em></li>
<li><code>elif desc.ShapeType == “Polyline”: </code>and press <em>Enter r</em></li>
<li><code>print(“Shape Type for “ + fcName + “ is “ + desc.ShapeType) </code>and press <em>Enter</em></li>
<li><code>elif desc.ShapeType == “Point”: </code>and press <em>Enter</em></li>
<li><code>print(“Shape Type for “ + fcName + “ is “ + desc.ShapeType) </code>and press <em>Enter</em></li>
<li><code>else: </code>and press <em>Enter</em></li>
<li><code>print(fcName + “ is not a Point, Line, or Polygon”) </code>and press <em>Enter</em> press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file71.png" />
</figure>
<p>The for loop will iterate through each feature class. For that feature class you are creating a variable to hold the Describe properties of that feature class. You then create a variable to hold the name of that feature class. Then you write if/elif/else statements to test the ShapeType property of the Describe object. The output statement will look like this.</p>
<figure>
<img src="../media/file72.png" />
</figure>
<blockquote>
<p><strong>Could the if/elif statement be condensed?</strong></p>
<p>Yes it could be, depending on what you wanted. But if you don’t know what you are looking for sometimes it can be better to be specific. And now that you have this code written out you can save it and copy and paste certain sections. For example if you wanted to run separate geoprocessing tools on the point, lines, and polygons in your geodatabase you now have the sample if/elif statement to use.</p>
</blockquote>
<p>Another way to select elements in the List functions before putting them into the list is to use the <strong>wildcard parameter</strong>. The wildcard limits what the function returns. It is not case sensitive and uses the * to include any number of characters before or after the *. Let’s look at some examples of this works using our current geodatabase workspace.</p>
<p>You can select all of the CPAD data</p>
<ul>
<li><p>type in <code>cpad_fcs = arcpy.ListFeatureClasses(“CPAD*”)</code> and press <em>Enter</em></p>
<figure>
<img src="../media/file73.png" />
</figure></li>
<li>View what is the list using a for loop. Type in <code>for fc in cpad_fcs:</code> and press <em>Enter</em></li>
<li>Type in <code>print(fc)</code> and press <em>Enter</em> and press <em>Enter</em></li>
</ul>
<figure>
<img src="../media/file74.png" />
</figure>
<p>The wildcard is finding any feature class that starts with CPAD the * then tells it to match anything after CPAD. You can see in the results that you now have a list that contains all the CPAD feature classes.</p>
<blockquote>
<p>The * can be used after, before, or before and after any characters.</p>
</blockquote>
<p>You could select just the CPAD units and super units by writing this</p>
<pre><code>cpad_fcs_units = arcpy.ListFeatureClasses(“*Units”)</code></pre>
<p>And verify using the for loop to print out</p>
<pre><code>for fc in cpad_fcs_units:
  print(fc)</code></pre>
<figure>
<img src="../media/file75.png" />
</figure>
<p>And the wildcard could be used to select just the census feature classes with 2019 in them by writing this</p>
<pre><code>census_fcs = arcpy.ListFeatureClasses(“*2019*”)</code></pre>
<p>And verify using the for loop to print out</p>
<pre><code>for fc in census_fcs:
  print(fc)</code></pre>
<figure>
<img src="../media/file76.png" />
</figure>
<p>The wildcard is one of the optional parameters in many of the list functions and can be used with the other parameters. The <code>ListFeatureClasses</code> function has a parameter for feature type, and feature dataset. The feature type parameter can be used to select specific feature types, including but not limited to: point, polygon, polyline. The feature dataset can be used to specify the feature dataset in a geodatabase that is to be searched for feature classes. If no feature dataset is specified the <code>ListFeatureClasses</code> function will only look for stand alone feature classes in the geodatabase.</p>
<p>Using your <code>MyProjects.gdb</code> you can see how to combine both the wildcard and feature type parameters to get a specific feature class.</p>
<p>You can select just the census polygon feature class by writing the following</p>
<pre><code>census_fc_poly = arcpy.ListFeatureClasses(“*2019*”, “Polygon”)</code></pre>
<p>And verify by entering the variable</p>
<pre><code>census_fc_poly</code></pre>
<figure>
<img src="../media/file77.png" />
</figure>
<p>Note that the feature class is stored within the [] as it is in a list. To do any geoprocessing tasks on this you either need to iterate through the list and do the tasks in the for loop or extract the feature class using the list index to grab whichever list index you need.</p>
<pre><code>census_county = census_fc_poly[0]</code></pre>
<figure>
<img src="../media/file78.png" />
</figure>
<p>Note that what the <code>census_county</code> variable returns is the name of the feature class. As long as your workspace is still the geodatabase you can use just that name to do geoprocessing tasks. But if you reset your workspace ArcPy won’t know where to find the feature class with that name. So it is good practice to use the <code>os</code> library to create a variable that contains the full path for your feature class. To use the <code>os</code> library it needs to be imported like ArcPy when working in IDLE.</p>
<ul>
<li>Type in <code>import os</code> and press <em>Enter</em></li>
<li>Now you can create a variable with the census feature class full path. Type in <code>gdb = wksp[0] </code>and press <em>Enter</em></li>
<li><em>Type in</em> <code>census_county_full = os.path.join(gdb,census_county) </code>and press <em>Enter</em></li>
</ul>
<p>Now you have the full path for the census county shapefile in a variable that you can use throughout any further code you may write.</p>
<figure>
<img src="../media/file79.png" />
</figure>
</section>
</section>
<section id="introduction-to-arcpy-modules" class="level3" data-number="3.1.6">
<h3 data-number="3.1.6">Introduction to ArcPy Modules</h3>
<p>ArcPy comes with a set of modules in addition to the geoprocessing tools and functions. Modules are just files that contain additional Python definitions and statements, including things like functions and variables. They are used to help organize code more logically.</p>
<p>ArcPy comes with the following modules</p>
<ul>
<li>Charts module (<code>arcpy.charts</code>)</li>
<li>Data Access module (<code>arcpy.da</code>)</li>
<li>Geocoding module (<code>arcpy.geocoding</code>)</li>
<li>Image Analysis module (<code>arcpy.ia</code>)</li>
<li>Mapping module (<code>arcpy.mp</code>)</li>
<li>Metadata module (<code>arcpy.metadata</code>)</li>
<li>Network Analyst module (<code>arcpy.na</code> or <code>arcpy.nax</code>)</li>
<li>Sharing module (<code>arcpy.sharing</code>)</li>
<li>Spatial Analyst module (<code>arcpy.sa</code>)</li>
<li>Workflow Manager module (<code>arpcy.wmx</code>)</li>
</ul>
<p>Some of the above modules do require specific licenses to use the functions and tools within them. For example the network analyst module and spatial analyst module would require you to have network analyst and spatial analyst extensions available. The two you will look at in depth in later chapters, the data access module and the mapping module do not. The data access module can help you to streamline your data cleaning and analyses processes. The mapping module can streamline mass map production and make creating 100s of maps a simple process.</p>
<section id="spatial-analyst-module" class="level4" data-number="3.1.6.1">
<h4 data-number="3.1.6.1">Spatial Analyst Module</h4>
<p>The spatial analyst module contains all of the geoprocessing tools associated with the spatial analyst extension. Because it is uses the spatial analyst extension you need to import the extension.</p>
<pre><code>from arcpy.sa import *</code></pre>
<p>Just like with wild cards the star means everything. You could import just specific modules, classes, or functions from the spatial analyst module but most of the time you will be importing the entire module.</p>
<p>You will learn how to write the code to run spatial analyst tools in the Python window using the FVEG data from CalFire. The data is available here: <a href="https://frap.fire.ca.gov/mapping/gis-data/">https://frap.fire.ca.gov/mapping/gis-data/</a></p>
<ul>
<li>Load the <code>fveg15_1</code> data into the map</li>
<li>Right click on it and select <strong>Symbology</strong></li>
<li>Click the drop down where it says <strong>Stretch</strong> and select <strong>Unique Values</strong></li>
<li>Click on the drop down for <strong>Field 1</strong> and select WHR10Name. You can play with the colors and color scheme if you want. But also explore the data a little to see what is showing. It is a land cover dataset for the entire state of California. You are going to extract the data in the protected areas in the City of Oakland</li>
<li>Type in <code>from arcpy.sa import * </code>and press <em>Enter</em></li>
<li>If you created the feature class for the parks in the City of Oakland you can skip the next step</li>
<li>Type in <code>arcpy.analysis.Select(“CPAD_2020b_Units”,r”C:\PythonBook\MyProject\MyProject.gdb\CPAD_2020b_Units_Oakland”,’”AGNCY_NAME” = \’Oakland, City of\’’) </code>and press <em>Enter</em></li>
<li>Check if a spatial analyst extension is available by typing in <code>arcpy.CheckExtension(“Spatial”)</code> and press <em>Enter</em>. It should return <code>‘Available’</code> if not you need to either enable your spatial analyst license or if on a shared license network have someone release theirs.</li>
<li>Once you have confirmed a license is available type in <code>arcpy.CheckOutExtension(“Spatial”) </code>and press <em>Enter</em>. It should return<code> ‘Checked Out’</code></li>
<li>Type in <code>oaklandParksLandCover = ExtractByMask(“fveg15_1”,“CPAD_2020b_Units_Oakland”) </code>and press <em>Enter</em></li>
<li>Type in<code> oaklandParksLandCover.save(r”C:\MyProject\MyProject.gdb\OaklandParksLandCover”) </code>and press <em>Enter</em></li>
</ul>
<blockquote>
<p><strong>Why do you have to save the raster? Could it be done in a single line of code?</strong></p>
<p>When working with the spatial analyst extension in ArcPy and you run the geoprocessing tool it is actually a function. The function returns the extraction raster. That raster is created in memory, if you want to save you have to use the save property of that returned raster.</p>
<p>It could be done in one line of code. That would look like this <code>oaklandParksLandCover_2 = ExtractByMask("fveg15_1","CPAD_2020b_Units_Oakland").save(r"C:\PythonBook\MyProject\MyProject.gdb\OakalndParksLandCover_2")</code></p>
</blockquote>
<p>Now that you have this data you can find just the areas of the parks that are not urban by using the Con tool.</p>
<ul>
<li>Start by giving your raster a name, type in <code>oaklandParksNonUrban =</code></li>
<li>Call the Con tool by typing <code>con(</code></li>
<li>The first parameter is the input raster, it is our newly created parks land cover, type in <code>oaklandParksLandCover,</code></li>
<li>The next parameter is the true raster or constant, this is the value that the new raster will get. This is going to be the same raster, as you want to keep the different land covers that are not urban in the new raster, type in <code>oaklandParksLandCover,</code></li>
<li>The next parameter is an optional parameter and it is the false raster or constant. This is what the new raster will get in areas that are urban. You want it to be No Data so that all the areas of parks that are urban will be blank in the new raster, type in <code>“”,</code></li>
<li>The final parameter is an optional parameter and it is a where clause. This is written just like a query for running a select tool, type in <code>“WHR10NAME &lt;&gt; ‘Urban’”)</code></li>
<li>The full code should look like this <code>oaklandParksNonUrban = Con(oaklandParksLandCover,oaklandParksLandCover,””,”WHRNAME &lt;&gt; ‘Urban’”)</code></li>
<li>Open up the attribute table on the new raster in your table of contents. It only has a Value field and not the rest of the attributes. That is because the con tool just takes the Value attribute from the true raster. This can be fixed by doing a join.</li>
<li>The Join Field tool is in the management tool box and works on rasters as well as feature classes and creates a permanent join. Type in <code>arcpy.management.JoinField(</code></li>
<li>The first parameter is the input layer, type in <code>oaklandParksNonUrban,</code></li>
<li>The second parameter is the field to join on, type in <code>VALUE,</code></li>
<li>The third parameter is the table to be joined, type in <code>oaklandParksLandCover,</code></li>
<li>The fourth parameter is the field to join on from the join table, type in <code>VALUE,</code></li>
<li>The last parameter is optional and is the list of fields you want to join from the join table to the input layer. You can select the fields to join by using a list. If left blank it will join all of the fields. You are going to join the WHR fields, type in <code>[“WHRNUM”,”WHRNAME”,”WHRTYPE”,”WHR10NUM”,”WHR10NAME”,”WHR13NUM”,”WHR13NAME”]</code></li>
<li>The full code should look like this <code>arcpy.management.JoinField(oaklandParksNonUrban,”VALUE”,oaklandParksLandCover,”VALUE”,[ [“WHRNUM”,”WHRNAME”,”WHRTYPE”,”WHR10NUM”,”WHR10NAME”,”WHR13NUM”,”WHR13NAME”])</code></li>
<li>Again this needs to be saved to store it. Type in<code> (oaklandParksNonUrban.save(r”C:\MyProject\MyProject.gdb\OaklandParksLandCover”) </code>and press <em>Enter</em></li>
</ul>
<p>In the following chapters you will learn how to use search cursors to create lists of the different attributes and iterate through them to create multiple rasters and do further analysis on them.</p>
</section>
</section>
</section>
</section>
</body>
</html>
