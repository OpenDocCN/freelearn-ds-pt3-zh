<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="packt"/>
<title>ArcGIS API for Python</title>
<link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css"/>
<link rel="stylesheet" type="text/css" href="../styles/stylesheet2.css"/>

</head>
<body>

<section id="arcgis-api-for-python" class="level1 pkt" data-number="4">
<h1 data-number="4">ArcGIS API for Python</h1>
<section id="what-is-the-arcgis-api-for-python" class="level2" data-number="4.1">
<h2 data-number="4.1">What is the ArcGIS API for Python?</h2>
<p>The ArcGIS API for Python is a Python package designed to work with web GIS. It allows you to work directly with data hosted on ArcGIS Online or ArcGIS Enterprise. Previously you have been using ArcPy, which is excellent for desktop work, but has limited capabilities when working with hosted data. The ArcGIS API for Python provides tool to do many of the same functions that ArcPy does such as create maps, geocode, manage data, and geoprocessing but within your ArcGIS Online or ArcGIS Enterprise account. In addition to this you can manage your organizations web GIS data by managing users, groups, and items. It is important to note that while all of the examples you will work through are within ArcGIS Pro Notebooks, you don’t have to work through ArcGIS Pro. You could install a stand-alone environment with <strong>conda</strong> and access everything through a Jupyter Notebook environment. This book will not cover that as it is focused on working with Python within ArcGIS Pro.</p>
<p>The ArcGIS API for Python is like ArcPy in that it is a Python package. It contains classes, modules, and functions. But it is not just a Python package: it is also an <strong>application programming interface (API).</strong> An API is code that allows different applications and software to talk to each other. It interacts primarily with the ArcGIS REST API. This means that you can use the module to make requests of data hosted on ArcGIS Online or ArcGIS Enterprise. This data is either in your own organization or is publicly available. It is a <strong>pythonic</strong> API in that it is designed to Python standards and best practices. As a pythonic API it allows for python programmers to easily use ArcGIS, and ArcGIS users familiar with Python to automate web GIS tasks.</p>
<p>The API is organized into different modules for your use. Each module has different functions and types to assist in your GIS.</p>
<p>Modules:</p>
<ul>
<li><code>arcgis.gis</code> – this module is the one you will use the most. It allows for entry to the GIS and provides the functionality to create, read, update and delete GIS users, groups or content.</li>
<li><code>arcgis.features</code> – this module works with feature data, feature layers, collections of feature layers, and feature sets. It contains spatial analysis functions for working with feature data. All feature data is data with a set of geometric representations.</li>
<li><code>arcgis.raster</code> – this module works with raster data. It is contains classes and functions for working with raster and imagery data</li>
<li><code>arcgis.realtime</code> – this module works with real-time data feeds. It is for use with streaming data to perform continuous analysis. It allows for Python scripts that can subscribe to data that is streamed, broadcast updates, or alerts.</li>
<li><code>arcgis.network</code> – this module is for completing network analysis. It is for use on network layers and can be used to find best routes, closest facility, cost matrix, and service areas.</li>
<li><code>arcgis.schematics</code> – this module is for working with schematics. Schematics are simplified networks. It is for explaining the structure and way schematics work.</li>
<li><code>arcgis.geoanalytics</code> – this module is for creating distributed analysis of large datasets, feature and tabular. The tools are designed to work with big data as well with feature layers.</li>
<li><code>arcgis.geocoding</code> – this module is for geocoding and reverse geocoding. It creates points of addresses with the output visualized on a map, or used as input data for spatial analysis.</li>
<li><code>arcgis.geometry</code> – this module is for working with geometry types. It has functions that use geometry types as input and output, and for converting geometries to different representations.</li>
<li><code>arcgis.geoprocessing</code> – this module is for creating methods to create and share geoprocessing tools. Users can create their own geoprocessing tools to share and this module provides tools that can assist with that.</li>
<li><code>arcgis.geoenrichment</code> – this module is for providing data about an area or location. Users can get information about people and places in an area or within a distance. It can assist by easily providing demographic data for models.</li>
<li><code>arcpy.env</code> – this module is for having a shared environment to be used by the different modules. It stores the currently active GIS and the environment settings.</li>
<li><code>arcgis.mapping </code>– this module is for providing visualization capabilities for GIS data. It includes WebMap and WebScene to enable 2D and 3D visualization.</li>
<li><code>arcgis.widgets </code>– this module is for providing visualization of GIS data. It includes the Jupyter Notebook MapView widget to assist with display of maps and layers</li>
<li><code>arcgis.apps</code> – this module is for providing the ability to manage the web based applications available in ArcGIS.</li>
</ul>
<p>In this chapter the focus will be mostly on the <code>arcgis.gis</code> module to manage the data in your organization, the <code>arcgis.features</code> module to work with that data, and the <code>arcgis.mapping</code> module to visualize the data.</p>
<section id="what-does-it-do-and-why-use-it" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1">What does it do? And why use it?</h3>
<p>The ArcGIS API for Python allows you to access your data in ArcGIS Online without having to be in ArcGIS Online. You can manage your ArcGIS Online or ArcGIS Enterprise organization, its users, and its data from either a Jupyter Notebook or an ArcGIS Pro Notebook. By having the ability to do this in a Notebook and not through ArcGIS Online web interface you can use the full functionality of Python to iterate over data to run the same process multiple times, and schedule tasks to be run. The ArcGIS API for Python complements ArcPy as it allows you to automate your organization’s web GIS processes. <em>Just like using ArcPy to automate a process in ArcGIS Pro you would use the ArcGIS API for Python when you need to automate a process on your ArcGIS Online or ArcGIS Enterprise organization</em></p>
</section>
<section id="how-to-use-it" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2">How to use it?</h3>
<p>The ArcGIS API for Python comes with the install of ArcGIS Pro. If you are using ArcGIS Pro 2.5.x or later the conda package should have the arcgis package pre-installed. The default conda environment arcgispro-py3, which you have seen in the ArcPy chapter, includes the ArcGIS for Python API. If you need to upgrade your package you can do it through either the <strong>Python Package Manager</strong> or the <strong>Python Command Prompt.</strong> <em>If you only have the default Python environment installed and have not created a new one or cloned it you cannot update it.</em></p>
<figure>
<img src="../media/file80.png" />
</figure>
Default Python Package Install
<ul>
<li>Python Package Manager upgrade process
<ul>
<li>Open ArcGIS Pro with a blank Project</li>
<li>Select <strong>Project</strong> Tab</li>
<li>Select <strong>Python</strong> menu</li>
<li>Click the <strong>Manage Environment</strong></li>
<li>Select the package you want to update (You cannot update the default install this way)</li>
<li>Select <strong>Update Packages</strong></li>
<li>Choose the <code>arcgis</code> release from the list of packages with updates</li>
</ul></li>
<li>Python Command Prompt upgrade process
<ul>
<li>Under the ArcGIS folder in the start menu click on Python Command Prompt</li>
<li>Activate the environment to be upgraded</li>
<li>Type in <code>conda upgrade -c esri arcgis</code></li>
</ul></li>
</ul>
<figure>
<img src="../media/file81.png" />
</figure>
Python Package Manager with Cloned Environment to Upgrade
<p>Once you have checked that you have an updated version of the <code>arcgis</code> package installed you can test to see if it is installed properly.</p>
<ol>
<li>Go to <strong>Project&gt;Open&gt;Computer&gt;Open another Project</strong> and navigate to where you downloaded Chapter5.aprx and open it.</li>
<li>Right click on Chapter5 folder and select New&gt;Notebook. Rename the Notebook <code>TestArcGISAPI</code></li>
<li><p>In cell 1 type in the following</p>
<pre><code>from arcgis.gis import GIS
gis = GIS()
map1 = gis.map(&quot;Oakland, California&quot;)
map1</code></pre></li>
<li>Click <strong>Run</strong> to run the cell. You should see the following result.</li>
</ol>
<figure>
<img src="../media/file82.png" />
</figure>
Map created in ArcGIS Pro Notebook
<p>Let’s take a look at each line of code to understand what it did:</p>
<ol>
<li><code>from arcgis.gis import GIS</code> this imports GIS from the <code>arcgis.gis</code> module</li>
<li><code>gis = GIS()</code> this connects you to ArcGIS Online as an anonymous user.</li>
<li><code>map1 = gis.map(“Oakland, California”)</code> this is creating a map centered on Oakland, California</li>
<li><code>map1</code> this is printing the map to the output so you can see the map you created.</li>
</ol>
<section id="connecting-to-the-arcgis-online-or-arcgis-enterprise" class="level4" data-number="4.1.2.1">
<h4 data-number="4.1.2.1">Connecting to the ArcGIS Online or ArcGIS Enterprise</h4>
<p>There are different ways to connect to ArcGIS Online or ArcGIS Enterprise through constructing a GIS object. The GIS object takes three parameters, all of them optional.</p>
<ol>
<li>url – this is the url for your organizations ArcGIS Online or ArcGIS Enterprise. If none is given it is ArcGIS Online (<a href="https://www.arcgis.com">www.arcgis.com</a>)</li>
<li>username – this is your username, if left blank you will be logged in as anonymous</li>
<li>password – this is your password, if left blank and a username is specified you will be prompted to input your password.</li>
</ol>
<figure>
<img src="../media/file83.png" />
</figure>
Logging into ArcGIS Online with a username but no password
<blockquote>
<p>Using this set up you can share your Notebook but not your login credentials.</p>
</blockquote>
<section id="anonymous-users" class="level5" data-number="4.1.2.1.1">
<h5 data-number="4.1.2.1.1">Anonymous Users</h5>
<p>In the previous example to test your ArcGIS API for Python install you connected to ArcGIS Online as an anonymous user. That gives you the ability to query and view publically available data. <em>But it does not allow you to create or modify content or perform analysis.</em></p>
</section>
<section id="built-in-users" class="level5" data-number="4.1.2.1.2">
<h5 data-number="4.1.2.1.2">Built-In Users</h5>
<p>ArcGIS Online and ArcGIS Enterprise come with built-in identity store. This is done by writing the following code in the cell</p>
<pre><code>gis = GIS(‘home’)</code></pre>
<p>That will connect your Notebook into the ArcGIS Online account with credentials you are currently using to log into ArcGIS.</p>
</section>
<section id="arcgis-pro-connection" class="level5" data-number="4.1.2.1.3">
<h5 data-number="4.1.2.1.3">ArcGIS Pro Connection</h5>
<p>Connecting through ArcGIS Pro using the pro authentication scheme. This is done by writing the following code in the cell:</p>
<pre><code>gis = GIS(‘pro)</code></pre>
<p>This will connect your Notebook to your ArcGIS Online portal using the <strong>credentials</strong> used to sign into ArcGIS Pro. This is similar to a built-in user. The difference is that the pro authentication scheme only works when ArcGIS Pro is installed locally and is running concurrently.</p>
</section>
<section id="summary-of-connection-options" class="level5" data-number="4.1.2.1.4">
<h5 data-number="4.1.2.1.4">Summary of Connection Options</h5>
<table>
<tbody>
<tr class="odd">
<td>Anonymous User</td>
<td><code>gis = GIS()</code></td>
<td>Allows only access to query and view publically available data</td>
</tr>
<tr class="even">
<td>Built-In User</td>
<td><code>gis = GIS(‘home’)</code></td>
<td>Connects to ArcGIS Online with account you are currently logged in with, and allows full access to that data based on your user assignment.</td>
</tr>
<tr class="odd">
<td>ArcGIS Pro</td>
<td><code>gis = GIS(‘pro’)</code></td>
<td>Connects to active portal when logged into the ArcGIS Pro app. This only works within ArcGIS Pro with a local install of ArcGIS Pro</td>
</tr>
<tr class="even">
<td>Credentials</td>
<td><code>gis = GIS({url}, username = ‘example’)</code></td>
<td>Connects to a url, or <code>arcgis.com</code> if left blank, using a specific username. Leaving the password parameter blank will protect your credentials when sharing as you are prompted to enter it when the cell is run</td>
</tr>
</tbody>
</table>
<p>Most of the time you will be connecting either using the <code>gis = GIS(‘home’)</code> or <code>gis = GIS(‘pro’)</code>. Through this book you will be using connecting to either anonymously or to your organization by using <code>gis = GIS(‘home’)</code>.</p>
</section>
</section>
</section>
</section>
<section id="using-the-gis-module-to-manage-your-gis" class="level2" data-number="4.2">
<h2 data-number="4.2">Using the gis module to Manage your GIS</h2>
<p>Using the <code>gis</code> module you can access and manage your folders, your content, your group, and your users. If you have any repetitive tasks and workflows you can automate them as scripts. In this section you are going to see how search for data, publish items, organize data into folders, access and manage groups, access and manage users, download data, delete data, and download attachments.</p>
<section id="search-for-data" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1">Search for data</h3>
<p>You can use the content property of your GIS to use the <code>search()</code> method. This allows you to search through your GIS and find data. The <code>search()</code> method will return a list of items based on the arguments given. The <code>search()</code> method has several arguments that it can take. Most of the time you will be using the query, and type of item arguments. The query has multiple types of queries it can take. In this section you will look at how to query based off an items title or owner.</p>
<p>In previous samples you were connecting to your GIS in your ArcGIS Online account. For the search example you will be connecting anonymously to understand how to search for data. You are going to search for publically available feature layers of Oakland.</p>
<section id="search-for-public-data-as-an-anonymous-user" class="level4" data-number="4.2.1.1">
<h4 data-number="4.2.1.1">Search for Public Data as an Anonymous User</h4>
<ol>
<li>Go to <strong>Project&gt;Open&gt;Computer&gt;Open another Project</strong> and navigate to where you downloaded Chapter5.aprx and open it.</li>
<li>Right click on Chapter5 folder and select <strong>New&gt;Notebook</strong>. Rename the Notebook to <code>SearchForDataSample</code></li>
<li><p>You are going to create your GIS using an anonymous log in, and you are going to import a display module that will make viewing the data returned easier. Type in the following:</p>
<pre><code>from arcgis.gis import GIS
from IPython.display import display
gis = GIS()</code></pre>
<p>Click the <strong>Run</strong> button to run.</p></li>
<li><p>In the next cell you will search for feature layers associated with Oakland limited to just 5 items, and display the results.</p>
<pre><code>oaklandResults = gis.content.search(query=&quot;Oakland&quot;,item_type=&quot;Feature Layer&quot;,max_items=5)
for item in oaklandResults:
    print(item)
for result in oaklandResults:
    display(result)</code></pre>
<p>The two for loops will return the data details to you in two different ways. The first is just printing out the results and the second is using the display module to show more details. Click the <strong>Run</strong> button to run</p></li>
</ol>
<figure>
<img src="../media/file84.png" />
</figure>
Results of Search for Oakland data
<p>The results are just the first five feature layers returned associated with Oakland. There are many more arguments that could be used to find different data. You can apply any or all of the following arguments</p>
<ul>
<li><code>query</code> – this can be used to query for title or owner and can use wildcards.</li>
<li><code>item_type</code> – this can be used to query any type of item that can be on an ArcGIS Online portal<em>. It can find shapefiles, feature layers, feature collections, csvs, tables, maps, web scenes and more. It also can take wildcards.</em></li>
<li><code>sort_field</code> – this can be used to sort the data on a field such as the title, owner or number of views</li>
<li><code>sort_order</code> – this can be used with the sort field to sort ascending or descending.</li>
<li><code>outside_org</code> – this can be used when logged into your organization to search for data outside of it.</li>
</ul>
<p>You are going to test some of the arguments to see how you can get different results from the <code>search()</code> method.</p>
<p>First you will take the last search and modify to find feature layers or collections that have Oakland in the title, and sort them by the number of views.</p>
<ol>
<li><p>You are now searching for data with Oakland in the title. You do not have to use the wild card in the title as this will search for the word Oakland. It is searching for just the word Oakland though so anything like OaklandCounty will not be returned. You are using a wildcard for the <code>item_type</code> to return all types that begin with Feature. This will return feature layers and feature collections. You are also sorting this by the number of views descending to get the most viewed items, and retuning only 5 items. In the same Notebook type in the following:</p>
<pre><code>oaklandResults2 = gis.content.search(query=&quot;title:Oakland&quot;,item_type=&quot;Feature *&quot;,
                                     sort_field=&quot;numViews&quot;,sort_order=&quot;desc&quot;,max_items=5)
for item in oaklandResults2:
    print(item)
for result in oaklandResults2:
    display(result)</code></pre>
<p>Click the <strong>Run</strong> button to run. The output should look something like this.</p>
<figure>
<img src="../media/file85.png" />
</figure>
<p>Results of search query for Oakland with different search arguments</p>
<p>You can also search for data by the owner of the data. Your query argument is structured like this <code>query=”owner:username” </code>This will only return data that the owner has made publically available.</p></li>
<li><p>You are taking the owner of two of the datasets from the previous cell and searching for all the feature data types they own. Since you don’t know how many there are and don’t want to print all that data you just print out the length of the search results list returned. In the same Notebook in the next cell type the following</p>
<pre><code>oaklandResults3 = gis.content.search(query=&quot;owner:antievictionmapdev&quot;,item_type=&quot;Feature *&quot;)
print(len(oaklandResults3))</code></pre>
<p>Click the <strong>Run</strong> button to run and see the results</p>
<figure>
<img src="../media/file86.png" />
</figure>
<p>Results of search for owner query</p></li>
<li><p>Now that you know there are 10 feature layers or feature collections in the next cell you can type the following.</p>
<pre><code>for result in oaklandResults3:
    display(result)</code></pre>
<p>Click <strong>Run</strong> to see the layers display.</p></li>
</ol>
<figure>
<img src="../media/file87.png" />
</figure>
Display of layers from the owner query
<blockquote>
<p>You can click on the layer name in the Output cell and a browser will open showing you the overview page for the item you clicked on.</p>
</blockquote>
</section>
<section id="searching-for-data-when-connected-to-your-organization" class="level4" data-number="4.2.1.2">
<h4 data-number="4.2.1.2">Searching for data when connected to your organization</h4>
<p>In this section you have seen how to use the <code>search()</code> operation to search for public data as an anonymous user and how to search for data within your organization. As you have seen there are different ways to connect to your organization, depending on how you are using the ArcGIS API for Python, and if you are using ArcGIS Online or ArcGIS Enterprise. Because you will be connected to your organization in these samples there will be limited figures showing the out cells as those will depend on what data you have in your organization.</p>
<p>To search for data in your organization you are going to continue to use the <code>SearchForDataSample</code> Notebook from the above samples.</p>
<ol>
<li><p>In the next cell you are going to create another connection ArcGIS Online using the account you are logged into in ArcGIS Pro by typing in the following</p>
<pre><code>gis2 = GIS(‘home’)</code></pre>
<p>This will create a GIS under gis2 that you can use to access and manage content and users in your ArcGIS Online. If you are using an ArcGIS Enterprise you need to type the following</p>
<pre><code>gis2 = GIS(“https://portal/domain.com/webadapter”,”username”,”password”)</code></pre>
<p>Click the <strong>Run</strong> button to run the cell.</p></li>
<li><p>You can see properties of the user you are signed in under by typing the following</p>
<pre><code>gis2.properties.user</code></pre>
<p>Click the <strong>Run</strong> button to run the cell. The results will be a data dictionary containing all the information about the user.</p>
<figure>
<img src="../media/file88.png" />
</figure>
<p>User details</p></li>
<li><p>All of which can be further accessed and assigned to variables if needed. To access the first name you just need to type in</p>
<pre><code>firstName = gis2.properties.user.firstName
firstName</code></pre>
<p>Click the <strong>Run</strong> button.</p>
<figure>
<img src="../media/file89.png" />
</figure>
<p>Extract a user’s name</p></li>
<li><p>Searching through your content is the same as when logged in anonymously. The only difference is you are searching through data within your organization. In the next cell type in the following</p>
<pre><code>searchResults = gis2.content.search(query=&quot;*&quot;,item_type=&quot;Feature Layer&quot;)
for result in searchResults:
    display(result)</code></pre>
<p>Click the <strong>Run</strong> button to run the cell. It will display all of the feature layers in your organization.</p></li>
<li><p>To search for just the items owned by you write the following</p>
<pre><code>searchResults = gis2.content.search(query=&quot;owner:&quot;+gis2.users.me.username,item_type=&quot;Feature Layer&quot;)
for result in searchResults:
    display(result)</code></pre>
<p>Click the <strong>Run</strong> button to run the cell.</p>
<blockquote>
<p>The only argument in the <code>search()</code> that is required is the query. Because wildcards can be used you can search for everything by just writing query=”*”. But be careful, if you have a lot of layers the search could be slow.</p>
</blockquote></li>
<li><p>When connected to your organization you can still search for publically available data by setting the <code>outside_org</code> argument to <code>True </code>You can find the same Oakland datasets in <code>gis2</code> by writing the following code.</p>
<pre><code>oaklandResultsHome = gis2.content.search(query=&quot;title:Oakland&quot;,item_type=&quot;Feature *&quot;,
                                     sort_field=&quot;numViews&quot;,sort_order=&quot;desc&quot;,max_items=5,outside_org=True)
for result in oaklandResultsHome:
    display(result)</code></pre>
<p>Click the <strong>Run</strong> button to run the cell. The results should be the same as when connected anonymously.</p></li>
</ol>
<figure>
<img src="../media/file90.png" />
</figure>
Results from searching outside your organization
<p>In this section you have seen how to search for data both anonymously and when connected to your organization. Now that you can find data you will see how to add data to your organization and how to organize that data.</p>
</section>
</section>
<section id="publish-data" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2">Publish Data</h3>
<p>Much of the data you publish to ArcGIS Online or ArcGIS Enterprise is done within ArcGIS Pro. This is useful and convenient when you are publishing single maps or feature layers. It is less convenient if you are going to publish a csv with latitude and longitude fields as you would need to display the coordinates in ArcGIS Pro before publishing it. Using the ArcGIS API for Python you can take a csv and add it to your organization and publish it with a few lines of code.</p>
<section id="adding-data-from-a-csv." class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1">Adding data from a csv.</h4>
<p>To add data to your GIS you are going to use the <code>add()</code> method. Like the <code>search()</code> method the <code>add()</code> method is part of the <code>content()</code> property of the GIS object. To use the add method you will need to create a data dictionary of the properties of the item to be created. The properties are the same ones that you would need to fill in to add items from ArcGIS Pro: title, description, tags. You can add an optional thumbnail as well using the <code>add()</code> method.</p>
<p>First open up the csv AlamedaCountyFarmersMarket.csv to see what you will be adding. It is a basic csv with a market name, days, hours, location, city, latitude, and longitude. Right now it only has the famers markets for Oakland and Berkeley and not all of Alameda County. Later you will append the rest of the data to the feature layer you are creating from this csv data.</p>
<figure>
<img src="../media/file91.png" />
</figure>
Farmers Market CSV
<ol>
<li>Right click on <code>Chapter3</code> folder and select <strong>New&gt;Notebook</strong>. Rename the Notebook to <code>AddPublishData</code></li>
<li><p>In the first cell type in your import statements and create your GIS. You are going to create the GIS logged in to your ArcGIS Online account that you are logged into ArcGIS Pro with. Type the following</p>
<pre><code>from arcgis.gis import GIS
from IPython.display import display
gis = GIS(‘home’)</code></pre></li>
<li><p>Click the <strong>+</strong> button to add a cell. In this cell you are going to create a variable for the <code>csv</code>.</p>
<pre><code>csvFM = r&quot;C:\PythonBook\Chapter3\AlamedaCountyFarmersMarket.csv&quot;</code></pre>
<p><em>If your csv is saved to a different location make sure you are using its location.</em></p></li>
<li><p>Click the <strong>+</strong> button to add a cell. In this cell you are going to create the data dictionary of the <code>csv</code> properties. You will fill in the properties for the title, description, and tags as the keys with their properties as the values. Type the following</p>
<pre><code>csvProperties = {
    &quot;title&quot;:&quot;Farmers Markets in Alameda County&quot;,
    &quot;descrption&quot;:&quot;Location, days, and hours of Farmers Markets in Alameda County&quot;,
    &quot;tags&quot;:&quot;Farmers Market, Alameda County, ArcGIS API for Python&quot;
}</code></pre>
<blockquote>
<p>If you were going to add a thumbnail you would do it in this cell by defining a variable with the location of the thumbnail.</p>
<blockquote>
<p><code>thumbnail = r”PATH\TO\THUMBNAIL.png”</code></p>
</blockquote>
</blockquote></li>
<li><p>Click the <strong>+</strong> button to add a cell. In this cell you are going create a variable to hold the <code>csv</code> item being added. You use the add function from the content module. The arguments passed are the properties dictionary and the path for the <code>csv</code>. Type the following</p>
<pre><code>addCsvFM = gis.content.add(item_properties=csvProperties,data=csvFM)</code></pre></li>
<li><p>Click the <strong>+</strong> button to add a cell. In this cell you will publish the csv item you just added by calling the publish method. Type the following</p>
<pre><code>farmersMarketFL = addCsvFM.publish()
farmersMarketFL</code></pre>
<blockquote>
<p>By setting the publish method to a variable that variable contains the feature layer. You can call that variable to display the feature layers properties.</p>
</blockquote></li>
<li><p>Click the <strong>+</strong> button to add a cell. In this cell you are going to create a quick map to visualize your data to verify the feature layer was created. Type the following</p>
<pre><code>map1 = gis.map(&quot;Oakland, California&quot;)
map1.add_layer(farmersMarketFL)
map1</code></pre></li>
<li>Click <strong>Cell&gt;Run</strong> All to run all the cells. The output map should look like below</li>
</ol>
<figure>
<img src="../media/file92.png" />
</figure>
Map Widget showing Farmers Market Feature Layer.
</section>
<section id="adding-and-publishing-summary-and-tips" class="level4" data-number="4.2.2.2">
<h4 data-number="4.2.2.2">Adding and Publishing Summary and Tips</h4>
<p>You have seen how to publish a csv that has latitude and longitude columns for point data. This process could be turned into an iterative process using a loop to publish multiple csvs. All you would need to write is a properties data dictionary for each csv. But your data is not always going to be a csv of point locations with latitude and longitude. Below are some tips for publishing other types of data.</p>
<ul>
<li><p><em>When publishing a csv with latitude and longitude fields make sure they are named latitude and longitude</em>. The module is looking for those field names. If they are not found it will not locate the points correctly. You can specify the field names to use with the optional <code>publish_paramaters</code> dictionary in the <code>publish()</code> method. To do that you would need to create the following dictionary</p>
<pre><code>publishParam = {
    &quot;locationType&quot;:&quot;coordinates&quot;,
    &quot;latitudeFieldName&quot;:&quot;LatX&quot;,
    &quot;longitudeFieldName&quot;:&quot;LongY&quot;
}</code></pre>
<ul>
<li>The <code>locationType</code> value to use is coordinates, and then the <code>latituedFieldName</code> and <code>longitudeFieldName</code> are the field names for each in your csv.</li>
</ul></li>
<li><p><em>Csvs without latitude and longitude but with address can be geocoded.</em> To geocode data from a csv you would again use the <code>publish_paramaters</code> dictionary.</p>
<pre><code>publishParam = {
    &quot;locationType&quot;:&quot;address&quot;,
    “addressTemplate”:”{address},{city},{state},{zip}”
}</code></pre>
<ul>
<li>The <code>locationType</code> field is set to address. The <code>addressTemplate</code> field is then set to the fields that have the different address components. In this example there is a field with the street address, a field with the city, a field with the state, and a field with the zip. The set-up of this will depend on how you have your data in your csv.</li>
</ul></li>
<li><em>Shapefile and file geodatabses can be added and published using this same method but they must be zipped</em>. If you have a large amount of shapefiles or file geodatabases that are unzipped you could automate the process of zipping them up.</li>
</ul>
<p>Adding and publishing data using the ArcGIS API for Python can be very useful for quickly adding data to your organizations ArcGIS Online or ArcGIS Enterprise account. You have seen how to add and publish a csv. You have seen that the csvs can be geocoded on publishing using the ArcGIS Online geocoder. In the next section you will see how to organize the data into folders, create groups, and manage access to groups.</p>
</section>
</section>
<section id="organize-data-manage-groups-and-users" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3">Organize data, manage groups, and users</h3>
<p>Organizing your data within your ArcGIS Online or ArcGIS Enterprise is important. You want to be able to find your data. In addition to folders to hold your data in you also can create groups to share specific data with. In large organizations this is important as not everyone needs to have access to the same data. In this section you will see how to create folders and move data into them, create groups and manage access to them, and create and manage users.</p>
<section id="organize-data-into-folder" class="level4" data-number="4.2.3.1">
<h4 data-number="4.2.3.1">Organize data into folder</h4>
<p>One of the first things to do after adding data or publishing it should be finding a folder to place it in. It is good practice to use folders to organize your data. It not only helps you find data but also other members of your organization. You can add folders and move data over using the ArcGIS API for Python. In the sample below you will create a new folder and move the farmer’s market data from above.</p>
<ol>
<li>Right click on <code>Chapter3</code> folder and select <strong>New&gt;Notebook</strong>. Rename the Notebook to <code>CreateFolderMoveData</code></li>
<li><p>In the first cell type in your import statements and create your GIS. You are going to create the GIS logged in to your ArcGIS Online account that you are logged into ArcGIS Pro with</p>
<pre><code>from arcgis.gis import GIS
from IPython.display import display
gis = GIS(‘home’)</code></pre></li>
<li><p>Click the <strong>+</strong> button to add a cell. In this cell you will create a new folder</p>
<pre><code>gis.content.create_folder(folder=&quot;AlamedaFarmersMarkets&quot;)</code></pre></li>
<li><p>Click the <strong>+</strong> button to add a cell. In this cell you search for that you need to move over</p>
<pre><code>alamedaFM = gis.content.search(query=&quot;title:Farmers Markets in Alameda County”)</code></pre></li>
<li><p>Remember that the <code>search()</code> method returns a list of items. To confirm what you have in your list you will run a for loop to iterate through the list and display the data. Type into the same cell as above</p>
<pre><code>alamedaFM = gis.content.search(query=&quot;title:Farmers Markets in Alameda County&quot;)
for item in alamedaFM:
    display(item)</code></pre></li>
<li><p>Click <strong>Cell&gt;Run All</strong> to run all your cells to this point. Your Notebook should similar to this now.</p>
<figure>
<img src="../media/file93.png" />
</figure>
<p>Output of creating folder and finding data to move.</p></li>
<li><p>Click the <strong>+</strong> button to add a cell. In this cell you will move the feature layer and csv into the new folder. You will do that by looping though the search results and using <code>move()</code> method.</p>
<pre><code>for item in alamedaFM:
    item.move(folder=&quot;AlamedaFarmersMarkets&quot;)
     print(item)</code></pre>
<p>Click the <strong>Run</strong> button to run this cell. You should see an output like below confirming that your data has been moved. If you go to your ArcGIS Online you will see that you now have a new folder and both datasets are there.</p></li>
</ol>
<figure>
<img src="../media/file94.png" />
</figure>
Output of moving data to a new folder
<p>Creating a folder and moving data into that folder is a process that ArcGIS API for Python can be used to help you organize data. In the sample you were able to find all the data sets by their name and move them to a newly created folder. Being able to search your GIS for data and move it to folders using the ArcGIS API for Python is a valuable tool that will save you time.</p>
<blockquote>
<p>If you need to move data back to the root directory it is just the following code <code>item.move(“\”)</code></p>
</blockquote>
</section>
<section id="access-and-manage-groups" class="level4" data-number="4.2.3.2">
<h4 data-number="4.2.3.2">Access and Manage Groups</h4>
<p>Groups are spaces where you share data with other users. It is how you can create a collaborative GIS by allowing other users access to your data and maps. Using the ArcGIS API for Python you can create and manage groups in a programmatic way to save you time while fostering better collaboration within and outside of your team. In this section you will see how to search for groups, find the properties of a groups, create new groups, and manage the group by sharing data to it, and adding and removing users from the group by using the ArcGIS API for Python.</p>
<section id="search-for-groups" class="level5" data-number="4.2.3.2.1">
<h5 data-number="4.2.3.2.1">Search for Groups</h5>
<p>Searching for groups is very similar to searching for data. You can search for groups that are open to all when logged in anonymously or search for groups within your organization when logged into your organization. You are going to first search for groups anonymously and then access the properties of that group you created. Then you will search for groups within your organization.</p>
<ol>
<li>Right click on <code>Chapter3</code> folder and select <strong>New&gt;Notebook</strong>. Rename the Notebook to <code>SearchForGroups</code></li>
<li><p>In the first cell type in your import statements and create your GIS. You are going to create the GIS anonymously.</p>
<pre><code>from arcgis.gis import GIS
from IPython.display import display
gis = GIS()</code></pre>
<p>Click the <strong>Run</strong> button to run.</p></li>
<li><p>In the next cell you will create your search and then display the results. Just like with the feature layers you are going to limit your data search to the first 5 records. You will also be using the display module to better show the group information. Type in the following</p>
<pre><code>oaklandGroups = gis.groups.search(&#39;title:Oakland&#39;,max_groups=5)
for group in oaklandGroups:
    display(group)</code></pre>
<p>Click the <strong>Run</strong> button to run. You should have results that look like the figure below</p>
<figure>
<img src="../media/file95.png" />
</figure>
<p>Results of group search for Oakland groups.</p></li>
<li><p>Just like with items you can search for groups by owner instead of title. You will use one of the group owners from the search results. Type in the following code</p>
<pre><code>oaklandGroups2 = gis.groups.search(&#39;owner:DebusB@oakgov.com_oakgov&#39;,max_groups=5)
for group in oaklandGroups2:
    display(group)</code></pre>
<p>Click the <strong>Run</strong> button to run. You should have results that look like the figure below</p>
<figure>
<img src="../media/file96.png" />
</figure>
<p>Results of search for group search by owner.</p></li>
<li><p>Just like with searching for items the group search returns a list. To look further at a group’s properties you need to select it using the list index. You are going to select the first group from the first search to look at its properties. Type in the following code</p>
<pre><code>oaklandGroup1 = oaklandGroups[0]
oaklandGroup1</code></pre>
<p>Click the <strong>Run</strong> button to run. You should have results that look like the figure below</p>
<figure>
<img src="../media/file97.png" />
</figure>
<p>Results of selecting a group from the group list</p></li>
<li><p>Now you can see some the properties of the group. You are going to print out the values using <code>.format()</code> to add some context to the values being printed out</p>
<pre><code>print(&quot;Group Access is : {}&quot;.format(oaklandGroup1.access))
print(&quot;Group id is: {}&quot;.format(oaklandGroup1.id))
print(&quot;Group Tags are : {}&quot;.format(&quot;, &quot;.join(oaklandGroup1.tags)))
print(&quot;Group is Invitation only: {}&quot;.format(oaklandGroup1.isInvitationOnly))</code></pre>
<p>Click the <strong>Run</strong> button to run. You should have results that look like the figure below</p>
<figure>
<img src="../media/file98.png" />
</figure>
<p>Results from Group Properties</p>
<p>There are more properties that you can access for a group. A full list of them is here, <a href="https://developers.arcgis.com/rest/users-groups-and-items/group-search.htm">https://developers.arcgis.com/rest/users-groups-and-items/group-search.htm</a></p></li>
<li><p>To search for groups within your organization you need to be logged into your GIS. Create a new GIS in this workbook by typing the following in the next cell</p>
<pre><code>gis2 = GIS(&#39;home&#39;)</code></pre>
<p>Click the <strong>Run</strong> button to run</p></li>
<li><p>In the next cell you will run a search for all groups in your organization that you have access to.</p>
<pre><code>myGroups = gis2.groups.search(query=&quot;*&quot;,max_groups=5)
for group in myGroups:
    display(group)</code></pre>
<p>Click the <strong>Run</strong> button to run. You should see at most 5 groups. If you are not a member of 5 groups you will only see those that you are a member of. If you want to see all the groups you are a member of you would remove the <code>max_groups=5</code></p></li>
</ol>
</section>
<section id="creating-a-group" class="level5" data-number="4.2.3.2.2">
<h5 data-number="4.2.3.2.2">Creating a Group</h5>
<p>Now that you have seen how to search for groups in your organization you need to create one. You can create groups to share data publically or with just members of the group. You are going to walk through how to create a group for sharing data publically. You will also see the arguments needed to create private groups and how to change the setting.</p>
<ol>
<li>Right click on <code>Chapter3</code> folder and select <strong>New&gt;Notebook</strong>. Rename the Notebook to <code>CreateGroupMoveData</code></li>
<li><p>You are going to log into your organizations GIS through the user you are currently logged into ArcGIS Pro with by typing in the following</p>
<pre><code>from arcgis.gis import GIS
from IPython.display import display
gis = GIS(&quot;home&quot;)</code></pre>
<p>Click the <strong>Run</strong> button to run</p></li>
<li><p>In the next cell you will create a group by using the create method of the groups module. The create method takes 5 arguments explained in the table below. Type in the following</p>
<pre><code>farmerMarketGroup = gis.groups.create(title=&quot;Alameda County Farmers Markets&quot;,
                                      tags=&quot;Alameda County, Farmers Market&quot;,
                                      description = &quot;Group with data for Alameda County Farmers Markets.&quot;,
                                      access = &quot;public&quot;,
                                      is_invitation_only = &quot;False&quot;
                                     )</code></pre>
<p>Click the <strong>Run</strong> button to run</p></li>
</ol>
<p>You should get no out message, but you have created a new public group. To check this you can go to your ArcGIS Online account and look in Groups. You can also type in <code>farmerMarketGroup</code> and click the <strong>Run</strong> button to see the group. It should look something like below.</p>
<figure>
<img src="../media/file99.png" />
</figure>
Newly created group.
<p>To create the group you used 5 arguments: title, tags, description, access, <code>is_invitation_only</code>. Those are the minimum arguments you should use when setting up a new group as they give the group a title, tags, description and set basic access. The table below has those arguments along with the values they can be.</p>
<table>
<tbody>
<tr class="odd">
<td><code>title</code></td>
<td>String between single or double quotes that will be the title of your group</td>
</tr>
<tr class="even">
<td><code>tags</code></td>
<td>String between single or double quotes with a comma separating all the tags. When returned it is a list</td>
</tr>
<tr class="odd">
<td><code>description</code></td>
<td>String between single or double quotes that will be the description of your group</td>
</tr>
<tr class="even">
<td><code>access</code></td>
<td>String between single or double quotes that sets the access. The access values can be: org, private, public. Org is a group that everyone in your organization can see. Private is a private group that only invited users can see. Public is a public group available to everyone.</td>
</tr>
<tr class="odd">
<td><code>is_invitation_only</code></td>
<td>String between single or double quotes that is a boolean value. When set to True users can only gain access if invited. When set to False users can request access or be invited.</td>
</tr>
</tbody>
</table>
<p>You can verify any of the settings by typing the variable for the group a dot and the value. To verify the access of the group you just created you would type the following in the next cell</p>
<pre><code>farmerMarketGroup.access</code></pre>
<p>And click <strong>Run</strong> to run.</p>
<p>You should see the following output.</p>
<figure>
<img src="../media/file100.png" />
</figure>
Verifying a groups access.
<p>To change any of the values of a group you can do that by using the update function. The update function takes all the same arguments used to create the group. To update the access type in the following</p>
<pre><code>farmerMarketGroup.update(access = &quot;private&quot;)</code></pre>
<p>And click <strong>Run</strong> to run.</p>
<p>You have now created a new group and seen how to change the values of that group. The next step is sharing <strong>data</strong> with a group.</p>
</section>
<section id="sharing-content-to-a-group" class="level5" data-number="4.2.3.2.3">
<h5 data-number="4.2.3.2.3">Sharing content to a Group</h5>
<p>An empty group is not very useful. The point of creating a group is to share data either publically or with other users. In this section you will see how to share data with a group.</p>
<ol>
<li><p>You are going to need to access the feature layer containing the Alameda County Farmers Markets. In the next cell of the same Notebook from above you will use the <code>search()</code> method to get the Farmers Markets in Alameda County feature layer. The search method returns a list but you know you only have one item with that title so you can add a [0] at the end of the search method to return just the first value from the list to your variable. Type the following</p>
<pre><code>alamedaFM = gis.content.search(query=&quot;title:Farmers Markets in Alameda County&quot;)[0]
alamedaFM</code></pre>
<p>Click <strong>Run</strong> to run. You should see the display for the Alameda County Farmers Market Feature Layer</p></li>
<li><p>Now you can check the access of the feature layer by typing in the following</p>
<pre><code>alamedaFM.access</code></pre>
<p>Click <strong>Run</strong> to run. You should see it return<code> ‘private’</code></p></li>
<li><p>Now that you have a feature layer you can share it with your group. To share with the group you are going to use the <code>share()</code> method, and you are going to use two arguments to set the organization sharing level when sharing it with the group. The org argument can be set to True or False, when set to True it shares the item with your entire organization, when false it share it just with the group. The group argument takes the id from the group. Since you have a variable holding the group you just have to access its id by using the id method. Type in the following</p>
<pre><code>alamedaFM.share(org=False,groups=farmerMarketGroup.id)</code></pre>
<p>Click <strong>Run</strong> to run. You should see the result below</p>
<figure>
<img src="../media/file101.png" />
</figure>
<p>Results of sharing an item to a group</p></li>
<li><p>You can check the sharing level of any of your items by calling the <code>shared_with</code> method on it. To see that type in the following</p>
<pre><code>alamedaFM.shared_with</code></pre>
<p>Click <strong>Run</strong> to run. You should see the result below</p>
<figure>
<img src="../media/file102.png" />
</figure>
<p>Results of shared_with</p>
<p>The result is a dictionary with values for everyone, org, and groups that the item is now shared with.</p></li>
</ol>
<p>Now that you have shared some data with the group you need to add or invite users to join your group.</p>
</section>
<section id="adding-inviting-and-removing-users-from-a-group" class="level5" data-number="4.2.3.2.4">
<h5 data-number="4.2.3.2.4">Adding, Inviting, and Removing Users from a Group</h5>
<p>Adding, inviting and removing users from a group all use similar code. They all apply a method to the group. The method takes a list of strings of usernames as its argument. The table below displays the syntax using our farmers market group from the example.</p>
<table>
<tbody>
<tr class="odd">
<td><code>add_users</code></td>
<td><code>farmerMarketGroup.add_users([“user1”,”user2”, . . .])</code></td>
</tr>
<tr class="even">
<td><code>invite_users</code></td>
<td><code>farmerMarketGroup.invite_users([“user1”,”user2”, . . .])</code></td>
</tr>
<tr class="odd">
<td><code>remove_users</code></td>
<td><code>farmerMarketGroup.remove_users([“user1”,”user2”, . . .])</code></td>
</tr>
</tbody>
</table>
<p>When any of the above code is run the output is a dictionary with a list of users that were added, invited, or removed along with the details. <em>The group owner cannot be removed from the group.</em></p>
<blockquote>
<p>Which user can belong to group is dependent on your organization type. In some cases organizations do not allow users from outside your organization or public users to be part of a group.</p>
</blockquote>
<p>Now you have created a group, shared data with it and added or invited new users to that group. Next you will see how to manage users</p>
</section>
</section>
<section id="manage-users" class="level4" data-number="4.2.3.3">
<h4 data-number="4.2.3.3">Manage Users</h4>
<p>Managing users in your organization through the ArcGIS API for Python can be a time saver as you can have Notebooks created that can be run to quickly create new users, access user data, reassign user content and delete users. The first step is understanding the User class to see what information you can see about users.</p>
<section id="user-properties" class="level5" data-number="4.2.3.3.1">
<h5 data-number="4.2.3.3.1">User Properties</h5>
<p>In order to learn more about the properties of users you are going to look at yourself and explore the different user properties.</p>
<ol>
<li>Right click on <code>Chapter3</code> folder and select <strong>New&gt;Notebook</strong>. Rename the Notebook to <code>UserProperties</code></li>
<li><p>You are going to log into your organizations GIS through the user you are currently logged into ArcGIS Pro with by typing in the following</p>
<pre><code>from arcgis.gis import GIS
from IPython.display import display
gis = GIS(&#39;home&#39;)</code></pre>
<p>Click <strong>Run</strong> to run</p></li>
<li><p>In the next cell you are going to view your own account by using the me property. Type in the following</p>
<pre><code>me = gis.users.me
me</code></pre>
<p>Click <strong>Run</strong> to run. You should see the following returned with your user information</p>
<figure>
<img src="../media/file103.png" />
</figure>
<p>User information</p></li>
<li><p>You can identify many different aspects of a user’s profile. Things like a user’s first and last name, email address, when they last accessed their account, what groups they are a member of, and how much storage they are using, You are going to extract and write out all of this information. You will need to import the time module to convert the time returned to month/date/year. The groups property returns a data dictionary. In order to access the name you create an empty list, and iterate through the data dictionary accessing the title of each, and append it to the group, then use the join function to write the contents of the group to string. In the next cell type the following</p>
<pre><code>import time
firstName = me.firstName
lastName = me.lastName
email = me.email
accessedLast = time.localtime(me.lastLogin/1000)
groups = me.groups
myGroupsList =[]
for group in groups:
    groupName = group[&quot;title&quot;]
    myGroupsList.append(groupName)
groupsName = &quot;, &quot;.join(myGroupsList)
storageAssigned = me.storageQuota
storageUsed = me.storageUsage
prctStorage = round((storageUsed/storageAssigned)*100,4)
print(&quot;First Name:           {0}&quot;.format(firstName))
print(&quot;Last Name:            {0}&quot;.format(lastName))
print(&quot;email:                {0}&quot;.format(email))
print(&quot;Last Accessed:        {0}/{1}/{2}&quot;.format(accessedLast[1],accessedLast[2],accessedLast[0]))
print(&quot;Groups:               {0}&quot;.format(groupsName))
print(&quot;Storage Assigned:     {0}.&quot;.format(storageAssigned))
print(&quot;Storage Used:         {0}.&quot;.format(storageUsed))
print(&quot;Percent Storage Used: {0}&quot;.format(prctStorage))</code></pre>
<p>Click <strong>Run</strong> to run. You should see the following returned with your user information</p></li>
</ol>
<figure>
<img src="../media/file104.png" />
</figure>
User Information returned
<blockquote>
<p>Another useful item to be returned would be credits available. For this you need to have credit budgeting turned on. In a future section you will look more at managing credits as an administrator and you can add that code to your above code to find the credits available.</p>
</blockquote>
</section>
<section id="search-for-users" class="level5" data-number="4.2.3.3.2">
<h5 data-number="4.2.3.3.2">Search For Users</h5>
<p>You can search for users just like you would with items or groups. You can set a query to look for a user by username or find users by an email address. You will set up a Notebook with samples of both that you can use to further search for users within your organization.</p>
<ol>
<li>Right click on <code>Chapter5</code> folder and select <strong>New&gt;Notebook</strong>. Rename the Notebook to <code>SearchForUsers</code></li>
<li><p>You are going to log into your organizations GIS through the user you are currently logged into ArcGIS Pro with by typing in the following</p>
<pre><code>from arcgis.gis import GIS
from IPython.display import display
gis = GIS(&#39;home&#39;)</code></pre>
<p>Click <strong>Run</strong> to run</p></li>
<li><p>First you will search for users by username. You will be writing in your username below in the code where it says {<code>userNameSearch</code>}. The search for users works just like all the previous searches in that it returns a list of values. Since you are searching for a specific username you should have a list of one. To be sure you will run a test to print out the length of the list. Type in the following</p>
<pre><code>userNameSearch = gis.users.search(query=&quot;username:{userNameSearch}&quot;)
len(userNameSearch)</code></pre>
<p>Click <strong>Run</strong> to run</p>
<figure>
<img src="../media/file105.png" />
</figure>
<p>Result of username search</p></li>
<li><p>To access the user returned you need to use the list index to extract the first user. Then display those results. Type in the following</p>
<pre><code>userNameSelect = userNameSearch[0]
userNameSelect</code></pre>
<p>Click <strong>Run</strong> to run</p>
<figure>
<img src="../media/file106.png" />
</figure>
<p>Results of selecting a single user</p></li>
<li><p>You can also search by email using the wildcard *. This allows you to search for all email addresses from the same email provider. The code is the same as for searching by username except for the query. In this sample you will put in your own email provider in the <code>{@email.com}</code>. You are again going to find the length of the list returned to you before extracting a user. Type in the following in the next cell.</p>
<pre><code>emailSearch = gis.users.search(query=&quot;email: *{@email.com}&quot;)
len(emailSearch) </code></pre>
<p>Click <strong>Run</strong> to run</p></li>
<li><p>Depending on how many people in your organization have that email host you may have a large number. You could iterate through them using a for loop and print out the user information from the last Notebook. Type in the following</p>
<pre><code>import time
for user in emailSearch:
    firstName = user.firstName
    lastName = user.lastName
    email = user.email
    accessedLast = time.localtime(user.lastLogin/1000)
    groups = user.groups
    myGroupsList =[]
    for group in groups:
        groupName = group[&quot;title&quot;]
        myGroupsList.append(groupName)
    groupsName = &quot;, &quot;.join(myGroupsList)
    storageAssigned = user.storageQuota
    storageUsed = user.storageUsage
    prctStorage = round((storageUsed/storageAssigned)*100,4)
    print(&quot;--------------------------------------------&quot;)
    print(&quot;First Name:           {0}&quot;.format(firstName))
    print(&quot;Last Name:            {0}&quot;.format(lastName))
    print(&quot;email:                {0}&quot;.format(email))
    print(&quot;Last Accessed:        {0}/{1}/{2}&quot;.format(accessedLast[1],accessedLast[2],accessedLast[0]))
    print(&quot;Groups:               {0}&quot;.format(groupsName))
    print(&quot;Storage Assigned:     {0}.&quot;.format(storageAssigned))
    print(&quot;Storage Used:         {0}.&quot;.format(storageUsed))
    print(&quot;Percent Storage Used: {0}&quot;.format(prctStorage))</code></pre>
<p>Click <strong>Run</strong> to run. It will print out the user information for each user in that search, separated by a <code>-----------</code>.</p></li>
</ol>
<figure>
<img src="../media/file107.png" />
</figure>
User search information.
<p>You have seen how to search for users within your organization, and print out user information. In the next section you will see some of the admin privileges that can be applied to users.</p>
</section>
</section>
<section id="administering-your-gis" class="level4" data-number="4.2.3.4">
<h4 data-number="4.2.3.4">Administering Your GIS</h4>
<p>In this section you will explore what you can do if you are the administrator and have admin privileges. With admin privileges you can add and remove users, manage user licenses, and manage ArcGIS Online credits. In this section you will see how to do each of those.</p>
<blockquote>
<p>You must have admin privileges to do any of the following. To add users you must have credentials available for the new user</p>
</blockquote>
<section id="creating-and-deleting-users" class="level5" data-number="4.2.3.4.1">
<h5 data-number="4.2.3.4.1">Creating and Deleting users</h5>
<p>To create new users in AcGIS Online you will be using the <code>create()</code> method. The <code>create()</code> method takes the following arguments: <code>username</code>, <code>password</code>, <code>firstname</code>, <code>lastname</code>, <code>email</code>, <code>description</code>, <code>role</code>, <code>user_type</code>, and <code>provider</code>.</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><code>username</code></td>
<td>String value of the username</td>
</tr>
<tr class="even">
<td><code>password</code></td>
<td>String value of the password, this can be changed by user at any time when they log in</td>
</tr>
<tr class="odd">
<td><code>firstname</code></td>
<td>String value of the user’s first name</td>
</tr>
<tr class="even">
<td><code>lastname</code></td>
<td>String value of the user’s last name</td>
</tr>
<tr class="odd">
<td><code>email</code></td>
<td>String value of the user’s email address</td>
</tr>
<tr class="even">
<td><code>description</code></td>
<td>String value of the description of the user</td>
</tr>
<tr class="odd">
<td><code>role</code></td>
<td><p>String value of the role for the user in the organization.</p>
<p>ArcGIS Online has the three options</p>
<p><code>org_admin</code> is for admins with the organization that have admin privleges</p>
<p><code>org_publisher</code> is for publishers in the organization that can publish web layers and service layers</p>
<p><code>org_user</code> is for users in the organization that can create groups and content and use the organizations data</p></td>
</tr>
<tr class="even">
<td><code>user_type</code></td>
<td><p>String value for the user type in the organization</p>
<p><code>viewer_UT</code> is for users that need to view data shared with them. They can’t create or edit data</p>
<p><code>fieldworkerUT</code> is for users that need to view and edit data and is for users that interact mostly through field apps.</p>
<p><code>editor_UT</code> is for users that need to view and edit data shared with them. They can’t create or share data</p>
<p><code>creator_UT</code> is for users that need to create and share content, such as web maps and apps.</p>
<p><code>GISProfessionalBasicUT</code> is for users with all the capabilities of a creator and access to ArcGIS Pro Basic</p>
<p><code>GISProfessionalStdUT</code> is for users with all the capabilities of a creator and access to ArcGIS Pro Standard</p>
<p><code>GISProfessionalAdvUT</code> is for users with all the capabilities of a creator and access to ArcGIS Pro Advanced</p></td>
</tr>
<tr class="odd">
<td><code>provider</code></td>
<td><p>String value for the provider</p>
<p><code>arcgis</code> for ArcGIS Online</p>
<p>enterprise for ArcGIS Enterprise</p></td>
</tr>
</tbody>
</table>
<p>With this table you can create your new user.</p>
<ol>
<li>Right click on <code>Chapter5</code> folder and select <strong>New&gt;Notebook</strong>. Rename the Notebook to <code>AdminsteringYourOrg</code></li>
<li><p>You are going to log into your organizations GIS through the user you are currently logged into ArcGIS Pro with by typing in the following</p>
<pre><code>from arcgis.gis import GIS
from IPython.display import display
gis = GIS(&#39;home&#39;)</code></pre>
<p>Click <strong>Run</strong> to run</p></li>
<li><p>You are going to create a sample new user. You will assign them a username, password, first name, last name, email, description, role, user type, and provider. Type in the following</p>
<pre><code>newUser = gis.users.create(username = &quot;newUser1&quot;,
                           password = &quot;1234PleaseChange&quot;,
                           firstname = &quot;New&quot;,
                           lastname = &quot;User&quot;,
                           email = &quot;newUser@company.com&quot;,
                           description  = &quot;Creating a new user&quot;,
                           role = &quot;org_publisher&quot;,
                           user_type = &quot;GISProfessionalAdvUT&quot;,
                           provider = &quot;arcgis&quot;                          
                          )</code></pre>
<p>Click <strong>Run</strong> to run. If it runs you should get no result.</p></li>
<li>To view the user type in <code>newUser</code> in the next cell and click <strong>Run</strong> to run</li>
<li><p>When it comes time to delete a user you first want to make sure you don’t lose any data. As an admin you can reassign a user’s data to a different user. The first step is to find all of that user’s data. Recall from earlier you can search for content based on the owner’s username. In the next cell type the following</p>
<pre><code>items = gis.content.search(query=&quot;owner: newUser1&quot;)</code></pre>
<p>Click <strong>Run</strong> to run.</p></li>
<li><p>To reassign all the items to a new user you loop through the list of items calling the <code>reassign_to </code>method. The reassign_<code>to </code>method takes a <code>target_owner </code>and <code>target_folder </code>argument. If the name of the <code>target_folder </code>is not assigned it will put the items in the root folder. You can now reassign all the data from newUser to yourself by typing in the following</p>
<pre><code>for item in items:
    item.reassign_to(target_owner = &quot;{yourUserName}&quot;)</code></pre>
<p>Click <strong>Run</strong> to run. You should get no output</p></li>
<li><p>Now you can delete the user as all of their data has been reassigned. In the next cell type in</p>
<pre><code>newUser1.delete()</code></pre>
<p>Click <strong>Run</strong> to run. You should get no output</p></li>
</ol>
<blockquote>
<p>You can reassign all of a user’s items when you delete the user. But you are only able to reassign it to the root folder. To do that you would write <code>newUser.delete(reassign_to ={userNameToAssignTo}”</code></p>
</blockquote>
<p>You have seen how to create a user and the different attributes you can assign a user when you create them. You have also seen how to reassign a user’s data and delete that user. Next you will see how to assign licenses and monitor credits for your users</p>
</section>
<section id="assign-licenses-and-credits" class="level5" data-number="4.2.3.4.2">
<h5 data-number="4.2.3.4.2">Assign Licenses and Credits</h5>
<p>You can manage both user licenses and credits through Notebooks. Users can be assigned a license and have that license revoked. You can view the available credits in your organization, and you can manage those credits through credit budgeting. You are first going to see how to check the apps in your organization and then view the licenses in your organization and see how to assign them.</p>
<ol>
<li><p>Continue working in the <code>AdminsteringYourOrg</code> Notebook by finding all the apps licensed in your organization. You will create variable to hold the list of apps and then a loop to print out the apps each on a single line. Type in the following</p>
<pre><code>license = gis.admin.license.all()
for l in license:
    print(l)</code></pre>
<p>Click <strong>Run</strong> to run. You will see the apps your organization has licensed.</p></li>
<li><p>In the next cell you will use the get method to get the license to your ArcGIS Pro app so you can see what individual license you have. Type in the following</p>
<pre><code>proLic = gis.admin.license.get(&quot;ArcGIS Pro&quot;)</code></pre>
<p>Click <strong>Run</strong> to run. You should get no output</p></li>
<li><p>Now that you have the Pro app license you can see what extensions you have licensed and if any are assigned. You are using the report object to get a table showing you what licenses you have, how many are assigned and how many are remaining. Type in the following</p>
<pre><code>proLic.report</code></pre>
<p>Click <strong>Run</strong> to run. You should see a table similar to below, just with the licenses in your organization</p>
<figure>
<img src="../media/file108.png" />
</figure>
<p>ArcGIS Pro Licenses in your organization</p></li>
<li><p>Now that you know what licenses you have available you can assign one. You use the assign method with the username and the extension as the entitlements argument. Assign yourself a spatial analyst license.</p>
<pre><code>proLic.assign(username = me.username,entitlements=&quot;spatialAnalystN&quot;)</code></pre>
<p>Click <strong>Run</strong> to run. If assigned your result should be <strong>True</strong></p></li>
<li><p>You can check on what extension a user has assigned. You use the <code>user_entitlement</code> method passing in the user name as the argument. Check on what extensions you have assigned to you by typing in the following, putting in your user name between the quotes.</p>
<pre><code>proLic.user_entitlement(&quot;{yourUserName}&quot;)</code></pre>
<p>Click <strong>Run</strong> to run. The results are a dictionary with the username, last login, connected, and list of entitlements as the key/value pairs.</p>
<figure>
<img src="../media/file109.png" />
</figure>
<p>Extensions assigned to a user</p></li>
<li><p>To revoke a license you use the revoke method on the license object. The arguments are the same as assign, a username and the extensions to be revoked. You can use the * wildcard to revoke all licenses. Revoke all the licenses assigned to you.</p>
<pre><code>proLic.revoke(username = me.username,entitlements=&quot;*&quot;)</code></pre>
<p>Click <strong>Run</strong> to run. If assigned your result should be <strong>True</strong></p></li>
<li><p>To verify you have no license use the <code>user_entitlement</code> method again</p>
<pre><code>proLic.user_entitlement(&quot;{yourUserName}&quot;)</code></pre>
<p>Click <strong>Run</strong> to run. The results are an empty dictionary.</p></li>
<li><p>You can use the credits property to view the amount of credits available in your organization. Type in the following</p>
<pre><code>gis.admin.credits.credits</code></pre>
<p>Click <strong>Run</strong> to run. The results will be the number of credits in your organization.</p></li>
<li><p>You can manage the credits available to each user by using credit budgeting. Turn on credit budgeting by using the enable method on the credits property.</p>
<pre><code>gis.admin.credits.enable()</code></pre>
<p>Click <strong>Run</strong> to run. Your result should be <strong>True</strong></p></li>
<li><p>Now you can allocate credits to a user by using the allocate method. The allocate method takes the username and number of credits as its arguments. Allocate 10 credits to yourself</p>
<pre><code>gis.admin.credits.allocate(username=me.username, credits=api_acc_credits)</code></pre>
<p>Click <strong>Run</strong> to run. Your result should be <strong>True</strong></p>
<blockquote>
<p>You can also remove credits from a user by using the deallocate method. The deallocate method removes all the credits from a user. If you want to remove all the credits you would type in the following <code>gis.admin.credits.deallocate(username='{username}')</code></p>
</blockquote></li>
<li><p>When credit budgeting is enabled you can check the available credits for each user as they get an assigned credits and available credits property. Check the credits you have available</p>
<pre><code>me.availableCredits</code></pre>
<p>Click <strong>Run</strong> to run. The results will be the number of credits available to you. <em>If you are using single user account you cannot assign credits to yourself as you have access to all the credits</em></p></li>
</ol>
</section>
</section>
<section id="summary-1" class="level4" data-number="4.2.3.5">
<h4 data-number="4.2.3.5">Summary</h4>
<p>In this section you have seen how to search for content inside and outside of your organization. You can now create new folders for organizing your content. You can create groups and set different sharing levels of your groups for sharing content by inviting users to your group. Using the admin settings you can create new users with different roles and types. You can search for existing users and pull up information about their roles and data owned, groups they are members of, and storage used. You can manage licenses for users and budget credits. In all you have the tools and Notebooks to manage your content and users of your organization.</p>
</section>
</section>
</section>
</section>
</body>
</html>
