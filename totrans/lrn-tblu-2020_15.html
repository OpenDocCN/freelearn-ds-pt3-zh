<html><head></head><body>
  <div id="_idContainer628">
    <h1 class="chapterNumber">15</h1>
    <h1 id="_idParaDest-274" class="chapterTitle">Taming Data with Tableau Prep</h1>
    <p class="normal">We considered some options for structuring data in Tableau Desktop in the previous chapter. Many of the concepts around well-structured data will apply here as we now turn our attention to another product from Tableau: <strong class="bold">Tableau Prep</strong>. Tableau Prep extends the Tableau platform with robust options for cleaning and structuring data for analysis in Tableau. In the same way that Tableau Desktop provides a hands-on, visual experience for visualizing and analyzing data, Tableau Prep provides a hands-on, visual experience for cleaning and shaping data.</p>
    <p class="normal">Tableau Prep is on an accelerated, monthly release cycle and while the platform continues to grow and expand, there is an underlying paradigm that sets a foundation for cleaning and shaping data. We'll cover a lot of ground in this chapter, but our goal is not to cover every possible feature—and indeed, we won't. Instead, we will seek to understand the underlying paradigm and flow of thought that will enable you to tackle a multitude of data challenges in Tableau Prep.</p>
    <p class="normal">In this chapter, we'll work through a couple of practical examples as we explore the paradigm of Tableau Prep, understand the fundamental transformations, and see many of the features and functions of Tableau Prep.</p>
    <p class="normal">We'll cover quite a few topics in this chapter, including the following:</p>
    <ul>
      <li class="list">Getting ready to explore Tableau Prep</li>
      <li class="list">Understanding the Tableau Prep Builder interface</li>
      <li class="list">Flowing with the fundamental paradigm<ul>
          <li class="Bullet-Within-Bullet--PACKT-">Connecting to data</li>
          <li class="Bullet-Within-Bullet--PACKT-">Cleaning the data</li>
          <li class="Bullet-Within-Bullet--PACKT-">Calculations and aggregations in Tableau Prep</li>
          <li class="Bullet-Within-Bullet--PACKT-">Filtering data in Tableau Prep</li>
          <li class="Bullet-Within-Bullet-End--PACKT-">Transforming the data for analysis</li>
        </ul>
      </li>
      <li class="list">Options for automating flows</li>
    </ul>
    <p class="normal">In this chapter, we'll use the term Tableau Prep broadly to speak of the entire platform that Tableau has developed for data prep and sometimes as shorthand for Tableau Prep Builder, the client application that's used to connect to data, create data flows, and define output. Where needed for clarity, we'll use these specific names:</p>
    <ul>
      <li class="list"><strong class="bold">Tableau Prep Builder</strong>: The client application that's used to design data flows, run them locally, and publish them</li>
      <li class="list"><strong class="bold">Tableau Prep Conductor</strong>: An add-on to Tableau Server that allows the scheduling and automation of published data flows</li>
    </ul>
    <p class="normal">Let's start by understanding how to get started with Tableau Prep.</p>
    <h1 id="_idParaDest-275" class="title">Getting ready to explore Tableau Prep</h1>
    <p class="normal">Tableau Prep Builder <a id="_idIndexMarker1212"/>is available for Windows and Mac. If you do not currently have Tableau Prep Builder installed on your machine, please take a moment to <a id="_idIndexMarker1213"/>download the application from <a href="https://www.tableau.com/products/prep/download"><span class="url">https://www.tableau.com/products/prep/download</span></a>. Licenses for Tableau Prep Builder are included with Tableau Creator licensing. If you do not currently have a license, you may trial the application for 14 days. Please speak with your Tableau representative to confirm licensing and trial periods.</p>
    <p class="normal">The examples in this chapter use files located in the <code class="Code-In-Text--PACKT-">\Learning Tableau\Chapter 15</code> directory. Specific instructions will guide you on when and how to use the various files.</p>
    <p class="normal">Once you've downloaded and installed Tableau Prep Builder, you will be able to launch the application. Once you do, you'll find a welcome screen that we'll detail as we cover the interface in the next section.</p>
    <h1 id="_idParaDest-276" class="title">Understanding the Tableau Prep Builder interface</h1>
    <p class="normal">You'll find a lot of similarities in <a id="_idIndexMarker1214"/>the interfaces of Tableau Prep Builder and Tableau Desktop. The home screen of Tableau Prep Builder will look similar to this:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_01.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.1: The Tableau Prep Builder welcome screen with numbering to identify key components of the UI</p>
    <p class="normal">The following components<a id="_idIndexMarker1215"/> have been numbered in <em class="italics">Figure 15.1</em>:</p>
    <ol>
      <li class="list">The menu includes options for opening files, editing and running flows, signing into Tableau Server, and various <strong class="screen-text">Help</strong> functions. Also notice the <strong class="bold">Connections</strong> Pane to the left, immediately beneath the <strong class="screen-text">File</strong> menu. It is collapsed initially, but will contain a list of data connections as you create them.</li>
      <li class="list">The two large buttons at the top give you the option to <strong class="screen-text">Open a Flow</strong>, which opens an existing Tableau Prep flow file, or <strong class="screen-text">Connect to Data</strong>, to start a new flow with an initial data connection. We'll define a flow in the next section. For now, think of a flow in terms of Tableau Prep's equivalent of a Tableau Desktop workbook.</li>
      <li class="list"><strong class="screen-text">Recent Flows</strong> shows the Tableau Prep data flows that you have recently saved. You may click on one of these to open the flow and edit or run it. A toggle button on the right allows you to switch between thumbnails and a list.</li>
      <li class="list"><strong class="screen-text">Sample Flows</strong> allows you to open some prebuilt examples.</li>
      <li class="list" value="5">The <strong class="screen-text">Discover</strong> pane gives you options for training and resources as you learn more about Tableau Prep. A <a id="_idIndexMarker1216"/>notification to upgrade will also appear if there is a newer version available.</li>
    </ol>
    <p class="normal">Once you have opened or started a new flow, the home screen will be replaced with a new interface, which will facilitate the designing and running of flows:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_02.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.2: When designing a flow, you'll find an interface like this one. The major components are numbered and described as follows</p>
    <p class="normal">This interface consists of the<a id="_idIndexMarker1217"/> following, which are numbered in the preceding screenshot:</p>
    <ol>
      <li class="list" value="1">The flow pane, where you will logically build the flow of data with steps that will do anything from cleaning to calculation, to transformation and reshaping. Selecting any single step will reveal the interface on the bottom half of the screen. This interface will vary slightly, depending on the type of step you have selected.</li>
      <li class="list">The settings, or changes pane lists settings for the step and also a list of all changes that are made in the step, from calculations to renaming or removing fields, to changing data types or grouping values. You can click on individual changes to edit them or see how they alter the data.</li>
      <li class="list">The profile pane gives you a profile of each field in the data as it exists for the selected step. You can see the type and distribution of values for each field. Clicking on a field will highlight the lineage in the flow pane and clicking one or more values of a field will highlight the related values of other fields.</li>
      <li class="list" value="4">The data grid shows<a id="_idIndexMarker1218"/> individual records of data as they exist in that step. Selecting a change in the changes grid will show the data based on changes up to and including the selected change. Selecting a value in the profile pane will filter the data grid to only show records containing that value. For example, selecting the first row of the <code class="Code-In-Text--PACKT-">Order Date</code> field in the profile pane will filter the data grid to show only records represented by that bar. This allows you to explore the data, but doesn't alter the data until you perform a specific action that does result in a change.</li>
    </ol>
    <p class="normal">You will also notice the toolbar that allows you to undo or redo actions, refresh data, or run the flow. Additionally, there will be other options or controls that appear based on the type of step or field that's selected. We'll consider those details as we dive into the paradigm of Tableau Prep, and a practical example later in the chapter.</p>
    <h1 id="_idParaDest-277" class="title">Flowing with the fundamental paradigm</h1>
    <p class="normal">The overall paradigm of <a id="_idIndexMarker1219"/>Tableau Prep is a hands-on, visual experience of discovering, cleaning, and shaping data through a flow. A flow (sometimes also called a data flow) is a logical series of steps and changes that are applied to data from input(s) to output(s). </p>
    <p class="normal">Here is an example of what a flow looks like in the flow pane of Tableau Prep:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.3: An example flow in Tableau Prep</p>
    <p class="normal">Each of the individual <a id="_idIndexMarker1220"/>components of the flow are called steps, which are connected by lines that indicate the logical flow of data from left to right. The lines are sometimes called connectors or branches of the flow. Notice that the <strong class="screen-text">Aggregate Step</strong> here has one line coming in from the left and three branches extending to the right. Any step can have multiple output branches that represent logical copies of the data at that point in the flow.</p>
    <p class="normal">One important thing to notice is that four of the step types represent the four major transformations of data we discussed in <em class="italics">Chapter 14</em>, <em class="italics">Structuring Messy Data to Work Well in Tableau</em>. The step types of <strong class="screen-text">Pivot</strong>, <strong class="screen-text">Union</strong>, <strong class="screen-text">Join</strong>, and <strong class="screen-text">Aggregate</strong> exactly match those transformations, while the <strong class="screen-text">Clean Step</strong> allows various other operations involved in cleaning and calculating. You may wish to refresh your memory on the basic transformations in the previous chapter.</p>
    <p class="normal">As we work through an example of a flow throughout this chapter, we'll examine each type of step more closely. For now, consider these preliminary definitions of the primary steps in Tableau Prep:</p>
    <ul>
      <li class="list"><strong class="bold">Input</strong>: An<a id="_idIndexMarker1221"/> input step starts the flow with data from a source such as a file, table, view, or custom SQL. It gives options for defining file delimiters, unions of multiple tables or files, and how much data to sample (for larger record sets).</li>
      <li class="list"><strong class="bold">Clean Step</strong>: A clean step<a id="_idIndexMarker1222"/> allows you to perform a wide variety of functions on the data, including calculations, filtering, adjusting data types, removing and merging fields, grouping and cleaning, and much more.</li>
      <li class="list"><strong class="bold">Aggregate Step</strong>: An aggregate step<a id="_idIndexMarker1223"/> allows you to aggregate values (for example, get <code class="Code-In-Text--PACKT-">MIN</code>, <code class="Code-In-Text--PACKT-">MAX</code>, <code class="Code-In-Text--PACKT-">SUM</code>, <code class="Code-In-Text--PACKT-">AVG</code>) at a level of detail you specify.</li>
      <li class="list"><strong class="bold">Join Step</strong>: A join step<a id="_idIndexMarker1224"/> allows you to bring together two branches of the flow and match data row by row based on the fields you select and the type of join.</li>
      <li class="list"><strong class="bold">Union Step</strong>: A union step<a id="_idIndexMarker1225"/> allows you to bring together two or more branches representing sets of data to be unioned together. You will have options for merging or removing mismatched fields.
    <div class="packt_tip">
      <p>Both the <strong class="screen-text">Union Step</strong> and <strong class="screen-text">Join Step</strong> in this example have an error icon, indicating that something has not been configured correctly in the flow. Hovering over the icon gives a tooltip description of the error. In this case, the error is due to only having one input connection, while both the union and join require at least two inputs. Often, selecting a step with an error icon may reveal details about the error in the changes pane or elsewhere in the configuration steps.</p>
    </div>
	</li>
    </ul>
    <ul>
      <li class="list"><strong class="bold">Pivot Step</strong>: A pivot step<a id="_idIndexMarker1226"/> allows you to transform columns of data into rows or rows of data into columns. You'll have options to select the type of pivot as well as the fields themselves. The term <em class="italics">transpose</em> is sometimes also used to describe this operation.</li>
      <li class="list"><strong class="bold">Output</strong>: The output step<a id="_idIndexMarker1227"/> defines the ultimate destination for the cleaned and transformed data. This could be a text file (<code class="Code-In-Text--PACKT-">.csv</code>), extract (<code class="Code-In-Text--PACKT-">.hyper</code> or <code class="Code-In-Text--PACKT-">.tde</code>), or published extracted data source to Tableau Server. The ability to output to a database has been announced, although is not available at the time of writing. You'll have options to select the type of output, along with the path and filename or Tableau Server and project.</li>
    </ul>
    <div class="packt_tip">
      <p>Right-clicking a step or connector reveals various options. You may also drag and drop steps onto other steps to reveal options such as joining or unioning the steps together. If you want to replace an early part of the flow to swap out an input step, you can right-click the connector and select <strong class="screen-text">Remove</strong>, and then drag the new input step over the desired next step in the flow to add it as the new input.</p>
    </div>
    <p class="normal">In addition to using the term <em class="italics">flow</em> to refer to the steps and connections that define the logical flow and transformation of the data, we'll also use the term flow to refer to the file that Tableau Prep uses to store the definition of the steps and changes of a flow. Tableau Prep flow files have the <code class="Code-In-Text--PACKT-">.tfl</code> (unpackaged flow) or <code class="Code-In-Text--PACKT-">.tflx</code> (packaged flow) extension.</p>
    <p class="normal">The paradigm of Tableau Prep<a id="_idIndexMarker1228"/> goes far beyond the features and capabilities of any single step. As you build and modify flows, you'll receive instant feedback so that you can see the impact of each step and change. This makes it relatively easy (and fun!) to iteratively discover your data and make the necessary changes.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">When you are building flows, adding steps, making changes, and interacting with data, you are in <strong class="bold">design mode</strong>. Tableau Prep uses a combination of the Hyper engine's cache, along with direct queries of the database, to provide near-instant feedback as you make changes. When you run a flow, you are using <strong class="bold">batch mode</strong> or <strong class="bold">execution mode</strong>. Tableau Prep will run optimized queries and operations that may be slightly different than the queries that are run in design mode.</p>
    </div>
    <p class="normal">We'll consider an example in the remainder of this chapter to aid in our discussion of the Tableau Prep paradigm and highlight some important features and considerations. The example will unfold organically, which will allow us to see how Tableau Prep gives you incredible flexibility to address data challenges as they arise and make changes as you discover new aspects of your data.</p>
    <p class="normal">We'll put you in the role of an analyst at your organization, with the task of analyzing employee air travel. This will include ticket prices, airlines, and even a bit of geospatial analysis of the trips themselves. The data needs to be consolidated from multiple systems and will require some cleaning and shaping to enable the analysis.</p>
    <p class="normal">To follow along, open Tableau Prep Builder, which will start on the home screen (there is not a starter flow for this chapter). The sample data is in the <code class="Code-In-Text--PACKT-">Chapter 15 </code>directory, along with the <code class="Code-In-Text--PACKT-">Complete</code> flow if you want to check your work. The <code class="Code-In-Text--PACKT-">Complete (clean)</code> flow contains a sample of how a flow might be self-documented—it will not match screenshots precisely.</p>
    <div class="packt_tip">
      <p>When you open the <code class="Code-In-Text--PACKT-">Complete</code> flow file, you'll likely receive errors and warnings that input paths and output paths are not valid. This is expected because your machine will almost certainly have a different drive and directory structure than the one on which the examples were prepared. You'll also run into this behavior when you share flow files with others. To resolve the issues, simply work through the connections in the <strong class="screen-text">Connections</strong> pane (expanded in <em class="italics">Figure 15.4</em>) on the left to reconnect to the files and set output steps to appropriate directories on your machine.</p>
    </div>
    <p class="normal">We'll start by connecting to some data!</p>
    <h2 id="_idParaDest-278" class="title">Connecting to data</h2>
    <p class="normal">Connecting to data in<a id="_idIndexMarker1229"/> Tableau Prep is very similar to connecting to data in Tableau Desktop. From the home screen, you may click either <strong class="screen-text">Connect to Data</strong> or the <strong class="screen-text">+</strong> button on the expanded <strong class="screen-text">Connections</strong> pane:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_04.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.4: You can make a new data connection by clicking the + button or the Connect to Data button</p>
    <p class="normal">Either UI element will bring up a list of data source types to select.</p>
    <div class="packt_tip">
      <p>As with Tableau Desktop, for file-based data sources, you may drag the file from <strong class="bold">Windows Explorer</strong> or <strong class="bold">Finder</strong> onto the Tableau Prep window to quickly create a connection.</p>
    </div>
    <p class="normal">Tableau Prep supports dozens of file types and databases, and the list continues to grow. You'll recognize many of the same types of connection possibilities that exist in Tableau Desktop. However, at the time of writing this book, Tableau Prep does not support all the connections that are available in Tableau Desktop.</p>
    <p class="normal">You may create as many connections as you like and the <strong class="screen-text">Connections</strong> pane will list each connection separately with any associated files, tables, views, and stored procedures, or other options that are applicable to that data source. You will be able to use any combination of data sources in the flow.</p>
    <p class="normal">For now, let's start our<a id="_idIndexMarker1230"/> example with the following steps:</p>
    <ol>
      <li class="list" value="1">Starting from the window shown in <em class="italics">Figure 15.4</em>, click <strong class="screen-text">Connect to Data</strong>.</li>
      <li class="list">From the expanded list of possible connections that appears, select <strong class="screen-text">Microsoft Excel</strong>.</li>
      <li class="list">You'll see a main table called <strong class="screen-text">Employee Flights</strong> and a sub-table named <strong class="screen-text">Employee Flights Table 1</strong>. Drag the <strong class="screen-text">Employee Flights</strong> table to the flow canvas. An input step will be created, giving you a preview of the data and other options. The input preview pane will initially look like this:<figure class="mediaobject"><img src="../Images/B16021_15_05.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.5: The input preview allows you to select input fields to include in the flow, rename fields, and change data types</p>
        <p class="normal">The input step displays<a id="_idIndexMarker1231"/> a grid of fields and options for those fields. You'll notice that many of the fields in the <strong class="screen-text">Employee Flights</strong> table are named <code class="Code-In-Text--PACKT-">F2</code>, <code class="Code-In-Text--PACKT-">F3</code>, <code class="Code-In-Text--PACKT-">F4</code>, and so on. This is due to the format of the Excel file, which has merged cells and a summary sub-table. Continue the exercise with the following steps:</p>
      </li>
      <li class="list">Check the <strong class="screen-text">Use Data Interpreter</strong> option on the <strong class="screen-text">Connections</strong> pane and Tableau Prep will correctly parse the file as shown here:<figure class="mediaobject"><img src="../Images/B16021_15_06.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.6: The data interpreter parses the file to fix common issues such as merged cells, empty headers, and sub-total lines</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">When you select <a id="_idIndexMarker1232"/>an input step, Tableau Prep will display a grid of fields in the data. You may use the grid to uncheck any fields you do not wish to include, edit the <strong class="screen-text">Type</strong> of data by clicking the associated symbol (for example, change a string to a date), and edit the <strong class="screen-text">Field Name</strong> itself by double-clicking the field name value.</p>
        <div class="note">
          <p class="Information-Box--PACKT-">If Tableau Prep Builder detects that the data source contains a large number of records, it may turn on <a id="_idIndexMarker1233"/>data sampling. <strong class="bold">Data Sampling</strong> uses a smaller subset of records for giving rapid feedback and profiling in design mode. However, it will use the full set of data when you run the entire flow in batch mode. You can control the data sampling options by clicking <strong class="screen-text">Data Sample</strong> on the input pane. While you can set the sample size for the source, subsequent steps, such as joins, that result in large numbers of records may turn on sampling that cannot be disabled. You'll receive an indicator of <strong class="bold">Data Sampling</strong> if it occurs anywhere in the flow.</p>
        </div>
      </li>
      <li class="list">Now, we'll continue to <a id="_idIndexMarker1234"/>explore the data and fix some issues along the way. Click the <strong class="screen-text">+</strong> button that appears when you hover over the <strong class="screen-text">Employee Flights</strong> input step. This allows you to extend the flow by adding additional step types. In this case, we'll add a <strong class="screen-text">Clean Step</strong>. This will extend the flow by adding a clean step called <strong class="screen-text">Clean 1</strong>:
    <figure class="mediaobject"><img src="../Images/B16021_15_07.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.7: Adding a step extends the flow. Here, adding a clean step adds Clean 1</p>
	</li>
    </ol>
    <ol>
      <li class="list" value="6">With the <strong class="screen-text">Clean 1</strong> step selected, take a moment to explore the data using the profile pane. Observe how selecting individual values for fields in the profile pane highlights portions of related values for other fields. This can give you great insight into your data, such as seeing the different price ranges based on <code class="Code-In-Text--PACKT-">Ticket</code> <code class="Code-In-Text--PACKT-">Type</code>:
    <figure class="mediaobject"><img src="../Images/B16021_15_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.8: Selecting a value for a field in the profile pane highlights which values (and what proportion of those values) relate to the selected value</p>
	</li>
    </ol>
    <p class="normal">Highlighting the bar<a id="_idIndexMarker1235"/> segments across fields in the profile pane, which results from selecting a field value, is called brushing. You can also take action on selected values via the toolbar at the top of the profile pane or by right-clicking a field value. These actions include filtering, editing values, or replacing with <code class="Code-In-Text--PACKT-">NULL</code>. However, before making any changes or cleaning any of the data, let's connect to some additional data.</p>
    <p class="normal">It turns out that most of the airline ticket booking data is in one database that's represented by the Excel file, but another airline's booking data is stored in files that are periodically added to a directory. These files are in the <code class="Code-In-Text--PACKT-">\Learning Tableau\Chapter 15\</code> directory. The files are named with the convention <code class="Code-In-Text--PACKT-">Southwest YYYY.csv</code> (where <code class="Code-In-Text--PACKT-">YYYY</code> represents the <code class="Code-In-Text--PACKT-">year</code>).</p>
    <p class="normal">We'll connect to all the existing files and ensure that we are prepared for additional future files:</p>
    <ol>
      <li class="list" value="1">Click the <strong class="screen-text">+</strong> icon on the <strong class="screen-text">connections</strong> pane to add a new connection to a <strong class="screen-text">Text File</strong>.</li>
      <li class="list">Navigate to the <code class="Code-In-Text--PACKT-">\Learning Tableau\Chapter 15\</code> directory and select any of the <code class="Code-In-Text--PACKT-">Southwest YYYY.csv</code> files to start the connection. Looking at the <strong class="screen-text">Input</strong> settings, you should see that Tableau Prep correctly identifies the field separators, field names, and types:<figure class="mediaobject"><img src="../Images/B16021_15_09.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.9: A text file includes options for headers, field separators, text qualifiers, character sets, and more. Notice also the tabs such as Multiple Files and Data Sample giving other options for the text input</p>
      </li>
      <li class="list">In the <strong class="screen-text">Input</strong> pane, select<a id="_idIndexMarker1236"/> the <strong class="screen-text">Multiple Files</strong> tab and switch from <strong class="screen-text">Single table</strong> to <strong class="screen-text">Wildcard union</strong>. Set <strong class="screen-text">Matching Pattern</strong> to <code class="Code-In-Text--PACKT-">Southwest*</code> and click <strong class="screen-text">Apply</strong>. This tells Tableau Prep to union all of the text files in the directory that begin with <code class="Code-In-Text--PACKT-">Southwest</code> together:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B16021_15_10.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.10: Using Matching Pattern tells Tableau Prep which files to union together. That way, when Southwest 2020.txt and future files are dropped into the directory, they will be automatically included</p>
    <ol>
      <li class="list" value="4">Use the <strong class="screen-text">+</strong> icon on the <strong class="screen-text">Southwest</strong> input step in the flow pane to add a new clean step. This step will be named <strong class="screen-text">Clean 2</strong> by default. Once again, explore the data, but don't take any action<a id="_idIndexMarker1237"/> until you've brought the two sources together in the flow. You may notice a new field in the <strong class="screen-text">Clean 2</strong> step called <strong class="screen-text">File Paths</strong>, which indicates which file in the union is associated with each record.</li>
    </ol>
    <p class="normal">With our input steps defined, let's move on to consider how to clean up some of the data to get it ready for analysis.</p>
    <h2 id="_idParaDest-279" class="title">Cleaning the data</h2>
    <p class="normal">The process of <a id="_idIndexMarker1238"/>building out the flow is quite iterative, and you'll often make discoveries about the data that will aid you in cleaning and transforming it. We'll break this example into sections for the sake of reference, but don't let this detract from the idea that building a flow should be a flow of thought. The example is meant to be seamless!</p>
    <p class="normal">We'll take a look at quite a few possibilities for prepping the data in this section, including merging and<a id="_idIndexMarker1239"/> grouping. Let's start with seeing how to union together branches in the flow.</p>
    <h3 id="_idParaDest-280" class="title">Unioning, merging mismatched fields, and removing unnecessary fields</h3>
    <p class="normal">We know that we want to bring together the booking data for all the airlines, so we'll union together the two paths in the flow:</p>
    <ol>
      <li class="list" value="1">Drag the <strong class="screen-text">Clean 2</strong> step onto the <strong class="screen-text">Clean 1</strong> step and drop it onto the <strong class="screen-text">Union</strong> box that appears. This will create a new <strong class="screen-text">Union</strong> step with input connections from both of the clean steps:<figure class="mediaobject"><img src="../Images/B16021_15_11.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.11: Dragging one step onto another in the flow reveals options for bringing the datasets together in the flow. Here, for example, there are options for creating a Union or Join</p>
      </li>
      <li class="list">The <strong class="screen-text">Union</strong> pane that <a id="_idIndexMarker1240"/>shows up when the <strong class="screen-text">Union</strong> step is selected will show you the mismatched fields, indicate the associated input, and give you options for removing or merging the fields. For example, <code class="Code-In-Text--PACKT-">Fare</code> <code class="Code-In-Text--PACKT-">Type</code> and <code class="Code-In-Text--PACKT-">Ticket</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Type</code> are named differently between the Excel file and the text files, but in fact represent the same data. Hold down the <em class="italics">Ctrl</em> key and select both fields. Then, select <strong class="screen-text">Merge Fields</strong> from the toolbar at the top of the pane or from the right-click menu:<figure class="mediaobject"><img src="../Images/B16021_15_12.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.12: When you select a single field, Tableau Prep will highlight fields that are potentially the same data. Selecting both reveals the Merge Fields option</p>
      </li>
      <li class="list">Also, merge <code class="Code-In-Text--PACKT-">Row</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">ID</code> and <code class="Code-In-Text--PACKT-">Row_ID</code>.</li>
      <li class="list"><strong class="screen-text">File Paths </strong>applies only to<a id="_idIndexMarker1241"/> the <code class="Code-In-Text--PACKT-">Southwest</code> files, which <a id="_idIndexMarker1242"/>were unioned together in the <strong class="screen-text">Input</strong> step. While this auto-generated field can be very useful at times, it does not add anything to the data in this example. Select the field, then click the ellipses menu button and select <strong class="screen-text">Remove Field</strong>.</li>
      <li class="list">Similarly, <code class="Code-In-Text--PACKT-">Travel</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Insurance?</code> and <code class="Code-In-Text--PACKT-">Passenger</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">ID</code> apply to only one of the inputs and will be of little use in our analysis. Remove those fields as well.</li>
    </ol>
    <ol>
      <li class="list" value="6">The single remaining mismatched field, <code class="Code-In-Text--PACKT-">Airline</code>, is useful. Leave it for now and click the <strong class="screen-text">+</strong> icon on the <strong class="screen-text">Union 1</strong> step in the flow pane and extend the flow by selecting <strong class="screen-text">Clean Step</strong>. At <a id="_idIndexMarker1243"/>this point, your flow should look like this:
    <figure class="mediaobject"><img src="../Images/B16021_15_13.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.13: Your flow should look similar to this. You may notice some variation in the exact location of steps or color (you can change a step's color by right-clicking a step)</p>
	</li>
    </ol>
    <div class="packt_tip">
      <p>There is an icon above the <strong class="screen-text">Union 1</strong> step in the flow, indicating changes that were made within this step. In this case, the changes are the removal of several of the fields. Each step with changes will have similar icons, which will reveal tooltip details when you hover over them and also allow you to interact with the changes. You can see a complete list of changes, edit them, reorder them, and remove them by clicking the step and opening the changes pane. Depending on the step type, this is available by either expanding it or selecting the changes tab.</p>
    </div>
    <p class="normal">Next, we'll continue building the flow and consider some options for grouping and cleaning.</p>
    <h3 id="_idParaDest-281" class="title">Grouping and cleaning</h3>
    <p class="normal">Now, we'll spend<a id="_idIndexMarker1244"/> some time cleaning up the data that came from both <a id="_idIndexMarker1245"/>input sources. With the <strong class="screen-text">Clean 3</strong> step selected, use the profile pane to examine the data and continue our flow. The first two fields indicate some issues that need to be addressed:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_14.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.14: Every null value in the Airline field comes from the Southwest files. Fortunately, in this case, the source of the data indicates the airline</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">Table</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Names</code> field <a id="_idIndexMarker1246"/>was generated by Tableau Prep as part of <strong class="screen-text">Union 1</strong> to<a id="_idIndexMarker1247"/> indicate the source of the records. The <code class="Code-In-Text--PACKT-">Airline</code> field came only from the Excel files (you can confirm this by selecting it in the profile pane and observing the highlighted path of the field in the flow pane). Click the <strong class="screen-text">null</strong> value for <code class="Code-In-Text--PACKT-">Airline</code> and observe the brushing: this is proof that the <code class="Code-In-Text--PACKT-">null</code> values in <code class="Code-In-Text--PACKT-">Airline</code> all come from the Southwest files since those files did not contain a field to indicate the airline. We'll address the <code class="Code-In-Text--PACKT-">null</code> values and do some additional cleanup:</p>
    <ol>
      <li class="list" value="1">Double-click the <strong class="screen-text">null</strong> value and then type <code class="Code-In-Text--PACKT-">Southwest</code> to replace <code class="Code-In-Text--PACKT-">NULL</code> with the value you know represents the correct airline. Tableau Prep will indicate that a <strong class="screen-text">Group</strong> and <strong class="screen-text">Replace</strong> operation has occurred with a paperclip icon.</li>
      <li class="list">We'll do an additional grouping to clean up the variations of <strong class="screen-text">American</strong>. Using the <strong class="screen-text">Options</strong> button on the <code class="Code-In-Text--PACKT-">Airline</code> field, select <strong class="screen-text">Group Values</strong> | <strong class="screen-text">Pronunciation</strong>:<figure class="mediaobject"><img src="../Images/B16021_15_15.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.15: The ellipses button on a field will reveal a plethora of options, from cleaning to filtering, to grouping, to creating calculations</p>
        <p class="Bullet-Without-Bullet-Within-Bullet-End--PACKT-">Nearly <a id="_idIndexMarker1248"/>all the<a id="_idIndexMarker1249"/> variations are grouped into the <strong class="screen-text">American</strong> value. Only <strong class="screen-text">AA</strong> remains.</p>
      </li>
      <li class="list">In the <strong class="screen-text">Group Values by Pronunciation</strong> pane that has appeared, select the <strong class="screen-text">American Airlines</strong> group and manually add <strong class="screen-text">AA</strong> by checking it in the list that appears to the right:<figure class="mediaobject"><img src="../Images/B16021_15_16.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.16: When grouping by pronunciation, you'll notice a slider allowing you control over the sensitivity of the grouping. You can also manually adjust groupings by selecting a field</p>
      </li>
      <li class="list">Click <strong class="screen-text">Done</strong> on <a id="_idIndexMarker1250"/>the <strong class="screen-text">Group Values by Pronunciation</strong> pane.</li>
      <li class="list">Next, select the <code class="Code-In-Text--PACKT-">Table</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Names</code> field, which is<a id="_idIndexMarker1251"/> no longer needed. Using either the toolbar option, the menu from a right-click for the field, or the options button, select <strong class="screen-text">Remove Field.</strong></li>
      <li class="list">Some fields in the profile pane have a <strong class="screen-text">Recommendations</strong> icon (which resembles a lightbulb) in the upper-right corner. Click this icon on the <code class="Code-In-Text--PACKT-">Passenger</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Email</code> field and then <strong class="screen-text">Apply</strong> the recommendation to assign a data role of <strong class="screen-text">Email</strong>:<figure class="mediaobject"><img src="../Images/B16021_15_17.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.17: Recommendations will show when Tableau Prep has suggestions for cleaning a field</p>
        <div class="packt_tip">
          <p><strong class="bold">Data Roles</strong> allow you to <a id="_idIndexMarker1252"/>quickly identify valid or invalid values according to what pattern or domain of values is expected. Once you have assigned a data role, you may receive additional recommendations to either filter or replace invalid values.</p>
        </div>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">After <a id="_idIndexMarker1253"/>applying the recommendation, you'll see an indication in the <a id="_idIndexMarker1254"/>profile pane for invalid values. As you continue following the example, we'll consider some options for quickly dealing with those invalid values.</p>
      </li>
      <li class="list">Click the <strong class="screen-text">Recommendations</strong> button on the <code class="Code-In-Text--PACKT-">Passenger</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Email</code> field again. You'll see two new options presented. <strong class="screen-text">Apply</strong> the option to <strong class="screen-text">Group</strong> and <strong class="screen-text">Replace</strong> invalid values with <code class="Code-In-Text--PACKT-">null</code>:<figure class="mediaobject"><img src="../Images/B16021_15_18.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.18: Here, Tableau Prep suggests either filtering out records with invalid values or replacing the invalid values with null. In this case, we don't want to filter out the entire record, but the invalid values themselves are useless and are best represented by null</p>
      </li>
      <li class="list">Most of<a id="_idIndexMarker1255"/> the remaining fields look fine, except for <code class="Code-In-Text--PACKT-">Fare</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Type</code> (or possibly <code class="Code-In-Text--PACKT-">Ticket</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Type</code>, depending on which name was kept when merging the fields previously). This field contains the values <strong class="screen-text">1st Class</strong> and <strong class="screen-text">First Class</strong>. Select both <a id="_idIndexMarker1256"/>of these values by clicking each while holding down the <em class="italics">Ctrl</em> key and then <strong class="screen-text">Group</strong> them together with the <strong class="screen-text">First Class</strong> value. Two interface options for grouping the values are indicated here:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B16021_15_19.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.19: After selecting two or more values, you can group them together with the toolbar option or the right-click menu</p>
    <ol>
      <li class="list" value="9">At this point, we <a id="_idIndexMarker1257"/>have a clean dataset that contains all our primary data. There's already a lot of analysis we could do. In fact, let's take a <a id="_idIndexMarker1258"/>moment to preview the data. Right-click the <strong class="screen-text">Clean 3</strong> step and select <strong class="screen-text">Preview in Tableau Desktop</strong>:
    <figure class="mediaobject"><img src="../Images/B16021_15_20.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.20: You may preview the data represented by any step in Tableau Desktop by selecting the option from the right-click menu for that step</p>
	</li>
    </ol>
    <p class="normal">A new <a id="_idIndexMarker1259"/>data connection will be made and opened in Tableau Desktop. You can preview the data for any step in the flow. Take a few moments to explore the data in <a id="_idIndexMarker1260"/>Tableau Desktop and then return to Tableau Prep. Now, we'll turn our attention to extending the dataset with some calculations, supplemental data, and a little restructuring.</p>
    <h2 id="_idParaDest-282" class="title">Calculations and aggregations in Tableau Prep</h2>
    <p class="normal">Let's look at how to create<a id="_idIndexMarker1261"/> calculations and some options for <a id="_idIndexMarker1262"/>aggregations in Tableau Prep.</p>
    <h3 id="_idParaDest-283" class="title">Row-level calculations</h3>
    <p class="normal">Calculations in Tableau Prep follow a <a id="_idIndexMarker1263"/>syntax that's nearly identical to Tableau Desktop. However, you'll notice that only row-level and <code class="Code-In-Text--PACKT-">FIXED</code> level of detail functions are available. This is because all calculations in Tableau Prep will apply to the row level. Aggregations are performed using an <strong class="screen-text">Aggregate</strong> <strong class="screen-text">Step</strong>, which we'll consider shortly.</p>
    <p class="normal">Calculations and aggregations can greatly extend our analytic capabilities. In our current example, there is an opportunity to analyze the length of time between ticket purchase and actual travel. We may also want to mark each record with an indicator of how frequently a passenger travels overall. Let's dive into these calculations as we continue our example with the following steps:</p>
    <ol>
      <li class="list" value="1">We'll start with a calculation to determine the length of time between the purchasing of tickets and the day of travel. Select the <strong class="screen-text">Clean 3</strong> step and then click <strong class="screen-text">Create Calculated Field</strong>. Name the calculation <strong class="screen-text">Days from Purchase to Travel</strong> and enter <code class="Code-In-Text--PACKT-">DATEDIFF('day', [Purchase Date], [Travel Date])</code>.</li>
      <li class="list" value="2">Examine the results in the profile pane. The new field should look like this:
    <figure class="mediaobject"><img src="../Images/B16021_15_21.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.21: The calculated field shows up in the profile pane</p>
	</li>
    </ol>
    <p class="normal">The default view<a id="_idIndexMarker1264"/> here (as in many cases with numeric fields) is a summary binned histogram. You can change the view to see its details by selecting the ellipses button in the upper right of the field and switching to <strong class="screen-text">Detail</strong>, which will show every value of the field:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_22.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.22: Numeric and date fields can be viewed in Summary or in Detail</p>
    <p class="normal">The shape of the data that's<a id="_idIndexMarker1265"/> indicated by the default summary histogram is close to what we might have expected with most people purchasing tickets closer (but not immediately prior) to the date of travel. There might be some opportunity for getting better deals by purchasing farther in advance, so identifying this pattern (and then exploring it more fully in Tableau Desktop) will be key for this kind of analysis.</p>
    <h3 id="_idParaDest-284" class="title">Level of detail calculations</h3>
    <p class="normal">There are a <a id="_idIndexMarker1266"/>few other types of analysis we may wish to pursue. Let's consider how we might create segments of passengers based on how often they travel.</p>
    <p class="normal">We'll accomplish this using a <code class="Code-In-Text--PACKT-">FIXED</code> <strong class="bold">level of detail</strong> (<strong class="bold">LOD</strong>) expression. We could create the calculation from scratch, matching the syntax we learned for Tableau Desktop to write the calculation like this:</p>
    <pre class="programlisting code"><code class="hljs-code">{FIXED [Person] : COUNTD([Row_ID])}
</code></pre>
    <p class="normal">The preceding calculation would count the distinct rows per person. Knowing that each row represents a trip, we could alternately use the code <code class="Code-In-Text--PACKT-">{FIXED [Person] : SUM(1)}</code>, which would potentially be more performant, depending on the exact data source.</p>
    <p class="normal">In this example, though, we'll leverage the interface to visually create the calculation:</p>
    <ol>
      <li class="list" value="1">Click the ellipses button on the <code class="Code-In-Text--PACKT-">Person</code> field and select <strong class="screen-text">Create Calculated Field</strong> | <strong class="screen-text">Fixed LOD</strong>:<figure class="mediaobject"><img src="../Images/B16021_15_23.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.23: To create a Fixed LOD calculation, use the menu and select Create Calculated Field | Fixed LOD</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Notice also the options to create <strong class="screen-text">Custom Calculation</strong> (to write code) and <strong class="screen-text">Rank</strong> (to compute rank for the selected field).</p>
      </li>
      <li class="list">This will bring <a id="_idIndexMarker1267"/>up a <strong class="screen-text">Fixed LOD</strong> pane allowing us to configure the LOD expression. The <strong class="screen-text">Group by</strong> field is already set to <code class="Code-In-Text--PACKT-">Person</code> (as we started the calculation from that field), but we'll need to configure <strong class="screen-text">Compute using</strong> to perform the distinct count of rows and rename the field as <code class="Code-In-Text--PACKT-">Trips</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">per</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Person</code>, as shown here:<figure class="mediaobject"><img src="../Images/B16021_15_24.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.24: The Fixed LOD pane allows you to configure the LOD expression visually and get instant visual feedback concerning results</p>
      </li>
      <li class="list">Click <strong class="screen-text">Done</strong> when you<a id="_idIndexMarker1268"/> have finished configuring the <strong class="screen-text">Fixed LOD</strong>.</li>
      <li class="list" value="4">We'll use the <code class="Code-In-Text--PACKT-">Trips per Person</code> field to create segments of customers. We'll accomplish this with another calculated field, so click <strong class="screen-text">Create Calculated Field…</strong> to bring up the code editor. Name the field <code class="Code-In-Text--PACKT-">Frequency Segment</code> and enter the following code:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">IF</span> [Trips per Person] &lt;= <span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">"Rarely"</span>
<span class="hljs-keyword">ELSEIF</span> [Trips per Person] &lt;= <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">"Occasionally"</span>
<span class="hljs-keyword">ELSE</span> <span class="hljs-string">"Frequently"</span>
<span class="hljs-keyword">END</span>
</code></pre>
      </li>
    </ol>
    <p class="normal">The code uses the <code class="Code-In-Text--PACKT-">Trips per Person</code> field in an <code class="Code-In-Text--PACKT-">If</code> <code class="Code-In-Text--PACKT-">Then</code> <code class="Code-In-Text--PACKT-">Else</code> construction to create three segments. You can visually see the correspondence between the fields in the preview pane:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_25.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.25: You can easily visualize how calculations relate to each other and other fields using the Profile pane</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">Frequency</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Segment</code> field <a id="_idIndexMarker1269"/>can be used to accomplish all kinds of useful analysis. For example, you might want to understand whether frequent travelers typically get better ticket prices.</p>
    <p class="normal">We've seen row-level and FIXED LOD calculations, and noted the option for <strong class="screen-text">Rank</strong>. Let's now turn our attention to aggregations.</p>
    <h3 id="_idParaDest-285" class="title">Aggregations</h3>
    <p class="normal">Aggregations in Tableau <a id="_idIndexMarker1270"/>Prep are accomplished using an aggregate step. We'll continue our flow with the idea that we want to better understand our frequency of travel segment:</p>
    <ol>
      <li class="list" value="1">Click the <strong class="screen-text">+</strong> symbol on <strong class="screen-text">Clean 3</strong> and add an <strong class="screen-text">Aggregate</strong> step. The new step will be named <strong class="screen-text">Aggregate 1</strong> by default:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B16021_15_26.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.26: Adding an Aggregate step to the flow using the + symbol</p>
    <ol>
      <li class="list" value="2">Double-click the<a id="_idIndexMarker1271"/> text <strong class="screen-text">Aggregate 1</strong> under the new step. This allows you to edit the name. Change the name from <strong class="screen-text">Aggregate 1</strong> to <strong class="screen-text">Frequency</strong> <strong class="screen-text">Segment</strong>.<div class="packt_tip">
          <p>Give steps meaningful names to self-document the flow. This will greatly help you and others when you return to edit the flow in the future. Additionally, when you are editing the name of a step, the <strong class="screen-text">Add a description</strong> text will appear below the name, as shown in <em class="italics">Figure 15.27</em>.</p>
          <figure class="mediaobject"><img src="../Images/B16021_15_27.png" alt=""/></figure>
          <p class="packt_figref">Figure 15.27: When editing the name of a step, you may also add a more verbose description to help document the steps purpose</p>
        </div>
      
    <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Selecting the aggregate step <a id="_idIndexMarker1272"/>reveals a pane with options for grouping and aggregating fields in the flow:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_28.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.28: Adding an Aggregate step to the flow using the + symbol</p>
    <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">You may drag and drop <a id="_idIndexMarker1273"/>fields from the left to the <strong class="screen-text">Grouped Fields</strong> or <strong class="screen-text">Aggregated Fields</strong> sections and you may change the type of aggregation by clicking on the aggregation text (examples indicated by arrows in <em class="italics">Figure 15.28</em>: <code class="Code-In-Text--PACKT-">SUM</code> next to <code class="Code-In-Text--PACKT-">Trips</code> <code class="Code-In-Text--PACKT-">per</code> <code class="Code-In-Text--PACKT-">Person</code> or <code class="Code-In-Text--PACKT-">AVG</code> above <code class="Code-In-Text--PACKT-">Ticket</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Price</code>) and selecting a different aggregation from the resulting dropdown.</p>
    <p class="Bullet-Without-Bullet-Within-Bullet-End--PACKT-">In <em class="italics">Figure 15.28</em>, notice that we've added <strong class="screen-text">Frequency</strong> <strong class="screen-text">Segment</strong> to the <strong class="screen-text">GROUP</strong> and<strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Ticket</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Price</code> to the <strong class="screen-text">Aggregated Fields</strong> as an <code class="Code-In-Text--PACKT-">AVG</code>. Notice also the <code class="Code-In-Text--PACKT-">Number</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">of</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Rows</code><strong class="screen-text"> (Aggregated)</strong> that appears at the bottom of the list of fields on the left. This is a special field that's available in the aggregation step.</p>
		</li>
    </ol>
    <ol>
      <li class="list" value="3">Conclude the example by clicking the <strong class="screen-text">+</strong> icon that appears when you hover over the <strong class="screen-text">Frequency Segment</strong> aggregate step and adding an <strong class="screen-text">Output</strong> step:<figure class="mediaobject"><img src="../Images/B16021_15_29.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.29 Adding an Output step to the flow using the + symbol</p>
      </li>
      <li class="list">When you select the <strong class="screen-text">Output</strong> step, the <strong class="screen-text">Output</strong> pane shows options for saving the output and a <a id="_idIndexMarker1274"/>preview of what the output will look like. In this case, we've configured the output to save to a <strong class="screen-text">Comma Separated Values (.csv)</strong> file named <strong class="screen-text">Frequency Segment</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B16021_15_30.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.30: This output will contain exactly three rows of data</p>
    <ol>
      <li class="list" value="5">The <strong class="screen-text">Output</strong> pane <a id="_idIndexMarker1275"/>also gives options for setting the output type, performing a full refresh of the data, or appending to existing data, and running the flow.</li>
    </ol>
    <p class="normal">We'll extend our flow in the next few sections to additionally output detailed data. The detailed data as well as the output file of aggregate data gives us some nice options for leveraging Tableau's Data Model in Tableau Desktop to accomplish some complex analysis.</p>
    <p class="normal">Let's continue by thinking about filtering data in Tableau Prep.</p>
    <h2 id="_idParaDest-286" class="title">Filtering data in Tableau Prep</h2>
    <p class="normal">There are a couple of<a id="_idIndexMarker1276"/> ways to filter <a id="_idIndexMarker1277"/>data in Tableau Prep:</p>
    <ul>
      <li class="list">Filter an input</li>
      <li class="list">Filter within the flow</li>
    </ul>
    <p class="normal">Filtering an input can be efficient because the query that's sent to the data source will return fewer records. To filter an input, select the input step and then click the <strong class="screen-text">Filter Values...</strong> button on the input pane:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_31.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.31: The Filter Values... option allows you to filter values on the input step. This could improve performance on large datasets or relational databases</p>
    <p class="normal">The <strong class="screen-text">Add Filter</strong> dialog that pops up allows you to write a calculation with a <code class="Code-In-Text--PACKT-">Boolean</code> (true/false) result. Only true values will be retained.</p>
    <p class="normal">Filtering may also be done within a clean step anywhere in the flow. There are several ways to apply a filter:</p>
    <ul>
      <li class="list">Select one or more values for a given field and then use the <strong class="screen-text">Keep Only</strong> or <strong class="screen-text">Exclude</strong> options.</li>
      <li class="list">Use the <strong class="screen-text">Option</strong> button on a field to reveal multiple filter options based on the field type. For example, dates may be filtered by <strong class="screen-text">Calculation…</strong>, <strong class="screen-text">Range of Dates</strong>, <strong class="screen-text">Relative Dates</strong>, or <strong class="screen-text">Null Values</strong>:</li>
    </ul>
    <figure class="mediaobject"><img src="../Images/B16021_15_32.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.32: Filter options for a field include filtering by Calculation, Range of Dates, and Relative Dates, and keeping or excluding Null Values</p>
    <ul>
      <li class="list">Select a <a id="_idIndexMarker1278"/>field and then <strong class="screen-text">Filter Values</strong> from the toolbar. Similar to <a id="_idIndexMarker1279"/>the way filters work in the input pane, you will be prompted to write code that returns true for records you wish to keep. If, for example, you wanted to keep records for trips scheduled after January 1, 2016, you could write code such as the following:
        <pre class="programlisting code"><code class="hljs-code">[Travel Date] &gt; MAKEDATE(<span class="hljs-number">2016</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) 
</code></pre>
      </li>
    </ul>
    <p class="normal">While no filtering is required for the dataset in our example, you may wish to experiment with various filtering techniques.</p>
    <p class="normal">At this point, your flow should look something like this:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_33.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.33: Your flow should look similar to this (exact placement and colors of steps may vary)</p>
    <p class="normal">Let's conclude the Tableau Prep flow with some final transformations to make the data even easier to use in Tableau.</p>
    <h2 id="_idParaDest-287" class="title">Transforming the data for analysis</h2>
    <p class="normal">Let's create a new <a id="_idIndexMarker1280"/>branch in the flow to work once again with the detailed data. Click on the <strong class="screen-text">Clean 3</strong> step and examine the preview pane. In particular, consider the <code class="Code-In-Text--PACKT-">Route</code> field:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_34.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.34: Route uses airport codes for origin and destination separated by a dash</p>
    <p class="normal">Tableau Desktop (and Server) contain built-in geocoding for airport codes. But to accomplish our specific analysis goal (and open other possibilities for geospatial functions in Tableau Desktop), we'll supplement our data with our own geocoding. We'll also need to consider the shape of the data. Origins and destinations will be most useful split into separate fields, and if we want to connect them visually, we'll also want to consider splitting them into separate rows (a row for the origin and another row for the destination).</p>
    <div class="packt_tip">
      <p>There are quite a few possibilities for visualizing this data. For example, we could keep origin and destination on the same row and use a dual-axis map. If we want to connect origins with destinations with a line, we could keep them in the same row of data and use Tableau's <code class="Code-In-Text--PACKT-">MAKELINE()</code> function. The example you'll follow here will direct you to split the data into separate rows.</p>
    </div>
    <p class="normal">If you are following along, here <a id="_idIndexMarker1281"/>are the steps we'll take:</p>
    <ol>
      <li class="list" value="1">Use the <strong class="screen-text">+</strong> button that appears when you hover over the <strong class="screen-text">Clean 3</strong> step. Use that to add a new clean step, which will be automatically named <strong class="screen-text">Clean 4</strong>:<figure class="mediaobject"><img src="../Images/B16021_15_35.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.35: Adding to a step that already has an output adds a new branch to the flow</p>
      </li>
      <li class="list">In the <strong class="screen-text">Clean 4</strong> step, use the ellipses button on the <code class="Code-In-Text--PACKT-">Route</code> field and select <strong class="screen-text">Split Values</strong> | <strong class="screen-text">Automatic Split</strong>:<figure class="mediaobject"><img src="../Images/B16021_15_36.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.36: Split Values allows you to divide delimited strings into separate fields. Automatic Split attempts to determine the delimiter, while Custom Split… allows you greater options and flexibility</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">You'll now see two new<a id="_idIndexMarker1282"/> fields added to the step:</p>
        <figure class="mediaobject"><img src="../Images/B16021_15_37.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.37: The results of the split will be new fields in the flow</p>
      </li>
      <li class="list"><strong class="screen-text">Route - Split 1</strong> is the <a id="_idIndexMarker1283"/>origin and <strong class="screen-text">Route - Split 2</strong> is the destination. Double-click the field name in the profile pane (or use the option from the ellipses button) to rename the fields to <code class="Code-In-Text--PACKT-">Origin</code> and <code class="Code-In-Text--PACKT-">Destination</code>.</li>
      <li class="list">Locate the <code class="Code-In-Text--PACKT-">US Airports.hyper</code> file in the <code class="Code-In-Text--PACKT-">Chapter 15</code> directory. This file contains each <code class="Code-In-Text--PACKT-">Airport</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Code</code> along with the <code class="Code-In-Text--PACKT-">Airport</code><strong class="screen-text"> </strong><code class="Code-In-Text--PACKT-">Name</code> and <code class="Code-In-Text--PACKT-">Latitude</code> and <code class="Code-In-Text--PACKT-">Longitude</code>:<figure class="mediaobject"><img src="../Images/B16021_15_38.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.38: The hyper extract contains the data we'll need to supplement the flow with our own geospatial data</p>
      </li>
      <li class="list">Make a connection to this<a id="_idIndexMarker1284"/> file in Tableau Prep. You may choose to drag and drop the file onto the Tableau Prep canvas or use the <strong class="screen-text">Add Connection</strong> button from the interface. Tableau will automatically insert an input step named <strong class="screen-text">Extract (Extract.Extract)</strong>. Feel free to change the name of the input step to <strong class="screen-text">Airport Codes</strong>:<figure class="mediaobject"><img src="../Images/B16021_15_39.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.39: The input pane for the Airport Codes file</p>
      </li>
      <li class="list">We'll want to join the <strong class="screen-text">Airport Codes</strong> into our flow to look up <code class="Code-In-Text--PACKT-">Latitude</code> and <code class="Code-In-Text--PACKT-">Longitude</code>, but before we do, we'll need to account for the fact that <code class="Code-In-Text--PACKT-">Origin</code> and <code class="Code-In-Text--PACKT-">Destination</code> in <strong class="screen-text">Clean 4</strong> are currently both on the same row of data. One option is to pivot the data. Use the <strong class="screen-text">+</strong> button on the <strong class="screen-text">Clean 4</strong> step to add a <strong class="screen-text">Pivot</strong> step:<figure class="mediaobject"><img src="../Images/B16021_15_40.png" alt=""/></figure>
        <p class="packt_figref">Figure 15.40: Adding a Pivot step from Clean 4</p>
      </li>
      <li class="list">The pivot pane gives you<a id="_idIndexMarker1285"/> options for transforming rows into columns or columns into rows. We'll keep the default option of <strong class="screen-text">Columns to Rows</strong>. Drag both the <code class="Code-In-Text--PACKT-">Origin</code> and <code class="Code-In-Text--PACKT-">Destination</code> fields into the <strong class="screen-text">Pivot1 Values</strong> area of the pane:
    <figure class="mediaobject"><img src="../Images/B16021_15_41.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.41: Pivot1 Names keeps values from the original column names, while Pivot1 Values contains the actual values from Origin and Destination</p>
	</li>
      <li class="list">As a shortcut, instead <a id="_idIndexMarker1286"/>of <em class="italics">steps 6</em> and <em class="italics">7</em>, you could have selected both the <code class="Code-In-Text--PACKT-">Origin</code> and <code class="Code-In-Text--PACKT-">Destination</code> fields in the <strong class="screen-text">Clean 4</strong> step, and selected <strong class="screen-text">Pivot Columns to Rows</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B16021_15_42.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.42: A shortcut for pivoting columns to rows</p>
    <p class="Bullet-Without-Bullet-Within-Bullet-End--PACKT-">Continue with the following steps:</p>
    <ol>
      <li class="list" value="9">Double-click the text<a id="_idIndexMarker1287"/> for <strong class="screen-text">Pivot1 Values</strong> and rename the field <code class="Code-In-Text--PACKT-">Airport Code</code>. This field will contain all the airport codes for both the origin and destination records.</li>
      <li class="list" value="10">Double-click the text for <strong class="screen-text">Pivot1 Names</strong> and rename the field <code class="Code-In-Text--PACKT-">Route Point</code>. This field will label each record as either an <strong class="screen-text">Origin</strong> or <strong class="screen-text">Destination</strong>.<p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">At this point, we have a dataset that contains a single record for each endpoint of the trip (either an origin or destination).</p>
        <div class="packt_tip">
          <p>Notice that the pivot resulted in duplicate data. What was once one row (origin and destination together) is now two rows. The record count has doubled, so we can no longer count the number of records to determine the number of trips. We also cannot <code class="Code-In-Text--PACKT-">SUM</code> the cost of a ticket as it will double count the ticket. We'll need to use <code class="Code-In-Text--PACKT-">MIN</code>/<code class="Code-In-Text--PACKT-">MAX</code>/<code class="Code-In-Text--PACKT-">AVG</code> or some kind of level of detail expression or filter to look at only origins or destinations. While many transformations allow us to accomplish certain goals, we have to be aware that they may introduce other complications.</p>
        </div>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">The only location information we currently have in our main flow is the airport code. However, we already made a connection to <code class="Code-In-Text--PACKT-">Airports.hyper</code> and renamed the input step as <strong class="screen-text">Airport</strong> <strong class="screen-text">Codes</strong>.</p>
      </li>
      <li class="list">Locate the <strong class="screen-text">Airport Codes</strong> input step and drag it over the <strong class="screen-text">Pivot</strong> step. Drop it onto the <strong class="screen-text">Join</strong> area:
    <figure class="mediaobject"><img src="../Images/B16021_15_43.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.43: Dragging Airport Codes to the Join area of the Pivot step</p>
    <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">After <a id="_idIndexMarker1288"/>dropping the <strong class="screen-text">Airport Codes</strong> input step onto the <strong class="screen-text">Join</strong> area, a new join step will be created, named <strong class="screen-text">Join 1</strong>. Take a moment to examine the join pane:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_44.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.44: The join pane gives a lot of information and options for configuring the join and understanding the results. Important sections of the interface are numbered with descriptions below</p>
	</li>
    </ol>
    <p class="normal">You'll notice the<a id="_idIndexMarker1289"/> following features in <em class="italics">Figure 15.44</em>:</p>
    <ol>
      <li class="list" value="1"><strong class="screen-text">Applied Join Clauses</strong>: Here, you have the option to add conditions to the join clause, deciding which fields should be used as keys to define the join. You may add as many clauses as you need.</li>
      <li class="list"><strong class="screen-text">Join Type</strong>: Here, you may define the type of join (inner, left, left inner, right, right inner, outer). Accomplish this by clicking sections of the Venn diagram.</li>
      <li class="list"><strong class="screen-text">Summary of Join Results</strong>: The bar chart here indicates how many records come from each input of the flow and how many matched or did not match. You may click a bar segment to see filtered results in the data grid.</li>
      <li class="list"><strong class="screen-text">Join Clause Recommendations</strong>: If applicable, Tableau Prep will display probable join clauses that you can add with a single click.</li>
    
      <li class="list" value="5"><strong class="screen-text">Join Clauses</strong>: Here, Tableau Prep displays the fields used in the join clauses and the corresponding values. Any unmatched values will have a red font color. You may edit values by double-clicking them. This enables you to fix individual mismatched values as needed.</li>
    </ol>
    <p class="normal">We do not need to configure anything in this example. The default of an <strong class="screen-text">Inner</strong> join on the <code class="Code-In-Text--PACKT-">Airport Code</code> fields works well. We can confirm that all <code class="Code-In-Text--PACKT-">9,158</code> records from the <strong class="screen-text">Pivot</strong> step are kept. Only <code class="Code-In-Text--PACKT-">32</code> records from the <strong class="screen-text">Airport Codes</strong> hyper file are actual matches (<code class="Code-In-Text--PACKT-">1,301</code> records didn't match). That is not concerning. It just means we had a lot of extra codes that could have possibly supplemented our data but weren't actually needed. Now, continuing from our previous example:</p>
    <ol><li class="list" value="12">From <strong class="screen-text">Join 1</strong>, add a final output step and configure it to output to a <code class="Code-In-Text--PACKT-">.csv</code> file named <code class="Code-In-Text--PACKT-">Airline Travel.csv</code>.</li>
</ol>
    <ol><li class="list" value="13">Run the flow by <a id="_idIndexMarker1290"/>using the run button at the top of the toolbar or by clicking the run button on the output step.</li>
</ol>
    <figure class="mediaobject"><img src="../Images/B16021_15_45.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.45: The toolbar allows you to run the flow for all outputs or a single output, while the button on the output step will run the flow only for that output</p>
    <p class="normal">Your final flow will look something like this:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_46.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.46: Your final flow will resemble this, but may be slightly different in appearance</p>
    <p class="normal">The <code class="Code-In-Text--PACKT-">Chapter 15 Complete (clean).tfl</code> file is a bit cleaned up with appropriate step labels and descriptions. As a good practice, try to rename your steps and include descriptions so that your flow is easier to understand. Here is how the cleaned version looks:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_47.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.47: This flow is cleaned up and contains "self-documentation"</p>
    <p class="normal">Once the flow has been <a id="_idIndexMarker1291"/>executed, open the <code class="Code-In-Text--PACKT-">Airline Travel.twb</code> workbook in the <code class="Code-In-Text--PACKT-">\Learning Tableau\Chapter 15</code> directory to see how the data might be used and to explore it on your own:</p>
    <figure class="mediaobject"><img src="../Images/B16021_15_48.png" alt=""/></figure>
    <p class="packt_figref">Figure 15.48: Exploring the data in the Airline Travel.twb workbook</p>
    <div class="packt_tip">
      <p>Unlike <code class="Code-In-Text--PACKT-">.tde</code> or <code class="Code-In-Text--PACKT-">.hyper</code> files, <code class="Code-In-Text--PACKT-">.csv</code> files may be written to, even if they are open as a data source in Tableau Desktop. You will receive an error if you run a flow that attempts to overwrite a <code class="Code-In-Text--PACKT-">.tde</code> or <code class="Code-In-Text--PACKT-">.hyper</code> file that is in use. Additionally, you may rearrange the field order for a <code class="Code-In-Text--PACKT-">.csv</code> file by dragging and dropping fields into the profile pane of a clean step prior to the output.</p>
    </div>
    <p class="normal">With our example concluded, let's wrap up by considering some options for automating Tableau Prep flows.</p>
    <h1 id="_idParaDest-288" class="title">Options for automating flows</h1>
    <p class="normal">Tableau Prep Builder <a id="_idIndexMarker1292"/>allows you to design and run flows using the application. Sometimes, data cleansing and prepping will be a one-time operation to support an ad hoc analysis. However, you will often want to run a flow subsequently to capture new or changed data and to cleanse and shape it according to the same pattern. In these cases, you'll want to consider some options for automating the flow:</p>
    <ul>
      <li class="list"><strong class="bold">Tableau Prep Builder</strong> may be <a id="_idIndexMarker1293"/>run via a command line. You may supply JSON files to define credentials for input or output data connections. This enables you to use scripting and scheduling utilities to run the flow without manually opening and running the Tableau Prep interface. Details on this option are available from Tableau Help: <a href="https://onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line"><span class="url">https://onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line</span></a>.</li>
      <li class="list"><strong class="bold">Tableau Prep Conductor</strong>, an <a id="_idIndexMarker1294"/>add-on to Tableau Server, gives you the ability to publish entire flows from Tableau Prep Builder to Tableau Server and then either run them on demand or on a custom schedule. It also provides monitoring and troubleshooting capabilities.</li>
    </ul>
    <h1 id="_idParaDest-289" class="title">Summary</h1>
    <p class="normal">Tableau Prep's innovative paradigm of hands-on data cleansing and shaping with instant feedback greatly extends the Tableau platform and gives you incredible control over your data. In this chapter, we considered the overall interface and how it allows you to iteratively and rapidly build out a logical flow to clean and shape data for the desired analysis or visualization.</p>
    <p class="normal">Through a detailed, yet practical, example that was woven throughout this chapter, we explored every major transformation in Tableau Prep, from inputs to unions, joins, aggregates and pivots, to outputs. Along the way, we also examined other transformations and capabilities, including calculations, splits, merges, and the grouping of values. This gives you a foundation for molding and shaping data in any way you need.</p>
    <p class="normal">In the next chapter, we'll conclude with some final thoughts on how you can leverage Tableau's platform to share your analysis and data stories!</p>
  </div>
</body></html>