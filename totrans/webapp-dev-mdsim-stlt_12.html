<html><head></head><body>
<div id="_idContainer263">
<h1 class="chapter-number" id="_idParaDest-128"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.1.1">12</span></h1>
<h1 id="_idParaDest-129"><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.2.1">Smart File Uploading – Advanced Techniques for Professional Web Applications</span></h1>
<p><span class="koboSpan" id="kobo.3.1">At this point of our journey, we have almost acquired all the skills we need to implement and deploy well-working and nice-looking web applications. </span><span class="koboSpan" id="kobo.3.2">Anyway, our web apps still have a quite “naive” aspect and are a little bit far from professional ones. </span><span class="koboSpan" id="kobo.3.3">Starting with this chapter, we will deal with some advanced techniques that will help make our products look more complete </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">and professional.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">Let’s start with the file uploader, a widget that we already used in the </span><em class="italic"><span class="koboSpan" id="kobo.6.1">Covid-19 Detection Tool</span></em><span class="koboSpan" id="kobo.7.1"> app when we were asked to upload an X-ray image of </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">the chest.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">What we want to do now is move the file uploader to another level, deeply customizing it to automatically detect the type of file we are going to open and adopt the appropriate actions. </span><span class="koboSpan" id="kobo.9.2">This kind of behavior gives our web applications a very professional standing and makes them easy </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">to use.</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.13.1">Understanding the customized features of the </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">file uploader</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Creating a suitable file uploader for </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">web apps</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Simplifying web apps with </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">smart components</span></span></li>
</ul>
<h1 id="_idParaDest-130"><a id="_idTextAnchor130"/><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<ul>
<li><span class="koboSpan" id="kobo.20.1">In this chapter, we’ll use the following libraries, packages, </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">and tools:</span></span><ul><li><span class="No-Break"><span class="koboSpan" id="kobo.22.1">Sublime Text</span></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.23.1">Python 3</span></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.24.1">pipenv</span></strong></span></li><li><span class="No-Break"><span class="koboSpan" id="kobo.25.1">Streamlit</span></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.26.1">docx2txt</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.27.1">pdfplumber</span></strong></span></li></ul></li>
<li><span class="koboSpan" id="kobo.28.1">The code for this chapter can be found in this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">repository: </span></span><a href="https://github.com/PacktPublishing/Web-App-Development-Made-Simple-with-Streamlit/tree/57674ee5b5c58769120051cfb466f4b4d658c20c/Chapter12"><span class="No-Break"><span class="koboSpan" id="kobo.30.1">https://github.com/PacktPublishing/Web-App-Development-Made-Simple-with-Streamlit/tree/57674ee5b5c58769120051cfb466f4b4d658c20c/Chapter12</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.31.1">.</span></span></li>
</ul>
<h1 id="_idParaDest-131"><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.32.1">Understanding the customized features of the file uploader</span></h1>
<p><span class="koboSpan" id="kobo.33.1">Uploading a file is a simple task. </span><span class="koboSpan" id="kobo.33.2">There are several ways to do it, and these different approaches have </span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.34.1">different effects on the so-called </span><em class="italic"><span class="koboSpan" id="kobo.35.1">user experience</span></em><span class="koboSpan" id="kobo.36.1">: the way users </span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.37.1">perceive the application itself. </span><span class="koboSpan" id="kobo.37.2">Moreover, a better-implemented uploading feature can speed up the entire application, making things easier for the users. </span><span class="koboSpan" id="kobo.37.3">Let’s imagine that we want to upload a file containing text. </span><span class="koboSpan" id="kobo.37.4">It could be a </span><strong class="source-inline"><span class="koboSpan" id="kobo.38.1">.txt</span></strong><span class="koboSpan" id="kobo.39.1"> file, so a plain text file, but also a </span><strong class="source-inline"><span class="koboSpan" id="kobo.40.1">.docx</span></strong><span class="koboSpan" id="kobo.41.1"> file, a Microsoft Word file, or even a </span><strong class="source-inline"><span class="koboSpan" id="kobo.42.1">.pdf</span></strong><span class="koboSpan" id="kobo.43.1"> file. </span><span class="koboSpan" id="kobo.43.2">One approach is to ask the customer, </span><em class="italic"><span class="koboSpan" id="kobo.44.1">what kind of file do you need to upload (.txtx, .docx, .pdf)?</span></em><span class="koboSpan" id="kobo.45.1"> If the user replies </span><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">.txt</span></strong><span class="koboSpan" id="kobo.47.1">, the application will launch the </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1">file_uploader</span></strong><span class="koboSpan" id="kobo.49.1"> widget customized for this file format; if the answer is </span><strong class="source-inline"><span class="koboSpan" id="kobo.50.1">.docx</span></strong><span class="koboSpan" id="kobo.51.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.52.1">file_uploader</span></strong><span class="koboSpan" id="kobo.53.1"> widget customized for Microsoft Word will be executed, and so on. </span><span class="koboSpan" id="kobo.53.2">This kind of approach works perfectly, but it’s a little bit </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">too complex.</span></span></p>
<p><span class="koboSpan" id="kobo.55.1">What if the user updated a file and the web application recognized its type automatically without </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">human intervention?</span></span></p>
<p><span class="koboSpan" id="kobo.57.1">Let’s learn how to implement this feature according to both approaches, one requiring information from the user and another that’s </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">completely automated.</span></span></p>
<h2 id="_idParaDest-132"><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.59.1">Creating a new virtual environment</span></h2>
<p><span class="koboSpan" id="kobo.60.1">First, we’ll create </span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.61.1">a new virtual environment dedicated to this chapter. </span><span class="koboSpan" id="kobo.61.2">So, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.63.1">Create a new folder and call </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">it </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.65.1">FileUploader</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.67.1">Next, move to the newly created folder and, once inside it, as usual, write </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">pipenv shell</span></strong><span class="koboSpan" id="kobo.69.1"> to create the </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">virtual environment.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.71.1">The instructions are shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.72.1">Figure 12</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.73.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer249">
<span class="koboSpan" id="kobo.75.1"><img alt="Figure 12.1: Creating a new virtual environment dedicated to this chapter" src="image/B21147_12_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.76.1">Figure 12.1: Creating a new virtual environment dedicated to this chapter</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.77.1">After that, the only library we need is Streamlit, so let’s type </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">the following:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.79.1">pipenv install streamlit</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.80.1">After a </span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.81.1">few seconds, our environment will be equipped with the latest Streamlit version </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">that’s available.</span></span></p></li> <li><span class="koboSpan" id="kobo.83.1">As usual, before we start coding, we have to create an empty Python file, which is a very easy operation. </span><span class="koboSpan" id="kobo.83.2">We can do this by writing the </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">following instruction:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.85.1">touch app.py</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.86.1">Here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1">app.py</span></strong><span class="koboSpan" id="kobo.88.1"> is the name of </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">our file.</span></span></p>
<p><span class="koboSpan" id="kobo.90.1">We can open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">app.py</span></strong><span class="koboSpan" id="kobo.92.1"> file with our favorite IDE, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">Sublime Text.</span></span></p>
<h2 id="_idParaDest-133"><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.94.1">Building the app skeleton</span></h2>
<p><span class="koboSpan" id="kobo.95.1">When we </span><a id="_idIndexMarker395"/><span class="koboSpan" id="kobo.96.1">have an empty file, the best starting option is to always use the </span><em class="italic"><span class="koboSpan" id="kobo.97.1">skeleton</span></em><span class="koboSpan" id="kobo.98.1"> we adopted in the two web applications we implemented previously. </span><span class="koboSpan" id="kobo.98.2">So, we can import the libraries – in this case, just streamlit – and then define a main function containing the menu. </span><span class="koboSpan" id="kobo.98.3">The menu for this chapter’s app is quite light in that it just contains two voices: </span><strong class="bold"><span class="koboSpan" id="kobo.99.1">Dropfiles</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.100.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.101.1">About</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.103.1">In the following figure, we can see how short the skeleton we are using for this specific </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">case is:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer250">
<span class="koboSpan" id="kobo.105.1"><img alt="Figure 12.2: The skeleton of our app" src="image/B21147_12_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.106.1">Figure 12.2: The skeleton of our app</span></p>
<p><span class="koboSpan" id="kobo.107.1">Here’s a </span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.108.1">breakdown of the code shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.109.1">Figure 12</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.110.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.112.1">On </span><em class="italic"><span class="koboSpan" id="kobo.113.1">line 1</span></em><span class="koboSpan" id="kobo.114.1">, we import the library (here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">streamlit</span></strong><span class="koboSpan" id="kobo.116.1">), while on </span><em class="italic"><span class="koboSpan" id="kobo.117.1">line 4</span></em><span class="koboSpan" id="kobo.118.1">, we define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">main</span></strong><span class="koboSpan" id="kobo.120.1"> function – that is, the function containing the business logic of </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">our app.</span></span></li>
<li><span class="koboSpan" id="kobo.122.1">On </span><em class="italic"><span class="koboSpan" id="kobo.123.1">line 5</span></em><span class="koboSpan" id="kobo.124.1">, we have a list named </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">menu</span></strong><span class="koboSpan" id="kobo.126.1"> containing the values of the web application menu (the functions this web application </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">can offer).</span></span></li>
<li><span class="koboSpan" id="kobo.128.1">On </span><em class="italic"><span class="koboSpan" id="kobo.129.1">line 6</span></em><span class="koboSpan" id="kobo.130.1">, we create a select box starting from the menu list in </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">the sidebar.</span></span></li>
<li><span class="koboSpan" id="kobo.132.1">On </span><em class="italic"><span class="koboSpan" id="kobo.133.1">lines 8</span></em><span class="koboSpan" id="kobo.134.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.135.1">13</span></em><span class="koboSpan" id="kobo.136.1">, we add an </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">if</span></strong><span class="koboSpan" id="kobo.138.1"> clause that enters the proper code to execute according to the selection that was performed in the selectbox on </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.139.1">line 6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.141.1">With that, we have the skeleton of our app. </span><span class="koboSpan" id="kobo.141.2">Now, we can write the following instruction in </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">the terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.143.1">
pipenv run streamlit run app.py</span></pre> <p><span class="koboSpan" id="kobo.144.1">At this point, we can start the web application and see it in </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">our browser:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer251">
<span class="koboSpan" id="kobo.146.1"><img alt="Figure 12.3: First execution of our new web app" src="image/B21147_12_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.147.1">Figure 12.3: First execution of our new web app</span></p>
<p><span class="koboSpan" id="kobo.148.1">As we </span><a id="_idIndexMarker397"/><span class="koboSpan" id="kobo.149.1">can see, in the sidebar, there is a selectbox offering the two options in </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">the menu.</span></span></p>
<p><span class="koboSpan" id="kobo.151.1">Let’s focus on the </span><strong class="bold"><span class="koboSpan" id="kobo.152.1">Dropfile</span></strong><span class="koboSpan" id="kobo.153.1"> voice of </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">the menu.</span></span></p>
<h2 id="_idParaDest-134"><a id="_idTextAnchor134"/><span class="koboSpan" id="kobo.155.1">Creating a radio button for the app menu</span></h2>
<p><span class="koboSpan" id="kobo.156.1">We can </span><a id="_idIndexMarker398"/><span class="koboSpan" id="kobo.157.1">use a radio button to let the user indicate what kind of file they would like to upload. </span><span class="koboSpan" id="kobo.157.2">Let’s add the </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.159.1">
file_selection = st.radio("Select the file type", ['TXT', 'DOCX', 'PDF'])</span></pre> <p><span class="koboSpan" id="kobo.160.1">In this way, the file selection is stored in a variable named </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">file_selection</span></strong><span class="koboSpan" id="kobo.162.1">. </span><span class="koboSpan" id="kobo.162.2">So far, our app looks </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer252">
<span class="koboSpan" id="kobo.164.1"><img alt="Figure 12.4: Selecting the file type with radio buttons" src="image/B21147_12_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.165.1">Figure 12.4: Selecting the file type with radio buttons</span></p>
<p><span class="koboSpan" id="kobo.166.1">Once the </span><a id="_idIndexMarker399"/><span class="koboSpan" id="kobo.167.1">user selects an option, we are ready to open </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">file_uploader</span></strong><span class="koboSpan" id="kobo.169.1"> using the file type as the selected option. </span><span class="koboSpan" id="kobo.169.2">The following code can be adopted in </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">this case:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.171.1">
raw_text_file = st.file_uploader("Upload File", type=['txt'])
if raw_text_file is not None:
try:
raw_text = str(raw_text_file.read(),"utf-8")
st.info("Text from TXT file")
st.write(raw_text)
except:
st.warning("TXT File Fetching Problem...")</span></pre> <p><span class="koboSpan" id="kobo.172.1">Quite easily, after uploading the file (with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">txt</span></strong><span class="koboSpan" id="kobo.174.1"> type), we can check that the file is not null, read it using </span><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">utf-8</span></strong><span class="koboSpan" id="kobo.176.1"> encoding, and visualize it on the screen. </span><span class="koboSpan" id="kobo.176.2">If the uploaded file is null, we just print a warning on the screen stating </span><strong class="bold"><span class="koboSpan" id="kobo.177.1">TXT File </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.178.1">Fetching Problem...</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">.</span></span></p>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.180.1">Figure 12</span></em></span><em class="italic"><span class="koboSpan" id="kobo.181.1">.5</span></em><span class="koboSpan" id="kobo.182.1"> shows the code in </span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">the IDE:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer253">
<span class="koboSpan" id="kobo.184.1"><img alt="Figure 12.5: Uploading a .txt file" src="image/B21147_12_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.185.1">Figure 12.5: Uploading a .txt file</span></p>
<p><span class="koboSpan" id="kobo.186.1">When we </span><a id="_idIndexMarker400"/><span class="koboSpan" id="kobo.187.1">move to the browser, something interesting happens. </span><span class="koboSpan" id="kobo.187.2">Even if we have three different files containing text in our directory – that is, </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">'txt'</span></strong><span class="koboSpan" id="kobo.189.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">'docx'</span></strong><span class="koboSpan" id="kobo.191.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">'pdf'</span></strong><span class="koboSpan" id="kobo.193.1"> – since we specify </span><strong class="source-inline"><span class="koboSpan" id="kobo.194.1">txt</span></strong><span class="koboSpan" id="kobo.195.1"> as the type, the file uploader just sees and can open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">txt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.198.1"> file:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer254">
<span class="koboSpan" id="kobo.199.1"><img alt="Figure 12.6: In the directory on the left, there are three different files, but we can only open the .txt file" src="image/B21147_12_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.200.1">Figure 12.6: In the directory on the left, there are three different files, but we can only open the .txt file</span></p>
<p><span class="koboSpan" id="kobo.201.1">At this point, to manage other file types, we should write more or less the same code we used for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">txt</span></strong><span class="koboSpan" id="kobo.203.1"> type but also specify the different types. </span><span class="koboSpan" id="kobo.203.2">So, the code can evolve into something </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer255">
<span class="koboSpan" id="kobo.205.1"><img alt="Figure 12.7: Asking the user for the type of file" src="image/B21147_12_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.206.1">Figure 12.7: Asking the user for the type of file</span></p>
<p><span class="koboSpan" id="kobo.207.1">The code in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.208.1">Figure 12</span></em></span><em class="italic"><span class="koboSpan" id="kobo.209.1">.7</span></em><span class="koboSpan" id="kobo.210.1"> contains a couple of </span><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">pass</span></strong><span class="koboSpan" id="kobo.212.1"> calls for </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">.docx</span></strong><span class="koboSpan" id="kobo.214.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">.pdf</span></strong><span class="koboSpan" id="kobo.216.1"> files. </span><span class="koboSpan" id="kobo.216.2">If you want to complete the related functions, you must import the proper library and read the content of </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">the files.</span></span></p>
<p><span class="koboSpan" id="kobo.218.1">The real </span><a id="_idIndexMarker401"/><span class="koboSpan" id="kobo.219.1">point here is that when approaching file uploading in this way, even if the code works very well technically, we are forced to do a couple of operations we don’t like </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">that much:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.221.1">Asking the user about the type of file at </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">the beginning</span></span></li>
<li><span class="koboSpan" id="kobo.223.1">Repeating (we just copy and paste) a lot of code that </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">is redundant</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.225.1">Now that we’ve explored this solution, let’s try to implement something much more elegant and cleaner that can automatically read the type of file, without asking </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">the user.</span></span></p>
<h1 id="_idParaDest-135"><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.227.1">Creating a suitable file uploader for web apps</span></h1>
<p><span class="koboSpan" id="kobo.228.1">As you can imagine, this time, we are not using the radio button. </span><span class="koboSpan" id="kobo.228.2">Instead, we are directly uploading the files. </span><span class="koboSpan" id="kobo.228.3">So, referring to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.229.1">Figure 12</span></em></span><em class="italic"><span class="koboSpan" id="kobo.230.1">.7</span></em><span class="koboSpan" id="kobo.231.1">, let’s comment all the code between </span><em class="italic"><span class="koboSpan" id="kobo.232.1">lines 11</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.233.1">and </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.234.1">31</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.236.1">Immediately </span><a id="_idIndexMarker402"/><span class="koboSpan" id="kobo.237.1">in the subheading, on </span><em class="italic"><span class="koboSpan" id="kobo.238.1">line 10</span></em><span class="koboSpan" id="kobo.239.1">, we can add </span><strong class="source-inline"><span class="koboSpan" id="kobo.240.1">file_uploader</span></strong><span class="koboSpan" id="kobo.241.1">, this time including all </span><span class="No-Break"><span class="koboSpan" id="kobo.242.1">three types:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.243.1">
raw_text_file = st.file_uploader('Upload File', type=['txt', 'docx', 'pdf'])</span></pre> <p><span class="koboSpan" id="kobo.244.1">When we </span><a id="_idIndexMarker403"/><span class="koboSpan" id="kobo.245.1">try to upload the file from the browser, this time in our directory, we will see all three types of files and be able to select one </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">of them.</span></span></p>
<p><span class="koboSpan" id="kobo.247.1">As we did on </span><em class="italic"><span class="koboSpan" id="kobo.248.1">line 15</span></em><span class="koboSpan" id="kobo.249.1"> in the code presented in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.250.1">Figure 12</span></em></span><em class="italic"><span class="koboSpan" id="kobo.251.1">.5</span></em><span class="koboSpan" id="kobo.252.1">, we can check that the file is not null by writing </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.254.1">
if raw_text_file is not None:</span></pre> <p><span class="koboSpan" id="kobo.255.1">After this </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">if</span></strong><span class="koboSpan" id="kobo.257.1"> clause, we must get the details of the file. </span><span class="koboSpan" id="kobo.257.2">We need these details to understand which type of file we selected and how to manage it. </span><span class="koboSpan" id="kobo.257.3">By using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">raw_file_text</span></strong><span class="koboSpan" id="kobo.259.1"> variable, which contains the file we uploaded, we can use three methods named </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">name</span></strong><span class="koboSpan" id="kobo.261.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">type</span></strong><span class="koboSpan" id="kobo.263.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">size</span></strong><span class="koboSpan" id="kobo.265.1"> to collect the details </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">we need.</span></span></p>
<p><span class="koboSpan" id="kobo.267.1">These details will be put into a dictionary; we are calling it </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">file_details</span></strong><span class="koboSpan" id="kobo.269.1">. </span><span class="koboSpan" id="kobo.269.2">Let’s see it in </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">the code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer256">
<span class="koboSpan" id="kobo.271.1"><img alt="Figure 12.8: The code for file upload and file detail detection" src="image/B21147_12_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.272.1">Figure 12.8: The code for file upload and file detail detection</span></p>
<p><span class="koboSpan" id="kobo.273.1">This is the result in </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">the browser:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer257">
<span class="koboSpan" id="kobo.275.1"><img alt="Figure 12.9: File upload and file detail detection in the browser" src="image/B21147_12_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.276.1">Figure 12.9: File upload and file detail detection in the browser</span></p>
<p><span class="koboSpan" id="kobo.277.1">As we can see, in the directory, we have all three types of files and can select any one of them since </span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.278.1">the information about the file details has been intercepted correctly. </span><span class="koboSpan" id="kobo.278.2">In the case of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">.txt</span></strong><span class="koboSpan" id="kobo.280.1"> file, we got the correct filename, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">text/plain</span></strong><span class="koboSpan" id="kobo.282.1"> type, and </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">its size.</span></span></p>
<p><span class="koboSpan" id="kobo.284.1">Let’s see </span><a id="_idIndexMarker405"/><span class="koboSpan" id="kobo.285.1">what type we get for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">.docx</span></strong><span class="koboSpan" id="kobo.287.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">.pdf</span></strong><span class="koboSpan" id="kobo.289.1"> files. </span><span class="koboSpan" id="kobo.289.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">.docx</span></strong><span class="koboSpan" id="kobo.291.1"> file, as shown here, has a very long </span><span class="No-Break"><span class="koboSpan" id="kobo.292.1">type file:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer258">
<span class="koboSpan" id="kobo.293.1"><img alt="Figure 12.10: The .docx file" src="image/B21147_12_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.294.1">Figure 12.10: The .docx file</span></p>
<p><span class="koboSpan" id="kobo.295.1">Meanwhile, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">.pdf</span></strong><span class="koboSpan" id="kobo.297.1"> file has a </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">shorter name:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer259">
<span class="koboSpan" id="kobo.299.1"><img alt="Figure 12.11: The .pdf ﻿file" src="image/B21147_12_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.300.1">Figure 12.11: The .pdf file</span></p>
<p><span class="koboSpan" id="kobo.301.1">These three </span><a id="_idIndexMarker406"/><span class="koboSpan" id="kobo.302.1">different types of files are all we need to </span><a id="_idIndexMarker407"/><span class="koboSpan" id="kobo.303.1">manage file uploading automatically. </span><span class="koboSpan" id="kobo.303.2">To open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">.pdf</span></strong><span class="koboSpan" id="kobo.305.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">.docx</span></strong><span class="koboSpan" id="kobo.307.1"> files, we need to install the proper libraries (</span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">pdfplumber</span></strong><span class="koboSpan" id="kobo.309.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">docx2txt</span></strong><span class="koboSpan" id="kobo.311.1">). </span><span class="koboSpan" id="kobo.311.2">So, please write the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">your terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.313.1">
pipenv install pdfplumber docx2txt</span></pre> <p><span class="koboSpan" id="kobo.314.1">The first package takes care of </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">.pdf</span></strong><span class="koboSpan" id="kobo.316.1"> files, while the second takes care of </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.318.1">docx</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.319.1"> files.</span></span></p>
<p><span class="koboSpan" id="kobo.320.1">Once the installation is finished, we must import these libraries into our </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">app.py</span></strong><span class="koboSpan" id="kobo.322.1"> file by typing </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.324.1">
import docx2txt
import pdfplumber</span></pre> <p><span class="koboSpan" id="kobo.325.1">With that, we have everything we need. </span><span class="koboSpan" id="kobo.325.2">So, referring to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.326.1">Figure 12</span></em></span><em class="italic"><span class="koboSpan" id="kobo.327.1">.8</span></em><span class="koboSpan" id="kobo.328.1">, continuing from </span><em class="italic"><span class="koboSpan" id="kobo.329.1">line 15</span></em><span class="koboSpan" id="kobo.330.1"> of our code, we can write </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.332.1">
if raw_text_file.type == "text/plain":
try:
      raw_text = str(raw_text_file.read(), "utf-8")
st.info("Text from TXT file")
except:
st.write("TXT File Fetching Problem...")</span></pre> <p><span class="koboSpan" id="kobo.333.1">The preceding </span><a id="_idIndexMarker408"/><span class="koboSpan" id="kobo.334.1">code checks that the type of file we </span><a id="_idIndexMarker409"/><span class="koboSpan" id="kobo.335.1">uploaded is </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">text/plain</span></strong><span class="koboSpan" id="kobo.337.1">. </span><span class="koboSpan" id="kobo.337.2">In this case, it reads it, stores its content in a variable named </span><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">raw_text</span></strong><span class="koboSpan" id="kobo.339.1">, and prints a label on the screen saying just </span><strong class="bold"><span class="koboSpan" id="kobo.340.1">Text from TXT file</span></strong><span class="koboSpan" id="kobo.341.1">. </span><span class="koboSpan" id="kobo.341.2">This check happens in a try cycle; so, in case of an error, a simple exception will be printed on </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">the screen.</span></span></p>
<p><span class="koboSpan" id="kobo.343.1">The same code we used for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.344.1">.txt</span></strong><span class="koboSpan" id="kobo.345.1"> file has to be used for the other kind of files; the only differences are the type of the files and the libraries needed to read the content of the files (the two libraries we just imported – that is, </span><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">pdfplumber</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.347.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.348.1">docx2txt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.350.1">Let’s look at the code shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.351.1">Figure 12</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.352.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer260">
<span class="koboSpan" id="kobo.354.1"><img alt="Figure 12.12: The code that automatically uploads the files" src="image/B21147_12_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.355.1">Figure 12.12: The code that automatically uploads the files</span></p>
<p><span class="koboSpan" id="kobo.356.1">On </span><em class="italic"><span class="koboSpan" id="kobo.357.1">line 27</span></em><span class="koboSpan" id="kobo.358.1">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">pdfplumber</span></strong><span class="koboSpan" id="kobo.360.1"> because the file type is </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">"application/pdf"</span></strong><span class="koboSpan" id="kobo.362.1">, while on </span><em class="italic"><span class="koboSpan" id="kobo.363.1">line 35</span></em><span class="koboSpan" id="kobo.364.1">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">docx2txt</span></strong><span class="koboSpan" id="kobo.366.1"> because the file to open is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">docx</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.369.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.370.1">Finally, on </span><em class="italic"><span class="koboSpan" id="kobo.371.1">line 42</span></em><span class="koboSpan" id="kobo.372.1">, we automatically print the contents of the opened file on </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">the screen.</span></span></p>
<p><span class="koboSpan" id="kobo.374.1">This is the </span><a id="_idIndexMarker410"/><span class="koboSpan" id="kobo.375.1">result in the case of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">.docx</span></strong><span class="koboSpan" id="kobo.377.1"> file; please </span><a id="_idIndexMarker411"/><span class="koboSpan" id="kobo.378.1">note the very long name of the </span><span class="No-Break"><span class="koboSpan" id="kobo.379.1">file type:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer261">
<span class="koboSpan" id="kobo.380.1"><img alt="Figure 12.13: A .docx file is automatically recognized and opened" src="image/B21147_12_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.381.1">Figure 12.13: A .docx file is automatically recognized and opened</span></p>
<p><span class="koboSpan" id="kobo.382.1">The application behavior with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">.pdf</span></strong><span class="koboSpan" id="kobo.384.1"> file is </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">the same:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer262">
<span class="koboSpan" id="kobo.386.1"><img alt="Figure 12.14: A .pdf file is automatically recognized and opened" src="image/B21147_12_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.387.1">Figure 12.14: A .pdf file is automatically recognized and opened</span></p>
<p><span class="koboSpan" id="kobo.388.1">So far, we have </span><a id="_idIndexMarker412"/><span class="koboSpan" id="kobo.389.1">learned two ways of uploading </span><a id="_idIndexMarker413"/><span class="koboSpan" id="kobo.390.1">files: asking the user about the file type and making the file uploading process automated. </span><span class="koboSpan" id="kobo.390.2">Both approaches are valid, and which one you should choose depends on the use case. </span><span class="koboSpan" id="kobo.390.3">Simplifying our web apps with smart components should always be the </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">preferred solution.</span></span></p>
<h1 id="_idParaDest-136"><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.392.1">Simplifying web apps with smart components</span></h1>
<p><span class="koboSpan" id="kobo.393.1">So far in this chapter, we have learned about the principles of effective web application design. </span><span class="koboSpan" id="kobo.393.2">Now, we can move toward the user experience, which should always be simple, intuitive, and </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">aesthetically pleasing.</span></span></p>
<p><span class="koboSpan" id="kobo.395.1">The approach </span><a id="_idIndexMarker414"/><span class="koboSpan" id="kobo.396.1">with the radio button, from a functional point of view, works very well but makes things a little bit too complex because it requires the user’s intervention at the beginning and draws an ugly radio button on </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">the screen.</span></span></p>
<p><span class="koboSpan" id="kobo.398.1">The other approach is very neat and extremely clean because just a file uploader widget is present on the screen and the user can select the file by just clicking on it (or using drag and drop) without any other kind </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">of intervention.</span></span></p>
<p><span class="koboSpan" id="kobo.400.1">This is possible because the web app intercepts the file type property and uses it to open the file and read its content by selecting the </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">proper library.</span></span></p>
<p><span class="koboSpan" id="kobo.402.1">This kind of approach is quite smart and delineates the difference between an application made by a rookie and an application that looks </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">very professional.</span></span></p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.404.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.405.1">In this chapter, we learned how to manage file uploading in different ways and according to different approaches: first, by specifying the file type at any time to trigger the proper function, and second by making the file type detection automatic </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">and seamless.</span></span></p>
<p><span class="koboSpan" id="kobo.407.1">While the first approach involves the user, the second one makes our application usage </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">very smooth.</span></span></p>
<p><span class="koboSpan" id="kobo.409.1">In the next chapter, we will continue exploring advanced features and solutions to make our web applications </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">more professional.</span></span></p>
</div>
</body></html>