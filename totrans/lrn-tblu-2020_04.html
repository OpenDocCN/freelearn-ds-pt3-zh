<html><head></head><body>
  <div id="_idContainer209">
    <h1 class="chapterNumber">4</h1>
    <h1 id="_idParaDest-80" class="chapterTitle">Starting an Adventure with Calculations and Parameters</h1>
    <p class="normal">We have already seen what amazing discovery, analysis, and data storytelling is possible in Tableau by simply connecting to data and dragging and dropping fields. Now, we'll set off on an adventure with calculations.</p>
    <p class="normal">Calculations significantly extend the possibilities for analysis, design, and interactivity in Tableau. In this chapter, we'll see how calculations can be used in a wide variety of ways. We'll see how calculations can be used to address common issues with data, extend data by adding new dimensions and measures, and provide additional flexibility in interactivity.</p>
    <p class="normal">At the same time, while calculations provide incredible power and flexibility, they introduce a level of complexity and sophistication. As you work through this chapter, try to understand the key concepts behind how calculations work in Tableau. As usual, follow along with the examples, but feel free to explore and experiment. The goal is not to merely have a list of calculations you can copy, but to gain knowledge of how calculations can be used to solve problems and add creative functionality to your visualizations and dashboards.</p>
    <p class="normal">The first half of this chapter focuses on laying a foundation, while the second half provides quite a few practical examples. The topics we will study here are as follows:</p>
    <ul>
      <li class="list">Overview of the four main types of calculations</li>
      <li class="list">Creating and editing calculations</li>
      <li class="list">Row-level calculation examples</li>
      <li class="list">Aggregate calculation examples</li>
      <li class="list">Parameters</li>
      <li class="list">Practical examples</li>
      <li class="list">Performance considerations</li>
    </ul>
    <p class="normal">We'll start with an introduction to the types of calculations in Tableau and then delve into some examples.</p>
    <h1 id="_idParaDest-81" class="title">Introduction to calculations</h1>
    <p class="normal">A calculation<a id="_idIndexMarker319"/><a id="_idIndexMarker320"/> is often referred to<a id="_idIndexMarker321"/><a id="_idIndexMarker322"/> as a <strong class="bold">Calculated Field</strong> in Tableau because, in most cases, when you create a calculation, it will show up as either a new measure or dimension in the data pane. Calculations consist of code that's made up of functions, operations, and references to other fields, parameters, constants, groups, or sets. This code returns a value. Sometimes, this result is per row of data, and sometimes it is done at an aggregate level. We'll consider the difference between Tableau's major calculation types next.</p>
    <h2 id="_idParaDest-82" class="title">The four main types of calculations</h2>
    <p class="normal">The most fundamental way to understand calculations in Tableau is to think of four major types of calculations:</p>
    <ul>
      <li class="list"><strong class="bold">Row-level calculations</strong>: These calculations<a id="_idIndexMarker323"/><a id="_idIndexMarker324"/> are <a id="_idIndexMarker325"/><a id="_idIndexMarker326"/>performed for every row of underlying data.</li>
      <li class="list"><strong class="bold">Aggregate calculations</strong>: These<a id="_idIndexMarker327"/><a id="_idIndexMarker328"/> calculations are performed at an <a id="_idIndexMarker329"/><a id="_idIndexMarker330"/>aggregate level, which is usually defined by the dimensions used in the view.</li>
      <li class="list"><strong class="bold">Level of detail calculations</strong>: These special calculations<a id="_idIndexMarker331"/><a id="_idIndexMarker332"/> are aggregations that are performed at a specified level of detail, with the results available at the row level.</li>
      <li class="list"><strong class="bold">Table calculations</strong>: These calculations<a id="_idIndexMarker333"/><a id="_idIndexMarker334"/> are performed on the table of aggregate data that has been returned by the data source to Tableau.</li>
    </ul>
    <p class="normal">Understanding and recognizing the four main types of calculations will enable you to leverage the power and potential of calculations in Tableau.</p>
    <p class="normal">In this chapter, we'll take a close look at two of the four main types of calculations in Tableau: row-level and aggregate calculations. We'll consider the final two types in <em class="italics">Chapter 5</em>, <em class="italics">Leveraging Level of Detail Calculations</em>, and <em class="italics">Chapter 6</em>, <em class="italics">Diving Deep with Table Calculations</em>.</p>
    <div class="packt_tip">
      <p>As you think through using a calculation to solve a problem, always consider the type of calculation you might need. Look for tips throughout this chapter and the next two that will help you consider <em class="italics">why</em> a certain type of calculation was used.</p>
    </div>
    <p class="normal">Now we have examined the major calculation types in Tableau, we will see how they are created and edited.</p>
    <h2 id="_idParaDest-83" class="title">Creating and editing calculations</h2>
    <p class="normal">There are multiple ways to create a <a id="_idIndexMarker335"/><a id="_idIndexMarker336"/>calculated field in Tableau:</p>
    <ol>
      <li class="list">Select <strong class="screen-text">Analysis</strong> | <strong class="screen-text">Create Calculated Field...</strong> from the menu.</li>
      <li class="list">Use the drop-down menu next to <strong class="screen-text">Dimensions</strong> in the <strong class="screen-text">Data</strong> pane:<figure class="mediaobject"><img src="../Images/B16021_04_01.png" alt=""/></figure>
        <p class="packt_figref">Figure 4.1: The Create Calculated Fieldâ€¦ option</p>
      </li>
      <li class="list">Right-click an empty area in the <strong class="screen-text">Data</strong> pane and select <strong class="screen-text">Create Calculated Field...</strong>.</li>
      <li class="list">Use the drop-down menu on a field, set, or parameter in the data pane and select <strong class="screen-text">Create</strong> | <strong class="screen-text">Calculated Field...</strong>. The calculation will begin as a reference to the field you selected.</li>
      <li class="list">Double-click<a id="_idIndexMarker337"/><a id="_idIndexMarker338"/> an empty area on the <strong class="screen-text">Rows</strong>, <strong class="screen-text">Columns</strong>, or <strong class="screen-text">Measure Values</strong> shelves, or in the empty area on the <strong class="screen-text">Marks</strong> card to create an ad hoc calculation (though this will not show the full calculation editor).</li>
      <li class="list" value="6">When you create a calculated<a id="_idIndexMarker339"/><a id="_idIndexMarker340"/> field, it will be part of the data source that is currently selected at the time you create it. You can edit an existing calculated field in the data pane by using the drop-down menu and selecting <strong class="screen-text">Edit...</strong>.</li>
    </ol>
    <p class="normal">The interface for creating and editing calculations looks like this:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_02.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.2: The creating and editing calculations interface</p>
    <p class="normal">This window has several key features:</p>
    <ul>
      <li class="list"><strong class="bold">Calculated field name</strong>: Enter the name<a id="_idIndexMarker341"/><a id="_idIndexMarker342"/> of the calculated field here. Once created, the calculated field will show up as a field in the data pane with the name you entered in this text box.</li>
      <li class="list"><strong class="bold">Code editor</strong>: Enter code in this text area to perform the calculation. The editor includes autocomplete for recognized fields and functions. Additionally, you may drag and drop fields and text snippets to and from the code editor and the data pane and view.</li>
      <li class="list">An <strong class="bold">indicator</strong> at <a id="_idIndexMarker343"/><a id="_idIndexMarker344"/>the bottom of the editor will alert you to errors in your code. Additionally, if the calculation is used in views or other calculated fields, you will see a drop-down indicator that will let you see the dependencies. Click the <strong class="screen-text">Apply</strong> button to apply changes to the calculation throughout the workbook while leaving the calculation editor open. The <strong class="screen-text">OK</strong> button will save the code changes and close the editor. If you wish to discard any changes you've made, click the <strong class="screen-text">X</strong> button in the upper-right corner to cancel the changes.</li>
      <li class="list">The <strong class="bold">functions list</strong> contains all the functions that you can use in your code. Many of these functions will be used in examples or discussed in this chapter. Tableau groups various functions according to their overall use:<ul>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">Number</strong>: Mathematical functions, such as <a id="_idIndexMarker345"/><a id="_idIndexMarker346"/>rounding, absolute value, trig functions, square roots, and exponents.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">String</strong>: Functions that are useful for string<a id="_idIndexMarker347"/><a id="_idIndexMarker348"/> manipulation, such as getting a substring, finding a match within a string, replacing parts of a string, and converting a string value to uppercase or lowercase.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">Date</strong>: Functions that <a id="_idIndexMarker349"/><a id="_idIndexMarker350"/>are useful for working with dates, such as finding the difference between two dates, adding an interval to a date, getting the current date, and transforming strings with non-standard formats into dates.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">Type Conversion</strong>: Functions <a id="_idIndexMarker351"/><a id="_idIndexMarker352"/>that are useful for converting one type of field to another, such as converting strings into integers, integers into floating-point decimals, or strings into dates. We'll cover the major Tableau data types in the next section.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">Logical</strong>: Decision-making functions, such <a id="_idIndexMarker353"/><a id="_idIndexMarker354"/>as <code class="Code-In-Text--PACKT-">if</code> <code class="Code-In-Text--PACKT-">then</code> <code class="Code-In-Text--PACKT-">else</code> logic or <code class="Code-In-Text--PACKT-">case</code> statements.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">Aggregate</strong>: Functions that are used for aggregating such as summing, getting the minimum or maximum values, or calculating standard deviations or variances.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">Pass Through</strong> (only available when <a id="_idIndexMarker355"/><a id="_idIndexMarker356"/>connected live to certain databases, such as SQL Server): These functions allow you to pass through raw SQL code to the underlying database and retrieve a returned value at either a row level or aggregate level.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">User</strong>: Functions<a id="_idIndexMarker357"/><a id="_idIndexMarker358"/> that are used to obtain usernames and check whether the current user is a member of a group. These functions are often used in combination with logical functions to customize the user's experience or to implement user-based security when publishing to Tableau Server or Tableau Online.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="bold">Table calculation</strong>: These functions <a id="_idIndexMarker359"/><a id="_idIndexMarker360"/>are different from the others. They operate on the aggregated data <em class="italics">after</em> it is returned from the underlying data source and just prior to the rendering of the view. </li>
          <li class="Bullet-Within-Bullet-End--PACKT-"><strong class="bold">Spatial</strong>: These functions<a id="_idIndexMarker361"/><a id="_idIndexMarker362"/> allow you to perform calculations with spatial data.</li>
        </ul>
      </li>
      <li class="list">Selecting a<a id="_idIndexMarker363"/><a id="_idIndexMarker364"/> function in the list or clicking a field, parameter, or function in the code will reveal details about the selection on the right. This is helpful when nesting other calculated fields in your code, when you want to see the code for that particular calculated field, or when you want to understand the syntax for a function.</li>
    </ul>
    <p class="normal">With a good understanding of the interface, let's briefly look at some foundational concepts for calculations.</p>
    <h2 id="_idParaDest-84" class="title">Data types</h2>
    <p class="normal">Fundamental to the <a id="_idIndexMarker365"/><a id="_idIndexMarker366"/>concept of calculations are <strong class="bold">data types</strong>, which describe the kind of information stored by a field, parameter, or returned by a function. Tableau distinguishes six types of data:</p>
    <ul>
      <li class="list"><strong class="bold">Number (decimal)</strong>: These are numeric <a id="_idIndexMarker367"/><a id="_idIndexMarker368"/>values that include places after the decimal. Values such as <code class="Code-In-Text--PACKT-">0.02</code>,<code class="Code-In-Text--PACKT-"> 100.377</code>, or<code class="Code-In-Text--PACKT-"> 3.14159</code> are decimal values.</li>
      <li class="list"><strong class="bold">Number (whole)</strong>: These are integer or <a id="_idIndexMarker369"/><a id="_idIndexMarker370"/>whole numbers with no fractional values or places after the decimal. Values such as <code class="Code-In-Text--PACKT-">5</code>, <code class="Code-In-Text--PACKT-">157</code>, and <code class="Code-In-Text--PACKT-">1,455,982</code> are whole numbers.</li>
      <li class="list"><strong class="bold">Date and Time</strong>: These are <a id="_idIndexMarker371"/><a id="_idIndexMarker372"/>dates along with times. Values such as <code class="Code-In-Text--PACKT-">November 8</code>, <code class="Code-In-Text--PACKT-">1980 12:04:33 PM</code> are date and time types.</li>
      <li class="list"><strong class="bold">Date</strong>: These are dates without times. Values such as <code class="Code-In-Text--PACKT-">July 17, 1979</code> are date types.</li>
      <li class="list"><strong class="bold">String</strong>: These are a series of characters. A <a id="_idIndexMarker373"/><a id="_idIndexMarker374"/>string may consist of a mixture of alphabetic characters, numeric characters, symbols, or special characters. They may even be blank (empty). Values such as <code class="Code-In-Text--PACKT-">Hello World</code>, <code class="Code-In-Text--PACKT-">password123</code>, and<code class="Code-In-Text--PACKT-"> %$@*!</code> are all strings. In code, strings will be surrounded by single or double quotes.</li>
      <li class="list"><strong class="bold">Boolean</strong>: This is a true or <a id="_idIndexMarker375"/><a id="_idIndexMarker376"/>false value. The values <code class="Code-In-Text--PACKT-">TRUE</code>, <code class="Code-In-Text--PACKT-">FALSE</code>, and the expressions <code class="Code-In-Text--PACKT-">1=1</code> (which evaluates as true) and<code class="Code-In-Text--PACKT-"> 1=2</code> (which evaluates as false) are all Boolean types.</li>
      <li class="list"><strong class="bold">Spatial: </strong>A complex value that describes a location, line or shape as it relates to a spatial area.</li>
    </ul>
    <p class="normal">Every field in Tableau has one of these data types and every function in Tableau returns one of these data types. Some functions expect input that matches some of these types and you'll receive errors if you try to pass in the wrong type.</p>
    <p class="normal">Some types can be converted to other types. For example, using some of the type conversion functions mentioned above, you could convert the string <code class="Code-In-Text--PACKT-">"2.81"</code> to the decimal value <code class="Code-In-Text--PACKT-">2.81</code>. You could convert that decimal value to a whole number, but in that case, you'd lose the places after the decimal value and the whole number would simply be <code class="Code-In-Text--PACKT-">2</code>.</p>
    <p class="normal">A data type is different from the format displayed. For example, you may choose to format a decimal as a percentage (for example, <code class="Code-In-Text--PACKT-">0.2</code> could be shown as <code class="Code-In-Text--PACKT-">20%</code>), as currency (for example, <code class="Code-In-Text--PACKT-">144.56</code> could be formatted as <code class="Code-In-Text--PACKT-">$144.56</code>), or even as a number with 0 decimals (for example, <code class="Code-In-Text--PACKT-">2.81</code> would be rounded to <code class="Code-In-Text--PACKT-">3</code>).</p>
    <p class="normal">Pay attention to the data types of fields and functions as we continue.</p>
    <h2 id="_idParaDest-85" class="title">Additional functions and operators</h2>
    <p class="normal">Tableau supports numerous<a id="_idIndexMarker377"/><a id="_idIndexMarker378"/> functions and operators. In addition to the functions that are listed on the calculation screen, Tableau<a id="_idIndexMarker379"/><a id="_idIndexMarker380"/> supports the following operators, keywords, and syntax conventions:</p>
    <table id="table001" class="No-Table-Style _idGenTablePara-1">
      <colgroup>
        <col/>
        <col/>
      </colgroup>
      <tbody>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <strong class="heading">Operator / Keyword</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">Description</strong>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">AND</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Logical <em class="italics">and</em> between two Boolean (<code class="Code-In-Text--PACKT-">true/false</code>) values or statements</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">OR</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Logical <em class="italics">or</em> between two Boolean values or statements</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">NOT</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Logical <em class="italics">not</em> to negate a Boolean value or statement</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">= or ==</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Logical <em class="italics">equals to</em> to test the equality of two statements or values (single or double equal signs are equivalent in Tableau's syntax)</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">+</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Addition of numeric or date values or the concatenation of strings</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">-</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Subtraction of numeric or date values</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">*</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Multiplication of numeric values</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">/</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Division of numeric values</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">^</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Raise to a power with numeric values</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">( )</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Parentheses to define the order of operations or enclose function arguments</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">[ ]</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Square brackets to enclose field names</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">{ }</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Curly braces to enclose the level of detail calculations</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">//</p>
          </td>
          <td class="No-Table-Style">
            <p class="normal">Double slash to start a comment</p>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="note">
      <p class="Information-Box--PACKT-">Field names that are a single word may optionally be enclosed in brackets when used in calculations. Field names with spaces, special characters, or from secondary data sources must be enclosed in brackets.</p>
    </div>
    <p class="normal">You'll see these operators<a id="_idIndexMarker381"/><a id="_idIndexMarker382"/> and functions throughout the next few chapters, so familiarize yourself with their uses. Now, let's consider the data that will guide us through some practical examples.</p>
    <h2 id="_idParaDest-86" class="title">Example data</h2>
    <p class="normal">Before we get <a id="_idIndexMarker383"/><a id="_idIndexMarker384"/>started with some examples, let's consider a sample dataset that will be used for the examples in this chapter. It's simple and small, which means we will be able to easily see how the calculations are being done.</p>
    <p class="normal">This dataset is included as <code class="Code-In-Text--PACKT-">Vacation Rentals.csv</code> in the <code class="Code-In-Text--PACKT-">\Learning Tableau\Chapter 04</code> directory of this book's resources, and is also included in the <code class="Code-In-Text--PACKT-">Chapter 4</code> workbook as a data source named <code class="Code-In-Text--PACKT-">Vacation Rentals</code>:</p>
    <table id="table002" class="No-Table-Style _idGenTablePara-1">
      <colgroup>
        <col/>
        <col/>
        <col/>
        <col/>
        <col/>
        <col/>
        <col/>
        <col/>
      </colgroup>
      <tbody>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <strong class="heading">Rental Property</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">First</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">Last</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">Start</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">End</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">Discount</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">Rent</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">Tax per Night</strong>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">112-Asbury Atoll</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Mary</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Slessor</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 2</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 9</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">150</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1,500</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">15</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">112-Asbury Atoll</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Amy</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Carmichael</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 9</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 15</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">0</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1,500</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">15</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">155-Beach Breeze</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Charles</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Ryrie</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 2</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 9</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">260</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1,300</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">10</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">155-Beach Breeze</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dwight</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Pentecost</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 16</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 23</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">280</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1,400</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">10</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">207-Beach Breeze</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Lewis</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Chafer</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 9</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 23</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">280</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">2,800</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">10</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">207-Beach Breeze</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">John</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Walvoord</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 2</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 9</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">60</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1,500</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">10</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="normal">The dataset describes<a id="_idIndexMarker385"/><a id="_idIndexMarker386"/> several vacation rental properties, the renters, the start and end dates of the rental period, the discount, rent, and tax per night. We'll use it throughout the rest of the chapter as we see some examples of calculations. Let's start with row-level calculations.</p>
    <h1 id="_idParaDest-87" class="title">Row-level calculations</h1>
    <p class="normal">We'll walk through several examples of row-level calculations in this section. You'll find the completed calculations in the <code class="Code-In-Text--PACKT-">Complete</code> workbook, but you might prefer to start from scratch in the <code class="Code-In-Text--PACKT-">Starter</code> workbook. We won't necessarily cover creating a visualization for every example, but try building some of your own as you work through the examples.</p>
    <h2 id="_idParaDest-88" class="title">Simple example</h2>
    <p class="normal">We'll start with a very simple example and then build up in complexity. In the <code class="Code-In-Text--PACKT-">Chapter 04</code> workbook, create a new calculated field called <code class="Code-In-Text--PACKT-">Full Name</code> with the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">[<span class="hljs-keyword">First</span>] + <span class="hljs-string">" "</span> + [<span class="hljs-keyword">Last</span>] 
</code></pre>
    <p class="normal">This code concatenates the strings of <code class="Code-In-Text--PACKT-">First</code> and <code class="Code-In-Text--PACKT-">Last</code> with a space in-between them. Your calculation editor should look something like the following:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.3: Creating the Full Name calculation in the editor</p>
    <p class="normal">After clicking <strong class="screen-text">OK</strong>, you should notice a new <strong class="screen-text">Full Name</strong> field in the data pane. The value for that field is calculated per row of data. That is, every row of data contains the full name of the renter.</p>
    <h2 id="_idParaDest-89" class="title">More complex examples</h2>
    <p class="normal">Note that the <code class="Code-In-Text--PACKT-">Rental Property</code> field contains values such as <code class="Code-In-Text--PACKT-">112-Asbury Atoll</code> or <code class="Code-In-Text--PACKT-">207-Beach Breeze</code>. Let's assume that the naming convention of the rental unit in the vacation rental data gives us the room number and the name of the building separated by a dash. For example, the unit named <code class="Code-In-Text--PACKT-">207-Beach Breeze</code> is room 207 of the Beach Breeze building.</p>
    <p class="normal">Name the first <code class="Code-In-Text--PACKT-">Room</code> with the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">SPLIT([Rental <span class="hljs-keyword">Property</span>], <span class="hljs-string">"-"</span>, <span class="hljs-number">1</span>) 
</code></pre>
    <p class="normal">Then, create another calculated field named <code class="Code-In-Text--PACKT-">Building</code> with the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">SPLIT([Rental <span class="hljs-keyword">Property</span>], <span class="hljs-string">"-"</span>, <span class="hljs-number">2</span>) 
</code></pre>
    <p class="normal">Both of these functions use the <code class="Code-In-Text--PACKT-">Split()</code> function, which splits a string into multiple values and keeps one of those values. This function takes three arguments: the <strong class="bold">string</strong>, the <strong class="bold">delimiter</strong> (a character or set of characters that separate values), and the <strong class="bold">token number</strong> (which value to keep from the split, that is, first, second, third, and so on.) Using the <code class="Code-In-Text--PACKT-">-</code> (dash) as the delimiter, <code class="Code-In-Text--PACKT-">Room</code> is the first value and <code class="Code-In-Text--PACKT-">Building</code> is the second.</p>
    <p class="normal">Using the two calculated fields, create a bar chart of <strong class="screen-text">Rent per Building &amp; Room</strong>, like this:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_04.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.4: Using your calculated fields to build a view</p>
    <p class="normal">The <strong class="screen-text">Building</strong> and <strong class="screen-text">Room</strong> fields show up in the data pane as dimensions. The calculated dimensions can be used just like any other dimension. They can slice the data, define the level of detail, and group measures.</p>
    <p class="normal">Row-level calculations are calculated at the row level, but you can choose to aggregate the results. For example, you could aggregate to find the highest <strong class="screen-text">Room</strong> number <code class="Code-In-Text--PACKT-">(MAX)</code> or count the distinct number of <strong class="screen-text">Buildings</strong><code class="Code-In-Text--PACKT-"> (COUNTD)</code>. In fact, if the result of a row-level calculation is numeric, Tableau will often place the resulting field as a measure by default. But as we've seen, you can use a row-level field as either a dimension or measure in the view.</p>
    <p class="normal">Note that Tableau adds a small equals sign to the icon of the fields in the data pane to indicate that they are calculated fields:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_05.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.5: The small = sign indicates a field is a calculation</p>
    <p class="normal">The code for both calculated fields is executed for every row of data and returns a row-level value. We can verify that the code is operating on the row level by examining the source data. Simply click on the <strong class="screen-text">View Data</strong> icon next to dimensions to see the row-level detail (it's next to the magnifying glass icon in the preceding screenshot). Here, the new fields of <strong class="screen-text">Building</strong> and <strong class="screen-text">Unit</strong>, along with the row-level values, can be clearly seen:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_06.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.6: Viewing the underlying data shows us the calculation is done per row of data</p>
    <div class="packt_tip">
      <p>Tableau provides a shortcut for splitting a field. You can use the drop-down menu on a field in the data pane and select <strong class="screen-text">Transform</strong> | <strong class="screen-text">Split</strong> or <strong class="screen-text">Transform</strong> | <strong class="screen-text">Custom Split</strong> (if you have a non-standard delimiter). The results are calculated fields similar to those you created previously, but with some additional logic around determining data types. Transform functionality, such as split, is also available for fields in the <strong class="screen-text">Preview</strong> or <strong class="screen-text">Metadata</strong> views on the <strong class="screen-text">Data</strong> source screen.</p>
    </div>
    <h2 id="_idParaDest-90" class="title">Extending the example</h2>
    <p class="normal">We'll extend the example a bit more and assume you know that the floor of a room is indicated by its number. Rooms 100 through 199 are on the first floor, and 200 through 299 are on the second. You'd like to have that information available for analysis.</p>
    <p class="normal">We could potentially add this attribute to the source data, but there are times when this may not be an option or may not be feasible. You may not have permission to change the source data or the source might be a spreadsheet that is automatically generated every day, and any changes would be overwritten.</p>
    <p class="normal">Instead, you can create a row-level calculation in Tableau to extend the data. To do so, create a calculated field named <code class="Code-In-Text--PACKT-">Floor</code> with the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">IF</span> <span class="hljs-built_in">LEFT</span>([Room], <span class="hljs-number">1</span>) = <span class="hljs-string">"1"</span>
<span class="hljs-keyword">THEN</span> <span class="hljs-string">"First Floor"</span> 
<span class="hljs-keyword">ELSEIF</span> <span class="hljs-built_in">LEFT</span>([Room], <span class="hljs-number">1</span>) = <span class="hljs-string">"2"</span> 
<span class="hljs-keyword">THEN</span> <span class="hljs-string">"Second Floor"</span> 
<span class="hljs-keyword">END</span> 
</code></pre>
    <p class="normal">This code uses the <code class="Code-In-Text--PACKT-">LEFT()</code> function to return the leftmost character of the room. Thus, <code class="Code-In-Text--PACKT-">112</code> gives a result of <code class="Code-In-Text--PACKT-">1</code>; <code class="Code-In-Text--PACKT-">207</code> gives a result of <code class="Code-In-Text--PACKT-">2</code>. The <code class="Code-In-Text--PACKT-">IF THEN END</code> logic allows us to assign a result (either <code class="Code-In-Text--PACKT-">First Floor</code> or <code class="Code-In-Text--PACKT-">Second Floor</code>), depending on which case is true. Notice that you used the <code class="Code-In-Text--PACKT-">Room</code> field in the calculation, which, in turn, was another calculation.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Using a reference to a <a id="_idIndexMarker387"/><a id="_idIndexMarker388"/>calculated field within another calculation is referred to as <strong class="bold">nesting.</strong> The calculations that use other calculated fields are called <strong class="bold">nested </strong><strong class="bold"><a id="_idIndexMarker389"/><a id="_idIndexMarker390"/></strong><strong class="bold">calculations</strong>. There's no theoretical limit to how many levels of nesting you can use, but it may become hard to untangle the logic if you use too many levels of nesting.</p>
    </div>
    <h2 id="_idParaDest-91" class="title">Planning for data variations</h2>
    <p class="normal">As you write calculations, consider<a id="_idIndexMarker391"/><a id="_idIndexMarker392"/> whether your calculation covers variations in the data that are not currently present.</p>
    <div class="packt_tip">
      <p>A few good questions to ask yourself whenever you write a calculation in Tableau are: <em class="italics">What happens if the data changes?</em> <em class="italics">Does the calculation handle unexpected or invalid values?</em> <em class="italics">Have I covered every case?</em></p>
    </div>
    <p class="normal">For example, the preceding floor calculation only works if all the rooms are either 100- or 200-level rooms. What if there is a room, 306, on the third floor, or a room, 822, on the eighth floor?</p>
    <p class="normal">To account for additional cases, we might simplify our calculation to the following:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">LEFT</span><span class="hljs-params">([Room], </span><span class="hljs-number">1</span><span class="hljs-params">)</span> 
</code></pre>
    <p class="normal">This code simply returns the leftmost character of the room number. We'll get <code class="Code-In-Text--PACKT-">3</code> for <code class="Code-In-Text--PACKT-">306</code> and <code class="Code-In-Text--PACKT-">8</code> for <code class="Code-In-Text--PACKT-">822</code>. But what if we have room numbers such as 1056 on the tenth floor, and 1617 on the sixteenth? We'd have to consider other options, such as the following:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">MID</span><span class="hljs-params">([Room], </span><span class="hljs-number">0</span><span class="hljs-params">, LEN([Room])</span> - <span class="hljs-number">2</span>) 
</code></pre>
    <p class="normal">Although this is more complicated, the string functions return a substring that starts at the beginning of the string and ends just before the last two characters. That gives us floor <code class="Code-In-Text--PACKT-">10</code> for <code class="Code-In-Text--PACKT-">1025</code>, and floor <code class="Code-In-Text--PACKT-">18</code> for <code class="Code-In-Text--PACKT-">1856</code>.</p>
    <p class="normal">We've now considered some row-level calculation examples. Let's move on to the next major type of calculation in Tableau: aggregate-level calculations.</p>
    <h1 id="_idParaDest-92" class="title">Aggregate calculations</h1>
    <p class="normal">We've already considered<a id="_idIndexMarker393"/><a id="_idIndexMarker394"/> aggregations such as <code class="Code-In-Text--PACKT-">sum</code>, <code class="Code-In-Text--PACKT-">min</code>, and <code class="Code-In-Text--PACKT-">max</code> in Tableau. Often, you'll use fields as simple aggregations in the view. But sometimes, you'll want to use aggregations in more complex calculations.</p>
    <p class="normal">For example, you might be curious to explore the percentage of the rent that was discounted. There is no such field in the data. It could not really be stored in the source, because the value changes based on the level of detail present in the view (for example, the percent discounted for an individual unit will be different to the percent discounted per floor or per building). Rather, it must be calculated as an aggregate and recalculated as the level of detail changes.</p>
    <p class="normal">Let's create a calculation named <code class="Code-In-Text--PACKT-">Discount %</code> with the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">SUM</span><span class="hljs-params">([Discount])</span> / SUM([Rent]) 
</code></pre>
    <p class="normal">This code indicates that the <a id="_idIndexMarker395"/><a id="_idIndexMarker396"/>sum of <code class="Code-In-Text--PACKT-">Discount</code> should be divided by the sum of <code class="Code-In-Text--PACKT-">Rent</code>. This means that all the values of <code class="Code-In-Text--PACKT-">Discount</code> will be added, and all the values of <code class="Code-In-Text--PACKT-">Rent</code> will be added. Only after the sums are calculated will the division occur.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Once you've created the calculation, you'll notice that Tableau treats the new field as a <strong class="screen-text">Measure</strong> in the data pane. Tableau will treat any calculation with a numeric result as a measure by default, but you can change <em class="italics">row-level calculations</em> to dimensions if desired. In this case, though, you are not even able to redefine the new field as a dimension. The reason for this is that Tableau will treat every <em class="italics">aggregate calculation</em> as a measure, no matter what data type is returned. This is because an aggregate calculation depends on dimensions to define the level of detail at which the calculation is performed. So, an aggregate calculation cannot be a dimension itself.</p>
    </div>
    <p class="normal">As the value of your calculation is a percentage, you will also likely want to define the format as a percentage. To do this, right-click the <code class="Code-In-Text--PACKT-">Discount %</code> field, select <strong class="screen-text">Default Properties</strong> | <strong class="screen-text">Number Format</strong>, and select <strong class="screen-text">Percentage</strong>. You may adjust the number of decimal places that are displayed if desired.</p>
    <p class="normal">Now, create a couple of views to see how the calculation returns different results, depending on the level of detail in the view. First, we'll build a view to look at each individual rental period:</p>
    <ol>
      <li class="list" value="1">Place <strong class="screen-text">Building</strong>, <strong class="screen-text">Room</strong>, <strong class="screen-text">Full Name</strong>, <strong class="screen-text">Start</strong>, and <strong class="screen-text">End</strong> on <strong class="screen-text">Rows</strong>.</li>
      <li class="list">In the data pane, under <strong class="screen-text">Measures</strong>, double-click each of the following fields: <strong class="screen-text">Rent</strong>, <strong class="screen-text">Discount</strong>, and <strong class="screen-text">Discount %</strong>. Tableau will place each of these measures in the view by using <strong class="screen-text">Measure Names</strong> and <strong class="screen-text">Measure Values</strong>.</li>
      <li class="list">Rearrange the fields on the <strong class="screen-text">Measure Values</strong> shelf so that the order is <strong class="screen-text">Rent</strong>, <strong class="screen-text">Discount</strong>, and <strong class="screen-text">Discount %</strong>:
    <figure class="mediaobject"><img src="../Images/B16021_04_07.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.7: Illustrates the Discount % calculated at the level of Building, Room, Full Name, Start, and End</p></li>
    </ol>
    <p class="normal">You can see the<a id="_idIndexMarker397"/><a id="_idIndexMarker398"/> percentage given by way of discount for each rental period. However, notice how the values change when you remove all fields except <strong class="screen-text">Building</strong> and <strong class="screen-text">Room</strong>:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.8: Illustrates the Discount % calculated at the level of Building and Room</p>
    <p class="normal">Why did the values change? Because <a id="_idIndexMarker399"/><a id="_idIndexMarker400"/>aggregations depend on what dimensions are defining the level of detail of the view. In the first case, <strong class="screen-text">Building</strong> and <strong class="screen-text">Room</strong>, <strong class="screen-text">Full Name</strong>, <strong class="screen-text">Start</strong>, and <strong class="screen-text">End</strong> defined the level of detail in the view. So, the calculation added up all the rent for each rental period and all the discounts for the rental period and then divided them. In the second case, <strong class="screen-text">Building</strong> and <strong class="screen-text">Room</strong> redefine the level of detail. So, the calculation added up all the prices for each building and room and all the discounts for each building and room and then divided them.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">You may have noticed that as you double-clicked each measure, it was added to the pane of the view in a special way. <strong class="screen-text">Measure Names</strong> and <strong class="screen-text">Measure Values</strong> are special fields that appear in every data connection (toward the bottom of the <strong class="screen-text">Data</strong> pane). These serve as placeholders for multiple measures that share the same space in the view.</p>
      <p>In the view you just created, for example, three measures all shared space in the pane. <strong class="screen-text">Measure Values</strong> on <strong class="screen-text">Text</strong> indicated that all values of measures on the <strong class="screen-text">Measure Values</strong> shelf should be displayed as text. The <strong class="screen-text">Measure Names</strong> field on <strong class="screen-text">Columns</strong> created a column for each measure, with the value of the name of that measure.</p>
    </div>
    <p class="normal">Notice that the<a id="_idIndexMarker401"/><a id="_idIndexMarker402"/> values change again, as expected, if you look at the overall dataset without slicing by any dimensions:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_09.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.9: Illustrates the Discount % calculated at the highest possible level: the entire dataset</p>
    <div class="packt_tip">
      <p>An easy way to get Tableau to implement <strong class="screen-text">Measure Names</strong> / <strong class="screen-text">Measure Values</strong> is to remember that they are used whenever you want to use <em class="italics">two or more measures in the same space</em> in a view. So, if you want to use two or more measures in the pane, drag the first to the pane and then the second. If you want to use two or more measures on the same axis, drag the first to the axis, and then drag and drop the second on the same spot. </p>
    </div>
    <p class="normal">Now that you have a basic understanding of row-level and aggregate calculations, let's consider why the distinction is important.</p>
    <h2 id="_idParaDest-93" class="title">Why the row level versus aggregate difference matters</h2>
    <p class="normal">Let's say you created a <code class="Code-In-Text--PACKT-">Discount % (row level)</code> calculation <a id="_idIndexMarker403"/><a id="_idIndexMarker404"/>with the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-params">[Discount]</span>/[Rent] 
</code></pre>
    <p class="normal">The code differs from the aggregate calculation you created previously, which had the following code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">SUM</span><span class="hljs-params">([Discount])</span>/SUM([Rent]) 
</code></pre>
    <p class="normal">Here is the dramatic difference in results:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_10.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.10: Illustrates the Discount % calculated as a row-level value and as an aggregate</p>
    <p class="normal">Why is there such a difference in the results? It's a <a id="_idIndexMarker405"/><a id="_idIndexMarker406"/>result of the way the calculations were performed.</p>
    <p class="normal">Notice that <code class="Code-In-Text--PACKT-">Discount % (row level)</code> appears on the <strong class="screen-text">Measure Values</strong> shelf as a <code class="Code-In-Text--PACKT-">SUM</code>. That's because the calculation is a row-level calculation, so it gets calculated row by row and then aggregated as a measure after all row-level values have been determined. The <code class="Code-In-Text--PACKT-">54.00%</code> value you see is actually a sum of percentages that were calculated in each record of underlying data.</p>
    <p class="normal">In fact, the row-level calculation and the final aggregation is performed like this:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_11.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.11: If each Discount % result is calculated at a row level and then aggregated, the result is wrong</p>
    <p class="normal">Contrast that with the way the aggregate calculation<a id="_idIndexMarker407"/><a id="_idIndexMarker408"/> is performed. Notice that the aggregation that's listed in the active field on the <strong class="screen-text">Measure Values</strong> shelf in the view is <code class="Code-In-Text--PACKT-">AGG</code>, and not <code class="Code-In-Text--PACKT-">SUM</code>. This indicates that you have defined the aggregation in the calculation. Tableau is not aggregating the results further. Here is how the aggregate calculation is performed:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_12.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.12: If the numerator and denominator are aggregated first, then the Discount % calculation is correct</p>
    <p class="normal">It is vital to understand the difference between row-level and aggregate calculations to ensure you are getting the results you expect and need. In general, use row-level calculations when you are certain that you will use either the value as a dimension or that an aggregation of the row-level values will make sense. Use aggregate calculations if aggregations must be performed prior to other operations.</p>
    <p class="normal">One of the most common error messages that's encountered while writing Tableau calculations is <em class="italics">Cannot mix aggregate and non-aggregate arguments with this function</em>. When you encounter this message, check your code to make sure you are not improperly mixing row-level fields and calculations with<a id="_idIndexMarker409"/><a id="_idIndexMarker410"/> aggregate fields and calculations. For example, you cannot have something like <code class="Code-In-Text--PACKT-">[Discount] / SUM([Rent])</code>.</p>
    <p class="normal">This mixture of a row-level value <code class="Code-In-Text--PACKT-">(Discount)</code> and the aggregation (<code class="Code-In-Text--PACKT-">SUM</code> of <code class="Code-In-Text--PACKT-">Rent</code>) is invalid.</p>
    <p class="normal">With the distinction between row-level and aggregate calculations clear, let's take an interlude and discuss parameters before building additional examples.</p>
    <h1 id="_idParaDest-94" class="title">Parameters</h1>
    <p class="normal">Before moving to some additional examples of row-level and aggregate calculations, let's take a little side trip to examine parameters, given that they can be used in incredible ways in calculations.</p>
    <p class="normal">A <strong class="bold">parameter</strong> in Tableau is a placeholder for a single, global value such as a number, date, or string. Parameters may be shown as controls (such as sliders, drop-down lists, or type-in text boxes) to end users of dashboards or views, giving them the ability to change the current value of the parameter. Parameter values may even be changed with actions, as you'll see in <em class="italics">Chapter 8</em>, <em class="italics">Telling a Data Story with Dashboards</em>.</p>
    <p class="normal">The value of a parameter is global so that if the value is changed, every view and calculation in the workbook that references the parameter will use the new value. Parameters provide another way to provide rich interactivity to the end users of your dashboards and visualizations.</p>
    <p class="normal">Parameters can be used to allow anyone interacting with your view or dashboard to dynamically do many things, including the following:</p>
    <ul>
      <li class="list">Alter the results of a calculation</li>
      <li class="list">Change the size of bins</li>
      <li class="list">Change the number of top or bottom items in a top <em class="italics">n</em> filter or top <em class="italics">n</em> set</li>
      <li class="list">Set the value of a reference line or band</li>
      <li class="list">Change the size of bins</li>
      <li class="list">Pass values to a custom SQL statement that's used in a data source</li>
    </ul>
    <p class="normal">Some of these are options we'll consider in later chapters.</p>
    <p class="normal">Since parameters can be used in calculations, and since calculated fields can be used to define any aspect of a visualization (from filters to colors to rows and columns), the change in a parameter value can have dramatic results. We'll see some examples of this in the following sections.</p>
    <h2 id="_idParaDest-95" class="title">Creating parameters</h2>
    <p class="normal">Creating a parameter is similar to creating a calculated field.</p>
    <p class="normal">There are multiple ways to create a parameter in Tableau:</p>
    <ul>
      <li class="list">Use the drop-down menu next to <strong class="screen-text">Dimensions</strong> in the data pane and select <strong class="screen-text">Create Parameter</strong>.</li>
      <li class="list">Right-click an empty area in the data pane and select <strong class="screen-text">Create Parameter</strong>.</li>
      <li class="list">Use the drop-down menu on a field, set, or parameter already in the data pane and select <strong class="screen-text">Create</strong> | <strong class="screen-text">Parameter...</strong>.</li>
    </ul>
    <p class="normal">In the last case, Tableau will create a parameter with a list of potential values based on the <strong class="bold">domain</strong> (distinct values) of the field. For fields in the data pane that are <strong class="bold">discrete</strong> (blue) by default, Tableau will create a parameter with a list of values matching the discrete values of the field. For fields in the data pane that are <strong class="bold">continuous</strong> (green), Tableau will create a parameter with a range set to the minimum and maximum values of the field that's present in the data.</p>
    <p class="normal">When you first create a parameter (or subsequently edit an existing parameter), Tableau will present an interface like this:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_13.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.13: The Create Parameter interface numbered with corresponding descriptions below</p>
    <p class="normal">The interface contains the following features:</p>
    <ol>
      <li class="list" value="1"><strong class="screen-text">Name</strong> will show as the default title for parameter controls and will also be the reference in calculations. You can also add a <strong class="screen-text">Comment</strong> to describe the use of the parameter.</li>
      <li class="list"><strong class="screen-text">Data type</strong><strong class="bold"> </strong>defines what type of data is allowed for the value of the parameter. Options include integer, float (floating-point decimal), string, Boolean, date, or date with time.</li>
      <li class="list"><strong class="screen-text">Current value</strong> defines what the initial default value of the parameter will be. Changing this value on this screen or on a dashboard or visualization where the parameter control is shown will change the current value.</li>
      <li class="list"><strong class="screen-text">Value when workbook opens</strong> allows you to optionally change the default value of the parameter when the workbook opens based on a calculated value.</li>
      <li class="list"><strong class="screen-text">Display format</strong> defines how the values will be displayed. For example, you might want to show an integer value as a dollar amount, a decimal as a percentage, or display a date in a specific format.</li>
      <li class="list">The <strong class="screen-text">Allowable values</strong> option gives us the ability to restrict the scope of values that are permissible. There are three options for <strong class="screen-text">Allowable values</strong>:<ul>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="screen-text">All</strong><strong class="bold"> </strong>allows any input from the user that matches the data type of the parameter.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="screen-text">List</strong> allows us to define a list of values from which the user must select a single option. The list can be entered manually, pasted from the clipboard, or loaded from a dimension of the same data type.</li>
          <li class="Bullet-Within-Bullet-End--PACKT-"><strong class="screen-text">Range</strong> allows us to define a range of possible values, including an optional upper and lower limit, as well as a step size. This can also be set from a field or another parameter.</li>
        </ul>
      </li>
      <li class="list">In the example of the preceding screenshot, since we've selected <strong class="screen-text">List</strong> for <strong class="screen-text">Allowable values</strong>, we are given options to enter the list of possible values. In this example, a list of three items has been entered. Notice that the value must match the data type, but the display value can be any string value. You can drag and drop values in the list to reorder the list. If <strong class="screen-text">Range</strong> had been selected, the screen would instead show options for setting the <strong class="bold">Minimum</strong>, <strong class="bold">Maximum</strong>, and <strong class="bold">Step Size</strong> for the range.</li>
      <li class="list">Also specific to <strong class="screen-text">List</strong> are a couple of additional options for populating the list:<ul>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="screen-text">Fixed</strong>: You may manually enter the values, paste from the clipboard, or set them from the existing values of a field in the data. In any case, the list will be a static list and will not change even if the data is updated.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><strong class="screen-text">When the workbook opens</strong> allows you to specify a field that will dynamically update the list based on the available values for that field when the workbook is first opened.</li>
        </ul>
      </li>
    </ol>
    <p class="normal">Click <strong class="screen-text">OK</strong> to save changes to the parameter or <strong class="screen-text">Cancel</strong> to revert.</p>
    <p class="normal">When the parameter is created, it appears in the data pane in the <strong class="screen-text">Parameters</strong> section. The drop-down menu for a parameter reveals an option, <strong class="screen-text">Show Parameter Control</strong>, which adds the parameter control to the view. The little drop-down caret in the upper right of the parameter control reveals a menu for customizing the appearance and behavior of the parameter control. Here is the parameter control, shown as a single value list, for the parameter we created earlier:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_14.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.14: The parameter control shown as a single select radio button list</p>
    <p class="normal">This control can be shown on any sheet or dashboard and allows the end user to select a single value. When the value is changed, any calculations, filters, sets, or bins that use the parameter will be re-evaluated, and any views that are affected will be redrawn.</p>
    <p class="normal">Next, we'll consider some practical examples that use parameters in calculations.</p>
    <h1 id="_idParaDest-96" class="title">Practical examples of calculations and parameters</h1>
    <p class="normal">Let's turn our attention to some practical examples<a id="_idIndexMarker411"/><a id="_idIndexMarker412"/> of row-level and aggregate calculations. The<a id="_idIndexMarker413"/><a id="_idIndexMarker414"/> goal is to learn and understand some of what is possible with calculations. You will be able to build on these examples as you embark on your analysis and visualization journey.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">A great place to find help and suggestions for calculations is the official Tableau forums at <a href="https://community.tableau.com/s/explore-forums"><span class="url">https://community.tableau.com/s/explore-forums</span></a>.</p>
    </div>
    <h2 id="_idParaDest-97" class="title">Fixing data issues</h2>
    <p class="normal">Often, data is not<a id="_idIndexMarker415"/><a id="_idIndexMarker416"/> entirely clean. That is, it has problems that need to be corrected before meaningful analysis can be accomplished. For example, dates may be incorrectly formatted, or fields may contain a mix of numeric values and character codes that need to be separated into multiple fields. Calculated fields can often be used to fix these kinds of issues.</p>
    <div class="packt_tip">
      <p>We'll consider using Tableau Prepâ€”a tool designed to shape and cleanse dataâ€”in <em class="italics">Chapter 14</em>, <em class="italics">Structuring Messy Data to Work Well in Tableau</em>. Tableau Prep's calculation syntax is nearly identical, so many of the examples in this chapter will also be applicable in that context. Knowing how to address data issues in either Tableau Desktop or Tableau Prep will help you greatly.</p>
    </div>
    <p class="normal">We'll continue working with the <code class="Code-In-Text--PACKT-">Vacation Rentals</code> data. You'll recall that the start and end dates looked something like this:</p>
    <table id="table003" class="No-Table-Style _idGenTablePara-1">
      <colgroup>
        <col/>
        <col/>
      </colgroup>
      <tbody>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <strong class="heading">Start</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">End</strong>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Dec 2</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 9</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Dec 9</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 15</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Dec 16</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Dec 23</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="normal">Without the year, Tableau does not recognize the <code class="Code-In-Text--PACKT-">Start</code> or <code class="Code-In-Text--PACKT-">End</code> fields as <em class="italics">dates</em>. Instead, Tableau recognizes them as <em class="italics">strings</em>. You might try using the drop-down menu on the fields in the data pane to change the data type to date, but without the year, Tableau will almost certainly parse them incorrectly, or at least incompletely. This is a case where we'll need to use a calculation to fix the issue.</p>
    <p class="normal">Assuming, in this case, that you are confident the year should always be 2020, you might create calculated fields named <code class="Code-In-Text--PACKT-">Start Date</code> and <code class="Code-In-Text--PACKT-">End Date</code>.</p>
    <p class="normal">Here is the code for getting the start date:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">DATE</span><span class="hljs-params">([Start] + </span><span class="hljs-string">", 2020"</span><span class="hljs-params">)</span>
</code></pre>
    <p class="normal">And here is the code for getting the end date:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">DATE</span><span class="hljs-params">([End] + </span><span class="hljs-string">", 2020"</span><span class="hljs-params">)</span> 
</code></pre>
    <p class="normal">What these calculated fields do is concatenate the month and day with the year and then use the <code class="Code-In-Text--PACKT-">DATE()</code> function to convert the string into a date value. Indeed, Tableau recognizes the resulting fields as dates (with all the features of a date field, such as built-in hierarchies). A quick check in Tableau reveals the expected results:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_15.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.15: The corrected dates appear next to the string versions. All fields are discrete dimensions on Rows (the dates are exact dates)</p>
    <p class="normal">Not only are we <a id="_idIndexMarker417"/><a id="_idIndexMarker418"/>able to fix problems in the data, but we can also extend the data and our analysis using calculations. We'll consider this next.</p>
    <h2 id="_idParaDest-98" class="title">Extending the data</h2>
    <p class="normal">Often, there will be<a id="_idIndexMarker419"/><a id="_idIndexMarker420"/> dimensions or measures you'd like to have in your data, but which are not present in the source. Many times, you will be able to extend your dataset using calculated fields. We already considered an example of creating a field for the full name of the guest where we only had first and last name fields.</p>
    <p class="normal">Another piece of data that might unlock some truly interesting analysis would be the length of each rental. We have the start and end dates, but not the length of time between those two dates. Fortunately, this is easy to calculate.</p>
    <p class="normal">Create a calculated field named <code class="Code-In-Text--PACKT-">Nights Rented</code> with the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">DATEDIFF(<span class="hljs-string">'day'</span>, [<span class="hljs-keyword">Start</span> <span class="hljs-type">Date</span>], [<span class="hljs-keyword">End</span> <span class="hljs-type">Date</span>])
</code></pre>
    <div class="note">
      <p class="Information-Box--PACKT-">Tableau employs intelligent code completion. It will offer suggestions for functions and field names as you type in the code editor. Pressing the <kbd class="Key--PACKT-">Tab</kbd> key will autocomplete what you have started to type based on the current suggestion.</p>
      <figure class="mediaobject"><img src="../Images/B16021_04_16.png" alt=""/></figure>
      <figure class="mediaobject">Figure 4.16: The intelligent code completion will suggest possible field names and functions as you type.</figure>
    </div>
    <p class="normal">The <code class="Code-In-Text--PACKT-">DATEDIFF()</code> function <a id="_idIndexMarker421"/><a id="_idIndexMarker422"/>takes a date part description, a start and an end date, and returns a numeric value for the difference between the two dates. We now have a new measure, which wasn't available previously. We can use this new measure in our visualizations, such as the Gantt chart of rentals, as follows:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_17.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.17: The calculated field allows us to create the Gantt chart</p>
    <p class="normal">You'll find many ways to <a id="_idIndexMarker423"/><a id="_idIndexMarker424"/>extend your data with calculations as you continue your journey in Tableau. And that will enable you to accomplish some amazing analysis and visualizations. We'll consider some examples next.</p>
    <h2 id="_idParaDest-99" class="title">Enhancing user experience, analysis, and visualizations</h2>
    <p class="normal">Calculations and <a id="_idIndexMarker425"/><a id="_idIndexMarker426"/>parameters can greatly enhance the user experience, the<a id="_idIndexMarker427"/><a id="_idIndexMarker428"/> analysis, and the visualizations.</p>
    <p class="normal">Let's say we want to give the vacation condo <a id="_idIndexMarker429"/><a id="_idIndexMarker430"/>manager the ability to do some what-if analysis. Every year, she offers a free night during the month of December. She wants to be able to see which renters would have received the free night, depending on which night she chooses.</p>
    <p class="normal">To accomplish this, follow these steps:</p>
    <ol>
      <li class="list" value="1">If you have not done so, create a Gantt chart similar to what was shown earlier (following the field placement of the screenshot).</li>
      <li class="list">Create a parameter called <strong class="screen-text">Free Night</strong> with a data type of <strong class="bold">Date</strong> and a starting value of <code class="Code-In-Text--PACKT-">12/12/2020</code>. This will allow the manager to set and adjust the starting date for the promotional month. Show the parameter control by selecting <strong class="screen-text">Show Parameter Control</strong> from the drop-down menu on the <strong class="screen-text">Free Night</strong> parameter in the data pane.</li>
      <li class="list">Now, add<a id="_idIndexMarker431"/><a id="_idIndexMarker432"/> a reference line to the<a id="_idIndexMarker433"/><a id="_idIndexMarker434"/> view to show the free night. Do this by switching to the <strong class="screen-text">Analytics</strong> tab in the left <a id="_idIndexMarker435"/><a id="_idIndexMarker436"/>sidebar. Drag <strong class="screen-text">Reference Line</strong> toÂ theÂ view and drop it on <strong class="screen-text">Table</strong>:<figure class="mediaobject"><img src="../Images/B16021_04_18.png" alt=""/></figure>
        <p class="packt_figref">Figure 4.18: Add a reference line by switching to the Analytics pane and dragging the reference line onto the canvas</p>
      </li>
      <li class="list">In the resulting dialog box, set <strong class="screen-text">Line</strong> Value to <strong class="screen-text">Free Night</strong>. You may wish to set the <strong class="screen-text">Label</strong> to <strong class="screen-text">None</strong>, or <strong class="screen-text">Custom</strong> with the text <code class="Code-In-Text--PACKT-">Free Night</code>. You may also wish to adjust the formatting of the line:<figure class="mediaobject"><img src="../Images/B16021_04_19.png" alt=""/></figure>
        <p class="packt_figref">Figure 4.19: Use the Edit Reference Line dialog to adjust formatting, labels, and tooltips</p>
      </li>
      <li class="list">Create a <a id="_idIndexMarker437"/><a id="_idIndexMarker438"/>calculated<a id="_idIndexMarker439"/><a id="_idIndexMarker440"/> field called <strong class="screen-text">Gets Free Night</strong> that returns a <code class="Code-In-Text--PACKT-">true</code> or <code class="Code-In-Text--PACKT-">false</code> value, depending <a id="_idIndexMarker441"/><a id="_idIndexMarker442"/>on whether the free night falls within the rental period:
        <pre class="programlisting code"><code class="hljs-code">[Free Night] &gt;= [<span class="hljs-literal">Start</span> <span class="hljs-keyword">Date</span>]
<span class="hljs-keyword">AND</span>
[Free Night] &lt;= [<span class="hljs-keyword">End</span> <span class="hljs-built_in">Date</span>]
</code></pre>
      </li>
    </ol>
    <ol>
      <li class="list" value="6">Place this new calculated field on the <strong class="screen-text">Color</strong> shelf.</li>
    </ol>
    <p class="normal">We now have a <a id="_idIndexMarker443"/><a id="_idIndexMarker444"/>view that allows the apartment manager<a id="_idIndexMarker445"/><a id="_idIndexMarker446"/> to change the date and see a dynamically <a id="_idIndexMarker447"/><a id="_idIndexMarker448"/>changing view that makes it obvious which renters would have fallen within a given promotional period. Experiment by changing the value of the <strong class="screen-text">Free Night</strong> parameter to see how the view updates:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_20.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.20: The reference line will move, and the affected individuals will be recalculated every time you change the Free Night parameter value</p>
    <p class="normal">The preceding view shows the proposed free night as a dashed line and highlights which rental periods would receive a free night. The line and colors will change as the apartment manager adjusts the <strong class="screen-text">Free Night</strong> parameter value.</p>
    <p class="normal">In addition to extending your analysis, visualization, and user experience, you might also use calculations to add required business logic. We'll consider that next.</p>
    <h2 id="_idParaDest-100" class="title">Meeting business requirements</h2>
    <p class="normal">Sometimes, <a id="_idIndexMarker449"/><a id="_idIndexMarker450"/>data doesn't exactly match what your organization wants. For example, the measures in the data may not be the exact metrics required to make key business decisions. Or dimension values may need to be grouped according to a certain set of rules. Although this kind of business logic is often applied as data is transformed or modeled prior to connecting to it with Tableau, you may find cases where you need to implement business logic on the fly.</p>
    <p class="normal">In this example, consider that the measure <code class="Code-In-Text--PACKT-">Rent</code> is simply the base rent and does not include the discount or taxes. Those are separate fields in the data. If you needed to analyze the total <code class="Code-In-Text--PACKT-">Revenue</code>, you'd need to calculate it. That calculation might look something like this:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-selector-attr">[Rent]</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-attr">[Discount]</span> + (<span class="hljs-selector-attr">[Tax per Night]</span> * <span class="hljs-selector-attr">[Nights Rented]</span>)
</code></pre>
    <p class="normal">This formula takes the base <code class="Code-In-Text--PACKT-">Rent</code>, subtracts the <code class="Code-In-Text--PACKT-">Discount</code>, and then adds the <code class="Code-In-Text--PACKT-">Tax per Night</code> multiplied by the <code class="Code-In-Text--PACKT-">Nights Rented</code>. The parentheses aid readability but are not required because the multiplication operator, <code class="Code-In-Text--PACKT-">*</code>, has higher precedence and is evaluated before the addition, <code class="Code-In-Text--PACKT-">+</code>. </p>
    <p class="normal">Up until now, we've created calculated fields that extend the data source. Sometimes you just need a quick calculation to help in a single view. We'll conclude by looking at these quick ad hoc calculations.</p>
    <h2 id="_idParaDest-101" class="title">Ad hoc calculations</h2>
    <p class="normal">Ad hoc calculations <a id="_idIndexMarker451"/><a id="_idIndexMarker452"/>allow you to add calculated fields to shelves in a single view without adding fields to the data pane.</p>
    <p class="normal">Let's say you have a simple view that shows the <strong class="screen-text">Revenue per Guest</strong>, like this:</p>
    <figure class="mediaobject"> <img src="../Images/B16021_04_21.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.21: The revenue generated from each individual's stay</p>
    <p class="normal">What if you wanted<a id="_idIndexMarker453"/><a id="_idIndexMarker454"/> to quickly highlight any renters who had paid less than $1,500? One option would be to create an ad hoc calculation. To do so, simply double-click on an empty area of the <strong class="screen-text">Columns</strong>, <strong class="screen-text">Rows</strong>, or <strong class="screen-text">Measure Values</strong> cards, or on the empty space of the <strong class="screen-text">Marks</strong> shelf, and then start typing the code for a calculation. In this example, we've double-clicked the empty space on the <strong class="screen-text">Marks</strong> shelf:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_22.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.22: Creating an ad hoc calculation on the Marks card</p>
    <p class="normal">Here, we've entered code<a id="_idIndexMarker455"/><a id="_idIndexMarker456"/> that will return <code class="Code-In-Text--PACKT-">True</code> if the sum of <code class="Code-In-Text--PACKT-">Rent</code> is less than $1,500 and <code class="Code-In-Text--PACKT-">False</code> otherwise. Pressing <em class="italics">Enter</em> or clicking outside the text box will reveal a new ad hoc field that can be dragged and dropped anywhere within the view. Here, we've moved it to the <strong class="screen-text">Color</strong> shelf:</p>
    <figure class="mediaobject"><img src="../Images/B16021_04_23.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.23: Using the ad hoc calculation on Color</p>
    <p class="normal">The ad hoc field is only available within the view and does not show up in the data pane. You can double-click the field to edit the code.</p>
    <div class="packt_tip">
      <p>Dragging and dropping an ad hoc field into the data pane transforms it into a regular calculated field that will be available for other views that are using that data source.</p>
    </div>
    <p class="normal">Having seen a number of practical examples, let's conclude by considering some ways to ensure good performance when using calculations.</p>
    <h1 id="_idParaDest-102" class="title">Performance considerations</h1>
    <p class="normal">When working with<a id="_idIndexMarker457"/><a id="_idIndexMarker458"/> a small dataset and an efficient database, you often won't notice inefficient calculations. With larger datasets, the efficiency of your calculations can start to make a difference to the speed at which a view is rendered.</p>
    <p class="normal">Here are some tips for making your calculations as efficient as possible:</p>
    <ul>
      <li class="list">Boolean and numeric calculations are much faster than string calculations. If possible, avoid string manipulation and use aliasing or formatting to provide user-friendly labels. For example, don't write the following code: <code class="Code-In-Text--PACKT-">IF [value] == 1</code><code class="Code-In-Text--PACKT-"> THEN "Yes" ELSE "No" END</code>. Instead, simply write <code class="Code-In-Text--PACKT-">[value] == 1</code>, and then edit the aliases of the field and set <code class="Code-In-Text--PACKT-">True</code> to <code class="Code-In-Text--PACKT-">Yes</code> and <code class="Code-In-Text--PACKT-">False</code> to <code class="Code-In-Text--PACKT-">No</code>.</li>
      <li class="list">Look for ways to increase the efficiency of a calculation. If you find yourself writing a long <code class="Code-In-Text--PACKT-">IF ELSEIF</code> statement with lots of conditions, see whether there are one or two conditions that you can check first to eliminate the checks of all the other conditions. For example, let's consider simplifying the following code:
        <pre class="programlisting code"><code class="hljs-code">//<span class="hljs-symbol">This</span> is potentially less efficient...
<span class="hljs-symbol">IF</span> [<span class="hljs-symbol">Type</span>] = <span class="hljs-string">"Dog"</span> <span class="hljs-symbol">AND</span> [<span class="hljs-symbol">Age</span>] &lt; <span class="hljs-number">1</span> <span class="hljs-symbol">THEN</span> <span class="hljs-string">"Puppy"</span> 
<span class="hljs-symbol">ELSEIF</span> [<span class="hljs-symbol">Type</span>] = <span class="hljs-string">"Cat"</span> <span class="hljs-symbol">AND</span> [<span class="hljs-symbol">Age</span>] &lt; <span class="hljs-number">1</span> <span class="hljs-symbol">THEN</span> <span class="hljs-string">"Kitten"</span> 
<span class="hljs-symbol">END</span>
//...than this code:
<span class="hljs-symbol">IF</span> [<span class="hljs-symbol">Age</span>] &lt; <span class="hljs-number">1</span> <span class="hljs-symbol">THEN</span>
    <span class="hljs-symbol">IF</span> [<span class="hljs-symbol">Type</span>] = <span class="hljs-string">"Dog"</span> <span class="hljs-symbol">THEN</span> <span class="hljs-string">"Puppy"</span>
    <span class="hljs-symbol">ELSEIF</span> [<span class="hljs-symbol">Type</span>] = <span class="hljs-string">"Cat"</span> <span class="hljs-symbol">THEN</span> <span class="hljs-string">"Kitten"</span>
    <span class="hljs-symbol">END</span>
<span class="hljs-symbol">END</span> 
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet-End--PACKT-">Notice how the check of type doesn't have to be done for any records where the age was less than <code class="Code-In-Text--PACKT-">1</code>. That could be a very high percentage of records in the dataset.</p>
      </li>
      <li class="list">Row-level calculations have to be performed for every row of data. Try to minimize the complexity of row-level calculations. However, if that is not possible or doesn't solve a performance issue, consider the final option.</li>
      <li class="list">When you create a data extract, certain row-level calculations are materialized. This means that the calculation is performed once when the extract is created, and the results are then stored in the extract. This means that the data engine does not have to execute the calculation over and over. Instead, the value is simply read from the extract. Calculations that use any user functions, parameters, or <code class="Code-In-Text--PACKT-">TODAY()</code> or <code class="Code-In-Text--PACKT-">NOW()</code>, will not be materialized in an extract as the value necessarily changes according to the current user, parameter selection, and system time. Tableau's optimizer may also determine whether to materialize certain calculations that are more efficiently performed in memory rather than having<a id="_idIndexMarker459"/><a id="_idIndexMarker460"/> to read the stored value.</li>
    </ul>
    <div class="packt_tip">
      <p>When you use an extract to materialize row-level calculations, only the calculations that were created at the time of the extract are materialized. If you edit calculated fields or create new ones after creating the extract, you will need to optimize the extract (use the drop-down menu on the data source or select it from the <strong class="screen-text">Data</strong> menu and then select <strong class="screen-text">Extract</strong> | <strong class="screen-text">Optimize</strong> or <strong class="screen-text">Extract</strong> | <strong class="screen-text">Compute Calculations Now</strong>).</p>
    </div>
    <p class="normal">As you continue to work with calculations, pay special attention to situations where you notice performance issues, and consider whether you can optimize your calculations for better results.</p>
    <h1 id="_idParaDest-103" class="title">Summary</h1>
    <p class="normal">Calculations open amazing possibilities in Tableau. You are no longer confined to the fields in the source data. With calculations, you can extend the data by adding new dimensions and measures, fix bad or poorly formatted data, and enhance the user experience with parameters for user input and calculations that enhance the visualizations.</p>
    <p class="normal">The key to using calculated fields is understanding the four main types of calculations in Tableau. Row-level calculations are performed for every row of source data. These calculated fields can be used as dimensions or they can be aggregated as measures. Aggregate calculations are performed at the level of detail that's defined by the dimensions that are present in a view. They are especially helpful, and even necessary, when you must first aggregate components of the calculation before performing additional operations.</p>
    <p class="normal">In the next chapter, we'll explore the third of the four main types of calculations: <strong class="bold">Level of Detail calculations</strong>. This will greatly extend your ability to work with data and solve all kinds of interesting problems.</p>
  </div>
</body></html>