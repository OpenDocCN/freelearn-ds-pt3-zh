<html><head></head><body>
<div epub:type="chapter" id="_idContainer170">
<h1 class="chapter-number" id="_idParaDest-189"><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-190"><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.2.1">Going Further with  Apache Spark</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In the previous chapter, we leveraged open source components to bring time series analysis to production. </span><span class="koboSpan" id="kobo.3.2">This requires significant effort to set up and manage the platform. </span><span class="koboSpan" id="kobo.3.3">In this chapter, we will answer such challenges by using Databricks as a cloud-based </span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.4.1">managed </span><strong class="bold"><span class="koboSpan" id="kobo.5.1">platform-as-a-service</span></strong><span class="koboSpan" id="kobo.6.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.7.1">PaaS</span></strong><span class="koboSpan" id="kobo.8.1">) solution to go further with Apache Spark. </span><span class="koboSpan" id="kobo.8.2">We will use an end-to-end example of time series analysis built on Databricks using advanced features such as Delta Live Tables with a streaming pipeline, AutoML, Unity Catalog, and </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">AI/BI dashboards.</span></span></p>
<p><span class="koboSpan" id="kobo.10.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.12.1">Databricks components </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">and setup</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.14.1">Workflows</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Monitoring, security, </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">and governance</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">The </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">user interface</span></span></li>
</ul>
<h1 id="_idParaDest-191"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.20.1">In this chapter, we will use code examples to explore the deployment of a scalable end-to-end solution for time series analysis on Databricks, starting with the setup of the environment in the </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">following section.</span></span></p>
<p><span class="koboSpan" id="kobo.22.1">The code for this chapter is at </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">this URL:</span></span></p>
<p><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/tree/main/ch10"><span class="No-Break"><span class="koboSpan" id="kobo.24.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/tree/main/ch10</span></span></a></p>
<h1 id="_idParaDest-192"><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.25.1">Databricks components and setup</span></h1>
<p><span class="koboSpan" id="kobo.26.1">We will be </span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.27.1">using a Databricks environment, as in </span><a href="B18568_08.xhtml#_idTextAnchor151"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.28.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.29.1">, for the platform infrastructure. </span><span class="koboSpan" id="kobo.29.2">Follow the instructions in the </span><em class="italic"><span class="koboSpan" id="kobo.30.1">Technical requirements</span></em><span class="koboSpan" id="kobo.31.1"> section of </span><a href="B18568_08.xhtml#_idTextAnchor151"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.32.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.33.1"> on setting up the </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">Databricks environment.</span></span></p>
<h2 id="_idParaDest-193"><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.35.1">Workspace, folders, and notebooks</span></h2>
<p><span class="koboSpan" id="kobo.36.1">Once the </span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.37.1">environment is set up, follow the instructions </span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.38.1">in the links provided here to import </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">the </span></span><span class="No-Break"><a id="_idIndexMarker816"/></span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">notebooks:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.41.1">Navigate the Databricks </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">workspace: </span></span><a href="https://docs.databricks.com/en/workspace/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.43.1">https://docs.databricks.com/en/workspace/index.html</span></span></a></li>
<li><span class="koboSpan" id="kobo.44.1">Create a folder named </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">ts_spark</span></strong><span class="koboSpan" id="kobo.46.1"> and a sub-folder named </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">ch10</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">: </span></span><a href="https://docs.databricks.com/en/workspace/workspace-objects.html#folders"><span class="No-Break"><span class="koboSpan" id="kobo.49.1">https://docs.databricks.com/en/workspace/workspace-objects.html#folders</span></span></a></li>
<li><span class="koboSpan" id="kobo.50.1">Import the notebooks for this example into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">ch10</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.52.1">folder: </span></span><a href="https://docs.databricks.com/en/notebooks/notebook-export-import.html#import-a-notebook"><span class="No-Break"><span class="koboSpan" id="kobo.53.1">https://docs.databricks.com/en/notebooks/notebook-export-import.html#import-a-notebook</span></span></a><p class="list-inset"><span class="koboSpan" id="kobo.54.1">There are eight notebooks in all, and they can be imported from the </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">following URLs:</span></span></p><ul><li><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_dlt_features.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.56.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_dlt_features.dbc</span></span></a></li><li><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_evaluate_forecast.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.57.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_evaluate_forecast.dbc</span></span></a></li><li><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_generate_forecast.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.58.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_generate_forecast.dbc</span></span></a></li><li><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_model_training.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.59.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_model_training.dbc</span></span></a></li><li><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_model_training_automl.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.60.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_model_training_automl.dbc</span></span></a></li><li><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_reset.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.61.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_reset.dbc</span></span></a></li><li><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_update_data.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.62.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_update_data.dbc</span></span></a></li><li><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_update_model.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.63.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch10/ts_spark_ch10_update_model.dbc</span></span></a></li></ul></li>
</ol>
<p><span class="koboSpan" id="kobo.64.1">With the </span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.65.1">notebooks </span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.66.1">imported, we </span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.67.1">can next set up </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">the clusters.</span></span></p>
<h2 id="_idParaDest-194"><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.69.1">Clusters</span></h2>
<p><span class="koboSpan" id="kobo.70.1">We can </span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.71.1">use the Databricks </span><strong class="bold"><span class="koboSpan" id="kobo.72.1">Machine Learning Runtime</span></strong><span class="koboSpan" id="kobo.73.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.74.1">MLR</span></strong><span class="koboSpan" id="kobo.75.1">) or serverless compute for </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">the clusters.</span></span></p>
<p><span class="koboSpan" id="kobo.77.1">The MLR </span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.78.1">cluster comes preloaded with common libraries used for </span><strong class="bold"><span class="koboSpan" id="kobo.79.1">machine learning</span></strong><span class="koboSpan" id="kobo.80.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.81.1">ML</span></strong><span class="koboSpan" id="kobo.82.1">). </span><span class="koboSpan" id="kobo.82.2">It instantiates virtual machines in your cloud </span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.83.1">provider account. </span><span class="koboSpan" id="kobo.83.2">You will be charged for the virtual machine by the cloud provider. </span><span class="koboSpan" id="kobo.83.3">Choose a small instance with minimal CPU and memory to minimize this cost when creating the cluster. </span><span class="koboSpan" id="kobo.83.4">This will be sufficient for the example in this chapter. </span><span class="koboSpan" id="kobo.83.5">Refer to the </span><em class="italic"><span class="koboSpan" id="kobo.84.1">Technical requirements</span></em><span class="koboSpan" id="kobo.85.1"> section of </span><a href="B18568_08.xhtml#_idTextAnchor151"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.86.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.87.1"> on setting up the </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">Databricks cluster.</span></span></p>
<p><span class="koboSpan" id="kobo.89.1">The MLR cluster has libraries required for the AutoML example, which we will cover in a later section. </span><span class="koboSpan" id="kobo.89.2">You can skip the code execution for this example if you do not want to incur the MLR-related cloud provider cost for the associated virtual machines. </span><span class="koboSpan" id="kobo.89.3">We will provide an alternative workflow that does not </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">use AutoML.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.91.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.92.1">At the time of writing, the cloud provider cost for these virtual machines is above the free allowance that you get with the free cloud provider trial account. </span><span class="koboSpan" id="kobo.92.2">This means that you will have to upgrade to a paid cloud provider account and the cost will be charged to the credit card you specified when creating the account. </span><span class="koboSpan" id="kobo.92.3">The virtual machines and cloud infrastructure costs are not incurred from the free Databricks </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">trial account.</span></span></p>
<p><span class="koboSpan" id="kobo.94.1">The serverless cluster is included in your Databricks cost as the underlying virtual machines are fully managed by Databricks. </span><span class="koboSpan" id="kobo.94.2">This means it does not incur separate cloud provider costs. </span><span class="koboSpan" id="kobo.94.3">Serverless clusters do, however, require the installation of ML libraries at the time </span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.95.1">of writing, as you will see in the code example. </span><span class="koboSpan" id="kobo.95.2">Databricks may provide serverless clusters with pre-loaded ML libraries in </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">the future.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.97.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.98.1">Databricks has started to include serverless in the free trial account at the time of writing. </span><span class="koboSpan" id="kobo.98.2">This means that your use of serverless clusters to execute the code in this chapter will be free if within the time and cost limit of the Databricks free trial account. </span><span class="koboSpan" id="kobo.98.3">This may be subject to change in </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">the future.</span></span></p>
<p><span class="koboSpan" id="kobo.100.1">You can </span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.101.1">find more information on MLR </span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.102.1">and serverless clusters in the </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">following resources:</span></span></p>
<ul>
<li><a href="https://docs.databricks.com/en/machine-learning/databricks-runtime-ml.html"><span class="No-Break"><span class="koboSpan" id="kobo.104.1">https://docs.databricks.com/en/machine-learning/databricks-runtime-ml.html</span></span></a></li>
<li><a href="https://docs.databricks.com/en/compute/serverless/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.105.1">https://docs.databricks.com/en/compute/serverless/index.html</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.106.1">With the clusters covered, we will next configure the data pipeline using Delta </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">Live Tables.</span></span></p>
<h2 id="_idParaDest-195"><a id="_idTextAnchor196"/><span class="koboSpan" id="kobo.108.1">Streaming with Delta Live Tables</span></h2>
<p><span class="koboSpan" id="kobo.109.1">Databricks </span><strong class="bold"><span class="koboSpan" id="kobo.110.1">Delta Live Tables</span></strong><span class="koboSpan" id="kobo.111.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.112.1">DLT</span></strong><span class="koboSpan" id="kobo.113.1">) is a </span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.114.1">low-code declarative </span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.115.1">solution to build data pipelines. </span><span class="koboSpan" id="kobo.115.2">In our example, we will use DLT for the feature engineering pipeline, getting data from the source files, checking the data quality, and transforming it into </span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.116.1">features that can be used to train the time series model. </span><span class="koboSpan" id="kobo.116.2">You can find more information on DLT at the </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">following link:</span></span></p>
<p><a href="https://www.databricks.com/discover/pages/getting-started-with-delta-live-tables"><span class="No-Break"><span class="koboSpan" id="kobo.118.1">https://www.databricks.com/discover/pages/getting-started-with-delta-live-tables</span></span></a></p>
<p><span class="koboSpan" id="kobo.119.1">We will go into the details of the DLT configuration in the </span><em class="italic"><span class="koboSpan" id="kobo.120.1">Implementing </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.121.1">workflows</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.122.1"> section.</span></span></p>
<h2 id="_idParaDest-196"><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.123.1">Workflows</span></h2>
<p><span class="koboSpan" id="kobo.124.1">Databricks </span><a id="_idIndexMarker829"/><span class="koboSpan" id="kobo.125.1">workflows are the equivalent of the Airflow DAGs that we used in </span><a href="B18568_04.xhtml#_idTextAnchor087"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.126.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.127.1"> and </span><a href="B18568_09.xhtml#_idTextAnchor169"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.128.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.129.1">. </span><span class="koboSpan" id="kobo.129.2">You can find more information on workflows, also referred to as </span><strong class="bold"><span class="koboSpan" id="kobo.130.1">jobs</span></strong><span class="koboSpan" id="kobo.131.1">, at the </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">following link:</span></span></p>
<p><a href="https://docs.databricks.com/en/jobs/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.133.1">https://docs.databricks.com/en/jobs/index.html</span></span></a></p>
<p><span class="koboSpan" id="kobo.134.1">We will now go into the details of </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.135.1">jobs</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.136.1"> configuration.</span></span></p>
<h1 id="_idParaDest-197"><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.137.1">Implementing workflows</span></h1>
<p><span class="koboSpan" id="kobo.138.1">The code example in this chapter includes four workflows. </span><span class="koboSpan" id="kobo.138.2">These are implemented as jobs in </span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.139.1">Databricks. </span><span class="koboSpan" id="kobo.139.2">The best way to visualize the jobs is from the </span><strong class="bold"><span class="koboSpan" id="kobo.140.1">Workflows</span></strong><span class="koboSpan" id="kobo.141.1"> &gt; </span><strong class="bold"><span class="koboSpan" id="kobo.142.1">Jobs</span></strong><span class="koboSpan" id="kobo.143.1"> &gt; </span><strong class="bold"><span class="koboSpan" id="kobo.144.1">Tasks</span></strong><span class="koboSpan" id="kobo.145.1"> views in Databricks, as per </span><em class="italic"><span class="koboSpan" id="kobo.146.1">Figures 10.1</span></em><span class="koboSpan" id="kobo.147.1">, </span><em class="italic"><span class="koboSpan" id="kobo.148.1">10.2</span></em><span class="koboSpan" id="kobo.149.1">, </span><em class="italic"><span class="koboSpan" id="kobo.150.1">10.3</span></em><span class="koboSpan" id="kobo.151.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">and </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.153.1">10.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.155.1">The jobs are </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">ts-spark_ch10_1a_ingest_and_train</span></strong><span class="koboSpan" id="kobo.158.1"> – This job is for data ingestion, feature engineering, and model training, and is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.159.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.160.1">.1</span></em><span class="koboSpan" id="kobo.161.1">. </span><span class="koboSpan" id="kobo.161.2">It includes the </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">following tasks:</span></span><ul><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">reset</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">dlt_features</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">model_training</span></strong></span></li></ul></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer158">
<span class="koboSpan" id="kobo.166.1"><img alt="" src="image/B18568_10_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.167.1">Figure 10.1: Data ingestion, feature engineering, and model training job</span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">ts-spark_ch10_1b_ingest_and_train_automl</span></strong><span class="koboSpan" id="kobo.169.1"> – The second job, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.170.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.171.1">.2</span></em><span class="koboSpan" id="kobo.172.1">, is another version of the first job, with the difference being the use of AutoML, which will be explained in the </span><em class="italic"><span class="koboSpan" id="kobo.173.1">Training with </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.174.1">AutoML</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.175.1"> section.</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer159">
<span class="koboSpan" id="kobo.176.1"><img alt="" src="image/B18568_10_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.177.1">Figure 10.2: Data ingestion, feature engineering, and model training (AutoML) job</span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">ts-spark_ch10_2b_ingest_and_forecast</span></strong><span class="koboSpan" id="kobo.179.1"> – This job ingests new data, retrains </span><a id="_idIndexMarker831"/><span class="koboSpan" id="kobo.180.1">the model, and generates and evaluates forecasts, and is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.181.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.182.1">.3</span></em><span class="koboSpan" id="kobo.183.1">. </span><span class="koboSpan" id="kobo.183.2">It includes the </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">following tasks.</span></span><ul><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">dlt_features</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">update_model</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">generate_forecast</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">update_data</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">evaluate_forecast</span></strong></span></li></ul></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer160">
<span class="koboSpan" id="kobo.190.1"><img alt="" src="image/B18568_10_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.191.1">Figure 10.3: Ingest new data, retrain model, and generate forecasts job</span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">ts-spark_ch10_2a_update_iteration</span></strong><span class="koboSpan" id="kobo.193.1"> – This job, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.194.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.195.1">.4</span></em><span class="koboSpan" id="kobo.196.1">, calls the preceding one multiple times to ingest new data. </span><span class="koboSpan" id="kobo.196.2">It simulates what happens in the real world whereby the previous end-to-end workflow is launched at a regular interval, say, daily or weekly, with </span><span class="No-Break"><span class="koboSpan" id="kobo.197.1">new data.</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer161">
<span class="koboSpan" id="kobo.198.1"><img alt="" src="image/B18568_10_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.199.1">Figure 10.4: Multiple calls to ingest and process new data job</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.200.1">Modularity and task separation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.201.1">As in </span><a href="B18568_09.xhtml#_idTextAnchor169"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.202.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.203.1">, we have broken the jobs into multiple tasks to illustrate the best practice of modularization. </span><span class="koboSpan" id="kobo.203.2">This facilitates independent code change, scaling, and task reruns. </span><span class="koboSpan" id="kobo.203.3">The ownership of the tasks can be with different teams. </span><span class="koboSpan" id="kobo.203.4">The jobs in this example can be further split in your own implementation, depending on your requirement to launch the </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">tasks separately.</span></span></p>
<p><span class="koboSpan" id="kobo.205.1">We will explain </span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.206.1">each of these jobs and related tasks in detail in the upcoming sections, starting with the ingestion and </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">training job.</span></span></p>
<p><span class="koboSpan" id="kobo.208.1">To set up the jobs required for this chapter, follow the instructions on creating jobs and configuring tasks at </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">these links:</span></span></p>
<ul>
<li><a href="https://docs.databricks.com/en/jobs/configure-job.html#create-a-new-job"><span class="No-Break"><span class="koboSpan" id="kobo.210.1">https://docs.databricks.com/en/jobs/configure-job.html#create-a-new-job</span></span></a></li>
<li><a href="https://docs.databricks.com/en/jobs/configure-task.html#configure-and-edit-databricks-tasks"><span class="No-Break"><span class="koboSpan" id="kobo.211.1">https://docs.databricks.com/en/jobs/configure-task.html#configure-and-edit-databricks-tasks</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.212.1">Refer to the tables in the upcoming sections for the configuration when creating the jobs and related tasks, replacing </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">&lt;USER_LOGIN&gt;</span></strong><span class="koboSpan" id="kobo.214.1"> with your own Databricks </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">user login.</span></span></p>
<h2 id="_idParaDest-198"><a id="_idTextAnchor199"/><span class="koboSpan" id="kobo.216.1">Ingest and train</span></h2>
<p><span class="koboSpan" id="kobo.217.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.218.1">Tasks</span></strong><span class="koboSpan" id="kobo.219.1"> part of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">ts-spark_ch10_1a_ingest_and_train</span></strong><span class="koboSpan" id="kobo.221.1"> job, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.222.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.223.1">.1</span></em><span class="koboSpan" id="kobo.224.1">, will be detailed in </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">this section.</span></span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.226.1">Table 10.1</span></em><span class="koboSpan" id="kobo.227.1"> shows </span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.228.1">the configuration for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">ts_spark_ch10_1a_ingest_and_train</span></strong><span class="koboSpan" id="kobo.230.1"> job to use when following the instructions in the previously provided URL. </span><span class="koboSpan" id="kobo.230.2">Note that for simplicity, we have given each task the same name as the code notebook or pipeline that </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">it runs.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-4">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.232.1">Job</span></strong></span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">ts_spark_ch10_1a_ingest_and_train</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.234.1">Task 1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.235.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">ts_spark_ch10_reset</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.237.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.238.1">Notebook</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.239.1">Source</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.240.1">Workspace</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.241.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_reset</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.244.1">Compute</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.245.1">Serverless</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.246.1">Task 2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.247.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.249.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.250.1">Pipeline</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.251.1">Pipeline</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.253.1">Trigger a full refresh on </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">the pipeline</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.255.1">R</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.256.1">Depends on</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">ts_spark_ch10_reset</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.258.1">Task 3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.259.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">ts_spark_ch10_model_training</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.261.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.262.1">Notebook</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.263.1">Source</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.264.1">Workspace</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.265.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_model_training</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.268.1">Compute</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.269.1">Serverless</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.270.1">Depends on</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.272.1">Table 10.1: Job configuration – ts_spark_ch10_1a_ingest_and_train</span></p>
<h3><span class="koboSpan" id="kobo.273.1">reset</span></h3>
<p><span class="koboSpan" id="kobo.274.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">reset</span></strong><span class="koboSpan" id="kobo.276.1"> task </span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.277.1">does </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.279.1">Resets the Databricks catalog, </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">ts_spark</span></strong><span class="koboSpan" id="kobo.281.1">, which is used for </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">this example</span></span></li>
<li><span class="koboSpan" id="kobo.283.1">Downloads the data files from the GitHub location for this chapter to the volumes created in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">ts_spark</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.285.1"> catalog</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.286.1">The code for this task is in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">ts_spark_ch10_reset</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.288.1"> notebook.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.289.1">Catalog and volume</span></p>
<p class="callout"><span class="koboSpan" id="kobo.290.1">Databricks’ Unity Catalog provides data governance and management in Databricks. </span><span class="koboSpan" id="kobo.290.2">It organizes data into a three-level hierarchy: catalogs, schemas (equivalent to databases), and tables, views, or volumes. </span><span class="koboSpan" id="kobo.290.3">Tabular data is stored in tables and views, while files are stored in volumes. </span><span class="koboSpan" id="kobo.290.4">In our code example, we are using a separate catalog, </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">ts_spark</span></strong><span class="koboSpan" id="kobo.292.1">, and volumes to store the </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">data files.</span></span></p>
<h3><span class="koboSpan" id="kobo.294.1">dlt_features</span></h3>
<p><span class="koboSpan" id="kobo.295.1">This task </span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.296.1">is used for data ingestion and feature engineering. </span><span class="koboSpan" id="kobo.296.2">It is implemented as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">ts_spark_ch10_dlt_features</span></strong><span class="koboSpan" id="kobo.298.1"> DLT pipeline, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.299.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.300.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer162">
<span class="koboSpan" id="kobo.302.1"><img alt="" src="image/B18568_10_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.303.1">Figure 10.5: Feature engineering pipeline</span></p>
<p><span class="koboSpan" id="kobo.304.1">You can find and zoom in on a digital version of </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.305.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.306.1">.5</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.307.1">here: </span></span><a href="https://packt.link/D9OXb"><span class="No-Break"><span class="koboSpan" id="kobo.308.1">https://packt.link/D9OXb</span></span></a></p>
<p><span class="koboSpan" id="kobo.309.1">To set up </span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.310.1">the DLT pipeline required for this chapter, follow the instructions on creating the pipeline at the </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">following link:</span></span></p>
<p><a href="https://docs.databricks.com/en/delta-live-tables/configure-pipeline.html#configure-a-new-delta-live-tables-pipeline"><span class="No-Break"><span class="koboSpan" id="kobo.312.1">https://docs.databricks.com/en/delta-live-tables/configure-pipeline.html#configure-a-new-delta-live-tables-pipeline</span></span></a></p>
<p><span class="koboSpan" id="kobo.313.1">Note that you will have to create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">ts_spark</span></strong><span class="koboSpan" id="kobo.315.1"> catalog before you can set up the DLT pipeline. </span><span class="koboSpan" id="kobo.315.2">Refer to the following instructions to create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">ts_spark</span></strong><span class="koboSpan" id="kobo.317.1"> catalog via the Catalog </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">Explorer: </span></span><a href="https://docs.databricks.com/aws/en/catalogs/create-catalog?language=Catalog%C2%A0Explorer"><span class="No-Break"><span class="koboSpan" id="kobo.319.1">https://docs.databricks.com/aws/en/catalogs/create-catalog?language=Catalog%C2%A0Explorer</span></span></a></p>
<p><span class="koboSpan" id="kobo.320.1">Refer to </span><em class="italic"><span class="koboSpan" id="kobo.321.1">Table 10.2</span></em><span class="koboSpan" id="kobo.322.1"> for the configuration when creating the pipeline, replacing </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">&lt;USER_LOGIN&gt;</span></strong><span class="koboSpan" id="kobo.324.1"> with your own Databricks </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">user login.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.326.1">Pipeline</span></strong></span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.327.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.328.1">General</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.329.1">Pipeline name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.331.1">Serverless</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.332.1">R</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.333.1">Pipeline mode</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.334.1">Triggered</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.335.1">Source code</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.336.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.339.1">Destination</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.340.1">Storage options</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">Unity Catalog</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.342.1">Default catalog / Default </span><span class="No-Break"><span class="koboSpan" id="kobo.343.1">schema</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.344.1">ts_spark / </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">ch10</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.346.1">Table 10.2: DLT configuration – ts_spark_ch10_dlt_features</span></p>
<p><span class="koboSpan" id="kobo.347.1">The code </span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.348.1">for this pipeline task is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">ts_spark_ch10_dlt_features</span></strong><span class="koboSpan" id="kobo.350.1"> notebook. </span><span class="koboSpan" id="kobo.350.2">It has the </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.352.1">Read historical data from files in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">vol01_hist</span></strong><span class="koboSpan" id="kobo.354.1"> volume using Auto Loader, check the data, and store the data in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.355.1">raw_hist_power_consumption</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.356.1">streaming table.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.357.1">Auto Loader</span></p>
<p class="callout"><span class="koboSpan" id="kobo.358.1">Databricks Auto Loader, also </span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.359.1">referred to as </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1">cloudfiles</span></strong><span class="koboSpan" id="kobo.361.1"> in code, enables the efficient incremental ingestion of new data files as they arrive in a cloud storage location. </span><span class="koboSpan" id="kobo.361.2">You can find more information on Auto Loader at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">link: </span></span><a href="https://docs.databricks.com/en/ingestion/cloud-object-storage/auto-loader/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.363.1">https://docs.databricks.com/en/ingestion/cloud-object-storage/auto-loader/index.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.364.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.365.1">Data quality checks</span></p>
<p class="callout"><span class="koboSpan" id="kobo.366.1">Databricks DLT can include data quality checks to ensure data integrity based on quality constraints </span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.367.1">within data pipelines. </span><span class="koboSpan" id="kobo.367.2">You can find more information on data quality checks in DLT at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.368.1">link: </span></span><a href="https://docs.databricks.com/en/delta-live-tables/expectations.html"><span class="No-Break"><span class="koboSpan" id="kobo.369.1">https://docs.databricks.com/en/delta-live-tables/expectations.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.370.1">.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.371.1">Read update data from files in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">vol01_upd</span></strong><span class="koboSpan" id="kobo.373.1"> volume using Auto Loader, check the data, and store the data in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.374.1">raw_upd_power_consumption</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.375.1">streaming table.</span></span></li>
<li><span class="koboSpan" id="kobo.376.1">Read raw historical data from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">raw_hist_power_consumption</span></strong><span class="koboSpan" id="kobo.378.1"> streaming table, transform the data, and store the result in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">curated_hist_power_consumption</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.380.1">streaming table.</span></span></li>
<li><span class="koboSpan" id="kobo.381.1">Read raw </span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.382.1">update data from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">raw_upd_power_consumption</span></strong><span class="koboSpan" id="kobo.384.1"> streaming table, transform the data, and store the result in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">curated_upd_power_consumption</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.386.1">streaming table.</span></span></li>
<li><span class="koboSpan" id="kobo.387.1">Append data from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">curated_hist_power_consumption</span></strong><span class="koboSpan" id="kobo.389.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">curated_upd_power_consumption</span></strong><span class="koboSpan" id="kobo.391.1"> streaming tables, storing the combined result in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">curated_all_power_consumption</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.393.1">streaming table.</span></span></li>
<li><span class="koboSpan" id="kobo.394.1">Read curated data from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">curated_all_power_consumption</span></strong><span class="koboSpan" id="kobo.396.1"> streaming </span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.397.1">table, use Tempo to calculate the </span><strong class="bold"><span class="koboSpan" id="kobo.398.1">exponential moving average</span></strong><span class="koboSpan" id="kobo.399.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.400.1">EMA</span></strong><span class="koboSpan" id="kobo.401.1">) over a 5-minute window, and resample the data to hourly means. </span><span class="koboSpan" id="kobo.401.2">Then, store the aggregated data in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">features_aggr_power_consumption</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.403.1">materialized view.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.404.1">Tempo</span></p>
<p class="callout"><span class="koboSpan" id="kobo.405.1">Databricks Tempo is an open source project simplifying time series data manipulation within Apache Spark. </span><span class="koboSpan" id="kobo.405.2">You can find more information on Tempo at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">link: </span></span><a href="https://databrickslabs.github.io/tempo/"><span class="No-Break"><span class="koboSpan" id="kobo.407.1">https://databrickslabs.github.io/tempo/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.408.1">.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.409.1">Read aggregated data from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">features_aggr_power_consumption</span></strong><span class="koboSpan" id="kobo.411.1"> materialized view, and use Tempo to do an </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">AsOf</span></strong><span class="koboSpan" id="kobo.413.1"> join with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">curated_all_power_consumption</span></strong><span class="koboSpan" id="kobo.415.1"> streaming table. </span><span class="koboSpan" id="kobo.415.2">Then, store the result in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">features_gnlr_power_consumption</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.417.1">materialized view.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.418.1">These steps correspond to the data transformation stages of the medallion approach, which was discussed in the </span><em class="italic"><span class="koboSpan" id="kobo.419.1">Data processing and storage</span></em><span class="koboSpan" id="kobo.420.1"> section of </span><a href="B18568_04.xhtml#_idTextAnchor087"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.421.1">Chapter 4</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.422.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.423.1">model_training</span></h3>
<p><span class="koboSpan" id="kobo.424.1">This task </span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.425.1">is used to train a Prophet model using the features calculated in the prior </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">dlt_features</span></strong><span class="koboSpan" id="kobo.427.1"> task. </span><span class="koboSpan" id="kobo.427.2">The code for </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">model_training</span></strong><span class="koboSpan" id="kobo.429.1"> is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">ts_spark_ch10_model_training</span></strong><span class="koboSpan" id="kobo.431.1"> notebook. </span><span class="koboSpan" id="kobo.431.2">The steps are </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.433.1">Read the features </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">features_aggr_power_consumption</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.437.1">Rename the </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">Date</span></strong><span class="koboSpan" id="kobo.439.1"> column to </span><strong class="source-inline"><span class="koboSpan" id="kobo.440.1">ds</span></strong><span class="koboSpan" id="kobo.441.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.442.1">hourly_Global_active_power</span></strong><span class="koboSpan" id="kobo.443.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.444.1">y</span></strong><span class="koboSpan" id="kobo.445.1">. </span><span class="koboSpan" id="kobo.445.2">These column names are required </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">by Prophet.</span></span></li>
<li><span class="koboSpan" id="kobo.447.1">Start an MLflow run to track the training </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">in MLflow.</span></span></li>
<li><span class="koboSpan" id="kobo.449.1">Fit the Prophet model to </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">the dataset.</span></span></li>
<li><span class="koboSpan" id="kobo.451.1">Register the model to Unity Catalog, setting the alias </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.453.1">Champion</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.455.1">Note that this notebook shows a simplified model training, which is sufficient to illustrate the training step in the example in this chapter. </span><span class="koboSpan" id="kobo.455.2">It does not include the full model experimentation process and hyperparameter tuning, which we covered in </span><a href="B18568_07.xhtml#_idTextAnchor133"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.456.1">Chapter 7</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.457.1">.</span></span></p>
<h2 id="_idParaDest-199"><a id="_idTextAnchor200"/><span class="koboSpan" id="kobo.458.1">Training with AutoML</span></h2>
<p><span class="koboSpan" id="kobo.459.1">Another approach to model training is to use Databricks AutoML to find the best model for the </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">given dataset.</span></span></p>
<p><span class="koboSpan" id="kobo.461.1">AutoML is </span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.462.1">a feature within Databricks that automates the process </span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.463.1">of developing ML models. </span><span class="koboSpan" id="kobo.463.2">It has tasks such as data profiling, feature engineering, model selection, and hyperparameter tuning. </span><span class="koboSpan" id="kobo.463.3">This enables users to quickly generate baseline models for regression, classification, and forecasting problems. </span><span class="koboSpan" id="kobo.463.4">With its “glass box” approach, AutoML provides the underlying code for each model, which differs from “black box” approaches that do not show the code details. </span><span class="koboSpan" id="kobo.463.5">AutoML can be used from the UI, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.464.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.465.1">.6</span></em><span class="koboSpan" id="kobo.466.1">, or programmatically, as in the example provided in </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">this chapter.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer163">
<span class="koboSpan" id="kobo.468.1"><img alt="" src="image/B18568_10_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.469.1">Figure 10.6: Databricks AutoML</span></p>
<p><span class="koboSpan" id="kobo.470.1">You can </span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.471.1">find more information on </span><span class="No-Break"><span class="koboSpan" id="kobo.472.1">AutoML here:</span></span></p>
<p><a href="https://www.databricks.com/product/automl"><span class="No-Break"><span class="koboSpan" id="kobo.473.1">https://www.databricks.com/product/automl</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.474.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.475.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.476.1">ts-spark_ch10_1b_ingest_and_train_automl</span></strong><span class="koboSpan" id="kobo.477.1"> job is an example of how to </span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.478.1">include AutoML programmatically in the training task. </span><span class="koboSpan" id="kobo.478.2">The code </span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.479.1">for this task is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">ts_spark_ch10_model_training_automl</span></strong><span class="koboSpan" id="kobo.481.1"> notebook. </span><span class="koboSpan" id="kobo.481.2">The steps are </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.483.1">Read the features </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.485.1">features_aggr_power_consumption</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.486.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.487.1">Call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">databricks.automl.forecast</span></strong><span class="koboSpan" id="kobo.489.1"> function, which takes care of renaming the columns, starting an MLflow run to track the training, and finding the best model for forecasting based on the specified </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">primary_metric</span></strong><span class="koboSpan" id="kobo.491.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">mdape</span></strong><span class="koboSpan" id="kobo.493.1"> is used in </span><span class="No-Break"><span class="koboSpan" id="kobo.494.1">the example).</span></span></li>
<li><span class="koboSpan" id="kobo.495.1">Register the model to Unity Catalog, setting the alias </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.497.1">Champion</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.499.1">The configuration for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">ts_spark_ch10_1b_ingest_and_train_automl</span></strong><span class="koboSpan" id="kobo.501.1"> job is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.502.1">Table 10.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table003">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.504.1">Job (optional)</span></strong></span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">ts_spark_ch10_1b_ingest_and_train_automl</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.506.1">Task 1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.507.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">ts_spark_ch10_reset</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.509.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.510.1">Notebook</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.511.1">Source</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.512.1">Workspace</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.513.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.514.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_reset</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.516.1">Compute</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.517.1">Serverless</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.518.1">Task 2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.519.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.521.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.522.1">Pipeline</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.523.1">Pipeline</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.525.1">Trigger a full refresh on </span><span class="No-Break"><span class="koboSpan" id="kobo.526.1">the pipeline</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.527.1">R</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.528.1">Depends on</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">ts_spark_ch10_reset</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.530.1">Task 3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.531.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">ts_spark_ch10_model_training_automl</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.533.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.534.1">Notebook</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.535.1">Source</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.536.1">Workspace</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.537.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_model_training_automl</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.540.1">Compute</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.541.1">*Refer to the earlier section on clusters to choose </span><span class="No-Break"><span class="koboSpan" id="kobo.542.1">the compute</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.543.1">Depends on</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.545.1">Table 10.3: Job configuration – ts_spark_ch10_1b_ingest_and_train_automl</span></p>
<p><span class="koboSpan" id="kobo.546.1">Note that </span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.547.1">in addition to simplifying the steps compared to </span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.548.1">the previous training approach without AutoML, we also get to find the </span><span class="No-Break"><span class="koboSpan" id="kobo.549.1">best model.</span></span></p>
<h2 id="_idParaDest-200"><a id="_idTextAnchor201"/><span class="koboSpan" id="kobo.550.1">Ingest and forecast</span></h2>
<p><span class="koboSpan" id="kobo.551.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">Tasks</span></strong><span class="koboSpan" id="kobo.553.1"> part </span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.554.1">of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">ts-spark_ch10_2b_ingest_and_forecast</span></strong><span class="koboSpan" id="kobo.556.1"> job, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.557.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.558.1">.3</span></em><span class="koboSpan" id="kobo.559.1">, will be detailed in </span><span class="No-Break"><span class="koboSpan" id="kobo.560.1">this section.</span></span></p>
<p><span class="koboSpan" id="kobo.561.1">The configuration for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">ts_spark_ch10_2b_ingest_and_forecast</span></strong><span class="koboSpan" id="kobo.563.1"> job is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.564.1">Table 10.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table004">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.566.1">Job</span></strong></span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">ts_spark_ch10_2b_ingest_and_forecast</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.568.1">Job parameters</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.569.1">Key: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">upd_iter</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.571.1">Value: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">1</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.573.1">Task 1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.574.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.576.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.577.1">Pipeline</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.578.1">Pipeline</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.580.1">Trigger a full refresh on </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">the pipeline</span></span></p>
</td>
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.582.1">R</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.583.1">Task 2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.584.1">Task </span></span><span class="No-Break"><a id="_idIndexMarker851"/></span><span class="No-Break"><span class="koboSpan" id="kobo.585.1">name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">ts_spark_ch10_update_model</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.587.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.588.1">Notebook</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.589.1">Source</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.590.1">Workspace</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.591.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_update_model</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.594.1">Compute</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.595.1">Serverless</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.596.1">Depends on</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">ts_spark_ch10_dlt_features</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.598.1">Task 3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.599.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">ts_spark_ch10_generate_forecast</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.601.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.602.1">Notebook</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.603.1">Source</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.604.1">Workspace</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.605.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.606.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_generate_forecast</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.608.1">Compute</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.609.1">Serverless</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.610.1">Depends on</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.611.1">ts_spark_ch10_update_model</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.612.1">Task 4</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.613.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">ts_spark_ch10_update_data</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.615.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.616.1">Notebook</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.617.1">Source</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.618.1">Workspace</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.619.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_update_data</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.622.1">Compute</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.623.1">Serverless</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.624.1">Depends on</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.625.1">ts_spark_ch10_generate_forecast</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.626.1">Task 5</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.627.1">Task </span></span><span class="No-Break"><a id="_idIndexMarker852"/></span><span class="No-Break"><span class="koboSpan" id="kobo.628.1">name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">ts_spark_ch10_evaluate_forecast</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.630.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.631.1">Notebook</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.632.1">Source</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.633.1">Workspace</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.634.1">Path (notebook)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.635.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">Workspace/Users/&lt;USER_LOGIN&gt;/ts-spark/ch10/ts_spark_ch10_ evaluate_forecast</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.637.1">Compute</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.638.1">Serverless</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.639.1">Depends on</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">ts_spark_ch10_update_data</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.641.1">Table 10.4: Job configuration – ts_spark_ch10_2b_ingest_and_forecast</span></p>
<h3><span class="koboSpan" id="kobo.642.1">dlt_features</span></h3>
<p><span class="koboSpan" id="kobo.643.1">This task </span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.644.1">is the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.645.1">ts_spark_ch10_dlt_features</span></strong><span class="koboSpan" id="kobo.646.1"> DLT pipeline, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.647.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.648.1">.5</span></em><span class="koboSpan" id="kobo.649.1">, as used in the earlier </span><em class="italic"><span class="koboSpan" id="kobo.650.1">Ingest and train</span></em><span class="koboSpan" id="kobo.651.1"> section, where it was used to process historical data. </span><span class="koboSpan" id="kobo.651.2">The difference is here we will be calling this pipeline to process new data files from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">vol01_upd</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.653.1"> volume.</span></span></p>
<h3><span class="koboSpan" id="kobo.654.1">update_model</span></h3>
<p><span class="koboSpan" id="kobo.655.1">This task </span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.656.1">is used to train a Prophet model using the features calculated in the prior </span><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">dlt_features</span></strong><span class="koboSpan" id="kobo.658.1"> task. </span><span class="koboSpan" id="kobo.658.2">The code for </span><strong class="source-inline"><span class="koboSpan" id="kobo.659.1">update_model</span></strong><span class="koboSpan" id="kobo.660.1"> is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">ts_spark_ch10_update_model</span></strong><span class="koboSpan" id="kobo.662.1"> notebook. </span><span class="koboSpan" id="kobo.662.2">This task is similar to the task discussed in the </span><em class="italic"><span class="koboSpan" id="kobo.663.1">model_training</span></em><span class="koboSpan" id="kobo.664.1"> section, the difference being that we now have new data to include in the training. </span><span class="koboSpan" id="kobo.664.2">The steps are </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.666.1">Read the features </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">features_aggr_power_consumption</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.669.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.670.1">Rename the </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">Date</span></strong><span class="koboSpan" id="kobo.672.1"> column to </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">ds</span></strong><span class="koboSpan" id="kobo.674.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">hourly_Global_active_power</span></strong><span class="koboSpan" id="kobo.676.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.677.1">y</span></strong><span class="koboSpan" id="kobo.678.1">. </span><span class="koboSpan" id="kobo.678.2">These column names are required </span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">by Prophet.</span></span></li>
<li><span class="koboSpan" id="kobo.680.1">Fit the Prophet model to </span><span class="No-Break"><span class="koboSpan" id="kobo.681.1">the dataset.</span></span></li>
<li><span class="koboSpan" id="kobo.682.1">Register the model to Unity Catalog, setting the alias </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.684.1">Champion</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.685.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.686.1">With the latest model updated, we can use it to </span><span class="No-Break"><span class="koboSpan" id="kobo.687.1">forecast next.</span></span></p>
<h3><span class="koboSpan" id="kobo.688.1">generate_forecast</span></h3>
<p><span class="koboSpan" id="kobo.689.1">This task </span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.690.1">uses the previously trained model to generate and store forecasts. </span><span class="koboSpan" id="kobo.690.2">The code for </span><strong class="source-inline"><span class="koboSpan" id="kobo.691.1">generate_forecast</span></strong><span class="koboSpan" id="kobo.692.1"> is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.693.1">ts_spark_ch10_generate_forecast</span></strong><span class="koboSpan" id="kobo.694.1"> notebook. </span><span class="koboSpan" id="kobo.694.2">The steps are </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.696.1">Load the </span><strong class="source-inline"><span class="koboSpan" id="kobo.697.1">Champion</span></strong><span class="koboSpan" id="kobo.698.1"> model from </span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">Unity Catalog.</span></span></li>
<li><span class="koboSpan" id="kobo.700.1">Generate a forecast for the next </span><span class="No-Break"><span class="koboSpan" id="kobo.701.1">24 hours.</span></span></li>
<li><span class="koboSpan" id="kobo.702.1">Store the forecasts, together with the model’s name and version, in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">forecast</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.704.1"> table.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.705.1">With the forecast generated, we can compare the forecasted time period against the actuals, which we will </span><span class="No-Break"><span class="koboSpan" id="kobo.706.1">get next.</span></span></p>
<h3><span class="koboSpan" id="kobo.707.1">update_data</span></h3>
<p><span class="koboSpan" id="kobo.708.1">This task </span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.709.1">simply copies the data file for the new time period from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.710.1">vol01_upd_src</span></strong><span class="koboSpan" id="kobo.711.1"> volume to </span><strong class="source-inline"><span class="koboSpan" id="kobo.712.1">vol01_upd</span></strong><span class="koboSpan" id="kobo.713.1">. </span><span class="koboSpan" id="kobo.713.2">The code for </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">update_data</span></strong><span class="koboSpan" id="kobo.715.1"> is in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">ts_spark_ch10_update_data</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.717.1"> notebook.</span></span></p>
<h3><span class="koboSpan" id="kobo.718.1">evaluate_forecast</span></h3>
<p><span class="koboSpan" id="kobo.719.1">This </span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.720.1">task calculates and stores the forecasting accuracy metrics. </span><span class="koboSpan" id="kobo.720.2">The code for </span><strong class="source-inline"><span class="koboSpan" id="kobo.721.1">evaluate_forecast</span></strong><span class="koboSpan" id="kobo.722.1"> is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.723.1">ts_spark_ch10_evaluate_forecast</span></strong><span class="koboSpan" id="kobo.724.1"> notebook. </span><span class="koboSpan" id="kobo.724.2">The steps are </span><span class="No-Break"><span class="koboSpan" id="kobo.725.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.726.1">Join the </span><strong class="source-inline"><span class="koboSpan" id="kobo.727.1">features_aggr_power_consumption</span></strong><span class="koboSpan" id="kobo.728.1"> actuals table to the previously created </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">forecast</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.730.1"> table.</span></span></li>
<li><span class="koboSpan" id="kobo.731.1">Calculate the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.732.1">mdape</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.733.1"> metrics.</span></span></li>
<li><span class="koboSpan" id="kobo.734.1">Store the calculated metrics with the model’s name and version in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">forecast_metrics</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.736.1"> table.</span></span></li>
<li><span class="koboSpan" id="kobo.737.1">Store the data quality check results in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.738.1">dq_results</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.739.1"> table.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.740.1">With the forecast evaluated, we can report on the outcome and metrics. </span><span class="koboSpan" id="kobo.740.2">We will cover this in the </span><em class="italic"><span class="koboSpan" id="kobo.741.1">User interface</span></em><span class="koboSpan" id="kobo.742.1"> section. </span><span class="koboSpan" id="kobo.742.2">Before we get to this, let’s detail how we will orchestrate the multiple iterations of new data arrival and </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1">corresponding processing.</span></span></p>
<h2 id="_idParaDest-201"><a id="_idTextAnchor202"/><span class="koboSpan" id="kobo.744.1">Updating iterations</span></h2>
<p><span class="koboSpan" id="kobo.745.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.746.1">ts-spark_ch10_2a_update_iteration</span></strong><span class="koboSpan" id="kobo.747.1"> job, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.748.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.749.1">.4</span></em><span class="koboSpan" id="kobo.750.1">, simulates </span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.751.1">what happens in the real world whereby we have new data to process at a regular interval, say, daily or weekly. </span><span class="koboSpan" id="kobo.751.2">It calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.752.1">ts-spark_ch10_2b_ingest_and_forecast</span></strong><span class="koboSpan" id="kobo.753.1"> job seven times, corresponding to one week of daily new data. </span><span class="koboSpan" id="kobo.753.2">Every call results in the end-to-end processing of a new data file, as described in the previous </span><em class="italic"><span class="koboSpan" id="kobo.754.1">Ingest and </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.755.1">forecast</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.756.1"> section.</span></span></p>
<p><span class="koboSpan" id="kobo.757.1">The configuration for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.758.1">ts_spark_ch10_2a_update_iterations</span></strong><span class="koboSpan" id="kobo.759.1"> job is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.760.1">Table 10.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.761.1">.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table005">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.762.1">Job</span></strong></span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.763.1">ts_spark_ch10_2a_update_iterations</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.764.1">Task 1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.765.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.766.1">ts_spark_ch10_update_iterations</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.767.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.768.1">For each</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.769.1">Inputs</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.770.1">[</span><span class="No-Break"><span class="koboSpan" id="kobo.771.1">1,2,3,4,5,6,7]</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.772.1">Task 2 (Add a task to </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.773.1">loop over)</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.774.1">Task name</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.775.1">ts_spark_ch10_update_iterations_iteration</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.776.1">Type</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.777.1">Run Job</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.778.1">Job</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.779.1">ts_spark_ch10_2b_ingest_and_forecast</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.780.1">Job Parameters</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.781.1">Key: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.782.1">upd_iter</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.783.1">Value: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.784.1">{{input}}</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.785.1">Table 10.5: Job configuration – ts_spark_ch10_2a_update_iterations</span></p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor203"/><span class="koboSpan" id="kobo.786.1">Starting the jobs</span></h2>
<p><span class="koboSpan" id="kobo.787.1">With the </span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.788.1">jobs configured and explained, we will now start these jobs, which will execute the code for this chapter. </span><span class="koboSpan" id="kobo.788.2">You can find more information on running </span><span class="No-Break"><span class="koboSpan" id="kobo.789.1">jobs here:</span></span></p>
<p><a href="https://docs.databricks.com/en/jobs/run-now.html"><span class="No-Break"><span class="koboSpan" id="kobo.790.1">https://docs.databricks.com/en/jobs/run-now.html</span></span></a></p>
<p><span class="koboSpan" id="kobo.791.1">Proceed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.792.1">following order:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.793.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.794.1">Run Now</span></strong><span class="koboSpan" id="kobo.795.1"> for </span><strong class="source-inline"><span class="koboSpan" id="kobo.796.1">ts-spark_ch10_1a_ingest_and_train</span></strong><span class="koboSpan" id="kobo.797.1">. </span><span class="koboSpan" id="kobo.797.2">Wait for the job </span><span class="No-Break"><span class="koboSpan" id="kobo.798.1">to complete.</span></span></li>
<li><span class="koboSpan" id="kobo.799.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.800.1">Run Now</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.801.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.802.1">ts-spark_ch10_2a_update_iteration</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.803.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.804.1">With the jobs launched and executed, we can review their status, as will be explained in the </span><span class="No-Break"><span class="koboSpan" id="kobo.805.1">next section.</span></span></p>
<h1 id="_idParaDest-203"><a id="_idTextAnchor204"/><span class="koboSpan" id="kobo.806.1">Monitoring, security, and governance</span></h1>
<p><span class="koboSpan" id="kobo.807.1">As we discussed in </span><a href="B18568_04.xhtml#_idTextAnchor087"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.808.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.809.1"> in the </span><em class="italic"><span class="koboSpan" id="kobo.810.1">From DataOps to ModelOps to DevOps</span></em><span class="koboSpan" id="kobo.811.1"> section and in </span><a href="B18568_09.xhtml#_idTextAnchor169"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.812.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.813.1"> in the </span><em class="italic"><span class="koboSpan" id="kobo.814.1">Governance and security</span></em><span class="koboSpan" id="kobo.815.1"> section, a key requirement for workloads in a production environment and with sensitive data is to have proper monitoring, security, and governance in place. </span><span class="koboSpan" id="kobo.815.2">This is greatly facilitated by leveraging the built-in functionalities of a managed platform such as Databricks with Unity Catalog. </span><span class="koboSpan" id="kobo.815.3">The alternative approach, if we were to develop and test our own custom-built platform, requires considerable time and effort to robustly meet </span><span class="No-Break"><span class="koboSpan" id="kobo.816.1">these requirements.</span></span></p>
<h2 id="_idParaDest-204"><a id="_idTextAnchor205"/><span class="koboSpan" id="kobo.817.1">Monitoring</span></h2>
<p><span class="koboSpan" id="kobo.818.1">The monitoring </span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.819.1">of the jobs can be done from the </span><strong class="bold"><span class="koboSpan" id="kobo.820.1">Workflows</span></strong><span class="koboSpan" id="kobo.821.1"> &gt; </span><strong class="bold"><span class="koboSpan" id="kobo.822.1">Jobs</span></strong><span class="koboSpan" id="kobo.823.1"> &gt; </span><strong class="bold"><span class="koboSpan" id="kobo.824.1">Runs</span></strong><span class="koboSpan" id="kobo.825.1"> page, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.826.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.827.1">.7</span></em><span class="koboSpan" id="kobo.828.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1">ts-spark_ch10_2b_ingest_and_forecast</span></strong><span class="koboSpan" id="kobo.830.1"> job. </span><span class="koboSpan" id="kobo.830.2">We can see the different runs, their parameters, durations, and statuses, among other information useful </span><span class="No-Break"><span class="koboSpan" id="kobo.831.1">for monitoring.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer164">
<span class="koboSpan" id="kobo.832.1"><img alt="" src="image/B18568_10_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.833.1">Figure 10.7: Databricks Workflows – Jobs – Runs</span></p>
<p><span class="koboSpan" id="kobo.834.1">The monitoring of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.835.1">ts_spark_ch10_dlt_features</span></strong><span class="koboSpan" id="kobo.836.1"> DLT pipeline can be done from the </span><strong class="bold"><span class="koboSpan" id="kobo.837.1">Workflows</span></strong><span class="koboSpan" id="kobo.838.1"> &gt; </span><strong class="bold"><span class="koboSpan" id="kobo.839.1">Pipelines</span></strong><span class="koboSpan" id="kobo.840.1"> page, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.841.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.842.1">.8</span></em><span class="koboSpan" id="kobo.843.1">. </span><span class="koboSpan" id="kobo.843.2">We can see the different </span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.844.1">stages, data checks, durations, and statuses, among other information useful </span><span class="No-Break"><span class="koboSpan" id="kobo.845.1">for monitoring.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer165">
<span class="koboSpan" id="kobo.846.1"><img alt="" src="image/B18568_10_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.847.1">Figure 10.8: Databricks DLT pipelines</span></p>
<p><span class="koboSpan" id="kobo.848.1">You can </span><a id="_idIndexMarker862"/><span class="koboSpan" id="kobo.849.1">find more information on observability, monitoring, and alerting  </span><a id="_idIndexMarker863"/><span class="No-Break"><span class="koboSpan" id="kobo.850.1">here:</span></span></p>
<ul>
<li><a href="https://docs.databricks.com/en/delta-live-tables/observability.html"><span class="No-Break"><span class="koboSpan" id="kobo.851.1">https://docs.databricks.com/en/delta-live-tables/observability.html</span></span></a></li>
<li><a href="https://www.databricks.com/blog/lakehouse-monitoring-unified-solution-quality-data-and-ai"><span class="No-Break"><span class="koboSpan" id="kobo.852.1">https://www.databricks.com/blog/lakehouse-monitoring-unified-solution-quality-data-and-ai</span></span></a></li>
<li><a href="https://docs.databricks.com/en/lakehouse-monitoring/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.853.1">https://docs.databricks.com/en/lakehouse-monitoring/index.html</span></span></a></li>
<li><a href="https://docs.databricks.com/aws/en/lakehouse-monitoring/monitor-alerts"><span class="No-Break"><span class="koboSpan" id="kobo.854.1">https://docs.databricks.com/aws/en/lakehouse-monitoring/monitor-alerts</span></span></a></li>
</ul>
<h2 id="_idParaDest-205"><a id="_idTextAnchor206"/><span class="koboSpan" id="kobo.855.1">Security</span></h2>
<p><span class="koboSpan" id="kobo.856.1">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.857.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.858.1">.9</span></em><span class="koboSpan" id="kobo.859.1">, setting access </span><a id="_idIndexMarker864"/><span class="koboSpan" id="kobo.860.1">permissions to tables and other objects requires just a few clicks when using </span><span class="No-Break"><span class="koboSpan" id="kobo.861.1">Unity Catalog.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer166">
<span class="koboSpan" id="kobo.862.1"><img alt="" src="image/B18568_10_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.863.1">Figure 10.9: Databricks Unity Catalog – setting permission</span></p>
<p><span class="koboSpan" id="kobo.864.1">It is also </span><a id="_idIndexMarker865"/><span class="koboSpan" id="kobo.865.1">possible to define fine-grained access control at a more granular row or column level within tables, as per the </span><span class="No-Break"><span class="koboSpan" id="kobo.866.1">following resources:</span></span></p>
<p><a href="https://www.databricks.com/resources/demos/videos/governance/access-controls-with-unity-catalog"><span class="No-Break"><span class="koboSpan" id="kobo.867.1">https://www.databricks.com/resources/demos/videos/governance/access-controls-with-unity-catalog</span></span></a></p>
<p><span class="koboSpan" id="kobo.868.1">You can </span><a id="_idIndexMarker866"/><span class="koboSpan" id="kobo.869.1">find more information on </span><span class="No-Break"><span class="koboSpan" id="kobo.870.1">security here:</span></span></p>
<p><a href="https://docs.databricks.com/en/security/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.871.1">https://docs.databricks.com/en/security/index.html</span></span></a></p>
<h2 id="_idParaDest-206"><a id="_idTextAnchor207"/><span class="koboSpan" id="kobo.872.1">Governance</span></h2>
<p><span class="koboSpan" id="kobo.873.1">An important </span><a id="_idIndexMarker867"/><span class="koboSpan" id="kobo.874.1">consideration for governance is being able to track the lineage of data assets, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.875.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.876.1">.10</span></em><span class="koboSpan" id="kobo.877.1">. </span><span class="koboSpan" id="kobo.877.2">We can see here the source of the data, the multiple intermediate stages, and the final tables where the data is stored. </span><span class="koboSpan" id="kobo.877.3">Unity Catalog tracks this automatically in Databricks to give us real-time visibility into the </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">data flows.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer167">
<span class="koboSpan" id="kobo.879.1"><img alt="" src="image/B18568_10_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.880.1">Figure 10.10: Databricks Unity Catalog – lineage view</span></p>
<p><span class="koboSpan" id="kobo.881.1">You can find and zoom in on a digital version of </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.882.1">Figure </span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.883.1">10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.884.1">.10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.885.1"> here:</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.886.1">https://packt.link/D6DyC</span></span></p>
<p><span class="koboSpan" id="kobo.887.1">We have </span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.888.1">touched only briefly on governance and security with Databricks Unity Catalog. </span><span class="koboSpan" id="kobo.888.2">You can find more </span><span class="No-Break"><span class="koboSpan" id="kobo.889.1">information here:</span></span></p>
<p><a href="https://www.databricks.com/product/unity-catalog"><span class="No-Break"><span class="koboSpan" id="kobo.890.1">https://www.databricks.com/product/unity-catalog</span></span></a></p>
<p><span class="koboSpan" id="kobo.891.1">With an </span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.892.1">understanding of how to leverage a platform such as Databricks for monitoring, security, and governance, we will next uncover how to present the outcome of time </span><span class="No-Break"><span class="koboSpan" id="kobo.893.1">series analysis.</span></span></p>
<h1 id="_idParaDest-207"><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.894.1">Databricks UI — AI/BI dashboards</span></h1>
<p><span class="koboSpan" id="kobo.895.1">When it comes to presenting the outcome of the time series analysis we have done so far, Databricks </span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.896.1">provides a few options for the user interface with AI/BI dashboards, Genie spaces, AI-based chatbots, and Lakehouse Apps. </span><span class="koboSpan" id="kobo.896.2">We will cover AI/BI dashboards in this section and the other options in the </span><span class="No-Break"><span class="koboSpan" id="kobo.897.1">next chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.898.1">We have been using various graphs extensively throughout this book to represent data and the outcome of analysis. </span><span class="koboSpan" id="kobo.898.2">This has required us to execute code in notebooks to create the graphs. </span><span class="koboSpan" id="kobo.898.3">This works well when we are able to write code and have an execution environment. </span><span class="koboSpan" id="kobo.898.4">When this is not the case, a common way to present the data and the outcome of the analysis is with a reporting dashboard. </span><span class="koboSpan" id="kobo.898.5">This is possible with Databricks AI/BI dashboards, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.899.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.900.1">.11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.901.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.902.1">The Databricks AI/BI dashboard is a solution integrated into the Databricks platform to create reports </span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.903.1">and dashboards. </span><span class="koboSpan" id="kobo.903.2">It has AI-powered capabilities to assist with the creation of queries and data visualizations. </span><span class="koboSpan" id="kobo.903.3">The dashboards can be published and shared </span><span class="No-Break"><span class="koboSpan" id="kobo.904.1">for consumption.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer168">
<span class="koboSpan" id="kobo.905.1"><img alt="" src="image/B18568_10_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.906.1">Figure 10.11: Databricks AI/BI dashboard</span></p>
<p><span class="koboSpan" id="kobo.907.1">To install this dashboard in your own environment, first, download it from the </span><span class="No-Break"><span class="koboSpan" id="kobo.908.1">following location:</span></span></p>
<p><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/blob/main/ch10/ts_spark_ch10.lvdash.json"><span class="No-Break"><span class="koboSpan" id="kobo.909.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/blob/main/ch10/ts_spark_ch10.lvdash.json</span></span></a></p>
<p><span class="koboSpan" id="kobo.910.1">The dashboard file can then be imported into your own environment by following the </span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">instructions here:</span></span></p>
<p><a href="https://docs.databricks.com/en/dashboards/index.html#import-a-dashboard-file"><span class="No-Break"><span class="koboSpan" id="kobo.912.1">https://docs.databricks.com/en/dashboards/index.html#import-a-dashboard-file</span></span></a></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.913.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.914.1">You will need a SQL Warehouse in order to run the dashboard. </span><span class="koboSpan" id="kobo.914.2">Refer to the following instructions to create a </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1">SQL Warehouse:</span></span></p>
<p class="callout"><a href="https://docs.databricks.com/aws/en/compute/sql-warehouse/create"><span class="No-Break"><span class="koboSpan" id="kobo.916.1">https://docs.databricks.com/aws/en/compute/sql-warehouse/create</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.917.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.918.1">In this dashboard, we have brought together, in a combined view, </span><span class="No-Break"><span class="koboSpan" id="kobo.919.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.920.1">Graph of the actual and </span><span class="No-Break"><span class="koboSpan" id="kobo.921.1">forecasted values</span></span></li>
<li><span class="koboSpan" id="kobo.922.1">Number of records that failed and passed the data </span><span class="No-Break"><span class="koboSpan" id="kobo.923.1">quality checks</span></span></li>
<li><span class="koboSpan" id="kobo.924.1">Metrics for different </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1">model versions</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.926.1">You can </span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.927.1">find more information on AI/BI dashboards at the </span><span class="No-Break"><span class="koboSpan" id="kobo.928.1">following links:</span></span></p>
<ul>
<li><a href="https://www.databricks.com/blog/introducing-aibi-intelligent-analytics-real-world-data"><span class="No-Break"><span class="koboSpan" id="kobo.929.1">https://www.databricks.com/blog/introducing-aibi-intelligent-analytics-real-world-data</span></span></a></li>
<li><a href="https://docs.databricks.com/en/dashboards/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.930.1">https://docs.databricks.com/en/dashboards/index.html</span></span></a></li>
</ul>
<h1 id="_idParaDest-208"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.931.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.932.1">With the end-to-end example of time series analysis on a managed Spark platform, this chapter has shown how to leverage the out-of-the-box features of Databricks to go further with Apache Spark. </span><span class="koboSpan" id="kobo.932.2">We have gone from data ingestion with a streaming pipeline to feature engineering and model training and to inferencing and reporting while ensuring that monitoring, security, and governance are in place. </span><span class="koboSpan" id="kobo.932.3">By combining pre-built features on Databricks with our own custom code, we were able to implement a solution that can be extended to further </span><span class="No-Break"><span class="koboSpan" id="kobo.933.1">use cases.</span></span></p>
<p><span class="koboSpan" id="kobo.934.1">This brings us to our last chapter, where we will expand on some of the recent developments in time </span><span class="No-Break"><span class="koboSpan" id="kobo.935.1">series analysis.</span></span></p>
<h1 id="_idParaDest-209"><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.936.1">Join our community on Discord</span></h1>
<p><span class="koboSpan" id="kobo.937.1">Join our community’s Discord space for discussions with the authors and </span><span class="No-Break"><span class="koboSpan" id="kobo.938.1">other readers:</span></span></p>
<p><a href="https://packt.link/ds"><span class="No-Break"><span class="koboSpan" id="kobo.939.1">https://packt.link/ds</span></span></a></p>
<div>
<div class="IMG---Figure" id="_idContainer169">
<span class="koboSpan" id="kobo.940.1"><img alt="" src="image/ds_(1).jpg"/></span>
</div>
</div>
</div>
</body></html>