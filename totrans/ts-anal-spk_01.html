<html><head></head><body>
<div id="_idContainer027">
<h1 class="chapter-number" id="_idParaDest-17"><a id="_idTextAnchor016"/><span class="koboSpan" id="kobo.1.1">1</span></h1>
<h1 id="_idParaDest-18"><a id="_idTextAnchor017"/><span class="koboSpan" id="kobo.2.1">What Are Time Series?</span></h1>
<p class="author-quote"><span class="koboSpan" id="kobo.3.1">“Time is the wisest counselor of all.” </span><span class="koboSpan" id="kobo.3.2">– Pericles</span></p>
<p><span class="koboSpan" id="kobo.4.1">History is fascinating. </span><span class="koboSpan" id="kobo.4.2">It offers a profound narrative of our origins, the journey we are on, and the destination we strive toward. </span><span class="koboSpan" id="kobo.4.3">History equips us with learnings from the past to better face </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">the future.</span></span></p>
<p><span class="koboSpan" id="kobo.6.1">Let’s take, for example, the impact of meteorological data on history. </span><span class="koboSpan" id="kobo.6.2">Disruptions in weather patterns, starting in the Middle Ages and worsened by the Laki volcanic eruption in 1783, caused widespread hardship in France. </span><span class="koboSpan" id="kobo.6.3">This climatic upheaval contributed to the social unrest that ultimately led to the French Revolution in 1789. </span><span class="koboSpan" id="kobo.6.4">(Find out more about this in the </span><em class="italic"><span class="koboSpan" id="kobo.7.1">Further </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.8.1">reading </span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">section.)</span></span></p>
<p><span class="koboSpan" id="kobo.10.1">Time series embody this narrative with numbers echoing our past. </span><strong class="bold"><span class="koboSpan" id="kobo.11.1">They are history quantified</span></strong><span class="koboSpan" id="kobo.12.1">, a numerical narrative of our collective past, with lessons for </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">the future.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1">This book takes you on a comprehensive journey with time series, starting with foundational concepts, guiding you through practical data preparation and model building techniques, and culminating in advanced topics such as scaling, and deploying to production, while staying abreast of recent developments for cutting-edge applications across industries. </span><span class="koboSpan" id="kobo.14.2">By the end of this book, you will be equipped to build robust time series models, in combination with Apache Spark, to meet the requirements of the use cases in </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">your industry.</span></span></p>
<p><span class="koboSpan" id="kobo.16.1">As a start on this journey, this chapter introduces the fundamental concepts of time series data, exploring its sequential nature and the unique challenges it poses. </span><span class="koboSpan" id="kobo.16.2">The content covers key components such as trend and seasonality, providing a foundation to embark on time series analysis at scale using the Spark framework. </span><span class="koboSpan" id="kobo.16.3">This knowledge is crucial for data scientists and analysts as it forms the basis for leveraging Spark’s distributed computing capabilities in effectively analyzing and forecasting time-dependent data and making informed decisions in various domains such as finance, healthcare, </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">and marketing.</span></span></p>
<p><span class="koboSpan" id="kobo.18.1">We will cover the following topics in </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.20.1">Introduction to </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">time series</span></span></li>
<li><span class="koboSpan" id="kobo.22.1">Breaking time series into </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">their components</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">Additional considerations with time </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">series analysis</span></span></li>
</ul>
<h1 id="_idParaDest-19"><a id="_idTextAnchor018"/><span class="koboSpan" id="kobo.26.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.27.1">In the first part of the book, which sets the foundations, you can follow along without participating in hands-on examples (although it’s recommended). </span><span class="koboSpan" id="kobo.27.2">The latter part of the book will be more practice-driven. </span><span class="koboSpan" id="kobo.27.3">If you want to get hands-on from the beginning, the code for this chapter can be found in the GitHub repository of this </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">book at:</span></span></p>
<p><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/tree/main/ch1"><span class="No-Break"><span class="koboSpan" id="kobo.29.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/tree/main/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.30.1">ch1</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.31.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.32.1">Refer to this GitHub repository for the latest revisions of the code, which will be commented on if updated post-publication. </span><span class="koboSpan" id="kobo.32.2">The updated code (if any) might differ from what is presented in the book's </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">code sections.</span></span></p>
<p><span class="koboSpan" id="kobo.34.1">The following hands-on sections will give you further details to get started with time </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">series analysis.</span></span></p>
<h1 id="_idParaDest-20"><a id="_idTextAnchor019"/><span class="koboSpan" id="kobo.36.1">Introduction to time series</span></h1>
<p><span class="koboSpan" id="kobo.37.1">In this section, we will </span><a id="_idIndexMarker000"/><span class="koboSpan" id="kobo.38.1">develop an understanding of what time series are and some related terms. </span><span class="koboSpan" id="kobo.38.2">This will be illustrated by hands-on examples to visualize time series. </span><span class="koboSpan" id="kobo.38.3">We will look at different types of time series and what characterizes them. </span><span class="koboSpan" id="kobo.38.4">This knowledge of the nature of time series is necessary for us to choose the appropriate time series analysis approach in the </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">upcoming chapters.</span></span></p>
<p><span class="koboSpan" id="kobo.40.1">Let’s start with an example of a time series with the average temperature in Mauritius every year since 1950. </span><span class="koboSpan" id="kobo.40.2">A short sample of the data is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.41.1">Table 1.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-1">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.43.1">Year</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.44.1">Average temperature</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.45.1">1950</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.46.1">22.66</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.47.1">1951</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.48.1">22.35</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.49.1">1952</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.50.1">22.50</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.51.1">1953</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.52.1">22.71</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.53.1">1954</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.54.1">22.61</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.55.1">1955</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.56.1">22.40</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.57.1">1956</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.58.1">22.22</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.59.1">1957</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.60.1">22.53</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.61.1">1958</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.62.1">22.71</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.63.1">1959</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.64.1">22.49</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.65.1">Table 1.1: Sample time series data – average temperature</span></p>
<p><span class="koboSpan" id="kobo.66.1">While visualizing </span><a id="_idIndexMarker001"/><span class="koboSpan" id="kobo.67.1">and explaining this example, we will be introduced to some terms related to time series. </span><span class="koboSpan" id="kobo.67.2">The code to visualize this dataset is covered in the hands-on section of </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.69.1">In </span><em class="italic"><span class="koboSpan" id="kobo.70.1">the following figure</span></em><span class="koboSpan" id="kobo.71.1">, we see the change in temperature over the years since 1950. </span><span class="koboSpan" id="kobo.71.2">If we focus on the period after 1980, we can observe the variations more closely, with similarly increasing temperatures over the years (trend – shown with a dashed line in both figures) to the </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">current temperature.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<span class="koboSpan" id="kobo.73.1"><img alt="" src="image/B18568_01_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.74.1">Figure 1.1: Average temperature in Mauritius since 1950</span></p>
<p><span class="koboSpan" id="kobo.75.1">If the temperature continues to increase in the same way, we are heading to a warmer future, a manifestation of what is now widely accepted as global warming. </span><span class="koboSpan" id="kobo.75.2">At the same time as the </span><a id="_idIndexMarker002"/><span class="koboSpan" id="kobo.76.1">temperature has been increasing over the years, it also goes up every summer and down during the winter months (</span><strong class="bold"><span class="koboSpan" id="kobo.77.1">seasonality</span></strong><span class="koboSpan" id="kobo.78.1">). </span><span class="koboSpan" id="kobo.78.2">We will visualize this and other components of temperature time series in the hands-on section of </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.80.1">With the temperatures getting warmer over the years (</span><strong class="bold"><span class="koboSpan" id="kobo.81.1">trend</span></strong><span class="koboSpan" id="kobo.82.1">), global warming has an impact (</span><strong class="bold"><span class="koboSpan" id="kobo.83.1">causality</span></strong><span class="koboSpan" id="kobo.84.1">) on our planet and its inhabitants. </span><span class="koboSpan" id="kobo.84.2">This impact can also be represented with time series – for example, sea level or rainfall measurements. </span><span class="koboSpan" id="kobo.84.3">The consequences of global warming can be dramatic and irreversible, which further highlights the importance of understanding </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">this trend.</span></span></p>
<p><span class="koboSpan" id="kobo.86.1">These time-over-time readings of temperature form what we call a time series. </span><span class="koboSpan" id="kobo.86.2">Analysis and understanding of such a time series is critical for </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">our future.</span></span></p>
<p><span class="koboSpan" id="kobo.88.1">So, what is a time series in more general terms? </span><span class="koboSpan" id="kobo.88.2">It is simply a </span><em class="italic"><span class="koboSpan" id="kobo.89.1">chronological series of measurements together with the specific time at which it was generated by a source system</span></em><span class="koboSpan" id="kobo.90.1">. </span><span class="koboSpan" id="kobo.90.2">In the example of temperature, the source system is the thermometer at a specific </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">geographical location.</span></span></p>
<p><span class="koboSpan" id="kobo.92.1">Time series can also be represented in an aggregated form, such as the average temperature every year, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.93.1">Table 1.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.95.1">From this definition, illustrated with an example, let’s now probe further into the nature of time series. </span><span class="koboSpan" id="kobo.95.2">We will also cover in further detail in the rest of this book the terms introduced here, such as trend, seasonality, </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">and causality.</span></span></p>
<h2 id="_idParaDest-21"><a id="_idTextAnchor020"/><span class="koboSpan" id="kobo.97.1">Chronological order</span></h2>
<p><span class="koboSpan" id="kobo.98.1">At the beginning of the chapter, we mentioned chronological order while defining time series, this is because it </span><a id="_idIndexMarker003"/><span class="koboSpan" id="kobo.99.1">is a major factor that differentiates the approach when working with time series data compared to other datasets. </span><span class="koboSpan" id="kobo.99.2">One of the main reasons why order matters is due to potential auto-correlation within time series, where measurement at time </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">t</span></strong><span class="koboSpan" id="kobo.101.1"> is related to measurement at </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">n</span></strong><span class="koboSpan" id="kobo.103.1"> time steps earlier (</span><strong class="bold"><span class="koboSpan" id="kobo.104.1">lag</span></strong><span class="koboSpan" id="kobo.105.1">). </span><span class="koboSpan" id="kobo.105.2">Ignoring this order will make our analysis incomplete and even incorrect. </span><span class="koboSpan" id="kobo.105.3">We will look at the method to identify auto-correlation later, in </span><a href="B18568_06.xhtml#_idTextAnchor116"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.106.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.107.1"> on exploratory </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">data analysis.</span></span></p>
<p><span class="koboSpan" id="kobo.109.1">It is worth noting that, in many cases with time series, auto-correlation tends to make measurements closer in time closer in value, as compared to measurements further apart </span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">in time.</span></span></p>
<p><span class="koboSpan" id="kobo.111.1">Another reason to respect chronological order is to avoid data leakage during model training. </span><span class="koboSpan" id="kobo.111.2">In some of the analysis and forecasting methods, we will be training models on past data to predict value at a future target date. </span><span class="koboSpan" id="kobo.111.3">We need to ensure that all data points used are prior to the target date. </span><span class="koboSpan" id="kobo.111.4">Data leakage during training, often tricky to spot with time series data, will invalidate the integrity of the approach and create models that perform misleadingly well during development, then not so well when faced with new </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">unseen data.</span></span></p>
<p><span class="koboSpan" id="kobo.113.1">Terms introduced here, such as auto-correlation, lags, and data leakage, will be further explained in the rest of </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">the book.</span></span></p>
<p><span class="koboSpan" id="kobo.115.1">Chronological order, discussed here, is one defining characteristic of time series. </span><span class="koboSpan" id="kobo.115.2">In the next section, we will highlight regularity or the lack of it, which is </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">another characteristic.</span></span></p>
<h2 id="_idParaDest-22"><a id="_idTextAnchor021"/><span class="koboSpan" id="kobo.117.1">Regular and irregular</span></h2>
<p><span class="koboSpan" id="kobo.118.1">Time series can be regular or irregular with regard to the interval of </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">their measurements.</span></span></p>
<p><span class="koboSpan" id="kobo.120.1">Regular time </span><a id="_idIndexMarker004"/><span class="koboSpan" id="kobo.121.1">series have values expected at regular intervals in time, say every minute, hour, month, and so on. </span><span class="koboSpan" id="kobo.121.2">This is usually the case for source systems generating a continuous value, which is then measured at a regular interval. </span><span class="koboSpan" id="kobo.121.3">This regularity is expected, but not guaranteed, as these time series can have gaps or values at zero, due to missing data points or just the measurement itself being zero. </span><span class="koboSpan" id="kobo.121.4">In this case, they will still be considered of a </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">regular nature.</span></span></p>
<p><span class="koboSpan" id="kobo.123.1">Irregular time series are when measurements are not generated at regular intervals at the source. </span><span class="koboSpan" id="kobo.123.2">This is usually the case of events occurring at irregular points in time, for which events some type of value is then measured. </span><span class="koboSpan" id="kobo.123.3">These irregular interval values can be resampled </span><a id="_idIndexMarker005"/><span class="koboSpan" id="kobo.124.1">to a regular interval with a lower frequency—effectively turning into a regular time series. </span><span class="koboSpan" id="kobo.124.2">For example, an irregular event not occurring every minute may have a likelihood of occurring every hour and be considered regular in nature at the </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">hourly rate.</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">This book will primarily focus on regular time series. </span><span class="koboSpan" id="kobo.126.2">After the regularity of time series, another characteristic we will consider in the next section </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">is stationarity.</span></span></p>
<h2 id="_idParaDest-23"><a id="_idTextAnchor022"/><span class="koboSpan" id="kobo.128.1">Stationary and non-stationary</span></h2>
<p><span class="koboSpan" id="kobo.129.1">Considering the </span><a id="_idIndexMarker006"/><span class="koboSpan" id="kobo.130.1">statistical properties </span><a id="_idIndexMarker007"/><span class="koboSpan" id="kobo.131.1">of time series over time, they can be further categorized as stationary </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">or non-stationary.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.133.1">Stationary time series</span></strong><span class="koboSpan" id="kobo.134.1"> are those </span><a id="_idIndexMarker008"/><span class="koboSpan" id="kobo.135.1">for which statistical properties such as mean and variance do not vary </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">over time.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.137.1">Non-stationary time series</span></strong><span class="koboSpan" id="kobo.138.1"> have changing statistical properties. </span><span class="koboSpan" id="kobo.138.2">These time series can be </span><a id="_idIndexMarker009"/><span class="koboSpan" id="kobo.139.1">converted to stationary by a combination of methods: for example, one or more orders of differencing to stabilize the mean and using the log value to stabilize the variance. </span><span class="koboSpan" id="kobo.139.2">This distinction is important as it will determine which analysis method can be used. </span><span class="koboSpan" id="kobo.139.3">For instance, if an analysis method is based on the assumption of stationary series, the above conversion can be applied to non-stationary data first. </span><span class="koboSpan" id="kobo.139.4">You will learn about the method to identify stationarity in </span><a href="B18568_06.xhtml#_idTextAnchor116"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.140.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.141.1"> on exploratory </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">data analysis.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.143.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.144.1">Converting a non-stationary time series to a stationary one removes the trend and seasonal components, which may not be what we want if we want to analyze </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">these components.</span></span></p>
<p><span class="koboSpan" id="kobo.146.1">This section was an important one to understand the underlying nature of time series, which is a prerequisite to identifying the right analysis method to use in the later part of this book. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.147.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.148.1">.2</span></em><span class="koboSpan" id="kobo.149.1"> summarizes the types of time series and conversation operations that can </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">be used.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<span class="koboSpan" id="kobo.151.1"><img alt="" src="image/B18568_01_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.152.1">Figure 1.2: Types of time series</span></p>
<p><span class="koboSpan" id="kobo.153.1">This concludes </span><a id="_idIndexMarker010"/><span class="koboSpan" id="kobo.154.1">the theoretical part of </span><a id="_idIndexMarker011"/><span class="koboSpan" id="kobo.155.1">this chapter. </span><span class="koboSpan" id="kobo.155.2">In the next section, we will have our first hands-on experience, setting up the coding environment along the way. </span><span class="koboSpan" id="kobo.155.3">We will start with visualizing and decomposing time series in this chapter. </span><span class="koboSpan" id="kobo.155.4">We will get into different types of time series analysis and when they are used in the </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">next chapter.</span></span></p>
<h1 id="_idParaDest-24"><a id="_idTextAnchor023"/><span class="koboSpan" id="kobo.157.1">Hands-on: Loading and visualizing time series</span></h1>
<p><span class="koboSpan" id="kobo.158.1">Let’s go </span><a id="_idIndexMarker012"/><span class="koboSpan" id="kobo.159.1">through the hands-on exercise to load a time series </span><a id="_idIndexMarker013"/><span class="koboSpan" id="kobo.160.1">dataset and visualize it. </span><span class="koboSpan" id="kobo.160.2">We will try to create the visual representation we’ve already seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.161.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.162.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">.</span></span></p>
<h2 id="_idParaDest-25"><a id="_idTextAnchor024"/><span class="koboSpan" id="kobo.164.1">Development environment</span></h2>
<p><span class="koboSpan" id="kobo.165.1">In order </span><a id="_idIndexMarker014"/><span class="koboSpan" id="kobo.166.1">to run the code, you will need </span><a id="_idIndexMarker015"/><span class="koboSpan" id="kobo.167.1">a Python development environment where you can install Apache Spark and other required libraries. </span><span class="koboSpan" id="kobo.167.2">Specific libraries will be detailed, together with installation instructions, in the corresponding chapters </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">when required.</span></span></p>
<h3><span class="koboSpan" id="kobo.169.1">PaaS</span></h3>
<p><span class="koboSpan" id="kobo.170.1">An easy way </span><a id="_idIndexMarker016"/><span class="koboSpan" id="kobo.171.1">to get going with these requirements is by using Databricks Community Edition, which is free. </span><span class="koboSpan" id="kobo.171.2">This comes with a notebook-based </span><a id="_idIndexMarker017"/><span class="koboSpan" id="kobo.172.1">development interface, as well as compute with pre-installed Spark and some </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">other libraries.</span></span></p>
<p><span class="koboSpan" id="kobo.174.1">The instructions </span><a id="_idIndexMarker018"/><span class="koboSpan" id="kobo.175.1">to sign up for Databricks Community Edition can be </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">found here:</span></span></p>
<p><a href="https://docs.databricks.com/en/getting-started/community-edition.html"><span class="No-Break"><span class="koboSpan" id="kobo.177.1">https://docs.databricks.com/en/getting-started/community-edition.html</span></span></a></p>
<p><span class="koboSpan" id="kobo.178.1">Community Edition’s compute size is limited as it is a free cloud-based PaaS. </span><span class="koboSpan" id="kobo.178.2">You can also sign up for a 14-day free trial of Databricks, which, depending on the signup option you choose, may require you to first have an account with a cloud provider. </span><span class="koboSpan" id="kobo.178.3">Some cloud providers may have promotions with some free credits at the start. </span><span class="koboSpan" id="kobo.178.4">This will give you access to more resources than on Community Edition, for a </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">limited time.</span></span></p>
<p><span class="koboSpan" id="kobo.180.1">Sign up </span><a id="_idIndexMarker019"/><span class="koboSpan" id="kobo.181.1">for the free trial to Databricks at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">URL: </span></span><a href="https://www.databricks.com/try-databricks"><span class="No-Break"><span class="koboSpan" id="kobo.183.1">https://www.databricks.com/try-databricks</span></span></a></p>
<p><span class="koboSpan" id="kobo.184.1">The folks at Databricks are the original creators of Apache Spark, so you will be in a good </span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">place there.</span></span></p>
<p><span class="koboSpan" id="kobo.186.1">The examples in the early chapters will use Community Edition and the open source version of Apache Spark. </span><span class="koboSpan" id="kobo.186.2">We will use the full Databricks platform in </span><a href="B18568_08.xhtml#_idTextAnchor151"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.187.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.188.1"> and </span><a href="B18568_10.xhtml#_idTextAnchor190"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.189.1">Chapter 10</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.190.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.191.1">Custom</span></h3>
<p><span class="koboSpan" id="kobo.192.1">Alternatively, you can build your own environment, setting up the full stack, for instance, in a Docker container. </span><span class="koboSpan" id="kobo.192.2">This will be covered in </span><a href="B18568_03.xhtml#_idTextAnchor063"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.193.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.194.1">, </span><em class="italic"><span class="koboSpan" id="kobo.195.1">Introduction to </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.196.1">Apache Spark</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.197.1">.</span></span></p>
<h2 id="_idParaDest-26"><a id="_idTextAnchor025"/><span class="koboSpan" id="kobo.198.1">Code</span></h2>
<p><span class="koboSpan" id="kobo.199.1">The code </span><a id="_idIndexMarker020"/><span class="koboSpan" id="kobo.200.1">for this section is in the following notebook file titled </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">ts-spark_ch1_1.dbc</span></strong><span class="koboSpan" id="kobo.202.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">ch1</span></strong><span class="koboSpan" id="kobo.204.1"> folder of this book’s GitHub repository, as per the </span><em class="italic"><span class="koboSpan" id="kobo.205.1">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.206.1">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.207.1"> section.</span></span></p>
<p><span class="koboSpan" id="kobo.208.1">The location URL is as </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">follows: </span></span><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch1/ts-spark_ch1_1.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.210.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch1/ts-spark_ch1_1.dbc</span></span></a></p>
<h2 id="_idParaDest-27"><a id="_idTextAnchor026"/><span class="koboSpan" id="kobo.211.1">Dataset</span></h2>
<p><span class="koboSpan" id="kobo.212.1">Once the </span><a id="_idIndexMarker021"/><span class="koboSpan" id="kobo.213.1">development and runtime environment are chosen, the other consideration is the dataset. </span><span class="koboSpan" id="kobo.213.2">The one we will be using is the observed annual average mean surface air temperature of Mauritius, available on the Climate Change Knowledge Portal </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">at </span></span><a href="https://climateknowledgeportal.worldbank.org/country/mauritius"><span class="No-Break"><span class="koboSpan" id="kobo.215.1">https://climateknowledgeportal.worldbank.org/country/mauritius</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.216.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.217.1">A copy of the dataset (in the file titled </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">ts-spark_ch1_ds1.csv</span></strong><span class="koboSpan" id="kobo.219.1">) is available in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">ch1</span></strong><span class="koboSpan" id="kobo.221.1"> GitHub folder. </span><span class="koboSpan" id="kobo.221.2">It can be downloaded using the code </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">mentioned earlier.</span></span></p>
<p><span class="koboSpan" id="kobo.223.1">Next, you will be working on the Databricks Community Edition workspace, which will be your own </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">self-contained environment.</span></span></p>
<h2 id="_idParaDest-28"><a id="_idTextAnchor027"/><span class="koboSpan" id="kobo.225.1">Step-by-step: Loading and visualizing time series</span></h2>
<p><span class="koboSpan" id="kobo.226.1">Now that </span><a id="_idIndexMarker022"/><span class="koboSpan" id="kobo.227.1">we have everything set up, let’s get our hands on </span><a id="_idIndexMarker023"/><span class="koboSpan" id="kobo.228.1">the first coding exercise. </span><span class="koboSpan" id="kobo.228.2">First, log in to Databricks Community Edition to import the code, create a cluster, and finally run </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">the code:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.230.1">Log in to Databricks Community Edition, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.231.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.232.1">.3</span></em><span class="koboSpan" id="kobo.233.1">, using your credentials as specified during the signup process. </span><span class="koboSpan" id="kobo.233.2">Access the login page at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">URL: </span></span><a href="https://community.cloud.databricks.com/"><span class="No-Break"><span class="koboSpan" id="kobo.235.1">https://community.cloud.databricks.com/</span></span></a><p class="list-inset"><span class="koboSpan" id="kobo.236.1">Refer to the </span><em class="italic"><span class="koboSpan" id="kobo.237.1">Development environment</span></em><span class="koboSpan" id="kobo.238.1"> section on how to sign up if you have not </span><a id="_idIndexMarker024"/><span class="koboSpan" id="kobo.239.1">already </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">done so.</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer013">
<span class="koboSpan" id="kobo.241.1"><img alt="" src="image/B18568_01_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.242.1">Figure 1.3: Sign in to Databricks Community Edition</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.243.1">Once </span><a id="_idIndexMarker025"/><span class="koboSpan" id="kobo.244.1">in the workspace, click on </span><strong class="bold"><span class="koboSpan" id="kobo.245.1">Create a notebook</span></strong><span class="koboSpan" id="kobo.246.1">. </span><span class="koboSpan" id="kobo.246.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.247.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.248.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer014">
<span class="koboSpan" id="kobo.250.1"><img alt="" src="image/B18568_01_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.251.1">Figure 1.4: Create a notebook</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.252.1">From here, we will get into the code, first importing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">ts-spark_ch1_1.dbc</span></strong><span class="koboSpan" id="kobo.254.1"> notebook provided for </span><a href="B18568_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.255.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.256.1"> on GitHub, as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.257.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.258.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.260.1"><img alt="" src="image/B18568_01_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.261.1">Figure 1.5: Import a notebook</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.262.1">Note that </span><a id="_idIndexMarker026"/><span class="koboSpan" id="kobo.263.1">you can either download the file from the </span><a id="_idIndexMarker027"/><span class="koboSpan" id="kobo.264.1">GitHub URL for </span><a href="B18568_01.xhtml#_idTextAnchor016"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.265.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.266.1">, provided in the </span><em class="italic"><span class="koboSpan" id="kobo.267.1">Technical requirements</span></em><span class="koboSpan" id="kobo.268.1"> section, to your local machines and then import it from there, or you can specify the following raw file URL for the import, as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.269.1">Figure </span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.270.1">1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.271.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">: </span></span><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch1/ts-spark_ch1_1.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.273.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch1/ts-spark_ch1_1.dbc</span></span></a></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer016">
<span class="koboSpan" id="kobo.274.1"><img alt="" src="image/B18568_01_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.275.1">Figure 1.6: Import a notebook from the file or URL</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.276.1">We get to the actual code at this point. </span><span class="koboSpan" id="kobo.276.2">You should now have a notebook with code as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.277.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.278.1">.7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.280.1"><img alt="" src="image/B18568_01_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.281.1">Figure 1.7: Notebook with code</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.282.1">Finally, let’s </span><a id="_idIndexMarker028"/><span class="koboSpan" id="kobo.283.1">run the code. </span><span class="koboSpan" id="kobo.283.2">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.284.1">Run all</span></strong><span class="koboSpan" id="kobo.285.1"> as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.286.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.287.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.289.1"><img alt="" src="image/B18568_01_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.290.1">Figure 1.8: Run all code in the notebook</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.291.1">In case you </span><a id="_idIndexMarker029"/><span class="koboSpan" id="kobo.292.1">do not have a cluster already started, you will have to create and start a new one. </span><span class="koboSpan" id="kobo.292.2">Note that clusters are automatically terminated when not in use on Databricks Community Edition, in which case you will see the </span><strong class="bold"><span class="koboSpan" id="kobo.293.1">Attached cluster is terminated</span></strong><span class="koboSpan" id="kobo.294.1"> message, as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.295.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.296.1">.9</span></em><span class="koboSpan" id="kobo.297.1">, and you will have to select </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">another resource.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer019">
<span class="koboSpan" id="kobo.299.1"><img alt="" src="image/B18568_01_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.300.1">Figure 1.9: Attached cluster is terminated</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.301.1">From this point, you can either attach to another active cluster (non-terminated one) or choose to create a new resource as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.302.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.303.1">.10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer020">
<span class="koboSpan" id="kobo.305.1"><img alt="" src="image/B18568_01_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.306.1">Figure 1.10: Compute – Create new resource</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.307.1">Next, you will </span><a id="_idIndexMarker030"/><span class="koboSpan" id="kobo.308.1">need to specify a name for the cluster and </span><a id="_idIndexMarker031"/><span class="koboSpan" id="kobo.309.1">which version of Spark you want to use, as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.310.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.311.1">.11</span></em><span class="koboSpan" id="kobo.312.1">. </span><span class="koboSpan" id="kobo.312.2">The recommendation here is to use the latest version unless, for portability to another environment reasons, you need the code to work with an </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">earlier version.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer021">
<span class="koboSpan" id="kobo.314.1"><img alt="" src="image/B18568_01_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.315.1">Figure 1.11: Compute – Create, Attach, &amp; Run</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.316.1">Once the cluster is created and started, which may take a few minutes in this free environment, the code will run, and you will see the chart in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.317.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.318.1">.1</span></em><span class="koboSpan" id="kobo.319.1">, toward the beginning of the chapter, as output. </span><span class="koboSpan" id="kobo.319.2">The graphical library used to create and display the chart provides you with an interactive interface, allowing you – for instance – to zoom into a specific </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">time period.</span></span></li>
<li><span class="koboSpan" id="kobo.321.1">As this is the first hands-on, we have gone into the step-by-step details. </span><span class="koboSpan" id="kobo.321.2">In future hands-on sections, we will be focusing on specific datasets and code as the rest will be very similar. </span><span class="koboSpan" id="kobo.321.3">Additional instructions will be provided whenever </span><span class="No-Break"><span class="koboSpan" id="kobo.322.1">they differ.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.323.1">Now that we </span><a id="_idIndexMarker032"/><span class="koboSpan" id="kobo.324.1">have executed the code, let’s go over the main </span><a id="_idIndexMarker033"/><span class="koboSpan" id="kobo.325.1">sections. </span><span class="koboSpan" id="kobo.325.2">We will keep it high level in this introductory section and go into further details in upcoming chapters once Apache Spark concepts have </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">been introduced:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.327.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">import</span></strong><span class="koboSpan" id="kobo.329.1"> statements add libraries for date format conversion and for </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">drawing graphs:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.331.1">
import pyspark.</span><strong class="bold"><span class="koboSpan" id="kobo.332.1">pandas</span></strong><span class="koboSpan" id="kobo.333.1"> as ps
import </span><strong class="bold"><span class="koboSpan" id="kobo.334.1">plotly</span></strong><span class="koboSpan" id="kobo.335.1">.express as px</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.336.1">We are using pandas, which is an open source data manipulation Python library – more specifically, the PySpark version, which is optimized </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">for Spark.</span></span></p><p class="list-inset"><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">Plotly</span></strong><span class="koboSpan" id="kobo.339.1">, a graphing library that enables interactive visualization, converts data points </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">into graphs.</span></span></p></li> <li><span class="koboSpan" id="kobo.341.1">We then use </span><strong class="source-inline"><span class="koboSpan" id="kobo.342.1">spark.read</span></strong><span class="koboSpan" id="kobo.343.1"> to read the CSV data file into </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">a table:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.345.1">
df1 = </span><strong class="bold"><span class="koboSpan" id="kobo.346.1">spark.read</span></strong><span class="koboSpan" id="kobo.347.1">.format("csv") \
    .option("header", "true") \
    .load("file:///" + SparkFiles.get(DATASET_FILE))
df1.createOrReplaceTempView("temperatures")</span></pre></li> <li><span class="koboSpan" id="kobo.348.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">spark.sql</span></strong><span class="koboSpan" id="kobo.350.1"> statement chooses a subset of the dataset based on the year column, named </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">Category</span></strong><span class="koboSpan" id="kobo.352.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">source dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.354.1">
df2 = </span><strong class="bold"><span class="koboSpan" id="kobo.355.1">spark.sql</span></strong><span class="koboSpan" id="kobo.356.1">("select to_date(Category) as year, float(`Annual Mean`) as annual_mean from temperatures where Category &gt; '1950'")</span></pre></li> <li><span class="koboSpan" id="kobo.357.1">Finally, we plot </span><a id="_idIndexMarker034"/><span class="koboSpan" id="kobo.358.1">the time series as well as the trendline based on </span><strong class="bold"><span class="koboSpan" id="kobo.359.1">Ordinary Least Squares</span></strong><span class="koboSpan" id="kobo.360.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.361.1">OLS</span></strong><span class="koboSpan" id="kobo.362.1">) regression, as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.363.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.364.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.366.1">
fig = px.</span><strong class="bold"><span class="koboSpan" id="kobo.367.1">scatter</span></strong><span class="koboSpan" id="kobo.368.1">(
    df2_pd, x="year", y="annual_mean",
    trendline="</span><strong class="bold"><span class="koboSpan" id="kobo.369.1">ols</span></strong><span class="koboSpan" id="kobo.370.1">", 
    title='Average Temperature - Mauritius (from 1950)'
)</span></pre></li> <li><span class="koboSpan" id="kobo.371.1">The plotting library used, </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">plotly</span></strong><span class="koboSpan" id="kobo.373.1">, allows interactivity on the user interface, such as mouseover information on the data points and zooming in </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">and out.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.375.1">From this </span><a id="_idIndexMarker035"/><span class="koboSpan" id="kobo.376.1">point on, feel free to experiment with the code and the </span><a id="_idIndexMarker036"/><span class="koboSpan" id="kobo.377.1">Databricks Community Edition environment, which we will be using for most of the initial chapters of </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">this book.</span></span></p>
<p><span class="koboSpan" id="kobo.379.1">In this section, you had your first introduction to time series and the coding environment, starting with a simple exercise. </span><span class="koboSpan" id="kobo.379.2">In the next section, we will go into detail about some of the concepts introduced so far and break down a time series into </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">its components.</span></span></p>
<h1 id="_idParaDest-29"><a id="_idTextAnchor028"/><span class="koboSpan" id="kobo.381.1">Breaking a time series down into its components</span></h1>
<p><span class="koboSpan" id="kobo.382.1">This section aims to further your understanding of a time series by analyzing its components </span><a id="_idIndexMarker037"/><span class="koboSpan" id="kobo.383.1">and detailing several terms introduced so far. </span><span class="koboSpan" id="kobo.383.2">This will set you on track for the rest of the book, to use the right methods based on the nature of the time series you </span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">are analyzing.</span></span></p>
<p><span class="koboSpan" id="kobo.385.1">Time series models can be broken down into three main components: trend, seasonality, </span><span class="No-Break"><span class="koboSpan" id="kobo.386.1">and residuals:</span></span></p>
<p><span class="koboSpan" id="kobo.387.1"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/1.png" style="vertical-align:-0.257em;height:0.968em;width:17.956em"/></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.388.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.389.1">The mathematical representations in this book will follow a simplified English notation, in favour of a broad audience. </span><span class="koboSpan" id="kobo.389.2">Refer to the following great resource on time series for mathematical formulations: </span><em class="italic"><span class="koboSpan" id="kobo.390.1">Forecasting: Principles and </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.391.1">Practice</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">: </span></span><a href="https://otexts.com/fpp3/"><span class="No-Break"><span class="koboSpan" id="kobo.393.1">https://otexts.com/fpp3/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.394.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.395.1">As you will see in the next hands-on section, this breakdown into components is derived from the model fitted to the time series data. </span><span class="koboSpan" id="kobo.395.2">For most real-life datasets, the breakdown is only an approximation of reality by the model. </span><span class="koboSpan" id="kobo.395.3">As such, each model will come up with its own identification and approximation of the components. </span><span class="koboSpan" id="kobo.395.4">The whole idea is to find the best model </span><a id="_idIndexMarker038"/><span class="koboSpan" id="kobo.396.1">that fits the time series. </span><span class="koboSpan" id="kobo.396.2">This is what we will be building up to and covering in </span><a href="B18568_07.xhtml#_idTextAnchor133"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.397.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.398.1"> on building and </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">testing models.</span></span></p>
<p><span class="koboSpan" id="kobo.400.1">Let’s go over each of the components, defining what they mean and visualizing them based on an example dataset, as in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.401.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.402.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer023">
<span class="koboSpan" id="kobo.404.1"><img alt="" src="image/B18568_01_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.405.1">Figure 1.12: Time series decomposition</span></p>
<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/><span class="koboSpan" id="kobo.406.1">Systematic and non-systematic components</span></h2>
<p><span class="koboSpan" id="kobo.407.1">The level, trend, seasonality, and cycle are called the </span><strong class="bold"><span class="koboSpan" id="kobo.408.1">systematic</span></strong><span class="koboSpan" id="kobo.409.1"> components. </span><span class="koboSpan" id="kobo.409.2">They represent </span><a id="_idIndexMarker039"/><span class="koboSpan" id="kobo.410.1">the underlying structure of the </span><a id="_idIndexMarker040"/><span class="koboSpan" id="kobo.411.1">time series, which can be modeled and </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">hence forecast.</span></span></p>
<p><span class="koboSpan" id="kobo.413.1">In addition to </span><a id="_idIndexMarker041"/><span class="koboSpan" id="kobo.414.1">the systematic components, there is a </span><strong class="bold"><span class="koboSpan" id="kobo.415.1">non-systematic</span></strong><span class="koboSpan" id="kobo.416.1"> part that cannot be modeled, which is called residual, noise, or error. </span><span class="koboSpan" id="kobo.416.2">The goal </span><a id="_idIndexMarker042"/><span class="koboSpan" id="kobo.417.1">of time series modeling is to find the model with the best match for the systematic components while minimizing </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">the residuals.</span></span></p>
<p><span class="koboSpan" id="kobo.419.1">We will now go into the details of each of the systematic and </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">non-systematic parts.</span></span></p>
<h3><span class="koboSpan" id="kobo.421.1">Level</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.422.1">Level</span></strong><span class="koboSpan" id="kobo.423.1">, also </span><a id="_idIndexMarker043"/><span class="koboSpan" id="kobo.424.1">referred to as the base level, is the mean of </span><a id="_idIndexMarker044"/><span class="koboSpan" id="kobo.425.1">the series, acting as a baseline on which the effects of the other components are added. </span><span class="koboSpan" id="kobo.425.2">Sometimes, it is explicitly added to the preceding formula as an additional component. </span><span class="koboSpan" id="kobo.425.3">However, the level is not always shown in the formula, as it may not be the primary focus of the analysis, or the decomposition method may implicitly account for it within </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">other components.</span></span></p>
<h3><span class="koboSpan" id="kobo.427.1">Trend</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.428.1">Trend</span></strong><span class="koboSpan" id="kobo.429.1"> is the </span><a id="_idIndexMarker045"/><span class="koboSpan" id="kobo.430.1">component indicating the general direction </span><a id="_idIndexMarker046"/><span class="koboSpan" id="kobo.431.1">in which the values in the time series go over a time period: increasing, decreasing, or flat. </span><span class="koboSpan" id="kobo.431.2">This change can be linear, as in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.432.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.433.1">.1</span></em><span class="koboSpan" id="kobo.434.1"> and </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.435.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.436.1">.12</span></em><span class="koboSpan" id="kobo.437.1">, or non-linear. </span><span class="koboSpan" id="kobo.437.2">The trend itself can change at different points in time, as what we can refer to as trend changepoints. </span><span class="koboSpan" id="kobo.437.3">More broadly, changepoints refer to points on the timeline when the statistical properties of the time series change. </span><span class="koboSpan" id="kobo.437.4">This can have a significant impact on the model parameters or even the model we use to analyze the </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">time series.</span></span></p>
<h3><span class="koboSpan" id="kobo.439.1">Seasonalities and cycles</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.440.1">Seasonality</span></strong><span class="koboSpan" id="kobo.441.1"> indicates </span><a id="_idIndexMarker047"/><span class="koboSpan" id="kobo.442.1">changes to a time series at </span><a id="_idIndexMarker048"/><span class="koboSpan" id="kobo.443.1">regular time intervals. </span><span class="koboSpan" id="kobo.443.2">This is usually due to seasonal calendar events. </span><span class="koboSpan" id="kobo.443.3">Using our example with temperature, every summer month the temperature goes up compared to the rest of the year, and down during the winter months, as can be seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.444.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.445.1">.12</span></em><span class="koboSpan" id="kobo.446.1">. </span><span class="koboSpan" id="kobo.446.2">Similarly, a time series for sales of gift items will likely show an increase in sales every Christmas period in its </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">seasonality pattern.</span></span></p>
<p><span class="koboSpan" id="kobo.448.1">Multiple </span><a id="_idIndexMarker049"/><span class="koboSpan" id="kobo.449.1">seasonalities (intervals and amplitudes) can </span><a id="_idIndexMarker050"/><span class="koboSpan" id="kobo.450.1">have a combined effect within the same time series, as illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.451.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.452.1">.13</span></em><span class="koboSpan" id="kobo.453.1">. </span><span class="koboSpan" id="kobo.453.2">For example, with temperatures, in addition to the ups and downs of summers and winters, the temperature goes up during the day and down </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">every night.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer024">
<span class="koboSpan" id="kobo.455.1"><img alt="" src="image/B18568_01_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.456.1">Figure 1.13: Multiple overlapping seasonalities (synthetic data)</span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.457.1">Cycles</span></strong><span class="koboSpan" id="kobo.458.1"> are changes </span><a id="_idIndexMarker051"/><span class="koboSpan" id="kobo.459.1">that happen at intervals, similar to </span><a id="_idIndexMarker052"/><span class="koboSpan" id="kobo.460.1">seasonality, with the difference of being at irregular intervals. </span><span class="koboSpan" id="kobo.460.2">Cycles in time series are reflective of external cycles impacting the series. </span><span class="koboSpan" id="kobo.460.3">For example, recessions occur every certain number of years and have an impact on economic indicators. </span><span class="koboSpan" id="kobo.460.4">We don’t know when in advance and it is different from the seasonality of Christmas, which just occurs predictably every </span><span class="No-Break"><span class="koboSpan" id="kobo.461.1">December 25.</span></span></p>
<h4><span class="koboSpan" id="kobo.462.1">Remainders or residuals</span></h4>
<p><strong class="bold"><span class="koboSpan" id="kobo.463.1">Remainders</span></strong><span class="koboSpan" id="kobo.464.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.465.1">residuals</span></strong><span class="koboSpan" id="kobo.466.1"> are </span><a id="_idIndexMarker053"/><span class="koboSpan" id="kobo.467.1">what remains once </span><a id="_idIndexMarker054"/><span class="koboSpan" id="kobo.468.1">the model </span><a id="_idIndexMarker055"/><span class="koboSpan" id="kobo.469.1">has accounted </span><a id="_idIndexMarker056"/><span class="koboSpan" id="kobo.470.1">for trends, seasonalities, and </span><a id="_idIndexMarker057"/><span class="koboSpan" id="kobo.471.1">cycles. </span><span class="koboSpan" id="kobo.471.2">Remainders </span><a id="_idIndexMarker058"/><span class="koboSpan" id="kobo.472.1">can be modeled using </span><strong class="bold"><span class="koboSpan" id="kobo.473.1">autoregression</span></strong><span class="koboSpan" id="kobo.474.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.475.1">AR</span></strong><span class="koboSpan" id="kobo.476.1">) or </span><strong class="bold"><span class="koboSpan" id="kobo.477.1">moving average</span></strong><span class="koboSpan" id="kobo.478.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.479.1">MA</span></strong><span class="koboSpan" id="kobo.480.1">) methods. </span><span class="koboSpan" id="kobo.480.2">What is still residual at this point, also referred to as noise or error, is random in nature and is the part that can’t be modeled. </span><span class="koboSpan" id="kobo.480.3">You can visualize residuals in the topmost graph of </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.481.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.482.1">.12</span></em><span class="koboSpan" id="kobo.483.1">, as the distance between the data points and the </span><a id="_idIndexMarker059"/><span class="koboSpan" id="kobo.484.1">modeled line. </span><span class="koboSpan" id="kobo.484.2">We will look at the method </span><a id="_idIndexMarker060"/><span class="koboSpan" id="kobo.485.1">to test for residuals in </span><a href="B18568_06.xhtml#_idTextAnchor116"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.486.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.487.1"> on exploratory </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">data analysis.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.489.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.490.1">While with </span><a id="_idIndexMarker061"/><span class="koboSpan" id="kobo.491.1">residuals only a component of the </span><a id="_idIndexMarker062"/><span class="koboSpan" id="kobo.492.1">time series is random, a whole series can be completely random or can be a random walk. </span><span class="koboSpan" id="kobo.492.2">A completely random series will have no dependency on earlier time values, whereas for a random walk, the value at time </span><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">t</span></strong><span class="koboSpan" id="kobo.494.1"> is dependent on the value at </span><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">t-1</span></strong><span class="koboSpan" id="kobo.496.1"> (plus some drift and a </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">random component).</span></span></p>
<h3><span class="koboSpan" id="kobo.498.1">Additive or multiplicative</span></h3>
<p><span class="koboSpan" id="kobo.499.1">Time series </span><a id="_idIndexMarker063"/><span class="koboSpan" id="kobo.500.1">can be </span><strong class="bold"><span class="koboSpan" id="kobo.501.1">additive</span></strong><span class="koboSpan" id="kobo.502.1"> (the preceding formula) or </span><strong class="bold"><span class="koboSpan" id="kobo.503.1">multiplicative</span></strong><span class="koboSpan" id="kobo.504.1">. </span><span class="koboSpan" id="kobo.504.2">In </span><a id="_idIndexMarker064"/><span class="koboSpan" id="kobo.505.1">the first case, the </span><a id="_idIndexMarker065"/><span class="koboSpan" id="kobo.506.1">seasonality and residual components are not dependent </span><a id="_idIndexMarker066"/><span class="koboSpan" id="kobo.507.1">on the trend. </span><span class="koboSpan" id="kobo.507.2">In the second case, they change with the trend and can be seen as changing amplitude of the seasonal component – for example, higher peaks and </span><span class="No-Break"><span class="koboSpan" id="kobo.508.1">lower troughs.</span></span></p>
<p><span class="koboSpan" id="kobo.509.1">Now that we have gone through the components of time series, let’s put this into practice </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">with code.</span></span></p>
<h2 id="_idParaDest-31"><a id="_idTextAnchor030"/><span class="koboSpan" id="kobo.511.1">Hands-on: Decomposing time series</span></h2>
<p><span class="koboSpan" id="kobo.512.1">To demonstrate </span><strong class="bold"><span class="koboSpan" id="kobo.513.1">time series decomposition</span></strong><span class="koboSpan" id="kobo.514.1">, we will be going through the code to create the </span><a id="_idIndexMarker067"/><span class="koboSpan" id="kobo.515.1">data visualization in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.516.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.517.1">.12</span></em><span class="koboSpan" id="kobo.518.1">. </span><span class="koboSpan" id="kobo.518.2">The code for this </span><a id="_idIndexMarker068"/><span class="koboSpan" id="kobo.519.1">section is in the notebook file </span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">titled </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">ts-spark_ch1_2fp.dbc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.523.1">The location URL is as </span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">follows: </span></span><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch1/ts-spark_ch1_2fp.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.525.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch1/ts-spark_ch1_2fp.dbc</span></span></a></p>
<p><span class="koboSpan" id="kobo.526.1">The dataset we will be using is the daily minimum temperature from 1981 to 1990 in Melbourne, Australia, originally from the Australian Bureau of Meteorology, and available on Kaggle at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">URL: </span></span><a href="https://www.kaggle.com/datasets/samfaraday/daily-minimum-temperatures-in-me"><span class="No-Break"><span class="koboSpan" id="kobo.528.1">https://www.kaggle.com/datasets/samfaraday/daily-minimum-temperatures-in-me</span></span></a></p>
<p><span class="koboSpan" id="kobo.529.1">A copy of the dataset is provided in the GitHub folder under the </span><span class="No-Break"><span class="koboSpan" id="kobo.530.1">name </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">ts-spark_ch1_ds2.csv</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.533.1">We will keep it high-level in this chapter, with selected extracts from the notebook, and go into further details in upcoming chapters once further concepts of forecasting models have </span><span class="No-Break"><span class="koboSpan" id="kobo.534.1">been introduced:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.535.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">import</span></strong><span class="koboSpan" id="kobo.537.1"> statements add libraries for forecasting models and for </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">drawing graphs:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.539.1">
from prophet </span><strong class="bold"><span class="koboSpan" id="kobo.540.1">import</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.541.1">Prophet</span></strong><span class="koboSpan" id="kobo.542.1">
from prophet.plot import plot_plotly, plot_components_plotly</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.543.1">The forecasting </span><a id="_idIndexMarker069"/><span class="koboSpan" id="kobo.544.1">library used is </span><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">Prophet</span></strong><span class="koboSpan" id="kobo.546.1">, which is </span><a id="_idIndexMarker070"/><span class="koboSpan" id="kobo.547.1">an open source library by Facebook. </span><span class="koboSpan" id="kobo.547.2">It is accessible to both experts and non-experts, providing automatic forecasting for time </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">series data.</span></span></p></li> <li><span class="koboSpan" id="kobo.549.1">We then use </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">spark.read</span></strong><span class="koboSpan" id="kobo.551.1"> to read the CSV data file into </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">a table:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.553.1">
df1 = </span><strong class="bold"><span class="koboSpan" id="kobo.554.1">spark.read</span></strong><span class="koboSpan" id="kobo.555.1">.format("csv") \
    .option("header", "true") \
    .load("file:///" + SparkFiles.get(DATASET_FILE))
df1.createOrReplaceTempView("temperatures")</span></pre></li> <li><span class="koboSpan" id="kobo.556.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">spark.sql</span></strong><span class="koboSpan" id="kobo.558.1"> statement converts the </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">date</span></strong><span class="koboSpan" id="kobo.560.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">daily_min_temperature</span></strong><span class="koboSpan" id="kobo.562.1"> columns into the correct format and column name, which is required </span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.564.1">Prophet</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.566.1">
df2 = spark.sql("select to_date(date) as ds, float(daily_min_temperature) as y from temperatures sort by ds asc")</span></pre></li> <li><span class="koboSpan" id="kobo.567.1">We then use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">Prophet</span></strong><span class="koboSpan" id="kobo.569.1"> library to create a forecasting model on the basis of a seasonality of 12 months and fit it to </span><span class="No-Break"><span class="koboSpan" id="kobo.570.1">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.571.1">
model = </span><strong class="bold"><span class="koboSpan" id="kobo.572.1">Prophet</span></strong><span class="koboSpan" id="kobo.573.1">(
    n_changepoints=20, 
    yearly_seasonality=True,
    changepoint_prior_scale=0.001)
model.</span><strong class="bold"><span class="koboSpan" id="kobo.574.1">fit</span></strong><span class="koboSpan" id="kobo.575.1">(df2_pd)</span></pre></li> <li><span class="koboSpan" id="kobo.576.1">The model is then used to predict temperatures for </span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">future dates:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.578.1">
future_dates = model.make_future_dataframe(
    periods=365, freq='D')
forecast = model.</span><strong class="bold"><span class="koboSpan" id="kobo.579.1">predict</span></strong><span class="koboSpan" id="kobo.580.1">(future_dates)</span></pre></li> <li><span class="koboSpan" id="kobo.581.1">Finally, we plot </span><a id="_idIndexMarker071"/><span class="koboSpan" id="kobo.582.1">the components of the time series as </span><a id="_idIndexMarker072"/><span class="koboSpan" id="kobo.583.1">identified by the model, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.584.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.585.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.587.1">plot</span></strong><span class="koboSpan" id="kobo.588.1">_components_plotly(model, forecast)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.589.1">Now that we have had a basic discussion on components and forecasting, let’s explore the case of </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">overlapping seasonalities.</span></span></p>
<h1 id="_idParaDest-32"><a id="_idTextAnchor031"/><span class="koboSpan" id="kobo.591.1">Multiple overlapping seasonalities</span></h1>
<p><span class="koboSpan" id="kobo.592.1">We will </span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.593.1">be going through the code to create the data visualization in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.594.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.595.1">.13</span></em><span class="koboSpan" id="kobo.596.1">. </span><span class="koboSpan" id="kobo.596.2">The code for this section is </span><a id="_idIndexMarker074"/><span class="koboSpan" id="kobo.597.1">in the notebook file </span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">ts-spark_ch1_3.dbc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.600.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.601.1">The location URL is as </span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">follows: </span></span><a href="https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch1/ts-spark_ch1_3.dbc"><span class="No-Break"><span class="koboSpan" id="kobo.603.1">https://github.com/PacktPublishing/Time-Series-Analysis-with-Spark/raw/main/ch1/ts-spark_ch1_3.dbc</span></span></a></p>
<p><span class="koboSpan" id="kobo.604.1">The dataset is synthetic and generated as three different sine curves representing three </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">overlapping seasonalities.</span></span></p>
<p><span class="koboSpan" id="kobo.606.1">The following code is an extract from the notebook. </span><span class="koboSpan" id="kobo.606.2">Let’s look at it at a </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">high level:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.608.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">import</span></strong><span class="koboSpan" id="kobo.610.1"> statements add libraries for numerical calculations and for </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1">drawing graphs:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.612.1">import</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.613.1">numpy</span></strong><span class="koboSpan" id="kobo.614.1"> as np
from plotly.subplots import make_subplots</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.615.1">NumPy is an open source Python library for scientific computing significantly more efficient in terms of computation and memory use than standard Python. </span><span class="koboSpan" id="kobo.615.2">We will use it here for its </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">mathematical functions.</span></span></p></li> <li><span class="koboSpan" id="kobo.617.1">We </span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.618.1">then generate </span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.619.1">a number of sine curves, using </span><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">np.sin</span></strong><span class="koboSpan" id="kobo.621.1">, to represent different seasonalities and add </span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">them together:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.623.1">
(amp, freq) = (</span><strong class="bold"><span class="koboSpan" id="kobo.624.1">3</span></strong><span class="koboSpan" id="kobo.625.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.626.1">0.33</span></strong><span class="koboSpan" id="kobo.627.1">)
seasonality1 = amp * </span><strong class="bold"><span class="koboSpan" id="kobo.628.1">np.sin</span></strong><span class="koboSpan" id="kobo.629.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.630.1">2</span></strong><span class="koboSpan" id="kobo.631.1"> * np.pi * freq * time_period)
(amp, freq) = (</span><strong class="bold"><span class="koboSpan" id="kobo.632.1">2</span></strong><span class="koboSpan" id="kobo.633.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.634.1">1</span></strong><span class="koboSpan" id="kobo.635.1">)
seasonality2 = amp * np.sin(</span><strong class="bold"><span class="koboSpan" id="kobo.636.1">2</span></strong><span class="koboSpan" id="kobo.637.1"> * np.pi * freq * time_period)
(amp, freq) = (</span><strong class="bold"><span class="koboSpan" id="kobo.638.1">1</span></strong><span class="koboSpan" id="kobo.639.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.640.1">4</span></strong><span class="koboSpan" id="kobo.641.1">)
seasonality3 = amp * np.sin(</span><strong class="bold"><span class="koboSpan" id="kobo.642.1">2</span></strong><span class="koboSpan" id="kobo.643.1"> * np.pi * freq * time_period)
combined = seasonality1 + seasonality2 + seasonality3</span></pre></li> <li><span class="koboSpan" id="kobo.644.1">Finally, we plot the individual seasonalities as well as the combined one, as per </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.645.1">Figure 1</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.646.1">.13</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.647.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.648.1">
fig = make_subplots(rows=</span><strong class="bold"><span class="koboSpan" id="kobo.649.1">4</span></strong><span class="koboSpan" id="kobo.650.1">, cols=</span><strong class="bold"><span class="koboSpan" id="kobo.651.1">1</span></strong><span class="koboSpan" id="kobo.652.1">, shared_xaxes=True)
fig.add_scatter(
    x=time_period, y=seasonality1, 
    row=</span><strong class="bold"><span class="koboSpan" id="kobo.653.1">1</span></strong><span class="koboSpan" id="kobo.654.1">, col=</span><strong class="bold"><span class="koboSpan" id="kobo.655.1">1</span></strong><span class="koboSpan" id="kobo.656.1">, name=</span><strong class="bold"><span class="koboSpan" id="kobo.657.1">f"seasonality 1"</span></strong><span class="koboSpan" id="kobo.658.1">)
fig.add_scatter(
    x=time_period, y=seasonality2, 
    row=</span><strong class="bold"><span class="koboSpan" id="kobo.659.1">2</span></strong><span class="koboSpan" id="kobo.660.1">, col=</span><strong class="bold"><span class="koboSpan" id="kobo.661.1">1</span></strong><span class="koboSpan" id="kobo.662.1">, name=</span><strong class="bold"><span class="koboSpan" id="kobo.663.1">f"seasonality 2"</span></strong><span class="koboSpan" id="kobo.664.1">)
fig.add_scatter(
    x=time_period, y=seasonality3, 
    row=</span><strong class="bold"><span class="koboSpan" id="kobo.665.1">3</span></strong><span class="koboSpan" id="kobo.666.1">, col=</span><strong class="bold"><span class="koboSpan" id="kobo.667.1">1</span></strong><span class="koboSpan" id="kobo.668.1">, name=</span><strong class="bold"><span class="koboSpan" id="kobo.669.1">f"seasonality 3"</span></strong><span class="koboSpan" id="kobo.670.1">)
fig.add_scatter(
    x=time_period, y=combined, 
    row=</span><strong class="bold"><span class="koboSpan" id="kobo.671.1">4</span></strong><span class="koboSpan" id="kobo.672.1">, col=</span><strong class="bold"><span class="koboSpan" id="kobo.673.1">1</span></strong><span class="koboSpan" id="kobo.674.1">, name=</span><strong class="bold"><span class="koboSpan" id="kobo.675.1">f"combined"</span></strong><span class="koboSpan" id="kobo.676.1">)fig.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.677.1">From here on, feel free to experiment with the full code in </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">the notebooks.</span></span></p></li> </ol>
<p><span class="koboSpan" id="kobo.679.1">In this </span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.680.1">section, we started our </span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.681.1">journey analyzing time series, probing the underlying structure, and paving the way for further analysis with the most appropriate method based on their nature. </span><span class="koboSpan" id="kobo.681.2">In the next section, we will cover several key considerations and challenges to factor into </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">our journey.</span></span></p>
<h1 id="_idParaDest-33"><a id="_idTextAnchor032"/><span class="koboSpan" id="kobo.683.1">Additional considerations with time series analysis</span></h1>
<p><span class="koboSpan" id="kobo.684.1">This section is probably the most important in this early part of the book. </span><span class="koboSpan" id="kobo.684.2">In the introductory section, we mentioned some key considerations for time series, such as the preservation </span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.685.1">of chronological order, regularity, and stationarity. </span><span class="koboSpan" id="kobo.685.2">Here, we map out the key challenges and additional considerations when analyzing time series in real-life projects. </span><span class="koboSpan" id="kobo.685.3">In doing so, it allows you to plan your learning and practice accordingly, with guidance in the relevant sections of this book as well as </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">further reading.</span></span></p>
<p><span class="koboSpan" id="kobo.687.1">According to </span><em class="italic"><span class="koboSpan" id="kobo.688.1">Hidden Technical Debt in Machine Learning Systems</span></em><span class="koboSpan" id="kobo.689.1"> a well-known paper published in 2015, only a fraction of the effort is with the code in advanced analytics projects. </span><span class="koboSpan" id="kobo.689.2">The rest of the time is mostly spent on other considerations such as data preparation </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">and infrastructure.</span></span></p>
<p><span class="koboSpan" id="kobo.691.1">The solutions to these challenges are very specific to your context. </span><span class="koboSpan" id="kobo.691.2">The aim in this chapter is to bring these considerations, as summarized in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.692.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.693.1">.14</span></em><span class="koboSpan" id="kobo.694.1">, to </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">your awareness.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer025">
<span class="koboSpan" id="kobo.696.1"><img alt="" src="image/B18568_01_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.697.1">Figure 1.14: Considerations and challenges with time series analysis</span></p>
<p><span class="koboSpan" id="kobo.698.1">While the </span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.699.1">majority of these considerations are shared in common with non-time-series analytics such as machine learning, time series analysis tends to be the most challenging of advanced analytics methods. </span><span class="koboSpan" id="kobo.699.2">We will go into detail on some of the solutions to these challenges in the rest of </span><span class="No-Break"><span class="koboSpan" id="kobo.700.1">the book.</span></span></p>
<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/><span class="koboSpan" id="kobo.701.1">Facing data challenges</span></h2>
<p><span class="koboSpan" id="kobo.702.1">As with </span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.703.1">all data science and machine learning projects, data is key. </span><span class="koboSpan" id="kobo.703.2">The analysis you run and the model you build are going to be only as good as the data. </span><span class="koboSpan" id="kobo.703.3">Data challenges are varied and very dependent on your own specific context and dataset. </span></p>
<p><span class="koboSpan" id="kobo.704.1">We will list some of the common </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">ones here:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.706.1">Access</span></strong><span class="koboSpan" id="kobo.707.1"> to data is probably where it all starts. </span><span class="koboSpan" id="kobo.707.2">For the purpose of this book, we will be using several freely accessible datasets, so this will not be an issue. </span><span class="koboSpan" id="kobo.707.3">In real-life projects, the ownership of the dataset you need may sit in another part of your organization or even with another organization altogether. </span><span class="koboSpan" id="kobo.707.4">In this case, you will have to go through the process of acquiring the dataset, potentially at a financial cost, and transferring it reliably, with acceptable speed and freshness. </span><span class="koboSpan" id="kobo.707.5">The transfer pipeline will have its own cost to build as well as the transfer cost itself. </span><span class="koboSpan" id="kobo.707.6">The transfer mechanism will have to be production grade to support operational requirements: robust, recoverable, monitored, and </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">so on.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.709.1">Initially, your data access requirement will be for exploratory data analysis and model training. </span><span class="koboSpan" id="kobo.709.2">A batch dump may be sufficient. </span><span class="koboSpan" id="kobo.709.3">Moving to production, you may need access to the data in real or near-real time. </span><span class="koboSpan" id="kobo.709.4">The considerations then are </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">vastly different.</span></span></p></li>
</ul>
<p><span class="koboSpan" id="kobo.711.1">Once data </span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.712.1">is ingested, the next requirement is to store it in a secure and usable way. </span><span class="koboSpan" id="kobo.712.2">Using a specialized time series database is an option that is optimized for performance, though for the majority of cases, general-purpose storage </span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">is sufficient:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.714.1">Sensitivity</span></strong><span class="koboSpan" id="kobo.715.1"> is another key aspect. </span><span class="koboSpan" id="kobo.715.2">Again, here, there will likely be different requirements in development and production. </span><span class="koboSpan" id="kobo.715.3">In many cases, though, a subset of production </span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.716.1">data is used in development and testing. </span><span class="koboSpan" id="kobo.716.2">Certain columns with </span><strong class="bold"><span class="koboSpan" id="kobo.717.1">Personally Identifiable Information</span></strong><span class="koboSpan" id="kobo.718.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.719.1">PII</span></strong><span class="koboSpan" id="kobo.720.1">) will require masking or encryption to comply with regulations such as GDPR in Europe. </span><span class="koboSpan" id="kobo.720.2">In highly sensitive cases, the whole dataset may be encrypted. </span><span class="koboSpan" id="kobo.720.3">This can be a challenge for large-scale processing, as every access to data may require decryption and re-encryption. </span><span class="koboSpan" id="kobo.720.4">This will have a </span><span class="No-Break"><span class="koboSpan" id="kobo.721.1">processing overhead.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.722.1">In summary, end-to-end security and data governance will be high on your requirement list, and this starts from day one. </span><span class="koboSpan" id="kobo.722.2">You want to avoid security and compliance risks at all stages, including during development, even more so if you are dealing with sensitive data. </span></p></li>
<li><span class="koboSpan" id="kobo.723.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.724.1">volume</span></strong><span class="koboSpan" id="kobo.725.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.726.1">frequency</span></strong><span class="koboSpan" id="kobo.727.1"> of data feeds at high volume in real or near-real time will require the right platform to enable quick processing without data loss. </span><span class="koboSpan" id="kobo.727.2">This may not be initially apparent in a pre-production environment due to the smaller scale. </span><span class="koboSpan" id="kobo.727.3">Performance and reliability issues then tend to surface late when ramping up in production. </span><span class="koboSpan" id="kobo.727.4">We will discuss scaling and streaming once we have introduced Apache Spark, which will help you avoid </span><span class="No-Break"><span class="koboSpan" id="kobo.728.1">such issues.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.729.1">Data quality</span></strong><span class="koboSpan" id="kobo.730.1"> is a challenge we will face very early on, as soon as data access is resolved, and we start working with the data during the exploratory phase and in development. </span><span class="koboSpan" id="kobo.730.2">Challenges include gaps in data, corrupt data, noisy data, and – even more pertinent for time series – delayed and out-of-order data. </span><span class="koboSpan" id="kobo.730.3">As mentioned in the earlier section, it is important to preserve the chronological order for time series data. </span><span class="koboSpan" id="kobo.730.4">We will go further into resolving data quality issues when we discuss </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">data preparation.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.732.1">Moving </span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.733.1">on from the data challenges, the next area of focus is choosing the right approach and model for the problem that </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">needs solving.</span></span></p>
<h2 id="_idParaDest-35"><a id="_idTextAnchor034"/><span class="koboSpan" id="kobo.735.1">Using the right model</span></h2>
<p><span class="koboSpan" id="kobo.736.1">This may be more of a challenge for those new to time series. </span><span class="koboSpan" id="kobo.736.2">As we have seen so far, time series </span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.737.1">have different statistical properties. </span><span class="koboSpan" id="kobo.737.2">Some analysis and modeling methods are created based on assumptions about the statistical properties of time series, with stationarity as a common assumption. </span><span class="koboSpan" id="kobo.737.3">The method used will not work as intended or lead to misleading results if used with the incorrect type of time series. </span><span class="koboSpan" id="kobo.737.4">Handling multiple overlapping seasonalities, assuming you have identified them in the first place, can also be a challenge for some methods. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.738.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.739.1">.14</span></em><span class="koboSpan" id="kobo.740.1"> gives a recap of the types of time series and analytical models. </span><span class="koboSpan" id="kobo.740.2">The choice of model will be discussed further in </span><a href="B18568_07.xhtml#_idTextAnchor133"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.741.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.742.1">, </span><em class="italic"><span class="koboSpan" id="kobo.743.1">Building and </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.744.1">Testing Models</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.745.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.746.1">Selecting the right model is also very much dependent on what we want to achieve as an outcome, whether it is forecasting one or many time steps into the future, or analyzing one (univariate) or more (multivariate) series at the same time. </span><span class="koboSpan" id="kobo.746.2">For some domains, such as regulated industries, there is usually an additional requirement for explainability, which can be difficult with some models, such as black-box models. </span><span class="koboSpan" id="kobo.746.3">We will go further into the outcomes of time series analysis and choosing the right model, including for anomaly and pattern detection, in addition to predictive modeling, in the next chapter on why time </span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">series matter.</span></span></p>
<h2 id="_idParaDest-36"><a id="_idTextAnchor035"/><span class="koboSpan" id="kobo.748.1">Maintaining spatial and temporal hierarchy</span></h2>
<p><span class="koboSpan" id="kobo.749.1">Note that another key consideration is the hierarchy in which the data is collected and analyzed. </span><span class="koboSpan" id="kobo.749.2">This needs to be consistent between different levels. </span><span class="koboSpan" id="kobo.749.3">To illustrate this point, let’s use </span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.750.1">an example of time series forecasting of the sales volume of different products by a multi-store retailer. </span><span class="koboSpan" id="kobo.750.2">Spatial hierarchies here will likely be at product and product category levels, as well as at specific stores and regional levels. </span><span class="koboSpan" id="kobo.750.3">Temporal hierarchies will correspond to sales every hour, every day, every quarter, and so on. </span><span class="koboSpan" id="kobo.750.4">The challenge in this case is to ensure the consistency of forecasts for individual products and product categories, as well as, say, daily forecasts adding up and being consistent with the </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1">quarterly forecast.</span></span></p>
<p><span class="koboSpan" id="kobo.752.1">Finally, the right model depends on the volume of data as we will see in our discussion on building models in </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">later chapters.</span></span></p>
<h2 id="_idParaDest-37"><a id="_idTextAnchor036"/><span class="koboSpan" id="kobo.754.1">Tackling scalability </span></h2>
<p><span class="koboSpan" id="kobo.755.1">There are </span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.756.1">primarily two factors impacting scalability: data volume and processing complexity. </span><span class="koboSpan" id="kobo.756.2">Earlier, we discussed data volume as a data challenge. </span><span class="koboSpan" id="kobo.756.3">Let’s consider </span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.757.1">processing complexity here. </span><strong class="bold"><span class="koboSpan" id="kobo.758.1">Complexity</span></strong><span class="koboSpan" id="kobo.759.1"> can arise from the extent of data transformations required to prepare the data for use, as well as the number, hierarchy, and size of models that need to </span><span class="No-Break"><span class="koboSpan" id="kobo.760.1">be managed:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.761.1">Large number and complex hierarchy of models</span></strong><span class="koboSpan" id="kobo.762.1">: As you work on actual projects, it will not be uncommon for you to have to run tens to even thousands of models in parallel within a relatively short time period – say, if you work in a store and need to forecast the next day’s sales and stock level for each of the thousands of items sold in the store. </span><span class="koboSpan" id="kobo.762.2">This need for parallelism is one of the key reasons for using Apache Spark, as we will see further in </span><span class="No-Break"><span class="koboSpan" id="kobo.763.1">this book.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.764.1">Size of the model</span></strong><span class="koboSpan" id="kobo.765.1">: Another requirement for scalability comes from the size of the model itself, which can be very large and have high compute requirements if we are using deep learning techniques with many layers </span><span class="No-Break"><span class="koboSpan" id="kobo.766.1">and nodes.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.767.1">We will dedicate a whole chapter to scaling later in </span><span class="No-Break"><span class="koboSpan" id="kobo.768.1">the book.</span></span></p>
<h2 id="_idParaDest-38"><a id="_idTextAnchor037"/><span class="koboSpan" id="kobo.769.1">Approaching real time</span></h2>
<p><span class="koboSpan" id="kobo.770.1">Earlier, we identified high-frequency data as a significant data challenge. </span><span class="koboSpan" id="kobo.770.2">Approaching real time </span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.771.1">requires not just data-level adjustments but also a processing pipeline designed to handle such demands. </span><span class="koboSpan" id="kobo.771.2">Typically, models are trained on a batch of data collected over time, before being deployed for tasks such as forecasting or anomaly detection, where real-time processing becomes critical. </span><span class="koboSpan" id="kobo.771.3">For instance, in detecting fraudulent transactions, it’s essential to identify anomalies as close to the event occurrence as possible. </span><span class="koboSpan" id="kobo.771.4">A viable solution for near-instant data processing is Apache Spark Structured Streaming, a topic we’ll explore when we discuss Apache Spark later in </span><span class="No-Break"><span class="koboSpan" id="kobo.772.1">the book.</span></span></p>
<h2 id="_idParaDest-39"><a id="_idTextAnchor038"/><span class="koboSpan" id="kobo.773.1">Managing production</span></h2>
<p><span class="koboSpan" id="kobo.774.1">The preceding considerations apply to the production environment as well. </span><span class="koboSpan" id="kobo.774.2">In addition, moving the </span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.775.1">developed solution into a production environment has several specific requirements. </span><span class="koboSpan" id="kobo.775.2">These can cause challenges if not </span><span class="No-Break"><span class="koboSpan" id="kobo.776.1">managed properly.</span></span></p>
<p><span class="koboSpan" id="kobo.777.1">Once the right model has been trained and is ready for use, the next step is to package it together with any required API wrapper, as well as the data pipeline and model-consuming application code. </span><span class="koboSpan" id="kobo.777.2">This means an end-to-end process involving DataOps, ModelOps, and DevOps. </span><span class="koboSpan" id="kobo.777.3">We will go into more on these in</span><em class="italic"> </em><a href="B18568_09.xhtml#_idTextAnchor169"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.778.1">Chapter 9</span></em></span></a><em class="italic"> </em><span class="koboSpan" id="kobo.779.1">when we </span><span class="No-Break"><span class="koboSpan" id="kobo.780.1">discuss production.</span></span></p>
<h2 id="_idParaDest-40"><a id="_idTextAnchor039"/><span class="koboSpan" id="kobo.781.1">Monitoring and addressing drift</span></h2>
<p><span class="koboSpan" id="kobo.782.1">Once a </span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.783.1">model is in use, changes happen over time, resulting in the model not being fit for purpose anymore. </span><span class="koboSpan" id="kobo.783.2">These changes are broadly categorized </span><span class="No-Break"><span class="koboSpan" id="kobo.784.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.785.1">Changes </span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.786.1">in the nature of the dataset (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.787.1">data drift</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.788.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.789.1">Changes in </span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.790.1">the relationship between input and output (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.791.1">concept drift</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.792.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.793.1">Unexpected events such as COVID, or impactful events missed out during the modeling process (</span><strong class="bold"><span class="koboSpan" id="kobo.794.1">sudden drift</span></strong><span class="koboSpan" id="kobo.795.1">, a type of </span><span class="No-Break"><span class="koboSpan" id="kobo.796.1">concept drift)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.797.1">These drifts </span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.798.1">will impact the model’s performance and, as such, need to be monitored. </span><span class="koboSpan" id="kobo.798.2">The solution in this case is usually to retrain the model on the new data or find a new model with better performance on the </span><span class="No-Break"><span class="koboSpan" id="kobo.799.1">updated dataset.</span></span></p>
<p><span class="koboSpan" id="kobo.800.1">This section </span><a id="_idIndexMarker095"/><span class="koboSpan" id="kobo.801.1">gave an overview of the considerations and challenges when working with time series. </span><span class="koboSpan" id="kobo.801.2">There are lots of commonalities with working on other datasets, so the guidance here will be useful in a broader context. </span><span class="koboSpan" id="kobo.801.3">As we saw in the introductory section, though, time series have their own set of </span><span class="No-Break"><span class="koboSpan" id="kobo.802.1">specific considerations.</span></span></p>
<h1 id="_idParaDest-41"><a id="_idTextAnchor040"/><span class="koboSpan" id="kobo.803.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.804.1">Time series are everywhere, and this chapter gave us an introduction to what they are, their components, and the challenges in working with them. </span><span class="koboSpan" id="kobo.804.2">We started with some simple code to explore time series, setting the foundation for further practice in upcoming chapters. </span><span class="koboSpan" id="kobo.804.3">The concepts discussed in this first chapter will be built upon to get us to the point of analyzing time series at scale by the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.805.1">this book.</span></span></p>
<p><span class="koboSpan" id="kobo.806.1">Now that you understand the “what” for time series, in the next chapter, we will be looking at the “why,” which will pave the way to applications in </span><span class="No-Break"><span class="koboSpan" id="kobo.807.1">various domains.</span></span></p>
<h1 id="_idParaDest-42"><a id="_idTextAnchor041"/><span class="koboSpan" id="kobo.808.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.809.1">This section serves as a repository of sources that can help you build on your understanding of </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">the topic:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.811.1">Climate Chaos Helped Spark the French </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.812.1">Revolution</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">: </span></span><a href="https://time.com/6107671/french-revolution-history-climate/"><span class="No-Break"><span class="koboSpan" id="kobo.814.1">https://time.com/6107671/french-revolution-history-climate/</span></span></a></li>
<li><span class="koboSpan" id="kobo.815.1">Databricks Community </span><span class="No-Break"><span class="koboSpan" id="kobo.816.1">Edition: </span></span><a href="https://docs.databricks.com/en/getting-started/community-edition.html"><span class="No-Break"><span class="koboSpan" id="kobo.817.1">https://docs.databricks.com/en/getting-started/community-edition.html</span></span></a></li>
<li><span class="koboSpan" id="kobo.818.1">Climate Change K</span><a id="_idTextAnchor042"/><span class="koboSpan" id="kobo.819.1">nowledge </span><span class="No-Break"><span class="koboSpan" id="kobo.820.1">Portal: </span></span><a href="https://climateknowledgeportal.worldbank.org/country/mauritius"><span class="No-Break"><span class="koboSpan" id="kobo.821.1">https://climateknowledgeportal.worldbank.org/country/mauritius</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.822.1">Forecasting: Principles and Practice</span></em><span class="koboSpan" id="kobo.823.1"> by Rob J Hyndman and George </span><span class="No-Break"><span class="koboSpan" id="kobo.824.1">Athanasopoulos: </span></span><a href="https://otexts.com/fpp3/"><span class="No-Break"><span class="koboSpan" id="kobo.825.1">https://otexts.com/fpp3/</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.826.1">Hidden Technical Debt in Machine Learning Systems</span></em><span class="koboSpan" id="kobo.827.1"> (Sculley et al., </span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">2015): </span></span><a href="https://papers.neurips.cc/paper/5656-hidden-technical-debt-in-machine-learning-systems.pdf"><span class="No-Break"><span class="koboSpan" id="kobo.829.1">https://papers.neurips.cc/paper/5656-hidden-technical-debt-in-machine-learning-systems.pdf</span></span></a></li>
</ul>
<h1 id="_idParaDest-43"><a id="_idTextAnchor043"/><span class="koboSpan" id="kobo.830.1">Join our community on Discord</span></h1>
<p><span class="koboSpan" id="kobo.831.1">Join our community’s Discord space for discussions with the authors and </span><span class="No-Break"><span class="koboSpan" id="kobo.832.1">other readers:</span></span></p>
<p><a href="https://packt.link/ds"><span class="No-Break"><span class="koboSpan" id="kobo.833.1">https://packt.link/ds</span></span></a></p>
<div>
<div class="IMG---Figure" id="_idContainer026">
<span class="koboSpan" id="kobo.834.1"><img alt="" src="image/ds_(1).jpg"/></span>
</div>
</div>
</div>
<div>
<div epub:type="chapter" id="_idContainer028">
</div>
</div>
</body></html>