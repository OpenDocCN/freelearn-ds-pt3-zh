<html><head></head><body>
		<div id="_idContainer122">
			<h1 id="_idParaDest-119"><em class="italic"><a id="_idTextAnchor122"/>Chapter 11</em>: Using Streamlit for Teams</h1>
			<p>Throughout the past two chapters, we have deeply explored how to use Streamlit for things such as personal data projects, projects for resume building, and even for creating apps for take-home job applications. In this chapter, we will focus on using Streamlit at your place of work, as a data scientist, machine learning engineer, or data analyst. We already know that Streamlit can be used as a convincing tool to influence those around us through thoughtful and interactive analyses, and we will work on applying that to the work data scientists actually do. </p>
			<p>Streamlit is both a company and an open source library and makes revenue by being such an excellent tool in a data science toolkit that companies are convinced to pay for special features and customizations that increase the productivity of their own data scientists. The best part about this is that the company is directly incentivized to make the experience of using the tool as useful and valuable as possible; if you're a better data scientist because of Streamlit, your company is more likely to pay more for access. </p>
			<p>Additionally, Streamlit is already designed to be collaborative. If another developer has access to a GitHub repository that is being used for a Streamlit app, then any edits they make will pop up on the deployed app automatically. Because of this, Streamlit is a natural collaborative fit for both individual data scientists and groups of data science teams working on similar analyses or applications. </p>
			<p>In this chapter, we will discuss the following:</p>
			<ul>
				<li>Analyzing hypothetical survey costs using Streamlit for Teams</li>
				<li>Creating and deploying apps from private repositories </li>
				<li>User authentication with Streamlit</li>
			</ul>
			<p>To kick us off for this chapter, we will start with an example of when we would use Streamlit for Teams instead of static analysis at work.</p>
			<h1 id="_idParaDest-120"><a id="_idTextAnchor123"/>Analyzing hypothetical survey costs using Streamlit for Teams </h1>
			<p>Imagine<a id="_idIndexMarker408"/> you are a data scientist for <strong class="bold">Big Internet Company</strong> (<strong class="bold">BIC</strong>). BIC <a id="_idIndexMarker409"/>sells budgeting software to users, and you are <a id="_idIndexMarker410"/>responsible for surveying the users of your app to see where the app could be improved. You work with a fairly typical team made up of a product manager, two software engineers, three project managers, two user experience researchers, and yourself, the lone data scientist. One day, your product manager messages you on Slack and asks you to figure out the right sample of users between the ages of 16 and 24, a crucial segment of the business, to take a 10-question survey about the software. In a brainstorming session, your researchers have found some evidence that giving people a 10% chance at winning a $500 gift card is more effective than giving people $50 for the response rates in your survey, and want you to incorporate that into your analysis. </p>
			<p>There are many factors that you need to consider here: how much does the team want to spend? How many samples should we choose? The hardest part here is the trade-off between cost and the representativeness of the sample. We have a few options. We could recommend a sample size without really informing the team why we are recommending a sample size. We could also give the team a few options on costs, describing some of the pros and cons in a list. A better option than any of these is to create a short Streamlit app that will help us make this decision as a team to understand all the trade-offs. </p>
			<p>Let's say that we want to do the latter! Our general steps here are going to be to do the following:</p>
			<ol>
				<li>Setting up a new Streamlit app folder</li>
				<li>Illustrating the representativeness of the sample</li>
				<li>Calculating the cost of the sample</li>
				<li>Using interaction to show trade-offs </li>
			</ol>
			<p>Now we need to start with the first option, setting up our folder.</p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor124"/>Setting up a new Streamlit app folder</h2>
			<p>We have taken <a id="_idIndexMarker411"/>this step quite a few times in this book before. Go ahead and set up a folder called <strong class="source-inline">random_survey_app</strong> and place within it a file called <strong class="source-inline">app.py</strong>, where we will put our new Streamlit app. Now on to the central problem at hand!</p>
			<h2 id="_idParaDest-122"><a id="_idTextAnchor125"/>Illustrating the representativeness of the sample</h2>
			<p>If we are the <a id="_idIndexMarker412"/>data scientist for BIC, we know a lot of data about the user population in question. We want to make sure that the sample we grab is representative of the population as a whole, especially in reference to one or more key variables of the business. For this example, we can assume that the most important metric to the business is user time spent on our app. We already know the distribution of user time spent and can represent that within our app using the following code: </p>
			<p class="source-code">import streamlit as st</p>
			<p class="source-code">import numpy as np</p>
			<p class="source-code">st.title('Deciding Survey Sample Size')</p>
			<p class="source-code">np.random.seed(1)</p>
			<p class="source-code">user_time_spent = np.random.normal(50.5, 10, 1000)</p>
			<p>We are using the <strong class="source-inline">np.random.seed(1)</strong> line so that you will see the same sample as the figures in this book, but when developing a user-facing app, I would recommend leaving this out, otherwise clever users will be more suspicious about your random selection methods! Setting a seed in <strong class="source-inline">numpy</strong> allows reproducible results with randomly selected data. </p>
			<p>Now that we know the distribution of the user time spent on the app, we can show the user how representative different-sized sub-samples will be by drawing the two distributions of user time spent next to each other. While this is not the best method for determining representativeness, it is going to be useful to prove the general point to your audience. The <a id="_idIndexMarker413"/>next code block sub-samples 100 from the set of 1,000 samples, and plots each in a histogram: </p>
			<p class="source-code">import streamlit as st</p>
			<p class="source-code">import numpy as np</p>
			<p class="source-code">import plotly.express as px</p>
			<p class="source-code">st.title('Deciding Survey Sample Size')</p>
			<p class="source-code">np.random.seed(1)</p>
			<p class="source-code">user_time_spent = np.random.normal(50.5, 10, 1000)</p>
			<p class="source-code">my_sample = np.random.choice(user_time_spent, 100)</p>
			<p class="source-code">fig = px.histogram(user_time_spent, title='Total Time Spent')</p>
			<p class="source-code">fig.update_traces(xbins=dict(start=0,end=100, size=5))</p>
			<p class="source-code">st.plotly_chart(fig)</p>
			<p class="source-code">fig = px.histogram(my_sample, title='Sample Time Spent')</p>
			<p class="source-code">fig.update_traces(xbins=dict(start=0,end=100, size=5))</p>
			<p class="source-code">st.plotly_chart(fig)</p>
			<p>This code block will <a id="_idIndexMarker414"/>produce the following app, showing that at 100 users, it looks fairly representative of the total time spent: </p>
			<div>
				<div id="_idContainer115" class="IMG---Figure">
					<img src="image/B16864_11_1.jpg" alt="Figure 11.1 – Survey sample size&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.1 – Survey sample size</p>
			<p>Now we need to<a id="_idIndexMarker415"/> figure out the trade-off – how to determine the cost of a set sample of users.</p>
			<h2 id="_idParaDest-123"><a id="_idTextAnchor126"/>Calculating the cost of the sample</h2>
			<p>As we <a id="_idIndexMarker416"/>discussed before, we can calculate the cost of the sample by looking at the number of survey respondents multiplied by the cost of each one. The cost of any individual survey respondent is a 10% chance at a $500 gift card, so we should show the expected value as 10% times $500, which is $50 on average. We should also be able to say, <em class="italic">what percent of the time does the cost of the experiment fall below some dollar amount?</em> dynamically, to assure the group of the costing risks associated with the randomness. </p>
			<p>We can calculate and print out the expected cost using the following code: </p>
			<p class="source-code">np.random.seed(1)</p>
			<p class="source-code">num_surveys = 100</p>
			<p class="source-code">user_time_spent = np.random.normal(50.5, 10, 1000)</p>
			<p class="source-code">my_sample = np.random.choice(user_time_spent, num_surveys)</p>
			<p class="source-code">expected_cost = 50 * num_surveys</p>
			<p class="source-code">st.write(f'The expected cost of this sample is {expected_cost}')</p>
			<p>Once we have this, we can<a id="_idIndexMarker417"/> simulate this survey running 10,000 times and count how often the cost of the experiment goes over a certain value, which we call <strong class="source-inline">max_cost</strong> in the next code block. We use the <strong class="source-inline">numpy</strong> library again to sample from the binomial distribution, which is the number of successes given a set of independent events with the same probability (for example, if you flipped a coin 10 times, how many times it would land on heads): </p>
			<p class="source-code">np.random.seed(1)</p>
			<p class="source-code">num_surveys = 100</p>
			<p class="source-code">user_time_spent = np.random.normal(50.5, 10, 1000)</p>
			<p class="source-code">my_sample = np.random.choice(user_time_spent, num_surveys)</p>
			<p class="source-code">#costing section</p>
			<p class="source-code">expected_cost = 50 * num_surveys</p>
			<p class="source-code">max_amount = 5000</p>
			<p class="source-code">percent_change_over = 100 * sum(np.random.binomial(num_surveys, 0.1, 10000) &gt; max_amount/500)/10000</p>
			<p class="source-code">st.write(f'The expected cost of this sample is {expected_cost}')</p>
			<p class="source-code">st.write(f'The percent chance the cost goes over {max_amount} is {percent_change_over}')</p>
			<p>For our survey <a id="_idIndexMarker418"/>size of 100 and a max cost of $5,000, the expected cost is $5,000 and the cost goes over our limit ~41% of the time: </p>
			<div>
				<div id="_idContainer116" class="IMG---Figure">
					<img src="image/B16864_11_2.jpg" alt="Figure 11.2 – Expected cost of survey&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.2 – Expected cost of survey</p>
			<p>Now that we<a id="_idIndexMarker419"/> have all the set pieces, we need to actually make this interactive with Streamlit features. </p>
			<h2 id="_idParaDest-124"><a id="_idTextAnchor127"/>Using interaction to show trade-offs </h2>
			<p>In order <a id="_idIndexMarker420"/>to make this app better than a static analysis, we need to let the user interact with our app. We can do this in two ways, first by allowing the user to change the number of people surveyed, and second by changing the max cost variable we assigned. We can do both of those things using the following code block: </p>
			<p class="source-code">st.title('Deciding Survey Sample Size')</p>
			<p class="source-code">np.random.seed(1)</p>
			<p class="source-code">num_surveys = 100</p>
			<p class="source-code">num_surveys = st.slider(label='Number of Surveys Sent', </p>
			<p class="source-code">     min_value=5, max_value=150, value=50)</p>
			<p class="source-code">max_amount = st.number_input(label='What is the max you want to spend?', </p>
			<p class="source-code">     value=num_surveys*50, step=500)</p>
			<p class="source-code">user_time_spent = np.random.normal(50.5, 10, 1000)</p>
			<p class="source-code">my_sample = np.random.choice(user_time_spent, num_surveys)</p>
			<p>In this block, we set a <a id="_idIndexMarker421"/>minimum and maximum value for the Streamlit slider, and also set the default value for the maximum amount to be the expected value to make it easier for the user as they change the number of surveys. We should also add some text above this to instruct the user how to interact with our app, as shown in the following addition to the app: </p>
			<p class="source-code">st.title('Deciding Survey Sample Size')</p>
			<p class="source-code">'''</p>
			<p class="source-code">Please use the following app to see how </p>
			<p class="source-code">representative and expensive a set sample</p>
			<p class="source-code">is for our survey design. </p>
			<p class="source-code">'''</p>
			<p class="source-code">np.random.seed(1)</p>
			<p class="source-code">num_surveys = 100</p>
			<p>These two additions to our app produce the following screenshot: </p>
			<div>
				<div id="_idContainer117" class="IMG---Figure">
					<img src="image/B16864_11_3.jpg" alt="Figure 11.3 – Streamlit sliders with costing&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.3 – Streamlit sliders with costing</p>
			<p>So far, this works<a id="_idIndexMarker422"/> perfectly fine. However, because you are working for a company, you want to make sure that none of this information in the app is released to the public or any competitors. Because of this, deploying this app publicly is not an option, and we need to figure out how to privately deploy the application. In <a href="B16864_09_Final_VK_ePub.xhtml#_idTextAnchor094"><em class="italic">Chapter 9</em></a>, <em class="italic">Improving Job Applications with Streamlit</em>, we discussed how to make our applications private with password protection, but Streamlit for Teams also allows us to deploy from private GitHub repositories, which is the topic of our next section. </p>
			<h1 id="_idParaDest-125"><a id="_idTextAnchor128"/>Creating and deploying apps from private repositories</h1>
			<p>One great feature of the<a id="_idIndexMarker423"/> Streamlit for Teams product is the ability to use Streamlit Sharing from private GitHub repositories. This works exactly the same as how we learned in <a href="B16864_05_Final_VK_ePub.xhtml#_idTextAnchor056"><em class="italic">Chapter 5</em></a>, <em class="italic">Deploying Streamlit with Streamlit Sharing</em>, but from a private rather than a public repository. To make this change, you will need to have access to Streamlit Teams or get access from the Streamlit team (they might just let you try it out if you ask nicely!). </p>
			<p>To create a private <a id="_idIndexMarker424"/>GitHub repo, head over to <a href="https://github.com/new">https://github.com/new</a> and make sure to click the <strong class="bold">Private</strong> rather than <strong class="bold">Public</strong> option, as shown in the next screenshot: </p>
			<div>
				<div id="_idContainer118" class="IMG---Figure">
					<img src="image/B16864_11_4.jpg" alt="Figure 11.4 – Private repository on GitHub&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.4 – Private repository on GitHub</p>
			<p>And after we add our current code to our GitHub repository, we can deploy on Streamlit Sharing just as we normally would, by going over to <a href="https://share.streamlit.io">https://share.streamlit.io</a> and following the directions for one-click deployment. I have deployed this Streamlit app using my own private repo, and the Streamlit app can be found at <a href="https://share.streamlit.io/tylerjrichards/random_survey_app/main/app.py">https://share.streamlit.io/tylerjrichards/random_survey_app/main/app.py</a>. Our next problem to work on is finding alternatives to the password method that we have already explored, with user-specific authentication with Streamlit. </p>
			<h1 id="_idParaDest-126"><a id="_idTextAnchor129"/>User authentication with Streamlit</h1>
			<p>One feature<a id="_idIndexMarker425"/> currently in beta on Streamlit for Teams but with an expected release date of late 2021 is Google-based <strong class="bold">single sign-on</strong> (<strong class="bold">SSO</strong>) authentication <a id="_idIndexMarker426"/>for our applications. This will allow us to make our app<a id="_idIndexMarker427"/> totally private, only viewable by users that we put on an allow list. The first step we need to take is to link our own Google account, by heading over to <a href="https://share.streamlit.io">https://share.streamlit.io</a> and clicking on <strong class="bold">Settings</strong> in the top-right corner. Once we are there, we will see the screen shown in the next screenshot:  </p>
			<div>
				<div id="_idContainer119" class="IMG---Figure">
					<img src="image/B16864_11_5.jpg" alt="Figure 11.5 – Linking Google accounts&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.5 – Linking Google accounts</p>
			<p>We can now click the blue <strong class="bold">Connect</strong> button and then sign in to our Google account. Once that is finished, we need to head over to our main page at <a href="https://share.streamlit.io">https://share.streamlit.io</a> and figure out which app we want to restrict traffic to: </p>
			<div>
				<div id="_idContainer120" class="IMG---Figure">
					<img src="image/B16864_11_6.jpg" alt="Figure 11.6 – Streamlit sharing options&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.6 – Streamlit sharing options</p>
			<p>In this case, I want to limit the reach of the second app, so I will go to the settings of this app by clicking the icon on the far-right side of the page and selecting <strong class="bold">Settings</strong>, as we have done before. </p>
			<p>Before we connected<a id="_idIndexMarker428"/> our Google account, we only had the option to edit <a id="_idIndexMarker429"/>the <strong class="bold">Secrets</strong> sections of our apps, but now we have this entirely new section called <strong class="bold">Viewers</strong>, as shown in the next screenshot: </p>
			<div>
				<div id="_idContainer121" class="IMG---Figure">
					<img src="image/B16864_11_7.jpg" alt="Figure 11.7 – Viewers auth&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.7 – Viewers auth</p>
			<p>We can set our<a id="_idIndexMarker430"/> app to private with the checkbox and add people<a id="_idIndexMarker431"/> with their email to this list. If they are not on the list, they will get a 404 error when trying to reach the app! This works extraordinarily well for a smaller number of users but does not work as well if you are trying to reach hundreds or thousands of users, especially those who do not have Google-related email accounts. </p>
			<h1 id="_idParaDest-127"><a id="_idTextAnchor130"/>Summary</h1>
			<p>In this chapter, we explored an example costing analysis, which showed us a job-specific use case for Streamlit. In this example, we discussed how to use interactive Streamlit applications to help improve and inform the data-based decision making of teams. After that, we also learned how to deploy Streamlit applications from private GitHub repositories, and we learned about multiple methods to make our Streamlit applications only available to a private audience with password protection and Google SSO. This concludes the chapter. </p>
			<p>In the next chapter, we will focus on interviews with power Streamlit users and creators to learn tips and tricks, why they use Streamlit so extensively, and also where they think the library will go from here. See you there!</p>
		</div>
	</body></html>